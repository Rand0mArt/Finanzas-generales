(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const Ml="modulepreload",Ll=function(s){return"/Finanzas-generales/"+s},Qn={},te=function(t,e,i){let n=Promise.resolve();if(e&&e.length>0){let c=function(h){return Promise.all(h.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};var o=c;document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");n=c(e.map(h=>{if(h=Ll(h),h in Qn)return;Qn[h]=!0;const u=h.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${d}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":Ml,u||(f.as="script"),f.crossOrigin="",f.href=h,l&&f.setAttribute("nonce",l),document.head.appendChild(f),u)return new Promise((p,g)=>{f.addEventListener("load",p),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${h}`)))})}))}function r(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return n.then(a=>{for(const l of a||[])l.status==="rejected"&&r(l.reason);return t().catch(r)})};function Cs(s){return s+.5|0}const Gt=(s,t,e)=>Math.max(Math.min(s,e),t);function ns(s){return Gt(Cs(s*2.55),0,255)}function Zt(s){return Gt(Cs(s*255),0,255)}function Nt(s){return Gt(Cs(s/2.55)/100,0,1)}function tr(s){return Gt(Cs(s*100),0,100)}const wt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},sn=[..."0123456789ABCDEF"],Dl=s=>sn[s&15],Il=s=>sn[(s&240)>>4]+sn[s&15],Ls=s=>(s&240)>>4===(s&15),jl=s=>Ls(s.r)&&Ls(s.g)&&Ls(s.b)&&Ls(s.a);function $l(s){var t=s.length,e;return s[0]==="#"&&(t===4||t===5?e={r:255&wt[s[1]]*17,g:255&wt[s[2]]*17,b:255&wt[s[3]]*17,a:t===5?wt[s[4]]*17:255}:(t===7||t===9)&&(e={r:wt[s[1]]<<4|wt[s[2]],g:wt[s[3]]<<4|wt[s[4]],b:wt[s[5]]<<4|wt[s[6]],a:t===9?wt[s[7]]<<4|wt[s[8]]:255})),e}const Nl=(s,t)=>s<255?t(s):"";function Bl(s){var t=jl(s)?Dl:Il;return s?"#"+t(s.r)+t(s.g)+t(s.b)+Nl(s.a,t):void 0}const Fl=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function ta(s,t,e){const i=t*Math.min(e,1-e),n=(r,o=(r+s/30)%12)=>e-i*Math.max(Math.min(o-3,9-o,1),-1);return[n(0),n(8),n(4)]}function Ul(s,t,e){const i=(n,r=(n+s/60)%6)=>e-e*t*Math.max(Math.min(r,4-r,1),0);return[i(5),i(3),i(1)]}function Wl(s,t,e){const i=ta(s,1,.5);let n;for(t+e>1&&(n=1/(t+e),t*=n,e*=n),n=0;n<3;n++)i[n]*=1-t-e,i[n]+=t;return i}function zl(s,t,e,i,n){return s===n?(t-e)/i+(t<e?6:0):t===n?(e-s)/i+2:(s-t)/i+4}function An(s){const e=s.r/255,i=s.g/255,n=s.b/255,r=Math.max(e,i,n),o=Math.min(e,i,n),a=(r+o)/2;let l,c,h;return r!==o&&(h=r-o,c=a>.5?h/(2-r-o):h/(r+o),l=zl(e,i,n,h,r),l=l*60+.5),[l|0,c||0,a]}function On(s,t,e,i){return(Array.isArray(t)?s(t[0],t[1],t[2]):s(t,e,i)).map(Zt)}function Cn(s,t,e){return On(ta,s,t,e)}function Vl(s,t,e){return On(Wl,s,t,e)}function Hl(s,t,e){return On(Ul,s,t,e)}function ea(s){return(s%360+360)%360}function ql(s){const t=Fl.exec(s);let e=255,i;if(!t)return;t[5]!==i&&(e=t[6]?ns(+t[5]):Zt(+t[5]));const n=ea(+t[2]),r=+t[3]/100,o=+t[4]/100;return t[1]==="hwb"?i=Vl(n,r,o):t[1]==="hsv"?i=Hl(n,r,o):i=Cn(n,r,o),{r:i[0],g:i[1],b:i[2],a:e}}function Kl(s,t){var e=An(s);e[0]=ea(e[0]+t),e=Cn(e),s.r=e[0],s.g=e[1],s.b=e[2]}function Gl(s){if(!s)return;const t=An(s),e=t[0],i=tr(t[1]),n=tr(t[2]);return s.a<255?`hsla(${e}, ${i}%, ${n}%, ${Nt(s.a)})`:`hsl(${e}, ${i}%, ${n}%)`}const er={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},sr={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Jl(){const s={},t=Object.keys(sr),e=Object.keys(er);let i,n,r,o,a;for(i=0;i<t.length;i++){for(o=a=t[i],n=0;n<e.length;n++)r=e[n],a=a.replace(r,er[r]);r=parseInt(sr[o],16),s[a]=[r>>16&255,r>>8&255,r&255]}return s}let Ds;function Yl(s){Ds||(Ds=Jl(),Ds.transparent=[0,0,0,0]);const t=Ds[s.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const Xl=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Zl(s){const t=Xl.exec(s);let e=255,i,n,r;if(t){if(t[7]!==i){const o=+t[7];e=t[8]?ns(o):Gt(o*255,0,255)}return i=+t[1],n=+t[3],r=+t[5],i=255&(t[2]?ns(i):Gt(i,0,255)),n=255&(t[4]?ns(n):Gt(n,0,255)),r=255&(t[6]?ns(r):Gt(r,0,255)),{r:i,g:n,b:r,a:e}}}function Ql(s){return s&&(s.a<255?`rgba(${s.r}, ${s.g}, ${s.b}, ${Nt(s.a)})`:`rgb(${s.r}, ${s.g}, ${s.b})`)}const Ri=s=>s<=.0031308?s*12.92:Math.pow(s,1/2.4)*1.055-.055,Ce=s=>s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4);function tc(s,t,e){const i=Ce(Nt(s.r)),n=Ce(Nt(s.g)),r=Ce(Nt(s.b));return{r:Zt(Ri(i+e*(Ce(Nt(t.r))-i))),g:Zt(Ri(n+e*(Ce(Nt(t.g))-n))),b:Zt(Ri(r+e*(Ce(Nt(t.b))-r))),a:s.a+e*(t.a-s.a)}}function Is(s,t,e){if(s){let i=An(s);i[t]=Math.max(0,Math.min(i[t]+i[t]*e,t===0?360:1)),i=Cn(i),s.r=i[0],s.g=i[1],s.b=i[2]}}function sa(s,t){return s&&Object.assign(t||{},s)}function ir(s){var t={r:0,g:0,b:0,a:255};return Array.isArray(s)?s.length>=3&&(t={r:s[0],g:s[1],b:s[2],a:255},s.length>3&&(t.a=Zt(s[3]))):(t=sa(s,{r:0,g:0,b:0,a:1}),t.a=Zt(t.a)),t}function ec(s){return s.charAt(0)==="r"?Zl(s):ql(s)}class ps{constructor(t){if(t instanceof ps)return t;const e=typeof t;let i;e==="object"?i=ir(t):e==="string"&&(i=$l(t)||Yl(t)||ec(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=sa(this._rgb);return t&&(t.a=Nt(t.a)),t}set rgb(t){this._rgb=ir(t)}rgbString(){return this._valid?Ql(this._rgb):void 0}hexString(){return this._valid?Bl(this._rgb):void 0}hslString(){return this._valid?Gl(this._rgb):void 0}mix(t,e){if(t){const i=this.rgb,n=t.rgb;let r;const o=e===r?.5:e,a=2*o-1,l=i.a-n.a,c=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;r=1-c,i.r=255&c*i.r+r*n.r+.5,i.g=255&c*i.g+r*n.g+.5,i.b=255&c*i.b+r*n.b+.5,i.a=o*i.a+(1-o)*n.a,this.rgb=i}return this}interpolate(t,e){return t&&(this._rgb=tc(this._rgb,t._rgb,e)),this}clone(){return new ps(this.rgb)}alpha(t){return this._rgb.a=Zt(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=Cs(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Is(this._rgb,2,t),this}darken(t){return Is(this._rgb,2,-t),this}saturate(t){return Is(this._rgb,1,t),this}desaturate(t){return Is(this._rgb,1,-t),this}rotate(t){return Kl(this._rgb,t),this}}function Dt(){}const sc=(()=>{let s=0;return()=>s++})();function L(s){return s==null}function q(s){if(Array.isArray&&Array.isArray(s))return!0;const t=Object.prototype.toString.call(s);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function D(s){return s!==null&&Object.prototype.toString.call(s)==="[object Object]"}function J(s){return(typeof s=="number"||s instanceof Number)&&isFinite(+s)}function yt(s,t){return J(s)?s:t}function P(s,t){return typeof s>"u"?t:s}const ic=(s,t)=>typeof s=="string"&&s.endsWith("%")?parseFloat(s)/100:+s/t,ia=(s,t)=>typeof s=="string"&&s.endsWith("%")?parseFloat(s)/100*t:+s;function z(s,t,e){if(s&&typeof s.call=="function")return s.apply(e,t)}function N(s,t,e,i){let n,r,o;if(q(s))for(r=s.length,n=0;n<r;n++)t.call(e,s[n],n);else if(D(s))for(o=Object.keys(s),r=o.length,n=0;n<r;n++)t.call(e,s[o[n]],o[n])}function ni(s,t){let e,i,n,r;if(!s||!t||s.length!==t.length)return!1;for(e=0,i=s.length;e<i;++e)if(n=s[e],r=t[e],n.datasetIndex!==r.datasetIndex||n.index!==r.index)return!1;return!0}function ri(s){if(q(s))return s.map(ri);if(D(s)){const t=Object.create(null),e=Object.keys(s),i=e.length;let n=0;for(;n<i;++n)t[e[n]]=ri(s[e[n]]);return t}return s}function na(s){return["__proto__","prototype","constructor"].indexOf(s)===-1}function nc(s,t,e,i){if(!na(s))return;const n=t[s],r=e[s];D(n)&&D(r)?ms(n,r,i):t[s]=ri(r)}function ms(s,t,e){const i=q(t)?t:[t],n=i.length;if(!D(s))return s;e=e||{};const r=e.merger||nc;let o;for(let a=0;a<n;++a){if(o=i[a],!D(o))continue;const l=Object.keys(o);for(let c=0,h=l.length;c<h;++c)r(l[c],s,o,e)}return s}function cs(s,t){return ms(s,t,{merger:rc})}function rc(s,t,e){if(!na(s))return;const i=t[s],n=e[s];D(i)&&D(n)?cs(i,n):Object.prototype.hasOwnProperty.call(t,s)||(t[s]=ri(n))}const nr={"":s=>s,x:s=>s.x,y:s=>s.y};function oc(s){const t=s.split("."),e=[];let i="";for(const n of t)i+=n,i.endsWith("\\")?i=i.slice(0,-1)+".":(e.push(i),i="");return e}function ac(s){const t=oc(s);return e=>{for(const i of t){if(i==="")break;e=e&&e[i]}return e}}function ee(s,t){return(nr[t]||(nr[t]=ac(t)))(s)}function Pn(s){return s.charAt(0).toUpperCase()+s.slice(1)}const bs=s=>typeof s<"u",se=s=>typeof s=="function",rr=(s,t)=>{if(s.size!==t.size)return!1;for(const e of s)if(!t.has(e))return!1;return!0};function lc(s){return s.type==="mouseup"||s.type==="click"||s.type==="contextmenu"}const j=Math.PI,V=2*j,cc=V+j,oi=Number.POSITIVE_INFINITY,hc=j/180,X=j/2,le=j/4,or=j*2/3,Jt=Math.log10,Lt=Math.sign;function hs(s,t,e){return Math.abs(s-t)<e}function ar(s){const t=Math.round(s);s=hs(s,t,s/1e3)?t:s;const e=Math.pow(10,Math.floor(Jt(s))),i=s/e;return(i<=1?1:i<=2?2:i<=5?5:10)*e}function uc(s){const t=[],e=Math.sqrt(s);let i;for(i=1;i<e;i++)s%i===0&&(t.push(i),t.push(s/i));return e===(e|0)&&t.push(e),t.sort((n,r)=>n-r).pop(),t}function dc(s){return typeof s=="symbol"||typeof s=="object"&&s!==null&&!(Symbol.toPrimitive in s||"toString"in s||"valueOf"in s)}function Ve(s){return!dc(s)&&!isNaN(parseFloat(s))&&isFinite(s)}function fc(s,t){const e=Math.round(s);return e-t<=s&&e+t>=s}function ra(s,t,e){let i,n,r;for(i=0,n=s.length;i<n;i++)r=s[i][e],isNaN(r)||(t.min=Math.min(t.min,r),t.max=Math.max(t.max,r))}function Ct(s){return s*(j/180)}function Rn(s){return s*(180/j)}function lr(s){if(!J(s))return;let t=1,e=0;for(;Math.round(s*t)/t!==s;)t*=10,e++;return e}function oa(s,t){const e=t.x-s.x,i=t.y-s.y,n=Math.sqrt(e*e+i*i);let r=Math.atan2(i,e);return r<-.5*j&&(r+=V),{angle:r,distance:n}}function nn(s,t){return Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2))}function gc(s,t){return(s-t+cc)%V-j}function ht(s){return(s%V+V)%V}function ys(s,t,e,i){const n=ht(s),r=ht(t),o=ht(e),a=ht(r-n),l=ht(o-n),c=ht(n-r),h=ht(n-o);return n===r||n===o||i&&r===o||a>l&&c<h}function et(s,t,e){return Math.max(t,Math.min(e,s))}function pc(s){return et(s,-32768,32767)}function Ft(s,t,e,i=1e-6){return s>=Math.min(t,e)-i&&s<=Math.max(t,e)+i}function Mn(s,t,e){e=e||(o=>s[o]<t);let i=s.length-1,n=0,r;for(;i-n>1;)r=n+i>>1,e(r)?n=r:i=r;return{lo:n,hi:i}}const Ut=(s,t,e,i)=>Mn(s,e,i?n=>{const r=s[n][t];return r<e||r===e&&s[n+1][t]===e}:n=>s[n][t]<e),mc=(s,t,e)=>Mn(s,e,i=>s[i][t]>=e);function bc(s,t,e){let i=0,n=s.length;for(;i<n&&s[i]<t;)i++;for(;n>i&&s[n-1]>e;)n--;return i>0||n<s.length?s.slice(i,n):s}const aa=["push","pop","shift","splice","unshift"];function yc(s,t){if(s._chartjs){s._chartjs.listeners.push(t);return}Object.defineProperty(s,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),aa.forEach(e=>{const i="_onData"+Pn(e),n=s[e];Object.defineProperty(s,e,{configurable:!0,enumerable:!1,value(...r){const o=n.apply(this,r);return s._chartjs.listeners.forEach(a=>{typeof a[i]=="function"&&a[i](...r)}),o}})})}function cr(s,t){const e=s._chartjs;if(!e)return;const i=e.listeners,n=i.indexOf(t);n!==-1&&i.splice(n,1),!(i.length>0)&&(aa.forEach(r=>{delete s[r]}),delete s._chartjs)}function la(s){const t=new Set(s);return t.size===s.length?s:Array.from(t)}const ca=(function(){return typeof window>"u"?function(s){return s()}:window.requestAnimationFrame})();function ha(s,t){let e=[],i=!1;return function(...n){e=n,i||(i=!0,ca.call(window,()=>{i=!1,s.apply(t,e)}))}}function _c(s,t){let e;return function(...i){return t?(clearTimeout(e),e=setTimeout(s,t,i)):s.apply(this,i),t}}const Ln=s=>s==="start"?"left":s==="end"?"right":"center",ct=(s,t,e)=>s==="start"?t:s==="end"?e:(t+e)/2,vc=(s,t,e,i)=>s===(i?"left":"right")?e:s==="center"?(t+e)/2:t;function ua(s,t,e){const i=t.length;let n=0,r=i;if(s._sorted){const{iScale:o,vScale:a,_parsed:l}=s,c=s.dataset&&s.dataset.options?s.dataset.options.spanGaps:null,h=o.axis,{min:u,max:d,minDefined:f,maxDefined:p}=o.getUserBounds();if(f){if(n=Math.min(Ut(l,h,u).lo,e?i:Ut(t,h,o.getPixelForValue(u)).lo),c){const g=l.slice(0,n+1).reverse().findIndex(m=>!L(m[a.axis]));n-=Math.max(0,g)}n=et(n,0,i-1)}if(p){let g=Math.max(Ut(l,o.axis,d,!0).hi+1,e?0:Ut(t,h,o.getPixelForValue(d),!0).hi+1);if(c){const m=l.slice(g-1).findIndex(b=>!L(b[a.axis]));g+=Math.max(0,m)}r=et(g,n,i)-n}else r=i-n}return{start:n,count:r}}function da(s){const{xScale:t,yScale:e,_scaleRanges:i}=s,n={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!i)return s._scaleRanges=n,!0;const r=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==e.min||i.ymax!==e.max;return Object.assign(i,n),r}const js=s=>s===0||s===1,hr=(s,t,e)=>-(Math.pow(2,10*(s-=1))*Math.sin((s-t)*V/e)),ur=(s,t,e)=>Math.pow(2,-10*s)*Math.sin((s-t)*V/e)+1,us={linear:s=>s,easeInQuad:s=>s*s,easeOutQuad:s=>-s*(s-2),easeInOutQuad:s=>(s/=.5)<1?.5*s*s:-.5*(--s*(s-2)-1),easeInCubic:s=>s*s*s,easeOutCubic:s=>(s-=1)*s*s+1,easeInOutCubic:s=>(s/=.5)<1?.5*s*s*s:.5*((s-=2)*s*s+2),easeInQuart:s=>s*s*s*s,easeOutQuart:s=>-((s-=1)*s*s*s-1),easeInOutQuart:s=>(s/=.5)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2),easeInQuint:s=>s*s*s*s*s,easeOutQuint:s=>(s-=1)*s*s*s*s+1,easeInOutQuint:s=>(s/=.5)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2),easeInSine:s=>-Math.cos(s*X)+1,easeOutSine:s=>Math.sin(s*X),easeInOutSine:s=>-.5*(Math.cos(j*s)-1),easeInExpo:s=>s===0?0:Math.pow(2,10*(s-1)),easeOutExpo:s=>s===1?1:-Math.pow(2,-10*s)+1,easeInOutExpo:s=>js(s)?s:s<.5?.5*Math.pow(2,10*(s*2-1)):.5*(-Math.pow(2,-10*(s*2-1))+2),easeInCirc:s=>s>=1?s:-(Math.sqrt(1-s*s)-1),easeOutCirc:s=>Math.sqrt(1-(s-=1)*s),easeInOutCirc:s=>(s/=.5)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1),easeInElastic:s=>js(s)?s:hr(s,.075,.3),easeOutElastic:s=>js(s)?s:ur(s,.075,.3),easeInOutElastic(s){return js(s)?s:s<.5?.5*hr(s*2,.1125,.45):.5+.5*ur(s*2-1,.1125,.45)},easeInBack(s){return s*s*((1.70158+1)*s-1.70158)},easeOutBack(s){return(s-=1)*s*((1.70158+1)*s+1.70158)+1},easeInOutBack(s){let t=1.70158;return(s/=.5)<1?.5*(s*s*(((t*=1.525)+1)*s-t)):.5*((s-=2)*s*(((t*=1.525)+1)*s+t)+2)},easeInBounce:s=>1-us.easeOutBounce(1-s),easeOutBounce(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},easeInOutBounce:s=>s<.5?us.easeInBounce(s*2)*.5:us.easeOutBounce(s*2-1)*.5+.5};function Dn(s){if(s&&typeof s=="object"){const t=s.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function dr(s){return Dn(s)?s:new ps(s)}function Mi(s){return Dn(s)?s:new ps(s).saturate(.5).darken(.1).hexString()}const wc=["x","y","borderWidth","radius","tension"],xc=["color","borderColor","backgroundColor"];function Sc(s){s.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),s.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),s.set("animations",{colors:{type:"color",properties:xc},numbers:{type:"number",properties:wc}}),s.describe("animations",{_fallback:"animation"}),s.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function kc(s){s.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const fr=new Map;function Ec(s,t){t=t||{};const e=s+JSON.stringify(t);let i=fr.get(e);return i||(i=new Intl.NumberFormat(s,t),fr.set(e,i)),i}function Ps(s,t,e){return Ec(t,e).format(s)}const fa={values(s){return q(s)?s:""+s},numeric(s,t,e){if(s===0)return"0";const i=this.chart.options.locale;let n,r=s;if(e.length>1){const c=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(c<1e-4||c>1e15)&&(n="scientific"),r=Tc(s,e)}const o=Jt(Math.abs(r)),a=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:n,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),Ps(s,i,l)},logarithmic(s,t,e){if(s===0)return"0";const i=e[t].significand||s/Math.pow(10,Math.floor(Jt(s)));return[1,2,3,5,10,15].includes(i)||t>.8*e.length?fa.numeric.call(this,s,t,e):""}};function Tc(s,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&s!==Math.floor(s)&&(e=s-Math.floor(s)),e}var bi={formatters:fa};function Ac(s){s.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:bi.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),s.route("scale.ticks","color","","color"),s.route("scale.grid","color","","borderColor"),s.route("scale.border","color","","borderColor"),s.route("scale.title","color","","color"),s.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),s.describe("scales",{_fallback:"scale"}),s.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const ke=Object.create(null),rn=Object.create(null);function ds(s,t){if(!t)return s;const e=t.split(".");for(let i=0,n=e.length;i<n;++i){const r=e[i];s=s[r]||(s[r]=Object.create(null))}return s}function Li(s,t,e){return typeof t=="string"?ms(ds(s,t),e):ms(ds(s,""),t)}class Oc{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,n)=>Mi(n.backgroundColor),this.hoverBorderColor=(i,n)=>Mi(n.borderColor),this.hoverColor=(i,n)=>Mi(n.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return Li(this,t,e)}get(t){return ds(this,t)}describe(t,e){return Li(rn,t,e)}override(t,e){return Li(ke,t,e)}route(t,e,i,n){const r=ds(this,t),o=ds(this,i),a="_"+e;Object.defineProperties(r,{[a]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const l=this[a],c=o[n];return D(l)?Object.assign({},c,l):P(l,c)},set(l){this[a]=l}}})}apply(t){t.forEach(e=>e(this))}}var K=new Oc({_scriptable:s=>!s.startsWith("on"),_indexable:s=>s!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Sc,kc,Ac]);function Cc(s){return!s||L(s.size)||L(s.family)?null:(s.style?s.style+" ":"")+(s.weight?s.weight+" ":"")+s.size+"px "+s.family}function ai(s,t,e,i,n){let r=t[n];return r||(r=t[n]=s.measureText(n).width,e.push(n)),r>i&&(i=r),i}function Pc(s,t,e,i){i=i||{};let n=i.data=i.data||{},r=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(n=i.data={},r=i.garbageCollect=[],i.font=t),s.save(),s.font=t;let o=0;const a=e.length;let l,c,h,u,d;for(l=0;l<a;l++)if(u=e[l],u!=null&&!q(u))o=ai(s,n,r,o,u);else if(q(u))for(c=0,h=u.length;c<h;c++)d=u[c],d!=null&&!q(d)&&(o=ai(s,n,r,o,d));s.restore();const f=r.length/2;if(f>e.length){for(l=0;l<f;l++)delete n[r[l]];r.splice(0,f)}return o}function ce(s,t,e){const i=s.currentDevicePixelRatio,n=e!==0?Math.max(e/2,.5):0;return Math.round((t-n)*i)/i+n}function gr(s,t){!t&&!s||(t=t||s.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,s.width,s.height),t.restore())}function on(s,t,e,i){ga(s,t,e,i,null)}function ga(s,t,e,i,n){let r,o,a,l,c,h,u,d;const f=t.pointStyle,p=t.rotation,g=t.radius;let m=(p||0)*hc;if(f&&typeof f=="object"&&(r=f.toString(),r==="[object HTMLImageElement]"||r==="[object HTMLCanvasElement]")){s.save(),s.translate(e,i),s.rotate(m),s.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),s.restore();return}if(!(isNaN(g)||g<=0)){switch(s.beginPath(),f){default:n?s.ellipse(e,i,n/2,g,0,0,V):s.arc(e,i,g,0,V),s.closePath();break;case"triangle":h=n?n/2:g,s.moveTo(e+Math.sin(m)*h,i-Math.cos(m)*g),m+=or,s.lineTo(e+Math.sin(m)*h,i-Math.cos(m)*g),m+=or,s.lineTo(e+Math.sin(m)*h,i-Math.cos(m)*g),s.closePath();break;case"rectRounded":c=g*.516,l=g-c,o=Math.cos(m+le)*l,u=Math.cos(m+le)*(n?n/2-c:l),a=Math.sin(m+le)*l,d=Math.sin(m+le)*(n?n/2-c:l),s.arc(e-u,i-a,c,m-j,m-X),s.arc(e+d,i-o,c,m-X,m),s.arc(e+u,i+a,c,m,m+X),s.arc(e-d,i+o,c,m+X,m+j),s.closePath();break;case"rect":if(!p){l=Math.SQRT1_2*g,h=n?n/2:l,s.rect(e-h,i-l,2*h,2*l);break}m+=le;case"rectRot":u=Math.cos(m)*(n?n/2:g),o=Math.cos(m)*g,a=Math.sin(m)*g,d=Math.sin(m)*(n?n/2:g),s.moveTo(e-u,i-a),s.lineTo(e+d,i-o),s.lineTo(e+u,i+a),s.lineTo(e-d,i+o),s.closePath();break;case"crossRot":m+=le;case"cross":u=Math.cos(m)*(n?n/2:g),o=Math.cos(m)*g,a=Math.sin(m)*g,d=Math.sin(m)*(n?n/2:g),s.moveTo(e-u,i-a),s.lineTo(e+u,i+a),s.moveTo(e+d,i-o),s.lineTo(e-d,i+o);break;case"star":u=Math.cos(m)*(n?n/2:g),o=Math.cos(m)*g,a=Math.sin(m)*g,d=Math.sin(m)*(n?n/2:g),s.moveTo(e-u,i-a),s.lineTo(e+u,i+a),s.moveTo(e+d,i-o),s.lineTo(e-d,i+o),m+=le,u=Math.cos(m)*(n?n/2:g),o=Math.cos(m)*g,a=Math.sin(m)*g,d=Math.sin(m)*(n?n/2:g),s.moveTo(e-u,i-a),s.lineTo(e+u,i+a),s.moveTo(e+d,i-o),s.lineTo(e-d,i+o);break;case"line":o=n?n/2:Math.cos(m)*g,a=Math.sin(m)*g,s.moveTo(e-o,i-a),s.lineTo(e+o,i+a);break;case"dash":s.moveTo(e,i),s.lineTo(e+Math.cos(m)*(n?n/2:g),i+Math.sin(m)*g);break;case!1:s.closePath();break}s.fill(),t.borderWidth>0&&s.stroke()}}function Wt(s,t,e){return e=e||.5,!t||s&&s.x>t.left-e&&s.x<t.right+e&&s.y>t.top-e&&s.y<t.bottom+e}function yi(s,t){s.save(),s.beginPath(),s.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),s.clip()}function _i(s){s.restore()}function Rc(s,t,e,i,n){if(!t)return s.lineTo(e.x,e.y);if(n==="middle"){const r=(t.x+e.x)/2;s.lineTo(r,t.y),s.lineTo(r,e.y)}else n==="after"!=!!i?s.lineTo(t.x,e.y):s.lineTo(e.x,t.y);s.lineTo(e.x,e.y)}function Mc(s,t,e,i){if(!t)return s.lineTo(e.x,e.y);s.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?e.cp2x:e.cp1x,i?e.cp2y:e.cp1y,e.x,e.y)}function Lc(s,t){t.translation&&s.translate(t.translation[0],t.translation[1]),L(t.rotation)||s.rotate(t.rotation),t.color&&(s.fillStyle=t.color),t.textAlign&&(s.textAlign=t.textAlign),t.textBaseline&&(s.textBaseline=t.textBaseline)}function Dc(s,t,e,i,n){if(n.strikethrough||n.underline){const r=s.measureText(i),o=t-r.actualBoundingBoxLeft,a=t+r.actualBoundingBoxRight,l=e-r.actualBoundingBoxAscent,c=e+r.actualBoundingBoxDescent,h=n.strikethrough?(l+c)/2:c;s.strokeStyle=s.fillStyle,s.beginPath(),s.lineWidth=n.decorationWidth||2,s.moveTo(o,h),s.lineTo(a,h),s.stroke()}}function Ic(s,t){const e=s.fillStyle;s.fillStyle=t.color,s.fillRect(t.left,t.top,t.width,t.height),s.fillStyle=e}function Ee(s,t,e,i,n,r={}){const o=q(t)?t:[t],a=r.strokeWidth>0&&r.strokeColor!=="";let l,c;for(s.save(),s.font=n.string,Lc(s,r),l=0;l<o.length;++l)c=o[l],r.backdrop&&Ic(s,r.backdrop),a&&(r.strokeColor&&(s.strokeStyle=r.strokeColor),L(r.strokeWidth)||(s.lineWidth=r.strokeWidth),s.strokeText(c,e,i,r.maxWidth)),s.fillText(c,e,i,r.maxWidth),Dc(s,e,i,c,r),i+=Number(n.lineHeight);s.restore()}function _s(s,t){const{x:e,y:i,w:n,h:r,radius:o}=t;s.arc(e+o.topLeft,i+o.topLeft,o.topLeft,1.5*j,j,!0),s.lineTo(e,i+r-o.bottomLeft),s.arc(e+o.bottomLeft,i+r-o.bottomLeft,o.bottomLeft,j,X,!0),s.lineTo(e+n-o.bottomRight,i+r),s.arc(e+n-o.bottomRight,i+r-o.bottomRight,o.bottomRight,X,0,!0),s.lineTo(e+n,i+o.topRight),s.arc(e+n-o.topRight,i+o.topRight,o.topRight,0,-X,!0),s.lineTo(e+o.topLeft,i)}const jc=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,$c=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Nc(s,t){const e=(""+s).match(jc);if(!e||e[1]==="normal")return t*1.2;switch(s=+e[2],e[3]){case"px":return s;case"%":s/=100;break}return t*s}const Bc=s=>+s||0;function In(s,t){const e={},i=D(t),n=i?Object.keys(t):t,r=D(s)?i?o=>P(s[o],s[t[o]]):o=>s[o]:()=>s;for(const o of n)e[o]=Bc(r(o));return e}function pa(s){return In(s,{top:"y",right:"x",bottom:"y",left:"x"})}function xe(s){return In(s,["topLeft","topRight","bottomLeft","bottomRight"])}function dt(s){const t=pa(s);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function tt(s,t){s=s||{},t=t||K.font;let e=P(s.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let i=P(s.style,t.style);i&&!(""+i).match($c)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const n={family:P(s.family,t.family),lineHeight:Nc(P(s.lineHeight,t.lineHeight),e),size:e,style:i,weight:P(s.weight,t.weight),string:""};return n.string=Cc(n),n}function rs(s,t,e,i){let n,r,o;for(n=0,r=s.length;n<r;++n)if(o=s[n],o!==void 0&&o!==void 0)return o}function Fc(s,t,e){const{min:i,max:n}=s,r=ia(t,(n-i)/2),o=(a,l)=>e&&a===0?0:a+l;return{min:o(i,-Math.abs(r)),max:o(n,r)}}function ne(s,t){return Object.assign(Object.create(s),t)}function jn(s,t=[""],e,i,n=()=>s[0]){const r=e||s;typeof i>"u"&&(i=_a("_fallback",s));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:s,_rootScopes:r,_fallback:i,_getTarget:n,override:a=>jn([a,...s],t,r,i)};return new Proxy(o,{deleteProperty(a,l){return delete a[l],delete a._keys,delete s[0][l],!0},get(a,l){return ba(a,l,()=>Gc(l,t,s,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(s[0])},has(a,l){return mr(a).includes(l)},ownKeys(a){return mr(a)},set(a,l,c){const h=a._storage||(a._storage=n());return a[l]=h[l]=c,delete a._keys,!0}})}function He(s,t,e,i){const n={_cacheable:!1,_proxy:s,_context:t,_subProxy:e,_stack:new Set,_descriptors:ma(s,i),setContext:r=>He(s,r,e,i),override:r=>He(s.override(r),t,e,i)};return new Proxy(n,{deleteProperty(r,o){return delete r[o],delete s[o],!0},get(r,o,a){return ba(r,o,()=>Wc(r,o,a))},getOwnPropertyDescriptor(r,o){return r._descriptors.allKeys?Reflect.has(s,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(s,o)},getPrototypeOf(){return Reflect.getPrototypeOf(s)},has(r,o){return Reflect.has(s,o)},ownKeys(){return Reflect.ownKeys(s)},set(r,o,a){return s[o]=a,delete r[o],!0}})}function ma(s,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:i=t.indexable,_allKeys:n=t.allKeys}=s;return{allKeys:n,scriptable:e,indexable:i,isScriptable:se(e)?e:()=>e,isIndexable:se(i)?i:()=>i}}const Uc=(s,t)=>s?s+Pn(t):t,$n=(s,t)=>D(t)&&s!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function ba(s,t,e){if(Object.prototype.hasOwnProperty.call(s,t)||t==="constructor")return s[t];const i=e();return s[t]=i,i}function Wc(s,t,e){const{_proxy:i,_context:n,_subProxy:r,_descriptors:o}=s;let a=i[t];return se(a)&&o.isScriptable(t)&&(a=zc(t,a,s,e)),q(a)&&a.length&&(a=Vc(t,a,s,o.isIndexable)),$n(t,a)&&(a=He(a,n,r&&r[t],o)),a}function zc(s,t,e,i){const{_proxy:n,_context:r,_subProxy:o,_stack:a}=e;if(a.has(s))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+s);a.add(s);let l=t(r,o||i);return a.delete(s),$n(s,l)&&(l=Nn(n._scopes,n,s,l)),l}function Vc(s,t,e,i){const{_proxy:n,_context:r,_subProxy:o,_descriptors:a}=e;if(typeof r.index<"u"&&i(s))return t[r.index%t.length];if(D(t[0])){const l=t,c=n._scopes.filter(h=>h!==l);t=[];for(const h of l){const u=Nn(c,n,s,h);t.push(He(u,r,o&&o[s],a))}}return t}function ya(s,t,e){return se(s)?s(t,e):s}const Hc=(s,t)=>s===!0?t:typeof s=="string"?ee(t,s):void 0;function qc(s,t,e,i,n){for(const r of t){const o=Hc(e,r);if(o){s.add(o);const a=ya(o._fallback,e,n);if(typeof a<"u"&&a!==e&&a!==i)return a}else if(o===!1&&typeof i<"u"&&e!==i)return null}return!1}function Nn(s,t,e,i){const n=t._rootScopes,r=ya(t._fallback,e,i),o=[...s,...n],a=new Set;a.add(i);let l=pr(a,o,e,r||e,i);return l===null||typeof r<"u"&&r!==e&&(l=pr(a,o,r,l,i),l===null)?!1:jn(Array.from(a),[""],n,r,()=>Kc(t,e,i))}function pr(s,t,e,i,n){for(;e;)e=qc(s,t,e,i,n);return e}function Kc(s,t,e){const i=s._getTarget();t in i||(i[t]={});const n=i[t];return q(n)&&D(e)?e:n||{}}function Gc(s,t,e,i){let n;for(const r of t)if(n=_a(Uc(r,s),e),typeof n<"u")return $n(s,n)?Nn(e,i,s,n):n}function _a(s,t){for(const e of t){if(!e)continue;const i=e[s];if(typeof i<"u")return i}}function mr(s){let t=s._keys;return t||(t=s._keys=Jc(s._scopes)),t}function Jc(s){const t=new Set;for(const e of s)for(const i of Object.keys(e).filter(n=>!n.startsWith("_")))t.add(i);return Array.from(t)}function va(s,t,e,i){const{iScale:n}=s,{key:r="r"}=this._parsing,o=new Array(i);let a,l,c,h;for(a=0,l=i;a<l;++a)c=a+e,h=t[c],o[a]={r:n.parse(ee(h,r),c)};return o}const Yc=Number.EPSILON||1e-14,qe=(s,t)=>t<s.length&&!s[t].skip&&s[t],wa=s=>s==="x"?"y":"x";function Xc(s,t,e,i){const n=s.skip?t:s,r=t,o=e.skip?t:e,a=nn(r,n),l=nn(o,r);let c=a/(a+l),h=l/(a+l);c=isNaN(c)?0:c,h=isNaN(h)?0:h;const u=i*c,d=i*h;return{previous:{x:r.x-u*(o.x-n.x),y:r.y-u*(o.y-n.y)},next:{x:r.x+d*(o.x-n.x),y:r.y+d*(o.y-n.y)}}}function Zc(s,t,e){const i=s.length;let n,r,o,a,l,c=qe(s,0);for(let h=0;h<i-1;++h)if(l=c,c=qe(s,h+1),!(!l||!c)){if(hs(t[h],0,Yc)){e[h]=e[h+1]=0;continue}n=e[h]/t[h],r=e[h+1]/t[h],a=Math.pow(n,2)+Math.pow(r,2),!(a<=9)&&(o=3/Math.sqrt(a),e[h]=n*o*t[h],e[h+1]=r*o*t[h])}}function Qc(s,t,e="x"){const i=wa(e),n=s.length;let r,o,a,l=qe(s,0);for(let c=0;c<n;++c){if(o=a,a=l,l=qe(s,c+1),!a)continue;const h=a[e],u=a[i];o&&(r=(h-o[e])/3,a[`cp1${e}`]=h-r,a[`cp1${i}`]=u-r*t[c]),l&&(r=(l[e]-h)/3,a[`cp2${e}`]=h+r,a[`cp2${i}`]=u+r*t[c])}}function th(s,t="x"){const e=wa(t),i=s.length,n=Array(i).fill(0),r=Array(i);let o,a,l,c=qe(s,0);for(o=0;o<i;++o)if(a=l,l=c,c=qe(s,o+1),!!l){if(c){const h=c[t]-l[t];n[o]=h!==0?(c[e]-l[e])/h:0}r[o]=a?c?Lt(n[o-1])!==Lt(n[o])?0:(n[o-1]+n[o])/2:n[o-1]:n[o]}Zc(s,n,r),Qc(s,r,t)}function $s(s,t,e){return Math.max(Math.min(s,e),t)}function eh(s,t){let e,i,n,r,o,a=Wt(s[0],t);for(e=0,i=s.length;e<i;++e)o=r,r=a,a=e<i-1&&Wt(s[e+1],t),r&&(n=s[e],o&&(n.cp1x=$s(n.cp1x,t.left,t.right),n.cp1y=$s(n.cp1y,t.top,t.bottom)),a&&(n.cp2x=$s(n.cp2x,t.left,t.right),n.cp2y=$s(n.cp2y,t.top,t.bottom)))}function sh(s,t,e,i,n){let r,o,a,l;if(t.spanGaps&&(s=s.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")th(s,n);else{let c=i?s[s.length-1]:s[0];for(r=0,o=s.length;r<o;++r)a=s[r],l=Xc(c,a,s[Math.min(r+1,o-(i?0:1))%o],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,c=a}t.capBezierPoints&&eh(s,e)}function Bn(){return typeof window<"u"&&typeof document<"u"}function Fn(s){let t=s.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function li(s,t,e){let i;return typeof s=="string"?(i=parseInt(s,10),s.indexOf("%")!==-1&&(i=i/100*t.parentNode[e])):i=s,i}const vi=s=>s.ownerDocument.defaultView.getComputedStyle(s,null);function ih(s,t){return vi(s).getPropertyValue(t)}const nh=["top","right","bottom","left"];function Se(s,t,e){const i={};e=e?"-"+e:"";for(let n=0;n<4;n++){const r=nh[n];i[r]=parseFloat(s[t+"-"+r+e])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const rh=(s,t,e)=>(s>0||t>0)&&(!e||!e.shadowRoot);function oh(s,t){const e=s.touches,i=e&&e.length?e[0]:s,{offsetX:n,offsetY:r}=i;let o=!1,a,l;if(rh(n,r,s.target))a=n,l=r;else{const c=t.getBoundingClientRect();a=i.clientX-c.left,l=i.clientY-c.top,o=!0}return{x:a,y:l,box:o}}function pe(s,t){if("native"in s)return s;const{canvas:e,currentDevicePixelRatio:i}=t,n=vi(e),r=n.boxSizing==="border-box",o=Se(n,"padding"),a=Se(n,"border","width"),{x:l,y:c,box:h}=oh(s,e),u=o.left+(h&&a.left),d=o.top+(h&&a.top);let{width:f,height:p}=t;return r&&(f-=o.width+a.width,p-=o.height+a.height),{x:Math.round((l-u)/f*e.width/i),y:Math.round((c-d)/p*e.height/i)}}function ah(s,t,e){let i,n;if(t===void 0||e===void 0){const r=s&&Fn(s);if(!r)t=s.clientWidth,e=s.clientHeight;else{const o=r.getBoundingClientRect(),a=vi(r),l=Se(a,"border","width"),c=Se(a,"padding");t=o.width-c.width-l.width,e=o.height-c.height-l.height,i=li(a.maxWidth,r,"clientWidth"),n=li(a.maxHeight,r,"clientHeight")}}return{width:t,height:e,maxWidth:i||oi,maxHeight:n||oi}}const Yt=s=>Math.round(s*10)/10;function lh(s,t,e,i){const n=vi(s),r=Se(n,"margin"),o=li(n.maxWidth,s,"clientWidth")||oi,a=li(n.maxHeight,s,"clientHeight")||oi,l=ah(s,t,e);let{width:c,height:h}=l;if(n.boxSizing==="content-box"){const d=Se(n,"border","width"),f=Se(n,"padding");c-=f.width+d.width,h-=f.height+d.height}return c=Math.max(0,c-r.width),h=Math.max(0,i?c/i:h-r.height),c=Yt(Math.min(c,o,l.maxWidth)),h=Yt(Math.min(h,a,l.maxHeight)),c&&!h&&(h=Yt(c/2)),(t!==void 0||e!==void 0)&&i&&l.height&&h>l.height&&(h=l.height,c=Yt(Math.floor(h*i))),{width:c,height:h}}function br(s,t,e){const i=t||1,n=Yt(s.height*i),r=Yt(s.width*i);s.height=Yt(s.height),s.width=Yt(s.width);const o=s.canvas;return o.style&&(e||!o.style.height&&!o.style.width)&&(o.style.height=`${s.height}px`,o.style.width=`${s.width}px`),s.currentDevicePixelRatio!==i||o.height!==n||o.width!==r?(s.currentDevicePixelRatio=i,o.height=n,o.width=r,s.ctx.setTransform(i,0,0,i,0,0),!0):!1}const ch=(function(){let s=!1;try{const t={get passive(){return s=!0,!1}};Bn()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return s})();function yr(s,t){const e=ih(s,t),i=e&&e.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function me(s,t,e,i){return{x:s.x+e*(t.x-s.x),y:s.y+e*(t.y-s.y)}}function hh(s,t,e,i){return{x:s.x+e*(t.x-s.x),y:i==="middle"?e<.5?s.y:t.y:i==="after"?e<1?s.y:t.y:e>0?t.y:s.y}}function uh(s,t,e,i){const n={x:s.cp2x,y:s.cp2y},r={x:t.cp1x,y:t.cp1y},o=me(s,n,e),a=me(n,r,e),l=me(r,t,e),c=me(o,a,e),h=me(a,l,e);return me(c,h,e)}const dh=function(s,t){return{x(e){return s+s+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,i){return e-i},leftForLtr(e,i){return e-i}}},fh=function(){return{x(s){return s},setWidth(s){},textAlign(s){return s},xPlus(s,t){return s+t},leftForLtr(s,t){return s}}};function We(s,t,e){return s?dh(t,e):fh()}function xa(s,t){let e,i;(t==="ltr"||t==="rtl")&&(e=s.canvas.style,i=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),s.prevTextDirection=i)}function Sa(s,t){t!==void 0&&(delete s.prevTextDirection,s.canvas.style.setProperty("direction",t[0],t[1]))}function ka(s){return s==="angle"?{between:ys,compare:gc,normalize:ht}:{between:Ft,compare:(t,e)=>t-e,normalize:t=>t}}function _r({start:s,end:t,count:e,loop:i,style:n}){return{start:s%e,end:t%e,loop:i&&(t-s+1)%e===0,style:n}}function gh(s,t,e){const{property:i,start:n,end:r}=e,{between:o,normalize:a}=ka(i),l=t.length;let{start:c,end:h,loop:u}=s,d,f;if(u){for(c+=l,h+=l,d=0,f=l;d<f&&o(a(t[c%l][i]),n,r);++d)c--,h--;c%=l,h%=l}return h<c&&(h+=l),{start:c,end:h,loop:u,style:s.style}}function Ea(s,t,e){if(!e)return[s];const{property:i,start:n,end:r}=e,o=t.length,{compare:a,between:l,normalize:c}=ka(i),{start:h,end:u,loop:d,style:f}=gh(s,t,e),p=[];let g=!1,m=null,b,y,_;const v=()=>l(n,_,b)&&a(n,_)!==0,x=()=>a(r,b)===0||l(r,_,b),S=()=>g||v(),k=()=>!g||x();for(let E=h,T=h;E<=u;++E)y=t[E%o],!y.skip&&(b=c(y[i]),b!==_&&(g=l(b,n,r),m===null&&S()&&(m=a(b,n)===0?E:T),m!==null&&k()&&(p.push(_r({start:m,end:E,loop:d,count:o,style:f})),m=null),T=E,_=b));return m!==null&&p.push(_r({start:m,end:u,loop:d,count:o,style:f})),p}function Ta(s,t){const e=[],i=s.segments;for(let n=0;n<i.length;n++){const r=Ea(i[n],s.points,t);r.length&&e.push(...r)}return e}function ph(s,t,e,i){let n=0,r=t-1;if(e&&!i)for(;n<t&&!s[n].skip;)n++;for(;n<t&&s[n].skip;)n++;for(n%=t,e&&(r+=n);r>n&&s[r%t].skip;)r--;return r%=t,{start:n,end:r}}function mh(s,t,e,i){const n=s.length,r=[];let o=t,a=s[t],l;for(l=t+1;l<=e;++l){const c=s[l%n];c.skip||c.stop?a.skip||(i=!1,r.push({start:t%n,end:(l-1)%n,loop:i}),t=o=c.stop?l:null):(o=l,a.skip&&(t=l)),a=c}return o!==null&&r.push({start:t%n,end:o%n,loop:i}),r}function bh(s,t){const e=s.points,i=s.options.spanGaps,n=e.length;if(!n)return[];const r=!!s._loop,{start:o,end:a}=ph(e,n,r,i);if(i===!0)return vr(s,[{start:o,end:a,loop:r}],e,t);const l=a<o?a+n:a,c=!!s._fullLoop&&o===0&&a===n-1;return vr(s,mh(e,o,l,c),e,t)}function vr(s,t,e,i){return!i||!i.setContext||!e?t:yh(s,t,e,i)}function yh(s,t,e,i){const n=s._chart.getContext(),r=wr(s.options),{_datasetIndex:o,options:{spanGaps:a}}=s,l=e.length,c=[];let h=r,u=t[0].start,d=u;function f(p,g,m,b){const y=a?-1:1;if(p!==g){for(p+=l;e[p%l].skip;)p-=y;for(;e[g%l].skip;)g+=y;p%l!==g%l&&(c.push({start:p%l,end:g%l,loop:m,style:b}),h=b,u=g%l)}}for(const p of t){u=a?u:p.start;let g=e[u%l],m;for(d=u+1;d<=p.end;d++){const b=e[d%l];m=wr(i.setContext(ne(n,{type:"segment",p0:g,p1:b,p0DataIndex:(d-1)%l,p1DataIndex:d%l,datasetIndex:o}))),_h(m,h)&&f(u,d-1,p.loop,h),g=b,h=m}u<d-1&&f(u,d-1,p.loop,h)}return c}function wr(s){return{backgroundColor:s.backgroundColor,borderCapStyle:s.borderCapStyle,borderDash:s.borderDash,borderDashOffset:s.borderDashOffset,borderJoinStyle:s.borderJoinStyle,borderWidth:s.borderWidth,borderColor:s.borderColor}}function _h(s,t){if(!t)return!1;const e=[],i=function(n,r){return Dn(r)?(e.includes(r)||e.push(r),e.indexOf(r)):r};return JSON.stringify(s,i)!==JSON.stringify(t,i)}function Ns(s,t,e){return s.options.clip?s[e]:t[e]}function vh(s,t){const{xScale:e,yScale:i}=s;return e&&i?{left:Ns(e,t,"left"),right:Ns(e,t,"right"),top:Ns(i,t,"top"),bottom:Ns(i,t,"bottom")}:t}function Aa(s,t){const e=t._clip;if(e.disabled)return!1;const i=vh(t,s.chartArea);return{left:e.left===!1?0:i.left-(e.left===!0?0:e.left),right:e.right===!1?s.width:i.right+(e.right===!0?0:e.right),top:e.top===!1?0:i.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?s.height:i.bottom+(e.bottom===!0?0:e.bottom)}}class wh{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,n){const r=e.listeners[n],o=e.duration;r.forEach(a=>a({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(i-e.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=ca.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((i,n)=>{if(!i.running||!i.items.length)return;const r=i.items;let o=r.length-1,a=!1,l;for(;o>=0;--o)l=r[o],l._active?(l._total>i.duration&&(i.duration=l._total),l.tick(t),a=!0):(r[o]=r[r.length-1],r.pop());a&&(n.draw(),this._notify(n,i,t,"progress")),r.length||(i.running=!1,this._notify(n,i,t,"complete"),i.initial=!1),e+=r.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((i,n)=>Math.max(i,n._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let n=i.length-1;for(;n>=0;--n)i[n].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var It=new wh;const xr="transparent",xh={boolean(s,t,e){return e>.5?t:s},color(s,t,e){const i=dr(s||xr),n=i.valid&&dr(t||xr);return n&&n.valid?n.mix(i,e).hexString():t},number(s,t,e){return s+(t-s)*e}};class Sh{constructor(t,e,i,n){const r=e[i];n=rs([t.to,n,r,t.from]);const o=rs([t.from,r,n]);this._active=!0,this._fn=t.fn||xh[t.type||typeof o],this._easing=us[t.easing]||us.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=o,this._to=n,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const n=this._target[this._prop],r=i-this._start,o=this._duration-r;this._start=i,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=rs([t.to,e,n,t.from]),this._from=rs([t.from,n,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,n=this._prop,r=this._from,o=this._loop,a=this._to;let l;if(this._active=r!==a&&(o||e<i),!this._active){this._target[n]=a,this._notify(!0);return}if(e<0){this._target[n]=r;return}l=e/i%2,l=o&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[n]=this._fn(r,a,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,i)=>{t.push({res:e,rej:i})})}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let n=0;n<i.length;n++)i[n][e]()}}class Oa{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!D(t))return;const e=Object.keys(K.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(n=>{const r=t[n];if(!D(r))return;const o={};for(const a of e)o[a]=r[a];(q(r.properties)&&r.properties||[n]).forEach(a=>{(a===n||!i.has(a))&&i.set(a,o)})})}_animateOptions(t,e){const i=e.options,n=Eh(t,i);if(!n)return[];const r=this._createAnimations(n,i);return i.$shared&&kh(t.options.$animations,i).then(()=>{t.options=i},()=>{}),r}_createAnimations(t,e){const i=this._properties,n=[],r=t.$animations||(t.$animations={}),o=Object.keys(e),a=Date.now();let l;for(l=o.length-1;l>=0;--l){const c=o[l];if(c.charAt(0)==="$")continue;if(c==="options"){n.push(...this._animateOptions(t,e));continue}const h=e[c];let u=r[c];const d=i.get(c);if(u)if(d&&u.active()){u.update(d,h,a);continue}else u.cancel();if(!d||!d.duration){t[c]=h;continue}r[c]=u=new Sh(d,t,c,h),n.push(u)}return n}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const i=this._createAnimations(t,e);if(i.length)return It.add(this._chart,i),!0}}function kh(s,t){const e=[],i=Object.keys(t);for(let n=0;n<i.length;n++){const r=s[i[n]];r&&r.active()&&e.push(r.wait())}return Promise.all(e)}function Eh(s,t){if(!t)return;let e=s.options;if(!e){s.options=t;return}return e.$shared&&(s.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function Sr(s,t){const e=s&&s.options||{},i=e.reverse,n=e.min===void 0?t:0,r=e.max===void 0?t:0;return{start:i?r:n,end:i?n:r}}function Th(s,t,e){if(e===!1)return!1;const i=Sr(s,e),n=Sr(t,e);return{top:n.end,right:i.end,bottom:n.start,left:i.start}}function Ah(s){let t,e,i,n;return D(s)?(t=s.top,e=s.right,i=s.bottom,n=s.left):t=e=i=n=s,{top:t,right:e,bottom:i,left:n,disabled:s===!1}}function Ca(s,t){const e=[],i=s._getSortedDatasetMetas(t);let n,r;for(n=0,r=i.length;n<r;++n)e.push(i[n].index);return e}function kr(s,t,e,i={}){const n=s.keys,r=i.mode==="single";let o,a,l,c;if(t===null)return;let h=!1;for(o=0,a=n.length;o<a;++o){if(l=+n[o],l===e){if(h=!0,i.all)continue;break}c=s.values[l],J(c)&&(r||t===0||Lt(t)===Lt(c))&&(t+=c)}return!h&&!i.all?0:t}function Oh(s,t){const{iScale:e,vScale:i}=t,n=e.axis==="x"?"x":"y",r=i.axis==="x"?"x":"y",o=Object.keys(s),a=new Array(o.length);let l,c,h;for(l=0,c=o.length;l<c;++l)h=o[l],a[l]={[n]:h,[r]:s[h]};return a}function Di(s,t){const e=s&&s.options.stacked;return e||e===void 0&&t.stack!==void 0}function Ch(s,t,e){return`${s.id}.${t.id}.${e.stack||e.type}`}function Ph(s){const{min:t,max:e,minDefined:i,maxDefined:n}=s.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:n?e:Number.POSITIVE_INFINITY}}function Rh(s,t,e){const i=s[t]||(s[t]={});return i[e]||(i[e]={})}function Er(s,t,e,i){for(const n of t.getMatchingVisibleMetas(i).reverse()){const r=s[n.index];if(e&&r>0||!e&&r<0)return n.index}return null}function Tr(s,t){const{chart:e,_cachedMeta:i}=s,n=e._stacks||(e._stacks={}),{iScale:r,vScale:o,index:a}=i,l=r.axis,c=o.axis,h=Ch(r,o,i),u=t.length;let d;for(let f=0;f<u;++f){const p=t[f],{[l]:g,[c]:m}=p,b=p._stacks||(p._stacks={});d=b[c]=Rh(n,h,g),d[a]=m,d._top=Er(d,o,!0,i.type),d._bottom=Er(d,o,!1,i.type);const y=d._visualValues||(d._visualValues={});y[a]=m}}function Ii(s,t){const e=s.scales;return Object.keys(e).filter(i=>e[i].axis===t).shift()}function Mh(s,t){return ne(s,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function Lh(s,t,e){return ne(s,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function Ye(s,t){const e=s.controller.index,i=s.vScale&&s.vScale.axis;if(i){t=t||s._parsed;for(const n of t){const r=n._stacks;if(!r||r[i]===void 0||r[i][e]===void 0)return;delete r[i][e],r[i]._visualValues!==void 0&&r[i]._visualValues[e]!==void 0&&delete r[i]._visualValues[e]}}}const ji=s=>s==="reset"||s==="none",Ar=(s,t)=>t?s:Object.assign({},s),Dh=(s,t,e)=>s&&!t.hidden&&t._stacked&&{keys:Ca(e,!0),values:null};class re{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=Di(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&Ye(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),n=(u,d,f,p)=>u==="x"?d:u==="r"?p:f,r=e.xAxisID=P(i.xAxisID,Ii(t,"x")),o=e.yAxisID=P(i.yAxisID,Ii(t,"y")),a=e.rAxisID=P(i.rAxisID,Ii(t,"r")),l=e.indexAxis,c=e.iAxisID=n(l,r,o,a),h=e.vAxisID=n(l,o,r,a);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(c),e.vScale=this.getScaleForId(h)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&cr(this._data,this),t._stacked&&Ye(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(D(e)){const n=this._cachedMeta;this._data=Oh(e,n)}else if(i!==e){if(i){cr(i,this);const n=this._cachedMeta;Ye(n),n._parsed=[]}e&&Object.isExtensible(e)&&yc(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let n=!1;this._dataCheck();const r=e._stacked;e._stacked=Di(e.vScale,e),e.stack!==i.stack&&(n=!0,Ye(e),e.stack=i.stack),this._resyncElements(t),(n||r!==e._stacked)&&(Tr(this,e._parsed),e._stacked=Di(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:n}=this,{iScale:r,_stacked:o}=i,a=r.axis;let l=t===0&&e===n.length?!0:i._sorted,c=t>0&&i._parsed[t-1],h,u,d;if(this._parsing===!1)i._parsed=n,i._sorted=!0,d=n;else{q(n[t])?d=this.parseArrayData(i,n,t,e):D(n[t])?d=this.parseObjectData(i,n,t,e):d=this.parsePrimitiveData(i,n,t,e);const f=()=>u[a]===null||c&&u[a]<c[a];for(h=0;h<e;++h)i._parsed[h+t]=u=d[h],l&&(f()&&(l=!1),c=u);i._sorted=l}o&&Tr(this,d)}parsePrimitiveData(t,e,i,n){const{iScale:r,vScale:o}=t,a=r.axis,l=o.axis,c=r.getLabels(),h=r===o,u=new Array(n);let d,f,p;for(d=0,f=n;d<f;++d)p=d+i,u[d]={[a]:h||r.parse(c[p],p),[l]:o.parse(e[p],p)};return u}parseArrayData(t,e,i,n){const{xScale:r,yScale:o}=t,a=new Array(n);let l,c,h,u;for(l=0,c=n;l<c;++l)h=l+i,u=e[h],a[l]={x:r.parse(u[0],h),y:o.parse(u[1],h)};return a}parseObjectData(t,e,i,n){const{xScale:r,yScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=new Array(n);let h,u,d,f;for(h=0,u=n;h<u;++h)d=h+i,f=e[d],c[h]={x:r.parse(ee(f,a),d),y:o.parse(ee(f,l),d)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const n=this.chart,r=this._cachedMeta,o=e[t.axis],a={keys:Ca(n,!0),values:e._stacks[t.axis]._visualValues};return kr(a,o,r.index,{mode:i})}updateRangeFromParsed(t,e,i,n){const r=i[e.axis];let o=r===null?NaN:r;const a=n&&i._stacks[e.axis];n&&a&&(n.values=a,o=kr(n,r,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const i=this._cachedMeta,n=i._parsed,r=i._sorted&&t===i.iScale,o=n.length,a=this._getOtherScale(t),l=Dh(e,i,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:h,max:u}=Ph(a);let d,f;function p(){f=n[d];const g=f[a.axis];return!J(f[t.axis])||h>g||u<g}for(d=0;d<o&&!(!p()&&(this.updateRangeFromParsed(c,t,f,l),r));++d);if(r){for(d=o-1;d>=0;--d)if(!p()){this.updateRangeFromParsed(c,t,f,l);break}}return c}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let n,r,o;for(n=0,r=e.length;n<r;++n)o=e[n][t.axis],J(o)&&i.push(o);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,n=e.vScale,r=this.getParsed(t);return{label:i?""+i.getLabelForValue(r[i.axis]):"",value:n?""+n.getLabelForValue(r[n.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=Ah(P(this.options.clip,Th(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,n=i.data||[],r=e.chartArea,o=[],a=this._drawStart||0,l=this._drawCount||n.length-a,c=this.options.drawActiveElementsOnTop;let h;for(i.dataset&&i.dataset.draw(t,r,a,l),h=a;h<a+l;++h){const u=n[h];u.hidden||(u.active&&c?o.push(u):u.draw(t,r))}for(h=0;h<o.length;++h)o[h].draw(t,r)}getStyle(t,e){const i=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const n=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const o=this._cachedMeta.data[t];r=o.$context||(o.$context=Lh(this.getContext(),t,o)),r.parsed=this.getParsed(t),r.raw=n.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=Mh(this.chart.getContext(),this.index)),r.dataset=n,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=i,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const n=e==="active",r=this._cachedDataOpts,o=t+"-"+e,a=r[o],l=this.enableOptionSharing&&bs(i);if(a)return Ar(a,l);const c=this.chart.config,h=c.datasetElementScopeKeys(this._type,t),u=n?[`${t}Hover`,"hover",t,""]:[t,""],d=c.getOptionScopes(this.getDataset(),h),f=Object.keys(K.elements[t]),p=()=>this.getContext(i,n,e),g=c.resolveNamedOptions(d,f,p,u);return g.$shared&&(g.$shared=l,r[o]=Object.freeze(Ar(g,l))),g}_resolveAnimations(t,e,i){const n=this.chart,r=this._cachedDataOpts,o=`animation-${e}`,a=r[o];if(a)return a;let l;if(n.options.animation!==!1){const h=this.chart.config,u=h.datasetAnimationScopeKeys(this._type,e),d=h.getOptionScopes(this.getDataset(),u);l=h.createResolver(d,this.getContext(t,i,e))}const c=new Oa(n,l&&l.animations);return l&&l._cacheable&&(r[o]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||ji(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const i=this.resolveDataElementOptions(t,e),n=this._sharedOptions,r=this.getSharedOptions(i),o=this.includeOptions(e,r)||r!==n;return this.updateSharedOptions(r,e,i),{sharedOptions:r,includeOptions:o}}updateElement(t,e,i,n){ji(n)?Object.assign(t,i):this._resolveAnimations(e,n).update(t,i)}updateSharedOptions(t,e,i){t&&!ji(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,n){t.active=n;const r=this.getStyle(e,n);this._resolveAnimations(e,i,n).update(t,{options:!n&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[a,l,c]of this._syncList)this[a](l,c);this._syncList=[];const n=i.length,r=e.length,o=Math.min(r,n);o&&this.parse(0,o),r>n?this._insertElements(n,r-n,t):r<n&&this._removeElements(r,n-r)}_insertElements(t,e,i=!0){const n=this._cachedMeta,r=n.data,o=t+e;let a;const l=c=>{for(c.length+=e,a=c.length-1;a>=o;a--)c[a]=c[a-e]};for(l(r),a=t;a<o;++a)r[a]=new this.dataElementType;this._parsing&&l(n._parsed),this.parse(t,e),i&&this.updateElements(r,t,e,"reset")}updateElements(t,e,i,n){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const n=i._parsed.splice(t,e);i._stacked&&Ye(i,n)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,n]=t;this[e](i,n)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function Ih(s,t){if(!s._cache.$bar){const e=s.getMatchingVisibleMetas(t);let i=[];for(let n=0,r=e.length;n<r;n++)i=i.concat(e[n].controller.getAllParsedValues(s));s._cache.$bar=la(i.sort((n,r)=>n-r))}return s._cache.$bar}function jh(s){const t=s.iScale,e=Ih(t,s.type);let i=t._length,n,r,o,a;const l=()=>{o===32767||o===-32768||(bs(a)&&(i=Math.min(i,Math.abs(o-a)||i)),a=o)};for(n=0,r=e.length;n<r;++n)o=t.getPixelForValue(e[n]),l();for(a=void 0,n=0,r=t.ticks.length;n<r;++n)o=t.getPixelForTick(n),l();return i}function $h(s,t,e,i){const n=e.barThickness;let r,o;return L(n)?(r=t.min*e.categoryPercentage,o=e.barPercentage):(r=n*i,o=1),{chunk:r/i,ratio:o,start:t.pixels[s]-r/2}}function Nh(s,t,e,i){const n=t.pixels,r=n[s];let o=s>0?n[s-1]:null,a=s<n.length-1?n[s+1]:null;const l=e.categoryPercentage;o===null&&(o=r-(a===null?t.end-t.start:a-r)),a===null&&(a=r+r-o);const c=r-(r-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/i,ratio:e.barPercentage,start:c}}function Bh(s,t,e,i){const n=e.parse(s[0],i),r=e.parse(s[1],i),o=Math.min(n,r),a=Math.max(n,r);let l=o,c=a;Math.abs(o)>Math.abs(a)&&(l=a,c=o),t[e.axis]=c,t._custom={barStart:l,barEnd:c,start:n,end:r,min:o,max:a}}function Pa(s,t,e,i){return q(s)?Bh(s,t,e,i):t[e.axis]=e.parse(s,i),t}function Or(s,t,e,i){const n=s.iScale,r=s.vScale,o=n.getLabels(),a=n===r,l=[];let c,h,u,d;for(c=e,h=e+i;c<h;++c)d=t[c],u={},u[n.axis]=a||n.parse(o[c],c),l.push(Pa(d,u,r,c));return l}function $i(s){return s&&s.barStart!==void 0&&s.barEnd!==void 0}function Fh(s,t,e){return s!==0?Lt(s):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function Uh(s){let t,e,i,n,r;return s.horizontal?(t=s.base>s.x,e="left",i="right"):(t=s.base<s.y,e="bottom",i="top"),t?(n="end",r="start"):(n="start",r="end"),{start:e,end:i,reverse:t,top:n,bottom:r}}function Wh(s,t,e,i){let n=t.borderSkipped;const r={};if(!n){s.borderSkipped=r;return}if(n===!0){s.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:o,end:a,reverse:l,top:c,bottom:h}=Uh(s);n==="middle"&&e&&(s.enableBorderRadius=!0,(e._top||0)===i?n=c:(e._bottom||0)===i?n=h:(r[Cr(h,o,a,l)]=!0,n=c)),r[Cr(n,o,a,l)]=!0,s.borderSkipped=r}function Cr(s,t,e,i){return i?(s=zh(s,t,e),s=Pr(s,e,t)):s=Pr(s,t,e),s}function zh(s,t,e){return s===t?e:s===e?t:s}function Pr(s,t,e){return s==="start"?t:s==="end"?e:s}function Vh(s,{inflateAmount:t},e){s.inflateAmount=t==="auto"?e===1?.33:0:t}class Hh extends re{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(t,e,i,n){return Or(t,e,i,n)}parseArrayData(t,e,i,n){return Or(t,e,i,n)}parseObjectData(t,e,i,n){const{iScale:r,vScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=r.axis==="x"?a:l,h=o.axis==="x"?a:l,u=[];let d,f,p,g;for(d=i,f=i+n;d<f;++d)g=e[d],p={},p[r.axis]=r.parse(ee(g,c),d),u.push(Pa(ee(g,h),p,o,d));return u}updateRangeFromParsed(t,e,i,n){super.updateRangeFromParsed(t,e,i,n);const r=i._custom;r&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:i,vScale:n}=e,r=this.getParsed(t),o=r._custom,a=$i(o)?"["+o.start+", "+o.end+"]":""+n.getLabelForValue(r[n.axis]);return{label:""+i.getLabelForValue(r[i.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,i,n){const r=n==="reset",{index:o,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),c=a.isHorizontal(),h=this._getRuler(),{sharedOptions:u,includeOptions:d}=this._getSharedOptions(e,n);for(let f=e;f<e+i;f++){const p=this.getParsed(f),g=r||L(p[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,h),b=(p._stacks||{})[a.axis],y={horizontal:c,base:g.base,enableBorderRadius:!b||$i(p._custom)||o===b._top||o===b._bottom,x:c?g.head:m.center,y:c?m.center:g.head,height:c?m.size:Math.abs(g.size),width:c?Math.abs(g.size):m.size};d&&(y.options=u||this.resolveDataElementOptions(f,t[f].active?"active":n));const _=y.options||t[f].options;Wh(y,_,b,o),Vh(y,_,h.ratio),this.updateElement(t[f],f,y,n)}}_getStacks(t,e){const{iScale:i}=this._cachedMeta,n=i.getMatchingVisibleMetas(this._type).filter(h=>h.controller.options.grouped),r=i.options.stacked,o=[],a=this._cachedMeta.controller.getParsed(e),l=a&&a[i.axis],c=h=>{const u=h._parsed.find(f=>f[i.axis]===l),d=u&&u[h.vScale.axis];if(L(d)||isNaN(d))return!0};for(const h of n)if(!(e!==void 0&&c(h))&&((r===!1||o.indexOf(h.stack)===-1||r===void 0&&h.stack===void 0)&&o.push(h.stack),h.index===t))break;return o.length||o.push(void 0),o}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(i=>t[i].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const i of this.chart.data.datasets)t[P(this.chart.options.indexAxis==="x"?i.xAxisID:i.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,i){const n=this._getStacks(t,i),r=e!==void 0?n.indexOf(e):-1;return r===-1?n.length-1:r}_getRuler(){const t=this.options,e=this._cachedMeta,i=e.iScale,n=[];let r,o;for(r=0,o=e.data.length;r<o;++r)n.push(i.getPixelForValue(this.getParsed(r)[i.axis],r));const a=t.barThickness;return{min:a||jh(e),pixels:n,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:i,index:n},options:{base:r,minBarLength:o}}=this,a=r||0,l=this.getParsed(t),c=l._custom,h=$i(c);let u=l[e.axis],d=0,f=i?this.applyStack(e,l,i):u,p,g;f!==u&&(d=f-u,f=u),h&&(u=c.barStart,f=c.barEnd-c.barStart,u!==0&&Lt(u)!==Lt(c.barEnd)&&(d=0),d+=u);const m=!L(r)&&!h?r:d;let b=e.getPixelForValue(m);if(this.chart.getDataVisibility(t)?p=e.getPixelForValue(d+f):p=b,g=p-b,Math.abs(g)<o){g=Fh(g,e,a)*o,u===a&&(b-=g/2);const y=e.getPixelForDecimal(0),_=e.getPixelForDecimal(1),v=Math.min(y,_),x=Math.max(y,_);b=Math.max(Math.min(b,x),v),p=b+g,i&&!h&&(l._stacks[e.axis]._visualValues[n]=e.getValueForPixel(p)-e.getValueForPixel(b))}if(b===e.getPixelForValue(a)){const y=Lt(g)*e.getLineWidthForValue(a)/2;b+=y,g-=y}return{size:g,base:b,head:p,center:p+g/2}}_calculateBarIndexPixels(t,e){const i=e.scale,n=this.options,r=n.skipNull,o=P(n.maxBarThickness,1/0);let a,l;const c=this._getAxisCount();if(e.grouped){const h=r?this._getStackCount(t):e.stackCount,u=n.barThickness==="flex"?Nh(t,e,n,h*c):$h(t,e,n,h*c),d=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,f=this._getAxis().indexOf(P(d,this.getFirstScaleIdForIndexAxis())),p=this._getStackIndex(this.index,this._cachedMeta.stack,r?t:void 0)+f;a=u.start+u.chunk*p+u.chunk/2,l=Math.min(o,u.chunk*u.ratio)}else a=i.getPixelForValue(this.getParsed(t)[i.axis],t),l=Math.min(o,e.min*e.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const t=this._cachedMeta,e=t.vScale,i=t.data,n=i.length;let r=0;for(;r<n;++r)this.getParsed(r)[e.axis]!==null&&!i[r].hidden&&i[r].draw(this._ctx)}}class qh extends re{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,i,n){const r=super.parsePrimitiveData(t,e,i,n);for(let o=0;o<r.length;o++)r[o]._custom=this.resolveDataElementOptions(o+i).radius;return r}parseArrayData(t,e,i,n){const r=super.parseArrayData(t,e,i,n);for(let o=0;o<r.length;o++){const a=e[i+o];r[o]._custom=P(a[2],this.resolveDataElementOptions(o+i).radius)}return r}parseObjectData(t,e,i,n){const r=super.parseObjectData(t,e,i,n);for(let o=0;o<r.length;o++){const a=e[i+o];r[o]._custom=P(a&&a.r&&+a.r,this.resolveDataElementOptions(o+i).radius)}return r}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:r}=e,o=this.getParsed(t),a=n.getLabelForValue(o.x),l=r.getLabelForValue(o.y),c=o._custom;return{label:i[t]||"",value:"("+a+", "+l+(c?", "+c:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,i,n){const r=n==="reset",{iScale:o,vScale:a}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(e,n),h=o.axis,u=a.axis;for(let d=e;d<e+i;d++){const f=t[d],p=!r&&this.getParsed(d),g={},m=g[h]=r?o.getPixelForDecimal(.5):o.getPixelForValue(p[h]),b=g[u]=r?a.getBasePixel():a.getPixelForValue(p[u]);g.skip=isNaN(m)||isNaN(b),c&&(g.options=l||this.resolveDataElementOptions(d,f.active?"active":n),r&&(g.options.radius=0)),this.updateElement(f,d,g,n)}}resolveDataElementOptions(t,e){const i=this.getParsed(t);let n=super.resolveDataElementOptions(t,e);n.$shared&&(n=Object.assign({},n,{$shared:!1}));const r=n.radius;return e!=="active"&&(n.radius=0),n.radius+=P(i&&i._custom,r),n}}function Kh(s,t,e){let i=1,n=1,r=0,o=0;if(t<V){const a=s,l=a+t,c=Math.cos(a),h=Math.sin(a),u=Math.cos(l),d=Math.sin(l),f=(_,v,x)=>ys(_,a,l,!0)?1:Math.max(v,v*e,x,x*e),p=(_,v,x)=>ys(_,a,l,!0)?-1:Math.min(v,v*e,x,x*e),g=f(0,c,u),m=f(X,h,d),b=p(j,c,u),y=p(j+X,h,d);i=(g-b)/2,n=(m-y)/2,r=-(g+b)/2,o=-(m+y)/2}return{ratioX:i,ratioY:n,offsetX:r,offsetY:o}}class Un extends re{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data,{labels:{pointStyle:i,textAlign:n,color:r,useBorderRadius:o,borderRadius:a}}=t.legend.options;return e.labels.length&&e.datasets.length?e.labels.map((l,c)=>{const u=t.getDatasetMeta(0).controller.getStyle(c);return{text:l,fillStyle:u.backgroundColor,fontColor:r,hidden:!t.getDataVisibility(c),lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:u.borderWidth,strokeStyle:u.borderColor,textAlign:n,pointStyle:i,borderRadius:o&&(a||u.borderRadius),index:c}}):[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}}};constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const i=this.getDataset().data,n=this._cachedMeta;if(this._parsing===!1)n._parsed=i;else{let r=l=>+i[l];if(D(i[t])){const{key:l="value"}=this._parsing;r=c=>+ee(i[c],l)}let o,a;for(o=t,a=t+e;o<a;++o)n._parsed[o]=r(o)}}_getRotation(){return Ct(this.options.rotation-90)}_getCircumference(){return Ct(this.options.circumference)}_getRotationExtents(){let t=V,e=-V;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const n=this.chart.getDatasetMeta(i).controller,r=n._getRotation(),o=n._getCircumference();t=Math.min(t,r),e=Math.max(e,r+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:i}=e,n=this._cachedMeta,r=n.data,o=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,a=Math.max((Math.min(i.width,i.height)-o)/2,0),l=Math.min(ic(this.options.cutout,a),1),c=this._getRingWeight(this.index),{circumference:h,rotation:u}=this._getRotationExtents(),{ratioX:d,ratioY:f,offsetX:p,offsetY:g}=Kh(u,h,l),m=(i.width-o)/d,b=(i.height-o)/f,y=Math.max(Math.min(m,b)/2,0),_=ia(this.options.radius,y),v=Math.max(_*l,0),x=(_-v)/this._getVisibleDatasetWeightTotal();this.offsetX=p*_,this.offsetY=g*_,n.total=this.calculateTotal(),this.outerRadius=_-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*c,0),this.updateElements(r,0,r.length,t)}_circumference(t,e){const i=this.options,n=this._cachedMeta,r=this._getCircumference();return e&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||n._parsed[t]===null||n.data[t].hidden?0:this.calculateCircumference(n._parsed[t]*r/V)}updateElements(t,e,i,n){const r=n==="reset",o=this.chart,a=o.chartArea,c=o.options.animation,h=(a.left+a.right)/2,u=(a.top+a.bottom)/2,d=r&&c.animateScale,f=d?0:this.innerRadius,p=d?0:this.outerRadius,{sharedOptions:g,includeOptions:m}=this._getSharedOptions(e,n);let b=this._getRotation(),y;for(y=0;y<e;++y)b+=this._circumference(y,r);for(y=e;y<e+i;++y){const _=this._circumference(y,r),v=t[y],x={x:h+this.offsetX,y:u+this.offsetY,startAngle:b,endAngle:b+_,circumference:_,outerRadius:p,innerRadius:f};m&&(x.options=g||this.resolveDataElementOptions(y,v.active?"active":n)),b+=_,this.updateElement(v,y,x,n)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let i=0,n;for(n=0;n<e.length;n++){const r=t._parsed[n];r!==null&&!isNaN(r)&&this.chart.getDataVisibility(n)&&!e[n].hidden&&(i+=Math.abs(r))}return i}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?V*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,n=i.data.labels||[],r=Ps(e._parsed[t],i.options.locale);return{label:n[t]||"",value:r}}getMaxBorderWidth(t){let e=0;const i=this.chart;let n,r,o,a,l;if(!t){for(n=0,r=i.data.datasets.length;n<r;++n)if(i.isDatasetVisible(n)){o=i.getDatasetMeta(n),t=o.data,a=o.controller;break}}if(!t)return 0;for(n=0,r=t.length;n<r;++n)l=a.resolveDataElementOptions(n),l.borderAlign!=="inner"&&(e=Math.max(e,l.borderWidth||0,l.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let i=0,n=t.length;i<n;++i){const r=this.resolveDataElementOptions(i);e=Math.max(e,r.offset||0,r.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e}_getRingWeight(t){return Math.max(P(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class Gh extends re{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:n=[],_dataset:r}=e,o=this.chart._animationsDisabled;let{start:a,count:l}=ua(e,n,o);this._drawStart=a,this._drawCount=l,da(e)&&(a=0,l=n.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!r._decimated,i.points=n;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(i,void 0,{animated:!o,options:c},t),this.updateElements(n,a,l,t)}updateElements(t,e,i,n){const r=n==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:h,includeOptions:u}=this._getSharedOptions(e,n),d=o.axis,f=a.axis,{spanGaps:p,segment:g}=this.options,m=Ve(p)?p:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||r||n==="none",y=e+i,_=t.length;let v=e>0&&this.getParsed(e-1);for(let x=0;x<_;++x){const S=t[x],k=b?S:{};if(x<e||x>=y){k.skip=!0;continue}const E=this.getParsed(x),T=L(E[f]),R=k[d]=o.getPixelForValue(E[d],x),M=k[f]=r||T?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,E,l):E[f],x);k.skip=isNaN(R)||isNaN(M)||T,k.stop=x>0&&Math.abs(E[d]-v[d])>m,g&&(k.parsed=E,k.raw=c.data[x]),u&&(k.options=h||this.resolveDataElementOptions(x,S.active?"active":n)),b||this.updateElement(S,x,k,n),v=E}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,n=t.data||[];if(!n.length)return i;const r=n[0].size(this.resolveDataElementOptions(0)),o=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(i,r,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}class Ra extends re{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:n}}=t.legend.options;return e.labels.map((r,o)=>{const l=t.getDatasetMeta(0).controller.getStyle(o);return{text:r,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:n,lineWidth:l.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(o),index:o}})}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,n=i.data.labels||[],r=Ps(e._parsed[t].r,i.options.locale);return{label:n[t]||"",value:r}}parseObjectData(t,e,i,n){return va.bind(this)(t,e,i,n)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,n)=>{const r=this.getParsed(n).r;!isNaN(r)&&this.chart.getDataVisibility(n)&&(r<e.min&&(e.min=r),r>e.max&&(e.max=r))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,i=t.options,n=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(n/2,0),o=Math.max(i.cutoutPercentage?r/100*i.cutoutPercentage:1,0),a=(r-o)/t.getVisibleDatasetCount();this.outerRadius=r-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,i,n){const r=n==="reset",o=this.chart,l=o.options.animation,c=this._cachedMeta.rScale,h=c.xCenter,u=c.yCenter,d=c.getIndexAngle(0)-.5*j;let f=d,p;const g=360/this.countVisibleElements();for(p=0;p<e;++p)f+=this._computeAngle(p,n,g);for(p=e;p<e+i;p++){const m=t[p];let b=f,y=f+this._computeAngle(p,n,g),_=o.getDataVisibility(p)?c.getDistanceFromCenterForValue(this.getParsed(p).r):0;f=y,r&&(l.animateScale&&(_=0),l.animateRotate&&(b=y=d));const v={x:h,y:u,innerRadius:0,outerRadius:_,startAngle:b,endAngle:y,options:this.resolveDataElementOptions(p,m.active?"active":n)};this.updateElement(m,p,v,n)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((i,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&e++}),e}_computeAngle(t,e,i){return this.chart.getDataVisibility(t)?Ct(this.resolveDataElementOptions(t,e).angle||i):0}}class Jh extends Un{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}class Yh extends re{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(t){const e=this._cachedMeta.vScale,i=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(i[e.axis])}}parseObjectData(t,e,i,n){return va.bind(this)(t,e,i,n)}update(t){const e=this._cachedMeta,i=e.dataset,n=e.data||[],r=e.iScale.getLabels();if(i.points=n,t!=="resize"){const o=this.resolveDatasetElementOptions(t);this.options.showLine||(o.borderWidth=0);const a={_loop:!0,_fullLoop:r.length===n.length,options:o};this.updateElement(i,void 0,a,t)}this.updateElements(n,0,n.length,t)}updateElements(t,e,i,n){const r=this._cachedMeta.rScale,o=n==="reset";for(let a=e;a<e+i;a++){const l=t[a],c=this.resolveDataElementOptions(a,l.active?"active":n),h=r.getPointPositionForValue(a,this.getParsed(a).r),u=o?r.xCenter:h.x,d=o?r.yCenter:h.y,f={x:u,y:d,angle:h.angle,skip:isNaN(u)||isNaN(d),options:c};this.updateElement(l,a,f,n)}}}class Xh extends re{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:r}=e,o=this.getParsed(t),a=n.getLabelForValue(o.x),l=r.getLabelForValue(o.y);return{label:i[t]||"",value:"("+a+", "+l+")"}}update(t){const e=this._cachedMeta,{data:i=[]}=e,n=this.chart._animationsDisabled;let{start:r,count:o}=ua(e,i,n);if(this._drawStart=r,this._drawCount=o,da(e)&&(r=0,o=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:l}=e;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!l._decimated,a.points=i;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(a,void 0,{animated:!n,options:c},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(i,r,o,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,i,n){const r=n==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,h=this.resolveDataElementOptions(e,n),u=this.getSharedOptions(h),d=this.includeOptions(n,u),f=o.axis,p=a.axis,{spanGaps:g,segment:m}=this.options,b=Ve(g)?g:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||r||n==="none";let _=e>0&&this.getParsed(e-1);for(let v=e;v<e+i;++v){const x=t[v],S=this.getParsed(v),k=y?x:{},E=L(S[p]),T=k[f]=o.getPixelForValue(S[f],v),R=k[p]=r||E?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,S,l):S[p],v);k.skip=isNaN(T)||isNaN(R)||E,k.stop=v>0&&Math.abs(S[f]-_[f])>b,m&&(k.parsed=S,k.raw=c.data[v]),d&&(k.options=u||this.resolveDataElementOptions(v,x.active?"active":n)),y||this.updateElement(x,v,k,n),_=S}this.updateSharedOptions(u,n,h)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let a=0;for(let l=e.length-1;l>=0;--l)a=Math.max(a,e[l].size(this.resolveDataElementOptions(l))/2);return a>0&&a}const i=t.dataset,n=i.options&&i.options.borderWidth||0;if(!e.length)return n;const r=e[0].size(this.resolveDataElementOptions(0)),o=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(n,r,o)/2}}var Zh=Object.freeze({__proto__:null,BarController:Hh,BubbleController:qh,DoughnutController:Un,LineController:Gh,PieController:Jh,PolarAreaController:Ra,RadarController:Yh,ScatterController:Xh});function he(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Wn{static override(t){Object.assign(Wn.prototype,t)}options;constructor(t){this.options=t||{}}init(){}formats(){return he()}parse(){return he()}format(){return he()}add(){return he()}diff(){return he()}startOf(){return he()}endOf(){return he()}}var Qh={_date:Wn};function tu(s,t,e,i){const{controller:n,data:r,_sorted:o}=s,a=n._cachedMeta.iScale,l=s.dataset&&s.dataset.options?s.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&o&&r.length){const c=a._reversePixels?mc:Ut;if(i){if(n._sharedOptions){const h=r[0],u=typeof h.getRange=="function"&&h.getRange(t);if(u){const d=c(r,t,e-u),f=c(r,t,e+u);return{lo:d.lo,hi:f.hi}}}}else{const h=c(r,t,e);if(l){const{vScale:u}=n._cachedMeta,{_parsed:d}=s,f=d.slice(0,h.lo+1).reverse().findIndex(g=>!L(g[u.axis]));h.lo-=Math.max(0,f);const p=d.slice(h.hi).findIndex(g=>!L(g[u.axis]));h.hi+=Math.max(0,p)}return h}}return{lo:0,hi:r.length-1}}function wi(s,t,e,i,n){const r=s.getSortedVisibleDatasetMetas(),o=e[t];for(let a=0,l=r.length;a<l;++a){const{index:c,data:h}=r[a],{lo:u,hi:d}=tu(r[a],t,o,n);for(let f=u;f<=d;++f){const p=h[f];p.skip||i(p,c,f)}}}function eu(s){const t=s.indexOf("x")!==-1,e=s.indexOf("y")!==-1;return function(i,n){const r=t?Math.abs(i.x-n.x):0,o=e?Math.abs(i.y-n.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))}}function Ni(s,t,e,i,n){const r=[];return!n&&!s.isPointInArea(t)||wi(s,e,t,function(a,l,c){!n&&!Wt(a,s.chartArea,0)||a.inRange(t.x,t.y,i)&&r.push({element:a,datasetIndex:l,index:c})},!0),r}function su(s,t,e,i){let n=[];function r(o,a,l){const{startAngle:c,endAngle:h}=o.getProps(["startAngle","endAngle"],i),{angle:u}=oa(o,{x:t.x,y:t.y});ys(u,c,h)&&n.push({element:o,datasetIndex:a,index:l})}return wi(s,e,t,r),n}function iu(s,t,e,i,n,r){let o=[];const a=eu(e);let l=Number.POSITIVE_INFINITY;function c(h,u,d){const f=h.inRange(t.x,t.y,n);if(i&&!f)return;const p=h.getCenterPoint(n);if(!(!!r||s.isPointInArea(p))&&!f)return;const m=a(t,p);m<l?(o=[{element:h,datasetIndex:u,index:d}],l=m):m===l&&o.push({element:h,datasetIndex:u,index:d})}return wi(s,e,t,c),o}function Bi(s,t,e,i,n,r){return!r&&!s.isPointInArea(t)?[]:e==="r"&&!i?su(s,t,e,n):iu(s,t,e,i,n,r)}function Rr(s,t,e,i,n){const r=[],o=e==="x"?"inXRange":"inYRange";let a=!1;return wi(s,e,t,(l,c,h)=>{l[o]&&l[o](t[e],n)&&(r.push({element:l,datasetIndex:c,index:h}),a=a||l.inRange(t.x,t.y,n))}),i&&!a?[]:r}var nu={modes:{index(s,t,e,i){const n=pe(t,s),r=e.axis||"x",o=e.includeInvisible||!1,a=e.intersect?Ni(s,n,r,i,o):Bi(s,n,r,!1,i,o),l=[];return a.length?(s.getSortedVisibleDatasetMetas().forEach(c=>{const h=a[0].index,u=c.data[h];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:h})}),l):[]},dataset(s,t,e,i){const n=pe(t,s),r=e.axis||"xy",o=e.includeInvisible||!1;let a=e.intersect?Ni(s,n,r,i,o):Bi(s,n,r,!1,i,o);if(a.length>0){const l=a[0].datasetIndex,c=s.getDatasetMeta(l).data;a=[];for(let h=0;h<c.length;++h)a.push({element:c[h],datasetIndex:l,index:h})}return a},point(s,t,e,i){const n=pe(t,s),r=e.axis||"xy",o=e.includeInvisible||!1;return Ni(s,n,r,i,o)},nearest(s,t,e,i){const n=pe(t,s),r=e.axis||"xy",o=e.includeInvisible||!1;return Bi(s,n,r,e.intersect,i,o)},x(s,t,e,i){const n=pe(t,s);return Rr(s,n,"x",e.intersect,i)},y(s,t,e,i){const n=pe(t,s);return Rr(s,n,"y",e.intersect,i)}}};const Ma=["left","top","right","bottom"];function Xe(s,t){return s.filter(e=>e.pos===t)}function Mr(s,t){return s.filter(e=>Ma.indexOf(e.pos)===-1&&e.box.axis===t)}function Ze(s,t){return s.sort((e,i)=>{const n=t?i:e,r=t?e:i;return n.weight===r.weight?n.index-r.index:n.weight-r.weight})}function ru(s){const t=[];let e,i,n,r,o,a;for(e=0,i=(s||[]).length;e<i;++e)n=s[e],{position:r,options:{stack:o,stackWeight:a=1}}=n,t.push({index:e,box:n,pos:r,horizontal:n.isHorizontal(),weight:n.weight,stack:o&&r+o,stackWeight:a});return t}function ou(s){const t={};for(const e of s){const{stack:i,pos:n,stackWeight:r}=e;if(!i||!Ma.includes(n))continue;const o=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=r}return t}function au(s,t){const e=ou(s),{vBoxMaxWidth:i,hBoxMaxHeight:n}=t;let r,o,a;for(r=0,o=s.length;r<o;++r){a=s[r];const{fullSize:l}=a.box,c=e[a.stack],h=c&&a.stackWeight/c.weight;a.horizontal?(a.width=h?h*i:l&&t.availableWidth,a.height=n):(a.width=i,a.height=h?h*n:l&&t.availableHeight)}return e}function lu(s){const t=ru(s),e=Ze(t.filter(c=>c.box.fullSize),!0),i=Ze(Xe(t,"left"),!0),n=Ze(Xe(t,"right")),r=Ze(Xe(t,"top"),!0),o=Ze(Xe(t,"bottom")),a=Mr(t,"x"),l=Mr(t,"y");return{fullSize:e,leftAndTop:i.concat(r),rightAndBottom:n.concat(l).concat(o).concat(a),chartArea:Xe(t,"chartArea"),vertical:i.concat(n).concat(l),horizontal:r.concat(o).concat(a)}}function Lr(s,t,e,i){return Math.max(s[e],t[e])+Math.max(s[i],t[i])}function La(s,t){s.top=Math.max(s.top,t.top),s.left=Math.max(s.left,t.left),s.bottom=Math.max(s.bottom,t.bottom),s.right=Math.max(s.right,t.right)}function cu(s,t,e,i){const{pos:n,box:r}=e,o=s.maxPadding;if(!D(n)){e.size&&(s[n]-=e.size);const u=i[e.stack]||{size:0,count:1};u.size=Math.max(u.size,e.horizontal?r.height:r.width),e.size=u.size/u.count,s[n]+=e.size}r.getPadding&&La(o,r.getPadding());const a=Math.max(0,t.outerWidth-Lr(o,s,"left","right")),l=Math.max(0,t.outerHeight-Lr(o,s,"top","bottom")),c=a!==s.w,h=l!==s.h;return s.w=a,s.h=l,e.horizontal?{same:c,other:h}:{same:h,other:c}}function hu(s){const t=s.maxPadding;function e(i){const n=Math.max(t[i]-s[i],0);return s[i]+=n,n}s.y+=e("top"),s.x+=e("left"),e("right"),e("bottom")}function uu(s,t){const e=t.maxPadding;function i(n){const r={left:0,top:0,right:0,bottom:0};return n.forEach(o=>{r[o]=Math.max(t[o],e[o])}),r}return i(s?["left","right"]:["top","bottom"])}function os(s,t,e,i){const n=[];let r,o,a,l,c,h;for(r=0,o=s.length,c=0;r<o;++r){a=s[r],l=a.box,l.update(a.width||t.w,a.height||t.h,uu(a.horizontal,t));const{same:u,other:d}=cu(t,e,a,i);c|=u&&n.length,h=h||d,l.fullSize||n.push(a)}return c&&os(n,t,e,i)||h}function Bs(s,t,e,i,n){s.top=e,s.left=t,s.right=t+i,s.bottom=e+n,s.width=i,s.height=n}function Dr(s,t,e,i){const n=e.padding;let{x:r,y:o}=t;for(const a of s){const l=a.box,c=i[a.stack]||{placed:0,weight:1},h=a.stackWeight/c.weight||1;if(a.horizontal){const u=t.w*h,d=c.size||l.height;bs(c.start)&&(o=c.start),l.fullSize?Bs(l,n.left,o,e.outerWidth-n.right-n.left,d):Bs(l,t.left+c.placed,o,u,d),c.start=o,c.placed+=u,o=l.bottom}else{const u=t.h*h,d=c.size||l.width;bs(c.start)&&(r=c.start),l.fullSize?Bs(l,r,n.top,d,e.outerHeight-n.bottom-n.top):Bs(l,r,t.top+c.placed,d,u),c.start=r,c.placed+=u,r=l.right}}t.x=r,t.y=o}var ut={addBox(s,t){s.boxes||(s.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},s.boxes.push(t)},removeBox(s,t){const e=s.boxes?s.boxes.indexOf(t):-1;e!==-1&&s.boxes.splice(e,1)},configure(s,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(s,t,e,i){if(!s)return;const n=dt(s.options.layout.padding),r=Math.max(t-n.width,0),o=Math.max(e-n.height,0),a=lu(s.boxes),l=a.vertical,c=a.horizontal;N(s.boxes,g=>{typeof g.beforeLayout=="function"&&g.beforeLayout()});const h=l.reduce((g,m)=>m.box.options&&m.box.options.display===!1?g:g+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:e,padding:n,availableWidth:r,availableHeight:o,vBoxMaxWidth:r/2/h,hBoxMaxHeight:o/2}),d=Object.assign({},n);La(d,dt(i));const f=Object.assign({maxPadding:d,w:r,h:o,x:n.left,y:n.top},n),p=au(l.concat(c),u);os(a.fullSize,f,u,p),os(l,f,u,p),os(c,f,u,p)&&os(l,f,u,p),hu(f),Dr(a.leftAndTop,f,u,p),f.x+=f.w,f.y+=f.h,Dr(a.rightAndBottom,f,u,p),s.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},N(a.chartArea,g=>{const m=g.box;Object.assign(m,s.chartArea),m.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class Da{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,n){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,n?Math.floor(e/n):i)}}isAttached(t){return!0}updateConfig(t){}}class du extends Da{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const ti="$chartjs",fu={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Ir=s=>s===null||s==="";function gu(s,t){const e=s.style,i=s.getAttribute("height"),n=s.getAttribute("width");if(s[ti]={initial:{height:i,width:n,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",Ir(n)){const r=yr(s,"width");r!==void 0&&(s.width=r)}if(Ir(i))if(s.style.height==="")s.height=s.width/(t||2);else{const r=yr(s,"height");r!==void 0&&(s.height=r)}return s}const Ia=ch?{passive:!0}:!1;function pu(s,t,e){s&&s.addEventListener(t,e,Ia)}function mu(s,t,e){s&&s.canvas&&s.canvas.removeEventListener(t,e,Ia)}function bu(s,t){const e=fu[s.type]||s.type,{x:i,y:n}=pe(s,t);return{type:e,chart:t,native:s,x:i!==void 0?i:null,y:n!==void 0?n:null}}function ci(s,t){for(const e of s)if(e===t||e.contains(t))return!0}function yu(s,t,e){const i=s.canvas,n=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||ci(a.addedNodes,i),o=o&&!ci(a.removedNodes,i);o&&e()});return n.observe(document,{childList:!0,subtree:!0}),n}function _u(s,t,e){const i=s.canvas,n=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||ci(a.removedNodes,i),o=o&&!ci(a.addedNodes,i);o&&e()});return n.observe(document,{childList:!0,subtree:!0}),n}const vs=new Map;let jr=0;function ja(){const s=window.devicePixelRatio;s!==jr&&(jr=s,vs.forEach((t,e)=>{e.currentDevicePixelRatio!==s&&t()}))}function vu(s,t){vs.size||window.addEventListener("resize",ja),vs.set(s,t)}function wu(s){vs.delete(s),vs.size||window.removeEventListener("resize",ja)}function xu(s,t,e){const i=s.canvas,n=i&&Fn(i);if(!n)return;const r=ha((a,l)=>{const c=n.clientWidth;e(a,l),c<n.clientWidth&&e()},window),o=new ResizeObserver(a=>{const l=a[0],c=l.contentRect.width,h=l.contentRect.height;c===0&&h===0||r(c,h)});return o.observe(n),vu(s,r),o}function Fi(s,t,e){e&&e.disconnect(),t==="resize"&&wu(s)}function Su(s,t,e){const i=s.canvas,n=ha(r=>{s.ctx!==null&&e(bu(r,s))},s);return pu(i,t,n),n}class ku extends Da{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(gu(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e[ti])return!1;const i=e[ti].initial;["height","width"].forEach(r=>{const o=i[r];L(o)?e.removeAttribute(r):e.setAttribute(r,o)});const n=i.style||{};return Object.keys(n).forEach(r=>{e.style[r]=n[r]}),e.width=e.width,delete e[ti],!0}addEventListener(t,e,i){this.removeEventListener(t,e);const n=t.$proxies||(t.$proxies={}),o={attach:yu,detach:_u,resize:xu}[e]||Su;n[e]=o(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),n=i[e];if(!n)return;({attach:Fi,detach:Fi,resize:Fi}[e]||mu)(t,e,n),i[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,n){return lh(t,e,i,n)}isAttached(t){const e=t&&Fn(t);return!!(e&&e.isConnected)}}function Eu(s){return!Bn()||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas?du:ku}class zt{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return Ve(this.x)&&Ve(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const n={};return t.forEach(r=>{n[r]=i[r]&&i[r].active()?i[r]._to:this[r]}),n}}function Tu(s,t){const e=s.options.ticks,i=Au(s),n=Math.min(e.maxTicksLimit||i,i),r=e.major.enabled?Cu(t):[],o=r.length,a=r[0],l=r[o-1],c=[];if(o>n)return Pu(t,c,r,o/n),c;const h=Ou(r,t,n);if(o>0){let u,d;const f=o>1?Math.round((l-a)/(o-1)):null;for(Fs(t,c,h,L(f)?0:a-f,a),u=0,d=o-1;u<d;u++)Fs(t,c,h,r[u],r[u+1]);return Fs(t,c,h,l,L(f)?t.length:l+f),c}return Fs(t,c,h),c}function Au(s){const t=s.options.offset,e=s._tickSize(),i=s._length/e+(t?0:1),n=s._maxLength/e;return Math.floor(Math.min(i,n))}function Ou(s,t,e){const i=Ru(s),n=t.length/e;if(!i)return Math.max(n,1);const r=uc(i);for(let o=0,a=r.length-1;o<a;o++){const l=r[o];if(l>n)return l}return Math.max(n,1)}function Cu(s){const t=[];let e,i;for(e=0,i=s.length;e<i;e++)s[e].major&&t.push(e);return t}function Pu(s,t,e,i){let n=0,r=e[0],o;for(i=Math.ceil(i),o=0;o<s.length;o++)o===r&&(t.push(s[o]),n++,r=e[n*i])}function Fs(s,t,e,i,n){const r=P(i,0),o=Math.min(P(n,s.length),s.length);let a=0,l,c,h;for(e=Math.ceil(e),n&&(l=n-i,e=l/Math.floor(l/e)),h=r;h<0;)a++,h=Math.round(r+a*e);for(c=Math.max(r,0);c<o;c++)c===h&&(t.push(s[c]),a++,h=Math.round(r+a*e))}function Ru(s){const t=s.length;let e,i;if(t<2)return!1;for(i=s[0],e=1;e<t;++e)if(s[e]-s[e-1]!==i)return!1;return i}const Mu=s=>s==="left"?"right":s==="right"?"left":s,$r=(s,t,e)=>t==="top"||t==="left"?s[t]+e:s[t]-e,Nr=(s,t)=>Math.min(t||s,s);function Br(s,t){const e=[],i=s.length/t,n=s.length;let r=0;for(;r<n;r+=i)e.push(s[Math.floor(r)]);return e}function Lu(s,t,e){const i=s.ticks.length,n=Math.min(t,i-1),r=s._startPixel,o=s._endPixel,a=1e-6;let l=s.getPixelForTick(n),c;if(!(e&&(i===1?c=Math.max(l-r,o-l):t===0?c=(s.getPixelForTick(1)-l)/2:c=(l-s.getPixelForTick(n-1))/2,l+=n<t?c:-c,l<r-a||l>o+a)))return l}function Du(s,t){N(s,e=>{const i=e.gc,n=i.length/2;let r;if(n>t){for(r=0;r<n;++r)delete e.data[i[r]];i.splice(0,n)}})}function Qe(s){return s.drawTicks?s.tickLength:0}function Fr(s,t){if(!s.display)return 0;const e=tt(s.font,t),i=dt(s.padding);return(q(s.text)?s.text.length:1)*e.lineHeight+i.height}function Iu(s,t){return ne(s,{scale:t,type:"scale"})}function ju(s,t,e){return ne(s,{tick:e,index:t,type:"tick"})}function $u(s,t,e){let i=Ln(s);return(e&&t!=="right"||!e&&t==="right")&&(i=Mu(i)),i}function Nu(s,t,e,i){const{top:n,left:r,bottom:o,right:a,chart:l}=s,{chartArea:c,scales:h}=l;let u=0,d,f,p;const g=o-n,m=a-r;if(s.isHorizontal()){if(f=ct(i,r,a),D(e)){const b=Object.keys(e)[0],y=e[b];p=h[b].getPixelForValue(y)+g-t}else e==="center"?p=(c.bottom+c.top)/2+g-t:p=$r(s,e,t);d=a-r}else{if(D(e)){const b=Object.keys(e)[0],y=e[b];f=h[b].getPixelForValue(y)-m+t}else e==="center"?f=(c.left+c.right)/2-m+t:f=$r(s,e,t);p=ct(i,o,n),u=e==="left"?-X:X}return{titleX:f,titleY:p,maxWidth:d,rotation:u}}class Te extends zt{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:n}=this;return t=yt(t,Number.POSITIVE_INFINITY),e=yt(e,Number.NEGATIVE_INFINITY),i=yt(i,Number.POSITIVE_INFINITY),n=yt(n,Number.NEGATIVE_INFINITY),{min:yt(t,i),max:yt(e,n),minDefined:J(t),maxDefined:J(e)}}getMinMax(t){let{min:e,max:i,minDefined:n,maxDefined:r}=this.getUserBounds(),o;if(n&&r)return{min:e,max:i};const a=this.getMatchingVisibleMetas();for(let l=0,c=a.length;l<c;++l)o=a[l].controller.getMinMax(this,t),n||(e=Math.min(e,o.min)),r||(i=Math.max(i,o.max));return e=r&&e>i?i:e,i=n&&e>i?e:i,{min:yt(e,yt(i,e)),max:yt(i,yt(e,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){z(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:n,grace:r,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Fc(this,r,n),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?Br(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=Tu(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,i;this.isHorizontal()?(e=this.left,i=this.right):(e=this.top,i=this.bottom,t=!t),this._startPixel=e,this._endPixel=i,this._reversePixels=t,this._length=i-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){z(this.options.afterUpdate,[this])}beforeSetDimensions(){z(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){z(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),z(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){z(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,n,r;for(i=0,n=t.length;i<n;i++)r=t[i],r.label=z(e.callback,[r.value,i,t],this)}afterTickToLabelConversion(){z(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){z(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=Nr(this.ticks.length,t.ticks.maxTicksLimit),n=e.minRotation||0,r=e.maxRotation;let o=n,a,l,c;if(!this._isVisible()||!e.display||n>=r||i<=1||!this.isHorizontal()){this.labelRotation=n;return}const h=this._getLabelSizes(),u=h.widest.width,d=h.highest.height,f=et(this.chart.width-u,0,this.maxWidth);a=t.offset?this.maxWidth/i:f/(i-1),u+6>a&&(a=f/(i-(t.offset?.5:1)),l=this.maxHeight-Qe(t.grid)-e.padding-Fr(t.title,this.chart.options.font),c=Math.sqrt(u*u+d*d),o=Rn(Math.min(Math.asin(et((h.highest.height+6)/a,-1,1)),Math.asin(et(l/c,-1,1))-Math.asin(et(d/c,-1,1)))),o=Math.max(n,Math.min(r,o))),this.labelRotation=o}afterCalculateLabelRotation(){z(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){z(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:n,grid:r}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const l=Fr(n,e.options.font);if(a?(t.width=this.maxWidth,t.height=Qe(r)+l):(t.height=this.maxHeight,t.width=Qe(r)+l),i.display&&this.ticks.length){const{first:c,last:h,widest:u,highest:d}=this._getLabelSizes(),f=i.padding*2,p=Ct(this.labelRotation),g=Math.cos(p),m=Math.sin(p);if(a){const b=i.mirror?0:m*u.width+g*d.height;t.height=Math.min(this.maxHeight,t.height+b+f)}else{const b=i.mirror?0:g*u.width+m*d.height;t.width=Math.min(this.maxWidth,t.width+b+f)}this._calculatePadding(c,h,m,g)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,n){const{ticks:{align:r,padding:o},position:a}=this.options,l=this.labelRotation!==0,c=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const h=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let d=0,f=0;l?c?(d=n*t.width,f=i*e.height):(d=i*t.height,f=n*e.width):r==="start"?f=e.width:r==="end"?d=t.width:r!=="inner"&&(d=t.width/2,f=e.width/2),this.paddingLeft=Math.max((d-h+o)*this.width/(this.width-h),0),this.paddingRight=Math.max((f-u+o)*this.width/(this.width-u),0)}else{let h=e.height/2,u=t.height/2;r==="start"?(h=0,u=t.height):r==="end"&&(h=e.height,u=0),this.paddingTop=h+o,this.paddingBottom=u+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){z(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,i;for(e=0,i=t.length;e<i;e++)L(t[e].label)&&(t.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=Br(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,i){const{ctx:n,_longestTextCache:r}=this,o=[],a=[],l=Math.floor(e/Nr(e,i));let c=0,h=0,u,d,f,p,g,m,b,y,_,v,x;for(u=0;u<e;u+=l){if(p=t[u].label,g=this._resolveTickFontOptions(u),n.font=m=g.string,b=r[m]=r[m]||{data:{},gc:[]},y=g.lineHeight,_=v=0,!L(p)&&!q(p))_=ai(n,b.data,b.gc,_,p),v=y;else if(q(p))for(d=0,f=p.length;d<f;++d)x=p[d],!L(x)&&!q(x)&&(_=ai(n,b.data,b.gc,_,x),v+=y);o.push(_),a.push(v),c=Math.max(_,c),h=Math.max(v,h)}Du(r,e);const S=o.indexOf(c),k=a.indexOf(h),E=T=>({width:o[T]||0,height:a[T]||0});return{first:E(0),last:E(e-1),widest:E(S),highest:E(k),widths:o,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return pc(this._alignToPixels?ce(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=ju(this.getContext(),t,i))}return this.$context||(this.$context=Iu(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=Ct(this.labelRotation),i=Math.abs(Math.cos(e)),n=Math.abs(Math.sin(e)),r=this._getLabelSizes(),o=t.autoSkipPadding||0,a=r?r.widest.width+o:0,l=r?r.highest.height+o:0;return this.isHorizontal()?l*i>a*n?a/i:l/n:l*n<a*i?l/i:a/n}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,n=this.options,{grid:r,position:o,border:a}=n,l=r.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),d=Qe(r),f=[],p=a.setContext(this.getContext()),g=p.display?p.width:0,m=g/2,b=function(H){return ce(i,H,g)};let y,_,v,x,S,k,E,T,R,M,I,it;if(o==="top")y=b(this.bottom),k=this.bottom-d,T=y-m,M=b(t.top)+m,it=t.bottom;else if(o==="bottom")y=b(this.top),M=t.top,it=b(t.bottom)-m,k=y+m,T=this.top+d;else if(o==="left")y=b(this.right),S=this.right-d,E=y-m,R=b(t.left)+m,I=t.right;else if(o==="right")y=b(this.left),R=t.left,I=b(t.right)-m,S=y+m,E=this.left+d;else if(e==="x"){if(o==="center")y=b((t.top+t.bottom)/2+.5);else if(D(o)){const H=Object.keys(o)[0],Y=o[H];y=b(this.chart.scales[H].getPixelForValue(Y))}M=t.top,it=t.bottom,k=y+m,T=k+d}else if(e==="y"){if(o==="center")y=b((t.left+t.right)/2);else if(D(o)){const H=Object.keys(o)[0],Y=o[H];y=b(this.chart.scales[H].getPixelForValue(Y))}S=y-m,E=S-d,R=t.left,I=t.right}const mt=P(n.ticks.maxTicksLimit,u),F=Math.max(1,Math.ceil(u/mt));for(_=0;_<u;_+=F){const H=this.getContext(_),Y=r.setContext(H),St=a.setContext(H),lt=Y.lineWidth,Ae=Y.color,Ms=St.dash||[],Oe=St.dashOffset,Ge=Y.tickWidth,oe=Y.tickColor,Je=Y.tickBorderDash||[],ae=Y.tickBorderDashOffset;v=Lu(this,_,l),v!==void 0&&(x=ce(i,v,lt),c?S=E=R=I=x:k=T=M=it=x,f.push({tx1:S,ty1:k,tx2:E,ty2:T,x1:R,y1:M,x2:I,y2:it,width:lt,color:Ae,borderDash:Ms,borderDashOffset:Oe,tickWidth:Ge,tickColor:oe,tickBorderDash:Je,tickBorderDashOffset:ae}))}return this._ticksLength=u,this._borderValue=y,f}_computeLabelItems(t){const e=this.axis,i=this.options,{position:n,ticks:r}=i,o=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:c,padding:h,mirror:u}=r,d=Qe(i.grid),f=d+h,p=u?-h:f,g=-Ct(this.labelRotation),m=[];let b,y,_,v,x,S,k,E,T,R,M,I,it="middle";if(n==="top")S=this.bottom-p,k=this._getXAxisLabelAlignment();else if(n==="bottom")S=this.top+p,k=this._getXAxisLabelAlignment();else if(n==="left"){const F=this._getYAxisLabelAlignment(d);k=F.textAlign,x=F.x}else if(n==="right"){const F=this._getYAxisLabelAlignment(d);k=F.textAlign,x=F.x}else if(e==="x"){if(n==="center")S=(t.top+t.bottom)/2+f;else if(D(n)){const F=Object.keys(n)[0],H=n[F];S=this.chart.scales[F].getPixelForValue(H)+f}k=this._getXAxisLabelAlignment()}else if(e==="y"){if(n==="center")x=(t.left+t.right)/2-f;else if(D(n)){const F=Object.keys(n)[0],H=n[F];x=this.chart.scales[F].getPixelForValue(H)}k=this._getYAxisLabelAlignment(d).textAlign}e==="y"&&(l==="start"?it="top":l==="end"&&(it="bottom"));const mt=this._getLabelSizes();for(b=0,y=a.length;b<y;++b){_=a[b],v=_.label;const F=r.setContext(this.getContext(b));E=this.getPixelForTick(b)+r.labelOffset,T=this._resolveTickFontOptions(b),R=T.lineHeight,M=q(v)?v.length:1;const H=M/2,Y=F.color,St=F.textStrokeColor,lt=F.textStrokeWidth;let Ae=k;o?(x=E,k==="inner"&&(b===y-1?Ae=this.options.reverse?"left":"right":b===0?Ae=this.options.reverse?"right":"left":Ae="center"),n==="top"?c==="near"||g!==0?I=-M*R+R/2:c==="center"?I=-mt.highest.height/2-H*R+R:I=-mt.highest.height+R/2:c==="near"||g!==0?I=R/2:c==="center"?I=mt.highest.height/2-H*R:I=mt.highest.height-M*R,u&&(I*=-1),g!==0&&!F.showLabelBackdrop&&(x+=R/2*Math.sin(g))):(S=E,I=(1-M)*R/2);let Ms;if(F.showLabelBackdrop){const Oe=dt(F.backdropPadding),Ge=mt.heights[b],oe=mt.widths[b];let Je=I-Oe.top,ae=0-Oe.left;switch(it){case"middle":Je-=Ge/2;break;case"bottom":Je-=Ge;break}switch(k){case"center":ae-=oe/2;break;case"right":ae-=oe;break;case"inner":b===y-1?ae-=oe:b>0&&(ae-=oe/2);break}Ms={left:ae,top:Je,width:oe+Oe.width,height:Ge+Oe.height,color:F.backdropColor}}m.push({label:v,font:T,textOffset:I,options:{rotation:g,color:Y,strokeColor:St,strokeWidth:lt,textAlign:Ae,textBaseline:it,translation:[x,S],backdrop:Ms}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-Ct(this.labelRotation))return t==="top"?"left":"right";let n="center";return e.align==="start"?n="left":e.align==="end"?n="right":e.align==="inner"&&(n="inner"),n}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:n,padding:r}}=this.options,o=this._getLabelSizes(),a=t+r,l=o.widest.width;let c,h;return e==="left"?n?(h=this.right+r,i==="near"?c="left":i==="center"?(c="center",h+=l/2):(c="right",h+=l)):(h=this.right-a,i==="near"?c="right":i==="center"?(c="center",h-=l/2):(c="left",h=this.left)):e==="right"?n?(h=this.left+r,i==="near"?c="right":i==="center"?(c="center",h-=l/2):(c="left",h-=l)):(h=this.left+a,i==="near"?c="left":i==="center"?(c="center",h+=l/2):(c="right",h=this.right)):c="right",{textAlign:c,x:h}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:n,width:r,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,n,r,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const n=this.ticks.findIndex(r=>r.value===t);return n>=0?e.setContext(this.getContext(n)).lineWidth:0}drawGrid(t){const e=this.options.grid,i=this.ctx,n=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,o;const a=(l,c,h)=>{!h.width||!h.color||(i.save(),i.lineWidth=h.width,i.strokeStyle=h.color,i.setLineDash(h.borderDash||[]),i.lineDashOffset=h.borderDashOffset,i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(c.x,c.y),i.stroke(),i.restore())};if(e.display)for(r=0,o=n.length;r<o;++r){const l=n[r];e.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),e.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:i,grid:n}}=this,r=i.setContext(this.getContext()),o=i.display?r.width:0;if(!o)return;const a=n.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,h,u,d;this.isHorizontal()?(c=ce(t,this.left,o)-o/2,h=ce(t,this.right,a)+a/2,u=d=l):(u=ce(t,this.top,o)-o/2,d=ce(t,this.bottom,a)+a/2,c=h=l),e.save(),e.lineWidth=r.width,e.strokeStyle=r.color,e.beginPath(),e.moveTo(c,u),e.lineTo(h,d),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,n=this._computeLabelArea();n&&yi(i,n);const r=this.getLabelItems(t);for(const o of r){const a=o.options,l=o.font,c=o.label,h=o.textOffset;Ee(i,c,0,h,l,a)}n&&_i(i)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:n}}=this;if(!i.display)return;const r=tt(i.font),o=dt(i.padding),a=i.align;let l=r.lineHeight/2;e==="bottom"||e==="center"||D(e)?(l+=o.bottom,q(i.text)&&(l+=r.lineHeight*(i.text.length-1))):l+=o.top;const{titleX:c,titleY:h,maxWidth:u,rotation:d}=Nu(this,l,e,a);Ee(t,i.text,0,0,r,{color:i.color,maxWidth:u,rotation:d,textAlign:$u(a,e,n),textBaseline:"middle",translation:[c,h]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=P(t.grid&&t.grid.z,-1),n=P(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==Te.prototype.draw?[{z:e,draw:r=>{this.draw(r)}}]:[{z:i,draw:r=>{this.drawBackground(),this.drawGrid(r),this.drawTitle()}},{z:n,draw:()=>{this.drawBorder()}},{z:e,draw:r=>{this.drawLabels(r)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",n=[];let r,o;for(r=0,o=e.length;r<o;++r){const a=e[r];a[i]===this.id&&(!t||a.type===t)&&n.push(a)}return n}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return tt(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class Us{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;Uu(e)&&(i=this.register(e));const n=this.items,r=t.id,o=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in n||(n[r]=t,Bu(t,o,i),this.override&&K.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,n=this.scope;i in e&&delete e[i],n&&i in K[n]&&(delete K[n][i],this.override&&delete ke[i])}}function Bu(s,t,e){const i=ms(Object.create(null),[e?K.get(e):{},K.get(t),s.defaults]);K.set(t,i),s.defaultRoutes&&Fu(t,s.defaultRoutes),s.descriptors&&K.describe(t,s.descriptors)}function Fu(s,t){Object.keys(t).forEach(e=>{const i=e.split("."),n=i.pop(),r=[s].concat(i).join("."),o=t[e].split("."),a=o.pop(),l=o.join(".");K.route(r,n,l,a)})}function Uu(s){return"id"in s&&"defaults"in s}class Wu{constructor(){this.controllers=new Us(re,"datasets",!0),this.elements=new Us(zt,"elements"),this.plugins=new Us(Object,"plugins"),this.scales=new Us(Te,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach(n=>{const r=i||this._getRegistryForType(n);i||r.isForType(n)||r===this.plugins&&n.id?this._exec(t,r,n):N(n,o=>{const a=i||this._getRegistryForType(o);this._exec(t,a,o)})})}_exec(t,e,i){const n=Pn(t);z(i["before"+n],[],i),e[t](i),z(i["after"+n],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const n=e.get(t);if(n===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return n}}var Mt=new Wu;class zu{constructor(){this._init=void 0}notify(t,e,i,n){if(e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const r=n?this._descriptors(t).filter(n):this._descriptors(t),o=this._notify(r,t,e,i);return e==="afterDestroy"&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),o}_notify(t,e,i,n){n=n||{};for(const r of t){const o=r.plugin,a=o[i],l=[e,n,r.options];if(z(a,l,o)===!1&&n.cancelable)return!1}return!0}invalidate(){L(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,n=P(i.options&&i.options.plugins,{}),r=Vu(i);return n===!1&&!e?[]:qu(t,r,n,e)}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,n=(r,o)=>r.filter(a=>!o.some(l=>a.plugin.id===l.plugin.id));this._notify(n(e,i),t,"stop"),this._notify(n(i,e),t,"start")}}function Vu(s){const t={},e=[],i=Object.keys(Mt.plugins.items);for(let r=0;r<i.length;r++)e.push(Mt.getPlugin(i[r]));const n=s.plugins||[];for(let r=0;r<n.length;r++){const o=n[r];e.indexOf(o)===-1&&(e.push(o),t[o.id]=!0)}return{plugins:e,localIds:t}}function Hu(s,t){return!t&&s===!1?null:s===!0?{}:s}function qu(s,{plugins:t,localIds:e},i,n){const r=[],o=s.getContext();for(const a of t){const l=a.id,c=Hu(i[l],n);c!==null&&r.push({plugin:a,options:Ku(s.config,{plugin:a,local:e[l]},c,o)})}return r}function Ku(s,{plugin:t,local:e},i,n){const r=s.pluginScopeKeys(t),o=s.getOptionScopes(i,r);return e&&t.defaults&&o.push(t.defaults),s.createResolver(o,n,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function an(s,t){const e=K.datasets[s]||{};return((t.datasets||{})[s]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function Gu(s,t){let e=s;return s==="_index_"?e=t:s==="_value_"&&(e=t==="x"?"y":"x"),e}function Ju(s,t){return s===t?"_index_":"_value_"}function Ur(s){if(s==="x"||s==="y"||s==="r")return s}function Yu(s){if(s==="top"||s==="bottom")return"x";if(s==="left"||s==="right")return"y"}function ln(s,...t){if(Ur(s))return s;for(const e of t){const i=e.axis||Yu(e.position)||s.length>1&&Ur(s[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${s}' axis. Please provide 'axis' or 'position' option.`)}function Wr(s,t,e){if(e[t+"AxisID"]===s)return{axis:t}}function Xu(s,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(i=>i.xAxisID===s||i.yAxisID===s);if(e.length)return Wr(s,"x",e[0])||Wr(s,"y",e[0])}return{}}function Zu(s,t){const e=ke[s.type]||{scales:{}},i=t.scales||{},n=an(s.type,t),r=Object.create(null);return Object.keys(i).forEach(o=>{const a=i[o];if(!D(a))return console.error(`Invalid scale configuration for scale: ${o}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const l=ln(o,a,Xu(o,s),K.scales[a.type]),c=Ju(l,n),h=e.scales||{};r[o]=cs(Object.create(null),[{axis:l},a,h[l],h[c]])}),s.data.datasets.forEach(o=>{const a=o.type||s.type,l=o.indexAxis||an(a,t),h=(ke[a]||{}).scales||{};Object.keys(h).forEach(u=>{const d=Gu(u,l),f=o[d+"AxisID"]||d;r[f]=r[f]||Object.create(null),cs(r[f],[{axis:d},i[f],h[u]])})}),Object.keys(r).forEach(o=>{const a=r[o];cs(a,[K.scales[a.type],K.scale])}),r}function $a(s){const t=s.options||(s.options={});t.plugins=P(t.plugins,{}),t.scales=Zu(s,t)}function Na(s){return s=s||{},s.datasets=s.datasets||[],s.labels=s.labels||[],s}function Qu(s){return s=s||{},s.data=Na(s.data),$a(s),s}const zr=new Map,Ba=new Set;function Ws(s,t){let e=zr.get(s);return e||(e=t(),zr.set(s,e),Ba.add(e)),e}const ts=(s,t,e)=>{const i=ee(t,e);i!==void 0&&s.add(i)};class td{constructor(t){this._config=Qu(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=Na(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),$a(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return Ws(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return Ws(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return Ws(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,i=this.type;return Ws(`${i}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const i=this._scopeCache;let n=i.get(t);return(!n||e)&&(n=new Map,i.set(t,n)),n}getOptionScopes(t,e,i){const{options:n,type:r}=this,o=this._cachedScopes(t,i),a=o.get(e);if(a)return a;const l=new Set;e.forEach(h=>{t&&(l.add(t),h.forEach(u=>ts(l,t,u))),h.forEach(u=>ts(l,n,u)),h.forEach(u=>ts(l,ke[r]||{},u)),h.forEach(u=>ts(l,K,u)),h.forEach(u=>ts(l,rn,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),Ba.has(e)&&o.set(e,c),c}chartOptionScopes(){const{options:t,type:e}=this;return[t,ke[e]||{},K.datasets[e]||{},{type:e},K,rn]}resolveNamedOptions(t,e,i,n=[""]){const r={$shared:!0},{resolver:o,subPrefixes:a}=Vr(this._resolverCache,t,n);let l=o;if(sd(o,e)){r.$shared=!1,i=se(i)?i():i;const c=this.createResolver(t,i,a);l=He(o,i,c)}for(const c of e)r[c]=l[c];return r}createResolver(t,e,i=[""],n){const{resolver:r}=Vr(this._resolverCache,t,i);return D(e)?He(r,e,void 0,n):r}}function Vr(s,t,e){let i=s.get(t);i||(i=new Map,s.set(t,i));const n=e.join();let r=i.get(n);return r||(r={resolver:jn(t,e),subPrefixes:e.filter(a=>!a.toLowerCase().includes("hover"))},i.set(n,r)),r}const ed=s=>D(s)&&Object.getOwnPropertyNames(s).some(t=>se(s[t]));function sd(s,t){const{isScriptable:e,isIndexable:i}=ma(s);for(const n of t){const r=e(n),o=i(n),a=(o||r)&&s[n];if(r&&(se(a)||ed(a))||o&&q(a))return!0}return!1}var id="4.5.1";const nd=["top","bottom","left","right","chartArea"];function Hr(s,t){return s==="top"||s==="bottom"||nd.indexOf(s)===-1&&t==="x"}function qr(s,t){return function(e,i){return e[s]===i[s]?e[t]-i[t]:e[s]-i[s]}}function Kr(s){const t=s.chart,e=t.options.animation;t.notifyPlugins("afterRender"),z(e&&e.onComplete,[s],t)}function rd(s){const t=s.chart,e=t.options.animation;z(e&&e.onProgress,[s],t)}function Fa(s){return Bn()&&typeof s=="string"?s=document.getElementById(s):s&&s.length&&(s=s[0]),s&&s.canvas&&(s=s.canvas),s}const ei={},Gr=s=>{const t=Fa(s);return Object.values(ei).filter(e=>e.canvas===t).pop()};function od(s,t,e){const i=Object.keys(s);for(const n of i){const r=+n;if(r>=t){const o=s[n];delete s[n],(e>0||r>t)&&(s[r+e]=o)}}}function ad(s,t,e,i){return!e||s.type==="mouseout"?null:i?t:s}class zn{static defaults=K;static instances=ei;static overrides=ke;static registry=Mt;static version=id;static getChart=Gr;static register(...t){Mt.add(...t),Jr()}static unregister(...t){Mt.remove(...t),Jr()}constructor(t,e){const i=this.config=new td(e),n=Fa(t),r=Gr(n);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const o=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||Eu(n)),this.platform.updateConfig(i);const a=this.platform.acquireContext(n,o.aspectRatio),l=a&&a.canvas,c=l&&l.height,h=l&&l.width;if(this.id=sc(),this.ctx=a,this.canvas=l,this.width=h,this.height=c,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new zu,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=_c(u=>this.update(u),o.resizeDelay||0),this._dataChanges=[],ei[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}It.listen(this,"complete",Kr),It.listen(this,"progress",rd),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:i,height:n,_aspectRatio:r}=this;return L(t)?e&&r?r:n?i/n:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Mt}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():br(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return gr(this.canvas,this.ctx),this}stop(){return It.stop(this),this}resize(t,e){It.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,n=this.canvas,r=i.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(n,t,e,r),a=i.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,br(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),z(i.onResize,[this,o],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};N(e,(i,n)=>{i.id=n})}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,n=Object.keys(i).reduce((o,a)=>(o[a]=!1,o),{});let r=[];e&&(r=r.concat(Object.keys(e).map(o=>{const a=e[o],l=ln(o,a),c=l==="r",h=l==="x";return{options:a,dposition:c?"chartArea":h?"bottom":"left",dtype:c?"radialLinear":h?"category":"linear"}}))),N(r,o=>{const a=o.options,l=a.id,c=ln(l,a),h=P(a.type,o.dtype);(a.position===void 0||Hr(a.position,c)!==Hr(o.dposition))&&(a.position=o.dposition),n[l]=!0;let u=null;if(l in i&&i[l].type===h)u=i[l];else{const d=Mt.getScale(h);u=new d({id:l,type:h,ctx:this.ctx,chart:this}),i[u.id]=u}u.init(a,t)}),N(n,(o,a)=>{o||delete i[a]}),N(i,o=>{ut.configure(this,o,o.options),ut.addBox(this,o)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort((n,r)=>n.index-r.index),i>e){for(let n=e;n<i;++n)this._destroyDatasetMeta(n);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(qr("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((i,n)=>{e.filter(r=>r===i._dataset).length===0&&this._destroyDatasetMeta(n)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,n;for(this._removeUnreferencedMetasets(),i=0,n=e.length;i<n;i++){const r=e[i];let o=this.getDatasetMeta(i);const a=r.type||this.config.type;if(o.type&&o.type!==a&&(this._destroyDatasetMeta(i),o=this.getDatasetMeta(i)),o.type=a,o.indexAxis=r.indexAxis||an(a,this.options),o.order=r.order||0,o.index=i,o.label=""+r.label,o.visible=this.isDatasetVisible(i),o.controller)o.controller.updateIndex(i),o.controller.linkScales();else{const l=Mt.getController(a),{datasetElementType:c,dataElementType:h}=K.datasets[a];Object.assign(l,{dataElementType:Mt.getElement(h),datasetElementType:c&&Mt.getElement(c)}),o.controller=new l(this,i),t.push(o.controller)}}return this._updateMetasets(),t}_resetElements(){N(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),n=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let c=0,h=this.data.datasets.length;c<h;c++){const{controller:u}=this.getDatasetMeta(c),d=!n&&r.indexOf(u)===-1;u.buildOrUpdateElements(d),o=Math.max(+u.getMaxOverflow(),o)}o=this._minPadding=i.layout.autoPadding?o:0,this._updateLayout(o),n||N(r,c=>{c.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(qr("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){N(this.scales,t=>{ut.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!rr(e,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:n,count:r}of e){const o=i==="_removeElements"?-r:r;od(t,n,o)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=r=>new Set(t.filter(o=>o[0]===r).map((o,a)=>a+","+o.splice(1).join(","))),n=i(0);for(let r=1;r<e;r++)if(!rr(n,i(r)))return;return Array.from(n).map(r=>r.split(",")).map(r=>({method:r[1],start:+r[2],count:+r[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;ut.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],N(this.boxes,n=>{i&&n.position==="chartArea"||(n.configure&&n.configure(),this._layers.push(...n._layers()))},this),this._layers.forEach((n,r)=>{n._idx=r}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,i=this.data.datasets.length;e<i;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,se(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),n={meta:i,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",n)!==!1&&(i.controller._update(e),n.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",n))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(It.has(this)?this.attached&&!It.running(this)&&It.start(this):(this.draw(),Kr({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:n}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,n)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let n,r;for(n=0,r=e.length;n<r;++n){const o=e[n];(!t||o.visible)&&i.push(o)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i={meta:t,index:t.index,cancelable:!0},n=Aa(this,t);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(n&&yi(e,n),t.controller.draw(),n&&_i(e),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return Wt(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,i,n){const r=nu.modes[e];return typeof r=="function"?r(this,t,i,n):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let n=i.filter(r=>r&&r._dataset===e).pop();return n||(n={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(n)),n}getContext(){return this.$context||(this.$context=ne(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!e.hidden}setDatasetVisibility(t,e){const i=this.getDatasetMeta(t);i.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const n=i?"show":"hide",r=this.getDatasetMeta(t),o=r.controller._resolveAnimations(void 0,n);bs(e)?(r.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),o.update(r,{visible:i}),this.update(a=>a.datasetIndex===t?n:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),It.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),gr(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete ei[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(r,o)=>{e.addEventListener(this,r,o),t[r]=o},n=(r,o,a)=>{r.offsetX=o,r.offsetY=a,this._eventHandler(r)};N(this.options.events,r=>i(r,n))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(l,c)=>{e.addEventListener(this,l,c),t[l]=c},n=(l,c)=>{t[l]&&(e.removeEventListener(this,l,c),delete t[l])},r=(l,c)=>{this.canvas&&this.resize(l,c)};let o;const a=()=>{n("attach",a),this.attached=!0,this.resize(),i("resize",r),i("detach",o)};o=()=>{this.attached=!1,n("resize",r),this._stop(),this._resize(0,0),i("attach",a)},e.isAttached(this.canvas)?a():o()}unbindEvents(){N(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},N(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const n=i?"set":"remove";let r,o,a,l;for(e==="dataset"&&(r=this.getDatasetMeta(t[0].datasetIndex),r.controller["_"+n+"DatasetHoverStyle"]()),a=0,l=t.length;a<l;++a){o=t[a];const c=o&&this.getDatasetMeta(o.datasetIndex).controller;c&&c[n+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map(({datasetIndex:r,index:o})=>{const a=this.getDatasetMeta(r);if(!a)throw new Error("No dataset found at index "+r);return{datasetIndex:r,element:a.data[o],index:o}});!ni(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,i){const n=this.options.hover,r=(l,c)=>l.filter(h=>!c.some(u=>h.datasetIndex===u.datasetIndex&&h.index===u.index)),o=r(e,t),a=i?t:r(t,e);o.length&&this.updateHoverStyle(o,n.mode,!1),a.length&&n.mode&&this.updateHoverStyle(a,n.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},n=o=>(o.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,n)===!1)return;const r=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,n),(r||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:n=[],options:r}=this,o=e,a=this._getActiveElements(t,n,i,o),l=lc(t),c=ad(t,this._lastEvent,i,l);i&&(this._lastEvent=null,z(r.onHover,[t,a,this],this),l&&z(r.onClick,[t,a,this],this));const h=!ni(a,n);return(h||e)&&(this._active=a,this._updateHoverStyles(a,n,e)),this._lastEvent=c,h}_getActiveElements(t,e,i,n){if(t.type==="mouseout")return[];if(!i)return e;const r=this.options.hover;return this.getElementsAtEventForMode(t,r.mode,r,n)}}function Jr(){return N(zn.instances,s=>s._plugins.invalidate())}function ld(s,t,e){const{startAngle:i,x:n,y:r,outerRadius:o,innerRadius:a,options:l}=t,{borderWidth:c,borderJoinStyle:h}=l,u=Math.min(c/o,ht(i-e));if(s.beginPath(),s.arc(n,r,o-c/2,i+u/2,e-u/2),a>0){const d=Math.min(c/a,ht(i-e));s.arc(n,r,a+c/2,e-d/2,i+d/2,!0)}else{const d=Math.min(c/2,o*ht(i-e));if(h==="round")s.arc(n,r,d,e-j/2,i+j/2,!0);else if(h==="bevel"){const f=2*d*d,p=-f*Math.cos(e+j/2)+n,g=-f*Math.sin(e+j/2)+r,m=f*Math.cos(i+j/2)+n,b=f*Math.sin(i+j/2)+r;s.lineTo(p,g),s.lineTo(m,b)}}s.closePath(),s.moveTo(0,0),s.rect(0,0,s.canvas.width,s.canvas.height),s.clip("evenodd")}function cd(s,t,e){const{startAngle:i,pixelMargin:n,x:r,y:o,outerRadius:a,innerRadius:l}=t;let c=n/a;s.beginPath(),s.arc(r,o,a,i-c,e+c),l>n?(c=n/l,s.arc(r,o,l,e+c,i-c,!0)):s.arc(r,o,n,e+X,i-X),s.closePath(),s.clip()}function hd(s){return In(s,["outerStart","outerEnd","innerStart","innerEnd"])}function ud(s,t,e,i){const n=hd(s.options.borderRadius),r=(e-t)/2,o=Math.min(r,i*t/2),a=l=>{const c=(e-Math.min(r,l))*i/2;return et(l,0,Math.min(r,c))};return{outerStart:a(n.outerStart),outerEnd:a(n.outerEnd),innerStart:et(n.innerStart,0,o),innerEnd:et(n.innerEnd,0,o)}}function Pe(s,t,e,i){return{x:e+s*Math.cos(t),y:i+s*Math.sin(t)}}function hi(s,t,e,i,n,r){const{x:o,y:a,startAngle:l,pixelMargin:c,innerRadius:h}=t,u=Math.max(t.outerRadius+i+e-c,0),d=h>0?h+i+e+c:0;let f=0;const p=n-l;if(i){const F=h>0?h-i:0,H=u>0?u-i:0,Y=(F+H)/2,St=Y!==0?p*Y/(Y+i):p;f=(p-St)/2}const g=Math.max(.001,p*u-e/j)/u,m=(p-g)/2,b=l+m+f,y=n-m-f,{outerStart:_,outerEnd:v,innerStart:x,innerEnd:S}=ud(t,d,u,y-b),k=u-_,E=u-v,T=b+_/k,R=y-v/E,M=d+x,I=d+S,it=b+x/M,mt=y-S/I;if(s.beginPath(),r){const F=(T+R)/2;if(s.arc(o,a,u,T,F),s.arc(o,a,u,F,R),v>0){const lt=Pe(E,R,o,a);s.arc(lt.x,lt.y,v,R,y+X)}const H=Pe(I,y,o,a);if(s.lineTo(H.x,H.y),S>0){const lt=Pe(I,mt,o,a);s.arc(lt.x,lt.y,S,y+X,mt+Math.PI)}const Y=(y-S/d+(b+x/d))/2;if(s.arc(o,a,d,y-S/d,Y,!0),s.arc(o,a,d,Y,b+x/d,!0),x>0){const lt=Pe(M,it,o,a);s.arc(lt.x,lt.y,x,it+Math.PI,b-X)}const St=Pe(k,b,o,a);if(s.lineTo(St.x,St.y),_>0){const lt=Pe(k,T,o,a);s.arc(lt.x,lt.y,_,b-X,T)}}else{s.moveTo(o,a);const F=Math.cos(T)*u+o,H=Math.sin(T)*u+a;s.lineTo(F,H);const Y=Math.cos(R)*u+o,St=Math.sin(R)*u+a;s.lineTo(Y,St)}s.closePath()}function dd(s,t,e,i,n){const{fullCircles:r,startAngle:o,circumference:a}=t;let l=t.endAngle;if(r){hi(s,t,e,i,l,n);for(let c=0;c<r;++c)s.fill();isNaN(a)||(l=o+(a%V||V))}return hi(s,t,e,i,l,n),s.fill(),l}function fd(s,t,e,i,n){const{fullCircles:r,startAngle:o,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:h,borderDash:u,borderDashOffset:d,borderRadius:f}=l,p=l.borderAlign==="inner";if(!c)return;s.setLineDash(u||[]),s.lineDashOffset=d,p?(s.lineWidth=c*2,s.lineJoin=h||"round"):(s.lineWidth=c,s.lineJoin=h||"bevel");let g=t.endAngle;if(r){hi(s,t,e,i,g,n);for(let m=0;m<r;++m)s.stroke();isNaN(a)||(g=o+(a%V||V))}p&&cd(s,t,g),l.selfJoin&&g-o>=j&&f===0&&h!=="miter"&&ld(s,t,g),r||(hi(s,t,e,i,g,n),s.stroke())}class gd extends zt{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:t=>t!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,i){const n=this.getProps(["x","y"],i),{angle:r,distance:o}=oa(n,{x:t,y:e}),{startAngle:a,endAngle:l,innerRadius:c,outerRadius:h,circumference:u}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),d=(this.options.spacing+this.options.borderWidth)/2,f=P(u,l-a),p=ys(r,a,l)&&a!==l,g=f>=V||p,m=Ft(o,c+d,h+d);return g&&m}getCenterPoint(t){const{x:e,y:i,startAngle:n,endAngle:r,innerRadius:o,outerRadius:a}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],t),{offset:l,spacing:c}=this.options,h=(n+r)/2,u=(o+a+c+l)/2;return{x:e+Math.cos(h)*u,y:i+Math.sin(h)*u}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:i}=this,n=(e.offset||0)/4,r=(e.spacing||0)/2,o=e.circular;if(this.pixelMargin=e.borderAlign==="inner"?.33:0,this.fullCircles=i>V?Math.floor(i/V):0,i===0||this.innerRadius<0||this.outerRadius<0)return;t.save();const a=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(a)*n,Math.sin(a)*n);const l=1-Math.sin(Math.min(j,i||0)),c=n*l;t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor,dd(t,this,c,r,o),fd(t,this,c,r,o),t.restore()}}function Ua(s,t,e=t){s.lineCap=P(e.borderCapStyle,t.borderCapStyle),s.setLineDash(P(e.borderDash,t.borderDash)),s.lineDashOffset=P(e.borderDashOffset,t.borderDashOffset),s.lineJoin=P(e.borderJoinStyle,t.borderJoinStyle),s.lineWidth=P(e.borderWidth,t.borderWidth),s.strokeStyle=P(e.borderColor,t.borderColor)}function pd(s,t,e){s.lineTo(e.x,e.y)}function md(s){return s.stepped?Rc:s.tension||s.cubicInterpolationMode==="monotone"?Mc:pd}function Wa(s,t,e={}){const i=s.length,{start:n=0,end:r=i-1}=e,{start:o,end:a}=t,l=Math.max(n,o),c=Math.min(r,a),h=n<o&&r<o||n>a&&r>a;return{count:i,start:l,loop:t.loop,ilen:c<l&&!h?i+c-l:c-l}}function bd(s,t,e,i){const{points:n,options:r}=t,{count:o,start:a,loop:l,ilen:c}=Wa(n,e,i),h=md(r);let{move:u=!0,reverse:d}=i||{},f,p,g;for(f=0;f<=c;++f)p=n[(a+(d?c-f:f))%o],!p.skip&&(u?(s.moveTo(p.x,p.y),u=!1):h(s,g,p,d,r.stepped),g=p);return l&&(p=n[(a+(d?c:0))%o],h(s,g,p,d,r.stepped)),!!l}function yd(s,t,e,i){const n=t.points,{count:r,start:o,ilen:a}=Wa(n,e,i),{move:l=!0,reverse:c}=i||{};let h=0,u=0,d,f,p,g,m,b;const y=v=>(o+(c?a-v:v))%r,_=()=>{g!==m&&(s.lineTo(h,m),s.lineTo(h,g),s.lineTo(h,b))};for(l&&(f=n[y(0)],s.moveTo(f.x,f.y)),d=0;d<=a;++d){if(f=n[y(d)],f.skip)continue;const v=f.x,x=f.y,S=v|0;S===p?(x<g?g=x:x>m&&(m=x),h=(u*h+v)/++u):(_(),s.lineTo(v,x),p=S,u=0,g=m=x),b=x}_()}function cn(s){const t=s.options,e=t.borderDash&&t.borderDash.length;return!s._decimated&&!s._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?yd:bd}function _d(s){return s.stepped?hh:s.tension||s.cubicInterpolationMode==="monotone"?uh:me}function vd(s,t,e,i){let n=t._path;n||(n=t._path=new Path2D,t.path(n,e,i)&&n.closePath()),Ua(s,t.options),s.stroke(n)}function wd(s,t,e,i){const{segments:n,options:r}=t,o=cn(t);for(const a of n)Ua(s,r,a.style),s.beginPath(),o(s,t,a,{start:e,end:e+i-1})&&s.closePath(),s.stroke()}const xd=typeof Path2D=="function";function Sd(s,t,e,i){xd&&!t.options.segment?vd(s,t,e,i):wd(s,t,e,i)}class xi extends zt{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"};constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const n=i.spanGaps?this._loop:this._fullLoop;sh(this._points,i,t,n,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=bh(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,n=t[e],r=this.points,o=Ta(this,{property:e,start:n,end:n});if(!o.length)return;const a=[],l=_d(i);let c,h;for(c=0,h=o.length;c<h;++c){const{start:u,end:d}=o[c],f=r[u],p=r[d];if(f===p){a.push(f);continue}const g=Math.abs((n-f[e])/(p[e]-f[e])),m=l(f,p,g,i.stepped);m[e]=t[e],a.push(m)}return a.length===1?a[0]:a}pathSegment(t,e,i){return cn(this)(t,this,e,i)}path(t,e,i){const n=this.segments,r=cn(this);let o=this._loop;e=e||0,i=i||this.points.length-e;for(const a of n)o&=r(t,this,a,{start:e,end:e+i-1});return!!o}draw(t,e,i,n){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),Sd(t,this,i,n),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Yr(s,t,e,i){const n=s.options,{[e]:r}=s.getProps([e],i);return Math.abs(t-r)<n.radius+n.hitRadius}class kd extends zt{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,i){const n=this.options,{x:r,y:o}=this.getProps(["x","y"],i);return Math.pow(t-r,2)+Math.pow(e-o,2)<Math.pow(n.hitRadius+n.radius,2)}inXRange(t,e){return Yr(this,t,"x",e)}inYRange(t,e){return Yr(this,t,"y",e)}getCenterPoint(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}size(t){t=t||this.options||{};let e=t.radius||0;e=Math.max(e,e&&t.hoverRadius||0);const i=e&&t.borderWidth||0;return(e+i)*2}draw(t,e){const i=this.options;this.skip||i.radius<.1||!Wt(this,e,this.size(i)/2)||(t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.fillStyle=i.backgroundColor,on(t,i,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}function za(s,t){const{x:e,y:i,base:n,width:r,height:o}=s.getProps(["x","y","base","width","height"],t);let a,l,c,h,u;return s.horizontal?(u=o/2,a=Math.min(e,n),l=Math.max(e,n),c=i-u,h=i+u):(u=r/2,a=e-u,l=e+u,c=Math.min(i,n),h=Math.max(i,n)),{left:a,top:c,right:l,bottom:h}}function Xt(s,t,e,i){return s?0:et(t,e,i)}function Ed(s,t,e){const i=s.options.borderWidth,n=s.borderSkipped,r=pa(i);return{t:Xt(n.top,r.top,0,e),r:Xt(n.right,r.right,0,t),b:Xt(n.bottom,r.bottom,0,e),l:Xt(n.left,r.left,0,t)}}function Td(s,t,e){const{enableBorderRadius:i}=s.getProps(["enableBorderRadius"]),n=s.options.borderRadius,r=xe(n),o=Math.min(t,e),a=s.borderSkipped,l=i||D(n);return{topLeft:Xt(!l||a.top||a.left,r.topLeft,0,o),topRight:Xt(!l||a.top||a.right,r.topRight,0,o),bottomLeft:Xt(!l||a.bottom||a.left,r.bottomLeft,0,o),bottomRight:Xt(!l||a.bottom||a.right,r.bottomRight,0,o)}}function Ad(s){const t=za(s),e=t.right-t.left,i=t.bottom-t.top,n=Ed(s,e/2,i/2),r=Td(s,e/2,i/2);return{outer:{x:t.left,y:t.top,w:e,h:i,radius:r},inner:{x:t.left+n.l,y:t.top+n.t,w:e-n.l-n.r,h:i-n.t-n.b,radius:{topLeft:Math.max(0,r.topLeft-Math.max(n.t,n.l)),topRight:Math.max(0,r.topRight-Math.max(n.t,n.r)),bottomLeft:Math.max(0,r.bottomLeft-Math.max(n.b,n.l)),bottomRight:Math.max(0,r.bottomRight-Math.max(n.b,n.r))}}}}function Ui(s,t,e,i){const n=t===null,r=e===null,a=s&&!(n&&r)&&za(s,i);return a&&(n||Ft(t,a.left,a.right))&&(r||Ft(e,a.top,a.bottom))}function Od(s){return s.topLeft||s.topRight||s.bottomLeft||s.bottomRight}function Cd(s,t){s.rect(t.x,t.y,t.w,t.h)}function Wi(s,t,e={}){const i=s.x!==e.x?-t:0,n=s.y!==e.y?-t:0,r=(s.x+s.w!==e.x+e.w?t:0)-i,o=(s.y+s.h!==e.y+e.h?t:0)-n;return{x:s.x+i,y:s.y+n,w:s.w+r,h:s.h+o,radius:s.radius}}class Pd extends zt{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:i,backgroundColor:n}}=this,{inner:r,outer:o}=Ad(this),a=Od(o.radius)?_s:Cd;t.save(),(o.w!==r.w||o.h!==r.h)&&(t.beginPath(),a(t,Wi(o,e,r)),t.clip(),a(t,Wi(r,-e,o)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),a(t,Wi(r,e)),t.fillStyle=n,t.fill(),t.restore()}inRange(t,e,i){return Ui(this,t,e,i)}inXRange(t,e){return Ui(this,t,null,e)}inYRange(t,e){return Ui(this,null,t,e)}getCenterPoint(t){const{x:e,y:i,base:n,horizontal:r}=this.getProps(["x","y","base","horizontal"],t);return{x:r?(e+n)/2:e,y:r?i:(i+n)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}var Rd=Object.freeze({__proto__:null,ArcElement:gd,BarElement:Pd,LineElement:xi,PointElement:kd});const hn=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Xr=hn.map(s=>s.replace("rgb(","rgba(").replace(")",", 0.5)"));function Va(s){return hn[s%hn.length]}function Ha(s){return Xr[s%Xr.length]}function Md(s,t){return s.borderColor=Va(t),s.backgroundColor=Ha(t),++t}function Ld(s,t){return s.backgroundColor=s.data.map(()=>Va(t++)),t}function Dd(s,t){return s.backgroundColor=s.data.map(()=>Ha(t++)),t}function Id(s){let t=0;return(e,i)=>{const n=s.getDatasetMeta(i).controller;n instanceof Un?t=Ld(e,t):n instanceof Ra?t=Dd(e,t):n&&(t=Md(e,t))}}function Zr(s){let t;for(t in s)if(s[t].borderColor||s[t].backgroundColor)return!0;return!1}function jd(s){return s&&(s.borderColor||s.backgroundColor)}function $d(){return K.borderColor!=="rgba(0,0,0,0.1)"||K.backgroundColor!=="rgba(0,0,0,0.1)"}var Nd={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(s,t,e){if(!e.enabled)return;const{data:{datasets:i},options:n}=s.config,{elements:r}=n,o=Zr(i)||jd(n)||r&&Zr(r)||$d();if(!e.forceOverride&&o)return;const a=Id(s);i.forEach(a)}};function Bd(s,t,e,i,n){const r=n.samples||i;if(r>=e)return s.slice(t,t+e);const o=[],a=(e-2)/(r-2);let l=0;const c=t+e-1;let h=t,u,d,f,p,g;for(o[l++]=s[h],u=0;u<r-2;u++){let m=0,b=0,y;const _=Math.floor((u+1)*a)+1+t,v=Math.min(Math.floor((u+2)*a)+1,e)+t,x=v-_;for(y=_;y<v;y++)m+=s[y].x,b+=s[y].y;m/=x,b/=x;const S=Math.floor(u*a)+1+t,k=Math.min(Math.floor((u+1)*a)+1,e)+t,{x:E,y:T}=s[h];for(f=p=-1,y=S;y<k;y++)p=.5*Math.abs((E-m)*(s[y].y-T)-(E-s[y].x)*(b-T)),p>f&&(f=p,d=s[y],g=y);o[l++]=d,h=g}return o[l++]=s[c],o}function Fd(s,t,e,i){let n=0,r=0,o,a,l,c,h,u,d,f,p,g;const m=[],b=t+e-1,y=s[t].x,v=s[b].x-y;for(o=t;o<t+e;++o){a=s[o],l=(a.x-y)/v*i,c=a.y;const x=l|0;if(x===h)c<p?(p=c,u=o):c>g&&(g=c,d=o),n=(r*n+a.x)/++r;else{const S=o-1;if(!L(u)&&!L(d)){const k=Math.min(u,d),E=Math.max(u,d);k!==f&&k!==S&&m.push({...s[k],x:n}),E!==f&&E!==S&&m.push({...s[E],x:n})}o>0&&S!==f&&m.push(s[S]),m.push(a),h=x,r=0,p=g=c,u=d=f=o}}return m}function qa(s){if(s._decimated){const t=s._data;delete s._decimated,delete s._data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function Qr(s){s.data.datasets.forEach(t=>{qa(t)})}function Ud(s,t){const e=t.length;let i=0,n;const{iScale:r}=s,{min:o,max:a,minDefined:l,maxDefined:c}=r.getUserBounds();return l&&(i=et(Ut(t,r.axis,o).lo,0,e-1)),c?n=et(Ut(t,r.axis,a).hi+1,i,e)-i:n=e-i,{start:i,count:n}}var Wd={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(s,t,e)=>{if(!e.enabled){Qr(s);return}const i=s.width;s.data.datasets.forEach((n,r)=>{const{_data:o,indexAxis:a}=n,l=s.getDatasetMeta(r),c=o||n.data;if(rs([a,s.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const h=s.scales[l.xAxisID];if(h.type!=="linear"&&h.type!=="time"||s.options.parsing)return;let{start:u,count:d}=Ud(l,c);const f=e.threshold||4*i;if(d<=f){qa(n);return}L(o)&&(n._data=c,delete n.data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(g){this._data=g}}));let p;switch(e.algorithm){case"lttb":p=Bd(c,u,d,i,e);break;case"min-max":p=Fd(c,u,d,i);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}n._decimated=p})},destroy(s){Qr(s)}};function zd(s,t,e){const i=s.segments,n=s.points,r=t.points,o=[];for(const a of i){let{start:l,end:c}=a;c=Si(l,c,n);const h=un(e,n[l],n[c],a.loop);if(!t.segments){o.push({source:a,target:h,start:n[l],end:n[c]});continue}const u=Ta(t,h);for(const d of u){const f=un(e,r[d.start],r[d.end],d.loop),p=Ea(a,n,f);for(const g of p)o.push({source:g,target:d,start:{[e]:to(h,f,"start",Math.max)},end:{[e]:to(h,f,"end",Math.min)}})}}return o}function un(s,t,e,i){if(i)return;let n=t[s],r=e[s];return s==="angle"&&(n=ht(n),r=ht(r)),{property:s,start:n,end:r}}function Vd(s,t){const{x:e=null,y:i=null}=s||{},n=t.points,r=[];return t.segments.forEach(({start:o,end:a})=>{a=Si(o,a,n);const l=n[o],c=n[a];i!==null?(r.push({x:l.x,y:i}),r.push({x:c.x,y:i})):e!==null&&(r.push({x:e,y:l.y}),r.push({x:e,y:c.y}))}),r}function Si(s,t,e){for(;t>s;t--){const i=e[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function to(s,t,e,i){return s&&t?i(s[e],t[e]):s?s[e]:t?t[e]:0}function Ka(s,t){let e=[],i=!1;return q(s)?(i=!0,e=s):e=Vd(s,t),e.length?new xi({points:e,options:{tension:0},_loop:i,_fullLoop:i}):null}function eo(s){return s&&s.fill!==!1}function Hd(s,t,e){let n=s[t].fill;const r=[t];let o;if(!e)return n;for(;n!==!1&&r.indexOf(n)===-1;){if(!J(n))return n;if(o=s[n],!o)return!1;if(o.visible)return n;r.push(n),n=o.fill}return!1}function qd(s,t,e){const i=Yd(s);if(D(i))return isNaN(i.value)?!1:i;let n=parseFloat(i);return J(n)&&Math.floor(n)===n?Kd(i[0],t,n,e):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function Kd(s,t,e,i){return(s==="-"||s==="+")&&(e=t+e),e===t||e<0||e>=i?!1:e}function Gd(s,t){let e=null;return s==="start"?e=t.bottom:s==="end"?e=t.top:D(s)?e=t.getPixelForValue(s.value):t.getBasePixel&&(e=t.getBasePixel()),e}function Jd(s,t,e){let i;return s==="start"?i=e:s==="end"?i=t.options.reverse?t.min:t.max:D(s)?i=s.value:i=t.getBaseValue(),i}function Yd(s){const t=s.options,e=t.fill;let i=P(e&&e.target,e);return i===void 0&&(i=!!t.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function Xd(s){const{scale:t,index:e,line:i}=s,n=[],r=i.segments,o=i.points,a=Zd(t,e);a.push(Ka({x:null,y:t.bottom},i));for(let l=0;l<r.length;l++){const c=r[l];for(let h=c.start;h<=c.end;h++)Qd(n,o[h],a)}return new xi({points:n,options:{}})}function Zd(s,t){const e=[],i=s.getMatchingVisibleMetas("line");for(let n=0;n<i.length;n++){const r=i[n];if(r.index===t)break;r.hidden||e.unshift(r.dataset)}return e}function Qd(s,t,e){const i=[];for(let n=0;n<e.length;n++){const r=e[n],{first:o,last:a,point:l}=tf(r,t,"x");if(!(!l||o&&a)){if(o)i.unshift(l);else if(s.push(l),!a)break}}s.push(...i)}function tf(s,t,e){const i=s.interpolate(t,e);if(!i)return{};const n=i[e],r=s.segments,o=s.points;let a=!1,l=!1;for(let c=0;c<r.length;c++){const h=r[c],u=o[h.start][e],d=o[h.end][e];if(Ft(n,u,d)){a=n===u,l=n===d;break}}return{first:a,last:l,point:i}}class Ga{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,i){const{x:n,y:r,radius:o}=this;return e=e||{start:0,end:V},t.arc(n,r,o,e.end,e.start,!0),!i.bounds}interpolate(t){const{x:e,y:i,radius:n}=this,r=t.angle;return{x:e+Math.cos(r)*n,y:i+Math.sin(r)*n,angle:r}}}function ef(s){const{chart:t,fill:e,line:i}=s;if(J(e))return sf(t,e);if(e==="stack")return Xd(s);if(e==="shape")return!0;const n=nf(s);return n instanceof Ga?n:Ka(n,i)}function sf(s,t){const e=s.getDatasetMeta(t);return e&&s.isDatasetVisible(t)?e.dataset:null}function nf(s){return(s.scale||{}).getPointPositionForValue?of(s):rf(s)}function rf(s){const{scale:t={},fill:e}=s,i=Gd(e,t);if(J(i)){const n=t.isHorizontal();return{x:n?i:null,y:n?null:i}}return null}function of(s){const{scale:t,fill:e}=s,i=t.options,n=t.getLabels().length,r=i.reverse?t.max:t.min,o=Jd(e,t,r),a=[];if(i.grid.circular){const l=t.getPointPositionForValue(0,r);return new Ga({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(o)})}for(let l=0;l<n;++l)a.push(t.getPointPositionForValue(l,o));return a}function zi(s,t,e){const i=ef(t),{chart:n,index:r,line:o,scale:a,axis:l}=t,c=o.options,h=c.fill,u=c.backgroundColor,{above:d=u,below:f=u}=h||{},p=n.getDatasetMeta(r),g=Aa(n,p);i&&o.points.length&&(yi(s,e),af(s,{line:o,target:i,above:d,below:f,area:e,scale:a,axis:l,clip:g}),_i(s))}function af(s,t){const{line:e,target:i,above:n,below:r,area:o,scale:a,clip:l}=t,c=e._loop?"angle":t.axis;s.save();let h=r;r!==n&&(c==="x"?(so(s,i,o.top),Vi(s,{line:e,target:i,color:n,scale:a,property:c,clip:l}),s.restore(),s.save(),so(s,i,o.bottom)):c==="y"&&(io(s,i,o.left),Vi(s,{line:e,target:i,color:r,scale:a,property:c,clip:l}),s.restore(),s.save(),io(s,i,o.right),h=n)),Vi(s,{line:e,target:i,color:h,scale:a,property:c,clip:l}),s.restore()}function so(s,t,e){const{segments:i,points:n}=t;let r=!0,o=!1;s.beginPath();for(const a of i){const{start:l,end:c}=a,h=n[l],u=n[Si(l,c,n)];r?(s.moveTo(h.x,h.y),r=!1):(s.lineTo(h.x,e),s.lineTo(h.x,h.y)),o=!!t.pathSegment(s,a,{move:o}),o?s.closePath():s.lineTo(u.x,e)}s.lineTo(t.first().x,e),s.closePath(),s.clip()}function io(s,t,e){const{segments:i,points:n}=t;let r=!0,o=!1;s.beginPath();for(const a of i){const{start:l,end:c}=a,h=n[l],u=n[Si(l,c,n)];r?(s.moveTo(h.x,h.y),r=!1):(s.lineTo(e,h.y),s.lineTo(h.x,h.y)),o=!!t.pathSegment(s,a,{move:o}),o?s.closePath():s.lineTo(e,u.y)}s.lineTo(e,t.first().y),s.closePath(),s.clip()}function Vi(s,t){const{line:e,target:i,property:n,color:r,scale:o,clip:a}=t,l=zd(e,i,n);for(const{source:c,target:h,start:u,end:d}of l){const{style:{backgroundColor:f=r}={}}=c,p=i!==!0;s.save(),s.fillStyle=f,lf(s,o,a,p&&un(n,u,d)),s.beginPath();const g=!!e.pathSegment(s,c);let m;if(p){g?s.closePath():no(s,i,d,n);const b=!!i.pathSegment(s,h,{move:g,reverse:!0});m=g&&b,m||no(s,i,u,n)}s.closePath(),s.fill(m?"evenodd":"nonzero"),s.restore()}}function lf(s,t,e,i){const n=t.chart.chartArea,{property:r,start:o,end:a}=i||{};if(r==="x"||r==="y"){let l,c,h,u;r==="x"?(l=o,c=n.top,h=a,u=n.bottom):(l=n.left,c=o,h=n.right,u=a),s.beginPath(),e&&(l=Math.max(l,e.left),h=Math.min(h,e.right),c=Math.max(c,e.top),u=Math.min(u,e.bottom)),s.rect(l,c,h-l,u-c),s.clip()}}function no(s,t,e,i){const n=t.interpolate(e,i);n&&s.lineTo(n.x,n.y)}var cf={id:"filler",afterDatasetsUpdate(s,t,e){const i=(s.data.datasets||[]).length,n=[];let r,o,a,l;for(o=0;o<i;++o)r=s.getDatasetMeta(o),a=r.dataset,l=null,a&&a.options&&a instanceof xi&&(l={visible:s.isDatasetVisible(o),index:o,fill:qd(a,o,i),chart:s,axis:r.controller.options.indexAxis,scale:r.vScale,line:a}),r.$filler=l,n.push(l);for(o=0;o<i;++o)l=n[o],!(!l||l.fill===!1)&&(l.fill=Hd(n,o,e.propagate))},beforeDraw(s,t,e){const i=e.drawTime==="beforeDraw",n=s.getSortedVisibleDatasetMetas(),r=s.chartArea;for(let o=n.length-1;o>=0;--o){const a=n[o].$filler;a&&(a.line.updateControlPoints(r,a.axis),i&&a.fill&&zi(s.ctx,a,r))}},beforeDatasetsDraw(s,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const i=s.getSortedVisibleDatasetMetas();for(let n=i.length-1;n>=0;--n){const r=i[n].$filler;eo(r)&&zi(s.ctx,r,s.chartArea)}},beforeDatasetDraw(s,t,e){const i=t.meta.$filler;!eo(i)||e.drawTime!=="beforeDatasetDraw"||zi(s.ctx,i,s.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const ro=(s,t)=>{let{boxHeight:e=t,boxWidth:i=t}=s;return s.usePointStyle&&(e=Math.min(e,t),i=s.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:e,itemHeight:Math.max(t,e)}},hf=(s,t)=>s!==null&&t!==null&&s.datasetIndex===t.datasetIndex&&s.index===t.index;class oo extends zt{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=z(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(i=>t.filter(i,this.chart.data))),t.sort&&(e=e.sort((i,n)=>t.sort(i,n,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,n=tt(i.font),r=n.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=ro(i,r);let c,h;e.font=n.string,this.isHorizontal()?(c=this.maxWidth,h=this._fitRows(o,r,a,l)+10):(h=this.maxHeight,c=this._fitCols(o,n,a,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(h,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,n){const{ctx:r,maxWidth:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],h=n+a;let u=t;r.textAlign="left",r.textBaseline="middle";let d=-1,f=-h;return this.legendItems.forEach((p,g)=>{const m=i+e/2+r.measureText(p.text).width;(g===0||c[c.length-1]+m+2*a>o)&&(u+=h,c[c.length-(g>0?0:1)]=0,f+=h,d++),l[g]={left:0,top:f,row:d,width:m,height:n},c[c.length-1]+=m+a}),u}_fitCols(t,e,i,n){const{ctx:r,maxHeight:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],h=o-t;let u=a,d=0,f=0,p=0,g=0;return this.legendItems.forEach((m,b)=>{const{itemWidth:y,itemHeight:_}=uf(i,e,r,m,n);b>0&&f+_+2*a>h&&(u+=d+a,c.push({width:d,height:f}),p+=d+a,g++,d=f=0),l[b]={left:p,top:f,col:g,width:y,height:_},d=Math.max(d,y),f+=_+a}),u+=d,c.push({width:d,height:f}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:n},rtl:r}}=this,o=We(r,this.left,this.width);if(this.isHorizontal()){let a=0,l=ct(i,this.left+n,this.right-this.lineWidths[a]);for(const c of e)a!==c.row&&(a=c.row,l=ct(i,this.left+n,this.right-this.lineWidths[a])),c.top+=this.top+t+n,c.left=o.leftForLtr(o.x(l),c.width),l+=c.width+n}else{let a=0,l=ct(i,this.top+t+n,this.bottom-this.columnSizes[a].height);for(const c of e)c.col!==a&&(a=c.col,l=ct(i,this.top+t+n,this.bottom-this.columnSizes[a].height)),c.top=l,c.left+=this.left+n,c.left=o.leftForLtr(o.x(c.left),c.width),l+=c.height+n}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;yi(t,this),this._draw(),_i(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:n}=this,{align:r,labels:o}=t,a=K.color,l=We(t.rtl,this.left,this.width),c=tt(o.font),{padding:h}=o,u=c.size,d=u/2;let f;this.drawTitle(),n.textAlign=l.textAlign("left"),n.textBaseline="middle",n.lineWidth=.5,n.font=c.string;const{boxWidth:p,boxHeight:g,itemHeight:m}=ro(o,u),b=function(S,k,E){if(isNaN(p)||p<=0||isNaN(g)||g<0)return;n.save();const T=P(E.lineWidth,1);if(n.fillStyle=P(E.fillStyle,a),n.lineCap=P(E.lineCap,"butt"),n.lineDashOffset=P(E.lineDashOffset,0),n.lineJoin=P(E.lineJoin,"miter"),n.lineWidth=T,n.strokeStyle=P(E.strokeStyle,a),n.setLineDash(P(E.lineDash,[])),o.usePointStyle){const R={radius:g*Math.SQRT2/2,pointStyle:E.pointStyle,rotation:E.rotation,borderWidth:T},M=l.xPlus(S,p/2),I=k+d;ga(n,R,M,I,o.pointStyleWidth&&p)}else{const R=k+Math.max((u-g)/2,0),M=l.leftForLtr(S,p),I=xe(E.borderRadius);n.beginPath(),Object.values(I).some(it=>it!==0)?_s(n,{x:M,y:R,w:p,h:g,radius:I}):n.rect(M,R,p,g),n.fill(),T!==0&&n.stroke()}n.restore()},y=function(S,k,E){Ee(n,E.text,S,k+m/2,c,{strikethrough:E.hidden,textAlign:l.textAlign(E.textAlign)})},_=this.isHorizontal(),v=this._computeTitleHeight();_?f={x:ct(r,this.left+h,this.right-i[0]),y:this.top+h+v,line:0}:f={x:this.left+h,y:ct(r,this.top+v+h,this.bottom-e[0].height),line:0},xa(this.ctx,t.textDirection);const x=m+h;this.legendItems.forEach((S,k)=>{n.strokeStyle=S.fontColor,n.fillStyle=S.fontColor;const E=n.measureText(S.text).width,T=l.textAlign(S.textAlign||(S.textAlign=o.textAlign)),R=p+d+E;let M=f.x,I=f.y;l.setWidth(this.width),_?k>0&&M+R+h>this.right&&(I=f.y+=x,f.line++,M=f.x=ct(r,this.left+h,this.right-i[f.line])):k>0&&I+x>this.bottom&&(M=f.x=M+e[f.line].width+h,f.line++,I=f.y=ct(r,this.top+v+h,this.bottom-e[f.line].height));const it=l.x(M);if(b(it,I,S),M=vc(T,M+p+d,_?M+R:this.right,t.rtl),y(l.x(M),I,S),_)f.x+=R+h;else if(typeof S.text!="string"){const mt=c.lineHeight;f.y+=Ja(S,mt)+h}else f.y+=x}),Sa(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=tt(e.font),n=dt(e.padding);if(!e.display)return;const r=We(t.rtl,this.left,this.width),o=this.ctx,a=e.position,l=i.size/2,c=n.top+l;let h,u=this.left,d=this.width;if(this.isHorizontal())d=Math.max(...this.lineWidths),h=this.top+c,u=ct(t.align,u,this.right-d);else{const p=this.columnSizes.reduce((g,m)=>Math.max(g,m.height),0);h=c+ct(t.align,this.top,this.bottom-p-t.labels.padding-this._computeTitleHeight())}const f=ct(a,u,u+d);o.textAlign=r.textAlign(Ln(a)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=i.string,Ee(o,e.text,f,h,i)}_computeTitleHeight(){const t=this.options.title,e=tt(t.font),i=dt(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,n,r;if(Ft(t,this.left,this.right)&&Ft(e,this.top,this.bottom)){for(r=this.legendHitBoxes,i=0;i<r.length;++i)if(n=r[i],Ft(t,n.left,n.left+n.width)&&Ft(e,n.top,n.top+n.height))return this.legendItems[i]}return null}handleEvent(t){const e=this.options;if(!gf(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const n=this._hoveredItem,r=hf(n,i);n&&!r&&z(e.onLeave,[t,n,this],this),this._hoveredItem=i,i&&!r&&z(e.onHover,[t,i,this],this)}else i&&z(e.onClick,[t,i,this],this)}}function uf(s,t,e,i,n){const r=df(i,s,t,e),o=ff(n,i,t.lineHeight);return{itemWidth:r,itemHeight:o}}function df(s,t,e,i){let n=s.text;return n&&typeof n!="string"&&(n=n.reduce((r,o)=>r.length>o.length?r:o)),t+e.size/2+i.measureText(n).width}function ff(s,t,e){let i=s;return typeof t.text!="string"&&(i=Ja(t,e)),i}function Ja(s,t){const e=s.text?s.text.length:0;return t*e}function gf(s,t){return!!((s==="mousemove"||s==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(s==="click"||s==="mouseup"))}var pf={id:"legend",_element:oo,start(s,t,e){const i=s.legend=new oo({ctx:s.ctx,options:e,chart:s});ut.configure(s,i,e),ut.addBox(s,i)},stop(s){ut.removeBox(s,s.legend),delete s.legend},beforeUpdate(s,t,e){const i=s.legend;ut.configure(s,i,e),i.options=e},afterUpdate(s){const t=s.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(s,t){t.replay||s.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(s,t,e){const i=t.datasetIndex,n=e.chart;n.isDatasetVisible(i)?(n.hide(i),t.hidden=!0):(n.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:s=>s.chart.options.color,boxWidth:40,padding:10,generateLabels(s){const t=s.data.datasets,{labels:{usePointStyle:e,pointStyle:i,textAlign:n,color:r,useBorderRadius:o,borderRadius:a}}=s.legend.options;return s._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(e?0:void 0),h=dt(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:r,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(h.width+h.height)/4,strokeStyle:c.borderColor,pointStyle:i||c.pointStyle,rotation:c.rotation,textAlign:n||c.textAlign,borderRadius:o&&(a||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:s=>s.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:s=>!s.startsWith("on"),labels:{_scriptable:s=>!["generateLabels","filter","sort"].includes(s)}}};class Vn extends zt{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const n=q(i.text)?i.text.length:1;this._padding=dt(i.padding);const r=n*tt(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:i,bottom:n,right:r,options:o}=this,a=o.align;let l=0,c,h,u;return this.isHorizontal()?(h=ct(a,i,r),u=e+t,c=r-i):(o.position==="left"?(h=i+t,u=ct(a,n,e),l=j*-.5):(h=r-t,u=ct(a,e,n),l=j*.5),c=n-e),{titleX:h,titleY:u,maxWidth:c,rotation:l}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=tt(e.font),r=i.lineHeight/2+this._padding.top,{titleX:o,titleY:a,maxWidth:l,rotation:c}=this._drawArgs(r);Ee(t,e.text,0,0,i,{color:e.color,maxWidth:l,rotation:c,textAlign:Ln(e.align),textBaseline:"middle",translation:[o,a]})}}function mf(s,t){const e=new Vn({ctx:s.ctx,options:t,chart:s});ut.configure(s,e,t),ut.addBox(s,e),s.titleBlock=e}var bf={id:"title",_element:Vn,start(s,t,e){mf(s,e)},stop(s){const t=s.titleBlock;ut.removeBox(s,t),delete s.titleBlock},beforeUpdate(s,t,e){const i=s.titleBlock;ut.configure(s,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const zs=new WeakMap;var yf={id:"subtitle",start(s,t,e){const i=new Vn({ctx:s.ctx,options:e,chart:s});ut.configure(s,i,e),ut.addBox(s,i),zs.set(s,i)},stop(s){ut.removeBox(s,zs.get(s)),zs.delete(s)},beforeUpdate(s,t,e){const i=zs.get(s);ut.configure(s,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const as={average(s){if(!s.length)return!1;let t,e,i=new Set,n=0,r=0;for(t=0,e=s.length;t<e;++t){const a=s[t].element;if(a&&a.hasValue()){const l=a.tooltipPosition();i.add(l.x),n+=l.y,++r}}return r===0||i.size===0?!1:{x:[...i].reduce((a,l)=>a+l)/i.size,y:n/r}},nearest(s,t){if(!s.length)return!1;let e=t.x,i=t.y,n=Number.POSITIVE_INFINITY,r,o,a;for(r=0,o=s.length;r<o;++r){const l=s[r].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),h=nn(t,c);h<n&&(n=h,a=l)}}if(a){const l=a.tooltipPosition();e=l.x,i=l.y}return{x:e,y:i}}};function Rt(s,t){return t&&(q(t)?Array.prototype.push.apply(s,t):s.push(t)),s}function jt(s){return(typeof s=="string"||s instanceof String)&&s.indexOf(`
`)>-1?s.split(`
`):s}function _f(s,t){const{element:e,datasetIndex:i,index:n}=t,r=s.getDatasetMeta(i).controller,{label:o,value:a}=r.getLabelAndValue(n);return{chart:s,label:o,parsed:r.getParsed(n),raw:s.data.datasets[i].data[n],formattedValue:a,dataset:r.getDataset(),dataIndex:n,datasetIndex:i,element:e}}function ao(s,t){const e=s.chart.ctx,{body:i,footer:n,title:r}=s,{boxWidth:o,boxHeight:a}=t,l=tt(t.bodyFont),c=tt(t.titleFont),h=tt(t.footerFont),u=r.length,d=n.length,f=i.length,p=dt(t.padding);let g=p.height,m=0,b=i.reduce((v,x)=>v+x.before.length+x.lines.length+x.after.length,0);if(b+=s.beforeBody.length+s.afterBody.length,u&&(g+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),b){const v=t.displayColors?Math.max(a,l.lineHeight):l.lineHeight;g+=f*v+(b-f)*l.lineHeight+(b-1)*t.bodySpacing}d&&(g+=t.footerMarginTop+d*h.lineHeight+(d-1)*t.footerSpacing);let y=0;const _=function(v){m=Math.max(m,e.measureText(v).width+y)};return e.save(),e.font=c.string,N(s.title,_),e.font=l.string,N(s.beforeBody.concat(s.afterBody),_),y=t.displayColors?o+2+t.boxPadding:0,N(i,v=>{N(v.before,_),N(v.lines,_),N(v.after,_)}),y=0,e.font=h.string,N(s.footer,_),e.restore(),m+=p.width,{width:m,height:g}}function vf(s,t){const{y:e,height:i}=t;return e<i/2?"top":e>s.height-i/2?"bottom":"center"}function wf(s,t,e,i){const{x:n,width:r}=i,o=e.caretSize+e.caretPadding;if(s==="left"&&n+r+o>t.width||s==="right"&&n-r-o<0)return!0}function xf(s,t,e,i){const{x:n,width:r}=e,{width:o,chartArea:{left:a,right:l}}=s;let c="center";return i==="center"?c=n<=(a+l)/2?"left":"right":n<=r/2?c="left":n>=o-r/2&&(c="right"),wf(c,s,t,e)&&(c="center"),c}function lo(s,t,e){const i=e.yAlign||t.yAlign||vf(s,e);return{xAlign:e.xAlign||t.xAlign||xf(s,t,e,i),yAlign:i}}function Sf(s,t){let{x:e,width:i}=s;return t==="right"?e-=i:t==="center"&&(e-=i/2),e}function kf(s,t,e){let{y:i,height:n}=s;return t==="top"?i+=e:t==="bottom"?i-=n+e:i-=n/2,i}function co(s,t,e,i){const{caretSize:n,caretPadding:r,cornerRadius:o}=s,{xAlign:a,yAlign:l}=e,c=n+r,{topLeft:h,topRight:u,bottomLeft:d,bottomRight:f}=xe(o);let p=Sf(t,a);const g=kf(t,l,c);return l==="center"?a==="left"?p+=c:a==="right"&&(p-=c):a==="left"?p-=Math.max(h,d)+n:a==="right"&&(p+=Math.max(u,f)+n),{x:et(p,0,i.width-t.width),y:et(g,0,i.height-t.height)}}function Vs(s,t,e){const i=dt(e.padding);return t==="center"?s.x+s.width/2:t==="right"?s.x+s.width-i.right:s.x+i.left}function ho(s){return Rt([],jt(s))}function Ef(s,t,e){return ne(s,{tooltip:t,tooltipItems:e,type:"tooltip"})}function uo(s,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?s.override(e):s}const Ya={beforeTitle:Dt,title(s){if(s.length>0){const t=s[0],e=t.chart.data.labels,i=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return e[t.dataIndex]}return""},afterTitle:Dt,beforeBody:Dt,beforeLabel:Dt,label(s){if(this&&this.options&&this.options.mode==="dataset")return s.label+": "+s.formattedValue||s.formattedValue;let t=s.dataset.label||"";t&&(t+=": ");const e=s.formattedValue;return L(e)||(t+=e),t},labelColor(s){const e=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(s){const e=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Dt,afterBody:Dt,beforeFooter:Dt,footer:Dt,afterFooter:Dt};function ft(s,t,e,i){const n=s[t].call(e,i);return typeof n>"u"?Ya[t].call(e,i):n}class fo extends zt{static positioners=as;constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),n=i.enabled&&e.options.animation&&i.animations,r=new Oa(this.chart,n);return n._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=Ef(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:i}=e,n=ft(i,"beforeTitle",this,t),r=ft(i,"title",this,t),o=ft(i,"afterTitle",this,t);let a=[];return a=Rt(a,jt(n)),a=Rt(a,jt(r)),a=Rt(a,jt(o)),a}getBeforeBody(t,e){return ho(ft(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:i}=e,n=[];return N(t,r=>{const o={before:[],lines:[],after:[]},a=uo(i,r);Rt(o.before,jt(ft(a,"beforeLabel",this,r))),Rt(o.lines,ft(a,"label",this,r)),Rt(o.after,jt(ft(a,"afterLabel",this,r))),n.push(o)}),n}getAfterBody(t,e){return ho(ft(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:i}=e,n=ft(i,"beforeFooter",this,t),r=ft(i,"footer",this,t),o=ft(i,"afterFooter",this,t);let a=[];return a=Rt(a,jt(n)),a=Rt(a,jt(r)),a=Rt(a,jt(o)),a}_createItems(t){const e=this._active,i=this.chart.data,n=[],r=[],o=[];let a=[],l,c;for(l=0,c=e.length;l<c;++l)a.push(_f(this.chart,e[l]));return t.filter&&(a=a.filter((h,u,d)=>t.filter(h,u,d,i))),t.itemSort&&(a=a.sort((h,u)=>t.itemSort(h,u,i))),N(a,h=>{const u=uo(t.callbacks,h);n.push(ft(u,"labelColor",this,h)),r.push(ft(u,"labelPointStyle",this,h)),o.push(ft(u,"labelTextColor",this,h))}),this.labelColors=n,this.labelPointStyles=r,this.labelTextColors=o,this.dataPoints=a,a}update(t,e){const i=this.options.setContext(this.getContext()),n=this._active;let r,o=[];if(!n.length)this.opacity!==0&&(r={opacity:0});else{const a=as[i.position].call(this,n,this._eventPosition);o=this._createItems(i),this.title=this.getTitle(o,i),this.beforeBody=this.getBeforeBody(o,i),this.body=this.getBody(o,i),this.afterBody=this.getAfterBody(o,i),this.footer=this.getFooter(o,i);const l=this._size=ao(this,i),c=Object.assign({},a,l),h=lo(this.chart,i,c),u=co(i,c,h,this.chart);this.xAlign=h.xAlign,this.yAlign=h.yAlign,r={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=o,this.$context=void 0,r&&this._resolveAnimations().update(this,r),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,n){const r=this.getCaretPosition(t,i,n);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}getCaretPosition(t,e,i){const{xAlign:n,yAlign:r}=this,{caretSize:o,cornerRadius:a}=i,{topLeft:l,topRight:c,bottomLeft:h,bottomRight:u}=xe(a),{x:d,y:f}=t,{width:p,height:g}=e;let m,b,y,_,v,x;return r==="center"?(v=f+g/2,n==="left"?(m=d,b=m-o,_=v+o,x=v-o):(m=d+p,b=m+o,_=v-o,x=v+o),y=m):(n==="left"?b=d+Math.max(l,h)+o:n==="right"?b=d+p-Math.max(c,u)-o:b=this.caretX,r==="top"?(_=f,v=_-o,m=b-o,y=b+o):(_=f+g,v=_+o,m=b+o,y=b-o),x=_),{x1:m,x2:b,x3:y,y1:_,y2:v,y3:x}}drawTitle(t,e,i){const n=this.title,r=n.length;let o,a,l;if(r){const c=We(i.rtl,this.x,this.width);for(t.x=Vs(this,i.titleAlign,i),e.textAlign=c.textAlign(i.titleAlign),e.textBaseline="middle",o=tt(i.titleFont),a=i.titleSpacing,e.fillStyle=i.titleColor,e.font=o.string,l=0;l<r;++l)e.fillText(n[l],c.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+a,l+1===r&&(t.y+=i.titleMarginBottom-a)}}_drawColorBox(t,e,i,n,r){const o=this.labelColors[i],a=this.labelPointStyles[i],{boxHeight:l,boxWidth:c}=r,h=tt(r.bodyFont),u=Vs(this,"left",r),d=n.x(u),f=l<h.lineHeight?(h.lineHeight-l)/2:0,p=e.y+f;if(r.usePointStyle){const g={radius:Math.min(c,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},m=n.leftForLtr(d,c)+c/2,b=p+l/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,on(t,g,m,b),t.strokeStyle=o.borderColor,t.fillStyle=o.backgroundColor,on(t,g,m,b)}else{t.lineWidth=D(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,t.strokeStyle=o.borderColor,t.setLineDash(o.borderDash||[]),t.lineDashOffset=o.borderDashOffset||0;const g=n.leftForLtr(d,c),m=n.leftForLtr(n.xPlus(d,1),c-2),b=xe(o.borderRadius);Object.values(b).some(y=>y!==0)?(t.beginPath(),t.fillStyle=r.multiKeyBackground,_s(t,{x:g,y:p,w:c,h:l,radius:b}),t.fill(),t.stroke(),t.fillStyle=o.backgroundColor,t.beginPath(),_s(t,{x:m,y:p+1,w:c-2,h:l-2,radius:b}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(g,p,c,l),t.strokeRect(g,p,c,l),t.fillStyle=o.backgroundColor,t.fillRect(m,p+1,c-2,l-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:n}=this,{bodySpacing:r,bodyAlign:o,displayColors:a,boxHeight:l,boxWidth:c,boxPadding:h}=i,u=tt(i.bodyFont);let d=u.lineHeight,f=0;const p=We(i.rtl,this.x,this.width),g=function(E){e.fillText(E,p.x(t.x+f),t.y+d/2),t.y+=d+r},m=p.textAlign(o);let b,y,_,v,x,S,k;for(e.textAlign=o,e.textBaseline="middle",e.font=u.string,t.x=Vs(this,m,i),e.fillStyle=i.bodyColor,N(this.beforeBody,g),f=a&&m!=="right"?o==="center"?c/2+h:c+2+h:0,v=0,S=n.length;v<S;++v){for(b=n[v],y=this.labelTextColors[v],e.fillStyle=y,N(b.before,g),_=b.lines,a&&_.length&&(this._drawColorBox(e,t,v,p,i),d=Math.max(u.lineHeight,l)),x=0,k=_.length;x<k;++x)g(_[x]),d=u.lineHeight;N(b.after,g)}f=0,d=u.lineHeight,N(this.afterBody,g),t.y-=r}drawFooter(t,e,i){const n=this.footer,r=n.length;let o,a;if(r){const l=We(i.rtl,this.x,this.width);for(t.x=Vs(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=l.textAlign(i.footerAlign),e.textBaseline="middle",o=tt(i.footerFont),e.fillStyle=i.footerColor,e.font=o.string,a=0;a<r;++a)e.fillText(n[a],l.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+i.footerSpacing}}drawBackground(t,e,i,n){const{xAlign:r,yAlign:o}=this,{x:a,y:l}=t,{width:c,height:h}=i,{topLeft:u,topRight:d,bottomLeft:f,bottomRight:p}=xe(n.cornerRadius);e.fillStyle=n.backgroundColor,e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.beginPath(),e.moveTo(a+u,l),o==="top"&&this.drawCaret(t,e,i,n),e.lineTo(a+c-d,l),e.quadraticCurveTo(a+c,l,a+c,l+d),o==="center"&&r==="right"&&this.drawCaret(t,e,i,n),e.lineTo(a+c,l+h-p),e.quadraticCurveTo(a+c,l+h,a+c-p,l+h),o==="bottom"&&this.drawCaret(t,e,i,n),e.lineTo(a+f,l+h),e.quadraticCurveTo(a,l+h,a,l+h-f),o==="center"&&r==="left"&&this.drawCaret(t,e,i,n),e.lineTo(a,l+u),e.quadraticCurveTo(a,l,a+u,l),e.closePath(),e.fill(),n.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,n=i&&i.x,r=i&&i.y;if(n||r){const o=as[t.position].call(this,this._active,this._eventPosition);if(!o)return;const a=this._size=ao(this,t),l=Object.assign({},o,this._size),c=lo(e,t,l),h=co(t,l,c,e);(n._to!==h.x||r._to!==h.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=a.width,this.height=a.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,h))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const n={width:this.width,height:this.height},r={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const o=dt(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=i,this.drawBackground(r,t,n,e),xa(t,e.textDirection),r.y+=o.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),Sa(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,n=t.map(({datasetIndex:a,index:l})=>{const c=this.chart.getDatasetMeta(a);if(!c)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:c.data[l],index:l}}),r=!ni(i,n),o=this._positionChanged(n,e);(r||o)&&(this._active=n,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const n=this.options,r=this._active||[],o=this._getActiveElements(t,r,e,i),a=this._positionChanged(o,t),l=e||!ni(o,r)||a;return l&&(this._active=o,(n.enabled||n.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),l}_getActiveElements(t,e,i,n){const r=this.options;if(t.type==="mouseout")return[];if(!n)return e.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const o=this.chart.getElementsAtEventForMode(t,r.mode,r,i);return r.reverse&&o.reverse(),o}_positionChanged(t,e){const{caretX:i,caretY:n,options:r}=this,o=as[r.position].call(this,t,e);return o!==!1&&(i!==o.x||n!==o.y)}}var Tf={id:"tooltip",_element:fo,positioners:as,afterInit(s,t,e){e&&(s.tooltip=new fo({chart:s,options:e}))},beforeUpdate(s,t,e){s.tooltip&&s.tooltip.initialize(e)},reset(s,t,e){s.tooltip&&s.tooltip.initialize(e)},afterDraw(s){const t=s.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(s.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(s.ctx),s.notifyPlugins("afterTooltipDraw",e)}},afterEvent(s,t){if(s.tooltip){const e=t.replay;s.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(s,t)=>t.bodyFont.size,boxWidth:(s,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Ya},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:s=>s!=="filter"&&s!=="itemSort"&&s!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Af=Object.freeze({__proto__:null,Colors:Nd,Decimation:Wd,Filler:cf,Legend:pf,SubTitle:yf,Title:bf,Tooltip:Tf});const Of=(s,t,e,i)=>(typeof t=="string"?(e=s.push(t)-1,i.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function Cf(s,t,e,i){const n=s.indexOf(t);if(n===-1)return Of(s,t,e,i);const r=s.lastIndexOf(t);return n!==r?e:n}const Pf=(s,t)=>s===null?null:et(Math.round(s),0,t);function go(s){const t=this.getLabels();return s>=0&&s<t.length?t[s]:s}class Rf extends Te{static id="category";static defaults={ticks:{callback:go}};constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const i=this.getLabels();for(const{index:n,label:r}of e)i[n]===r&&i.splice(n,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(L(t))return null;const i=this.getLabels();return e=isFinite(e)&&i[e]===t?e:Cf(i,t,P(e,t),this._addedLabels),Pf(e,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:n}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),e||(n=this.getLabels().length-1)),this.min=i,this.max=n}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,n=[];let r=this.getLabels();r=t===0&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let o=t;o<=e;o++)n.push({value:o});return n}getLabelForValue(t){return go.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}function Mf(s,t){const e=[],{bounds:n,step:r,min:o,max:a,precision:l,count:c,maxTicks:h,maxDigits:u,includeBounds:d}=s,f=r||1,p=h-1,{min:g,max:m}=t,b=!L(o),y=!L(a),_=!L(c),v=(m-g)/(u+1);let x=ar((m-g)/p/f)*f,S,k,E,T;if(x<1e-14&&!b&&!y)return[{value:g},{value:m}];T=Math.ceil(m/x)-Math.floor(g/x),T>p&&(x=ar(T*x/p/f)*f),L(l)||(S=Math.pow(10,l),x=Math.ceil(x*S)/S),n==="ticks"?(k=Math.floor(g/x)*x,E=Math.ceil(m/x)*x):(k=g,E=m),b&&y&&r&&fc((a-o)/r,x/1e3)?(T=Math.round(Math.min((a-o)/x,h)),x=(a-o)/T,k=o,E=a):_?(k=b?o:k,E=y?a:E,T=c-1,x=(E-k)/T):(T=(E-k)/x,hs(T,Math.round(T),x/1e3)?T=Math.round(T):T=Math.ceil(T));const R=Math.max(lr(x),lr(k));S=Math.pow(10,L(l)?R:l),k=Math.round(k*S)/S,E=Math.round(E*S)/S;let M=0;for(b&&(d&&k!==o?(e.push({value:o}),k<o&&M++,hs(Math.round((k+M*x)*S)/S,o,po(o,v,s))&&M++):k<o&&M++);M<T;++M){const I=Math.round((k+M*x)*S)/S;if(y&&I>a)break;e.push({value:I})}return y&&d&&E!==a?e.length&&hs(e[e.length-1].value,a,po(a,v,s))?e[e.length-1].value=a:e.push({value:a}):(!y||E===a)&&e.push({value:E}),e}function po(s,t,{horizontal:e,minRotation:i}){const n=Ct(i),r=(e?Math.sin(n):Math.cos(n))||.001,o=.75*t*(""+s).length;return Math.min(t/r,o)}class ui extends Te{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return L(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:n,max:r}=this;const o=l=>n=e?n:l,a=l=>r=i?r:l;if(t){const l=Lt(n),c=Lt(r);l<0&&c<0?a(0):l>0&&c>0&&o(0)}if(n===r){let l=r===0?1:Math.abs(r*.05);a(r+l),t||o(n-l)}this.min=n,this.max=r}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:i}=t,n;return i?(n=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,n>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${n} ticks. Limiting to 1000.`),n=1e3)):(n=this.computeTickLimit(),e=e||11),e&&(n=Math.min(e,n)),n}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const n={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},r=this._range||this,o=Mf(n,r);return t.bounds==="ticks"&&ra(o,this,"value"),t.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const n=(i-e)/Math.max(t.length-1,1)/2;e-=n,i+=n}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return Ps(t,this.chart.options.locale,this.options.ticks.format)}}class Lf extends ui{static id="linear";static defaults={ticks:{callback:bi.formatters.numeric}};determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=J(t)?t:0,this.max=J(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=Ct(this.options.ticks.minRotation),n=(t?Math.sin(i):Math.cos(i))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/n))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}const ws=s=>Math.floor(Jt(s)),ue=(s,t)=>Math.pow(10,ws(s)+t);function mo(s){return s/Math.pow(10,ws(s))===1}function bo(s,t,e){const i=Math.pow(10,e),n=Math.floor(s/i);return Math.ceil(t/i)-n}function Df(s,t){const e=t-s;let i=ws(e);for(;bo(s,t,i)>10;)i++;for(;bo(s,t,i)<10;)i--;return Math.min(i,ws(s))}function If(s,{min:t,max:e}){t=yt(s.min,t);const i=[],n=ws(t);let r=Df(t,e),o=r<0?Math.pow(10,Math.abs(r)):1;const a=Math.pow(10,r),l=n>r?Math.pow(10,n):0,c=Math.round((t-l)*o)/o,h=Math.floor((t-l)/a/10)*a*10;let u=Math.floor((c-h)/Math.pow(10,r)),d=yt(s.min,Math.round((l+h+u*Math.pow(10,r))*o)/o);for(;d<e;)i.push({value:d,major:mo(d),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(r++,u=2,o=r>=0?1:o),d=Math.round((l+h+u*Math.pow(10,r))*o)/o;const f=yt(s.max,d);return i.push({value:f,major:mo(f),significand:u}),i}class jf extends Te{static id="logarithmic";static defaults={ticks:{callback:bi.formatters.logarithmic,major:{enabled:!0}}};constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const i=ui.prototype.parse.apply(this,[t,e]);if(i===0){this._zero=!0;return}return J(i)&&i>0?i:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=J(t)?Math.max(0,t):null,this.max=J(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!J(this._userMin)&&(this.min=t===ue(this.min,0)?ue(this.min,-1):ue(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let i=this.min,n=this.max;const r=a=>i=t?i:a,o=a=>n=e?n:a;i===n&&(i<=0?(r(1),o(10)):(r(ue(i,-1)),o(ue(n,1)))),i<=0&&r(ue(n,-1)),n<=0&&o(ue(i,1)),this.min=i,this.max=n}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},i=If(e,this);return t.bounds==="ticks"&&ra(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return t===void 0?"0":Ps(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=Jt(t),this._valueRange=Jt(this.max)-Jt(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(Jt(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}function dn(s){const t=s.ticks;if(t.display&&s.display){const e=dt(t.backdropPadding);return P(t.font&&t.font.size,K.font.size)+e.height}return 0}function $f(s,t,e){return e=q(e)?e:[e],{w:Pc(s,t.string,e),h:e.length*t.lineHeight}}function yo(s,t,e,i,n){return s===i||s===n?{start:t-e/2,end:t+e/2}:s<i||s>n?{start:t-e,end:t}:{start:t,end:t+e}}function Nf(s){const t={l:s.left+s._padding.left,r:s.right-s._padding.right,t:s.top+s._padding.top,b:s.bottom-s._padding.bottom},e=Object.assign({},t),i=[],n=[],r=s._pointLabels.length,o=s.options.pointLabels,a=o.centerPointLabels?j/r:0;for(let l=0;l<r;l++){const c=o.setContext(s.getPointLabelContext(l));n[l]=c.padding;const h=s.getPointPosition(l,s.drawingArea+n[l],a),u=tt(c.font),d=$f(s.ctx,u,s._pointLabels[l]);i[l]=d;const f=ht(s.getIndexAngle(l)+a),p=Math.round(Rn(f)),g=yo(p,h.x,d.w,0,180),m=yo(p,h.y,d.h,90,270);Bf(e,t,f,g,m)}s.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),s._pointLabelItems=Wf(s,i,n)}function Bf(s,t,e,i,n){const r=Math.abs(Math.sin(e)),o=Math.abs(Math.cos(e));let a=0,l=0;i.start<t.l?(a=(t.l-i.start)/r,s.l=Math.min(s.l,t.l-a)):i.end>t.r&&(a=(i.end-t.r)/r,s.r=Math.max(s.r,t.r+a)),n.start<t.t?(l=(t.t-n.start)/o,s.t=Math.min(s.t,t.t-l)):n.end>t.b&&(l=(n.end-t.b)/o,s.b=Math.max(s.b,t.b+l))}function Ff(s,t,e){const i=s.drawingArea,{extra:n,additionalAngle:r,padding:o,size:a}=e,l=s.getPointPosition(t,i+n+o,r),c=Math.round(Rn(ht(l.angle+X))),h=Hf(l.y,a.h,c),u=zf(c),d=Vf(l.x,a.w,u);return{visible:!0,x:l.x,y:h,textAlign:u,left:d,top:h,right:d+a.w,bottom:h+a.h}}function Uf(s,t){if(!t)return!0;const{left:e,top:i,right:n,bottom:r}=s;return!(Wt({x:e,y:i},t)||Wt({x:e,y:r},t)||Wt({x:n,y:i},t)||Wt({x:n,y:r},t))}function Wf(s,t,e){const i=[],n=s._pointLabels.length,r=s.options,{centerPointLabels:o,display:a}=r.pointLabels,l={extra:dn(r)/2,additionalAngle:o?j/n:0};let c;for(let h=0;h<n;h++){l.padding=e[h],l.size=t[h];const u=Ff(s,h,l);i.push(u),a==="auto"&&(u.visible=Uf(u,c),u.visible&&(c=u))}return i}function zf(s){return s===0||s===180?"center":s<180?"left":"right"}function Vf(s,t,e){return e==="right"?s-=t:e==="center"&&(s-=t/2),s}function Hf(s,t,e){return e===90||e===270?s-=t/2:(e>270||e<90)&&(s-=t),s}function qf(s,t,e){const{left:i,top:n,right:r,bottom:o}=e,{backdropColor:a}=t;if(!L(a)){const l=xe(t.borderRadius),c=dt(t.backdropPadding);s.fillStyle=a;const h=i-c.left,u=n-c.top,d=r-i+c.width,f=o-n+c.height;Object.values(l).some(p=>p!==0)?(s.beginPath(),_s(s,{x:h,y:u,w:d,h:f,radius:l}),s.fill()):s.fillRect(h,u,d,f)}}function Kf(s,t){const{ctx:e,options:{pointLabels:i}}=s;for(let n=t-1;n>=0;n--){const r=s._pointLabelItems[n];if(!r.visible)continue;const o=i.setContext(s.getPointLabelContext(n));qf(e,o,r);const a=tt(o.font),{x:l,y:c,textAlign:h}=r;Ee(e,s._pointLabels[n],l,c+a.lineHeight/2,a,{color:o.color,textAlign:h,textBaseline:"middle"})}}function Xa(s,t,e,i){const{ctx:n}=s;if(e)n.arc(s.xCenter,s.yCenter,t,0,V);else{let r=s.getPointPosition(0,t);n.moveTo(r.x,r.y);for(let o=1;o<i;o++)r=s.getPointPosition(o,t),n.lineTo(r.x,r.y)}}function Gf(s,t,e,i,n){const r=s.ctx,o=t.circular,{color:a,lineWidth:l}=t;!o&&!i||!a||!l||e<0||(r.save(),r.strokeStyle=a,r.lineWidth=l,r.setLineDash(n.dash||[]),r.lineDashOffset=n.dashOffset,r.beginPath(),Xa(s,e,o,i),r.closePath(),r.stroke(),r.restore())}function Jf(s,t,e){return ne(s,{label:e,index:t,type:"pointLabel"})}class Yf extends ui{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:bi.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=dt(dn(this.options)/2),e=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=J(t)&&!isNaN(t)?t:0,this.max=J(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/dn(this.options))}generateTickLabels(t){ui.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,i)=>{const n=z(this.options.pointLabels.callback,[e,i],this);return n||n===0?n:""}).filter((e,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?Nf(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,i,n){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((i-n)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,i,n))}getIndexAngle(t){const e=V/(this._pointLabels.length||1),i=this.options.startAngle||0;return ht(t*e+Ct(i))}getDistanceFromCenterForValue(t){if(L(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(L(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const i=e[t];return Jf(this.getContext(),t,i)}}getPointPosition(t,e,i=0){const n=this.getIndexAngle(t)-X+i;return{x:Math.cos(n)*e+this.xCenter,y:Math.sin(n)*e+this.yCenter,angle:n}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:i,right:n,bottom:r}=this._pointLabelItems[t];return{left:e,top:i,right:n,bottom:r}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),Xa(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:i,grid:n,border:r}=e,o=this._pointLabels.length;let a,l,c;if(e.pointLabels.display&&Kf(this,o),n.display&&this.ticks.forEach((h,u)=>{if(u!==0||u===0&&this.min<0){l=this.getDistanceFromCenterForValue(h.value);const d=this.getContext(u),f=n.setContext(d),p=r.setContext(d);Gf(this,f,l,o,p)}}),i.display){for(t.save(),a=o-1;a>=0;a--){const h=i.setContext(this.getPointLabelContext(a)),{color:u,lineWidth:d}=h;!d||!u||(t.lineWidth=d,t.strokeStyle=u,t.setLineDash(h.borderDash),t.lineDashOffset=h.borderDashOffset,l=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),c=this.getPointPosition(a,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const n=this.getIndexAngle(0);let r,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(n),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&this.min>=0&&!e.reverse)return;const c=i.setContext(this.getContext(l)),h=tt(c.font);if(r=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=h.string,o=t.measureText(a.label).width,t.fillStyle=c.backdropColor;const u=dt(c.backdropPadding);t.fillRect(-o/2-u.left,-r-h.size/2-u.top,o+u.width,h.size+u.height)}Ee(t,a.label,0,-r,h,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}const ki={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},gt=Object.keys(ki);function _o(s,t){return s-t}function vo(s,t){if(L(t))return null;const e=s._adapter,{parser:i,round:n,isoWeekday:r}=s._parseOpts;let o=t;return typeof i=="function"&&(o=i(o)),J(o)||(o=typeof i=="string"?e.parse(o,i):e.parse(o)),o===null?null:(n&&(o=n==="week"&&(Ve(r)||r===!0)?e.startOf(o,"isoWeek",r):e.startOf(o,n)),+o)}function wo(s,t,e,i){const n=gt.length;for(let r=gt.indexOf(s);r<n-1;++r){const o=ki[gt[r]],a=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((e-t)/(a*o.size))<=i)return gt[r]}return gt[n-1]}function Xf(s,t,e,i,n){for(let r=gt.length-1;r>=gt.indexOf(e);r--){const o=gt[r];if(ki[o].common&&s._adapter.diff(n,i,o)>=t-1)return o}return gt[e?gt.indexOf(e):0]}function Zf(s){for(let t=gt.indexOf(s)+1,e=gt.length;t<e;++t)if(ki[gt[t]].common)return gt[t]}function xo(s,t,e){if(!e)s[t]=!0;else if(e.length){const{lo:i,hi:n}=Mn(e,t),r=e[i]>=t?e[i]:e[n];s[r]=!0}}function Qf(s,t,e,i){const n=s._adapter,r=+n.startOf(t[0].value,i),o=t[t.length-1].value;let a,l;for(a=r;a<=o;a=+n.add(a,1,i))l=e[a],l>=0&&(t[l].major=!0);return t}function So(s,t,e){const i=[],n={},r=t.length;let o,a;for(o=0;o<r;++o)a=t[o],n[a]=o,i.push({value:a,major:!1});return r===0||!e?i:Qf(s,i,n,e)}class fn extends Te{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const i=t.time||(t.time={}),n=this._adapter=new Qh._date(t.adapters.date);n.init(e),cs(i.displayFormats,n.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:vo(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:n,max:r,minDefined:o,maxDefined:a}=this.getUserBounds();function l(c){!o&&!isNaN(c.min)&&(n=Math.min(n,c.min)),!a&&!isNaN(c.max)&&(r=Math.max(r,c.max))}(!o||!a)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),n=J(n)&&!isNaN(n)?n:+e.startOf(Date.now(),i),r=J(r)&&!isNaN(r)?r:+e.endOf(Date.now(),i)+1,this.min=Math.min(n,r-1),this.max=Math.max(n+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,n=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&n.length&&(this.min=this._userMin||n[0],this.max=this._userMax||n[n.length-1]);const r=this.min,o=this.max,a=bc(n,r,o);return this._unit=e.unit||(i.autoSkip?wo(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):Xf(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:Zf(this._unit),this.initOffsets(n),t.reverse&&a.reverse(),So(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,i=0,n,r;this.options.offset&&t.length&&(n=this.getDecimalForValue(t[0]),t.length===1?e=1-n:e=(this.getDecimalForValue(t[1])-n)/2,r=this.getDecimalForValue(t[t.length-1]),t.length===1?i=r:i=(r-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;e=et(e,0,o),i=et(i,0,o),this._offsets={start:e,end:i,factor:1/(e+1+i)}}_generate(){const t=this._adapter,e=this.min,i=this.max,n=this.options,r=n.time,o=r.unit||wo(r.minUnit,e,i,this._getLabelCapacity(e)),a=P(n.ticks.stepSize,1),l=o==="week"?r.isoWeekday:!1,c=Ve(l)||l===!0,h={};let u=e,d,f;if(c&&(u=+t.startOf(u,"isoWeek",l)),u=+t.startOf(u,c?"day":o),t.diff(i,e,o)>1e5*a)throw new Error(e+" and "+i+" are too far apart with stepSize of "+a+" "+o);const p=n.ticks.source==="data"&&this.getDataTimestamps();for(d=u,f=0;d<i;d=+t.add(d,a,o),f++)xo(h,d,p);return(d===i||n.bounds==="ticks"||f===1)&&xo(h,d,p),Object.keys(h).sort(_o).map(g=>+g)}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}format(t,e){const n=this.options.time.displayFormats,r=this._unit,o=e||n[r];return this._adapter.format(t,o)}_tickFormatFunction(t,e,i,n){const r=this.options,o=r.ticks.callback;if(o)return z(o,[t,e,i],this);const a=r.time.displayFormats,l=this._unit,c=this._majorUnit,h=l&&a[l],u=c&&a[c],d=i[e],f=c&&u&&d&&d.major;return this._adapter.format(t,n||(f?u:h))}generateTickLabels(t){let e,i,n;for(e=0,i=t.length;e<i;++e)n=t[e],n.label=this._tickFormatFunction(n.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,n=Ct(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(n),o=Math.sin(n),a=this._resolveTickFontOptions(0).size;return{w:i*r+a*o,h:i*o+a*r}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,n=i[e.unit]||i.millisecond,r=this._tickFormatFunction(t,0,So(this,[t],this._majorUnit),n),o=this._getLabelSize(r),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],e,i;if(t.length)return t;const n=this.getMatchingVisibleMetas();if(this._normalized&&n.length)return this._cache.data=n[0].controller.getAllParsedValues(this);for(e=0,i=n.length;e<i;++e)t=t.concat(n[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const n=this.getLabels();for(e=0,i=n.length;e<i;++e)t.push(vo(this,n[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return la(t.sort(_o))}}function Hs(s,t,e){let i=0,n=s.length-1,r,o,a,l;e?(t>=s[i].pos&&t<=s[n].pos&&({lo:i,hi:n}=Ut(s,"pos",t)),{pos:r,time:a}=s[i],{pos:o,time:l}=s[n]):(t>=s[i].time&&t<=s[n].time&&({lo:i,hi:n}=Ut(s,"time",t)),{time:r,pos:a}=s[i],{time:o,pos:l}=s[n]);const c=o-r;return c?a+(l-a)*(t-r)/c:a}class tg extends fn{static id="timeseries";static defaults=fn.defaults;constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=Hs(e,this.min),this._tableRange=Hs(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,n=[],r=[];let o,a,l,c,h;for(o=0,a=t.length;o<a;++o)c=t[o],c>=e&&c<=i&&n.push(c);if(n.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(o=0,a=n.length;o<a;++o)h=n[o+1],l=n[o-1],c=n[o],Math.round((h+l)/2)!==c&&r.push({time:c,pos:o/(a-1)});return r}_generate(){const t=this.min,e=this.max;let i=super.getDataTimestamps();return(!i.includes(t)||!i.length)&&i.splice(0,0,t),(!i.includes(e)||i.length===1)&&i.push(e),i.sort((n,r)=>n-r)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return e.length&&i.length?t=this.normalize(e.concat(i)):t=e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(Hs(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return Hs(this._table,i*this._tableRange+this._minPos,!0)}}var eg=Object.freeze({__proto__:null,CategoryScale:Rf,LinearScale:Lf,LogarithmicScale:jf,RadialLinearScale:Yf,TimeScale:fn,TimeSeriesScale:tg});const sg=[Zh,Rd,Af,eg];zn.register(...sg);const Za="fg_state",ig=[{id:"hogar",name:"Hogar",emoji:"",color:"#E8956E",wallet_type:"personal",monthly_budget:2e4},{id:"random",name:"Random",emoji:"",color:"#5B8C5A",wallet_type:"business",monthly_budget:5e3},{id:"dhash",name:"Dhash",emoji:"",color:"#9B7EC8",wallet_type:"business",monthly_budget:1e4}],ng={hogar:[{name:"Renta",icon:"",type:"expense"},{name:"Comida",icon:"",type:"expense"},{name:"Salud",icon:"",type:"expense"},{name:"Beb",icon:"",type:"expense"},{name:"Mantenimiento",icon:"",type:"expense"},{name:"Transporte",icon:"",type:"expense"},{name:"Servicios",icon:"",type:"expense"},{name:"Personal",icon:"",type:"expense"},{name:"Mascotas",icon:"",type:"expense"},{name:"Suscripciones",icon:"",type:"expense"},{name:"Entretenimiento",icon:"",type:"expense"},{name:"Otro Ingreso",icon:"",type:"income"}],random:[{name:"Servicios",icon:"",type:"income"},{name:"Comisiones",icon:"",type:"income"},{name:"Ventas",icon:"",type:"income"},{name:"Renta",icon:"",type:"expense"},{name:"Contabilidad",icon:"",type:"expense"},{name:"Servicios Op.",icon:"",type:"expense"},{name:"Suscripciones",icon:"",type:"expense"},{name:"Marketing",icon:"",type:"expense"},{name:"Materiales",icon:"",type:"expense"},{name:"Otros",icon:"",type:"expense"}],dhash:[{name:"Cuadros",icon:"",type:"income"},{name:"Murales",icon:"",type:"income"},{name:"Tattoo",icon:"",type:"income"},{name:"Diseo",icon:"",type:"income"},{name:"Materiales",icon:"",type:"expense"},{name:"Sueldos",icon:"",type:"expense"},{name:"Gastos Operativos",icon:"",type:"expense"},{name:"Suscripciones",icon:"",type:"expense"},{name:"Transporte",icon:"",type:"expense"},{name:"Otros",icon:"",type:"expense"}]},rg=[{id:"mp-hogar",name:"Mercado Pago (Hogar)",institution:"Mercado Pago",balance:0,currency:"MXN"},{id:"mp-dhash",name:"Mercado Pago (Dhash)",institution:"Mercado Pago",balance:0,currency:"MXN"},{id:"mp-random",name:"Mercado Pago (Random)",institution:"Mercado Pago",balance:0,currency:"MXN"},{id:"bbva",name:"BBVA",institution:"BBVA",balance:0,currency:"MXN"}];let vt={wallets:[...ig],categories:{...ng},accounts:[...rg],transactions:[],goals:[],activeWalletId:"hogar",currentMonth:new Date().toISOString().slice(0,7),theme:"dark",userRules:[],supabaseConnected:!1};const ko={"01":{accent:"#A0C4FF",name:"Ice Blue"},"02":{accent:"#C8B560",name:"Golden Olive"},"03":{accent:"#9B7EC8",name:"Amethyst"},"04":{accent:"#FFADAD",name:"Cherry Blossom"},"05":{accent:"#80ED99",name:"Fresh Green"},"06":{accent:"#E7C6FF",name:"Lavender"},"07":{accent:"#FFD6A5",name:"Sunset"},"08":{accent:"#FDFFB6",name:"Lemon"},"09":{accent:"#FF9B85",name:"Terracotta"},10:{accent:"#D4A853",name:"Harvest Gold"},11:{accent:"#48CAE4",name:"Frost"},12:{accent:"#FF6B6B",name:"Festive Red"}};function og(){const s=vt.currentMonth.split("-")[1],t=ko[s]||ko["01"],e=document.documentElement;e.style.setProperty("--accent",t.accent),e.style.setProperty("--accent-light",`color-mix(in srgb, ${t.accent}, transparent 88%)`),e.style.setProperty("--accent-glow",`color-mix(in srgb, ${t.accent}, transparent 75%)`),console.log(`Applied theme for ${s}: ${t.name}`)}const gn=new Set;function ag(){try{const s=localStorage.getItem(Za);if(s){const t=JSON.parse(s);vt={...vt,...t}}}catch(s){console.warn("Failed to load state:",s)}return vt}function pt(){try{localStorage.setItem(Za,JSON.stringify(vt))}catch(s){console.warn("Failed to save state:",s)}}function B(){return vt}function Pt(s){const t=new Set(Object.keys(s));Object.assign(vt,s),pt(),gn.forEach(e=>e(vt,t))}function lg(s){return gn.add(s),()=>gn.delete(s)}function Qa(){return vt.wallets.find(s=>s.id===vt.activeWalletId)||vt.wallets[0]}function Ei(s,t){const e=vt.categories[s]||[];return t?e.filter(i=>i.type===t):e}function cg(){const[s,t]=vt.currentMonth.split("-").map(Number);return{year:s,month:t}}function hg(){const{year:s,month:t}=cg(),e=`${s}-${String(t).padStart(2,"0")}-01`,i=new Date(s,t,0).getDate(),n=`${s}-${String(t).padStart(2,"0")}-${i}`;return{start:e,end:n}}function ug(s){const[t,e]=s.split("-").map(Number);return`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][e-1]} ${t}`}function at(s){const t=s<0,e=new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",minimumFractionDigits:0,maximumFractionDigits:2}).format(Math.abs(s));return t?`-${e}`:e}function tl(s){const t=new Date(s+"T12:00:00"),e=new Date,i=new Date(e);return i.setDate(i.getDate()-1),t.toDateString()===e.toDateString()?"Hoy":t.toDateString()===i.toDateString()?"Ayer":t.toLocaleDateString("es-MX",{day:"numeric",month:"short"})}ag();function Ti(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(s);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(s,i[n])&&(e[i[n]]=s[i[n]]);return e}function dg(s,t,e,i){function n(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function a(h){try{c(i.next(h))}catch(u){o(u)}}function l(h){try{c(i.throw(h))}catch(u){o(u)}}function c(h){h.done?r(h.value):n(h.value).then(a,l)}c((i=i.apply(s,t||[])).next())})}const fg=s=>s?(...t)=>s(...t):(...t)=>fetch(...t);class Hn extends Error{constructor(t,e="FunctionsError",i){super(t),this.name=e,this.context=i}}class gg extends Hn{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class Eo extends Hn{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class To extends Hn{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var pn;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(pn||(pn={}));class pg{constructor(t,{headers:e={},customFetch:i,region:n=pn.Any}={}){this.url=t,this.headers=e,this.region=n,this.fetch=fg(i)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return dg(this,arguments,void 0,function*(e,i={}){var n;let r,o;try{const{headers:a,method:l,body:c,signal:h,timeout:u}=i;let d={},{region:f}=i;f||(f=this.region);const p=new URL(`${this.url}/${e}`);f&&f!=="any"&&(d["x-region"]=f,p.searchParams.set("forceFunctionRegion",f));let g;c&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",g=c):typeof c=="string"?(d["Content-Type"]="text/plain",g=c):typeof FormData<"u"&&c instanceof FormData?g=c:(d["Content-Type"]="application/json",g=JSON.stringify(c)):c&&typeof c!="string"&&!(typeof Blob<"u"&&c instanceof Blob)&&!(c instanceof ArrayBuffer)&&!(typeof FormData<"u"&&c instanceof FormData)?g=JSON.stringify(c):g=c;let m=h;u&&(o=new AbortController,r=setTimeout(()=>o.abort(),u),h?(m=o.signal,h.addEventListener("abort",()=>o.abort())):m=o.signal);const b=yield this.fetch(p.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),a),body:g,signal:m}).catch(x=>{throw new gg(x)}),y=b.headers.get("x-relay-error");if(y&&y==="true")throw new Eo(b);if(!b.ok)throw new To(b);let _=((n=b.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),v;return _==="application/json"?v=yield b.json():_==="application/octet-stream"||_==="application/pdf"?v=yield b.blob():_==="text/event-stream"?v=b:_==="multipart/form-data"?v=yield b.formData():v=yield b.text(),{data:v,error:null,response:b}}catch(a){return{data:null,error:a,response:a instanceof To||a instanceof Eo?a.context:void 0}}finally{r&&clearTimeout(r)}})}}var mg=class extends Error{constructor(s){super(s.message),this.name="PostgrestError",this.details=s.details,this.hint=s.hint,this.code=s.code}},bg=class{constructor(s){var t,e,i;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(t=s.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=s.signal,this.isMaybeSingle=(e=s.isMaybeSingle)!==null&&e!==void 0?e:!1,this.urlLengthLimit=(i=s.urlLengthLimit)!==null&&i!==void 0?i:8e3,s.fetch?this.fetch=s.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,t){return this.headers=new Headers(this.headers),this.headers.set(s,t),this}then(s,t){var e=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const i=this.fetch;let n=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{let o=null,a=null,l=null,c=r.status,h=r.statusText;if(r.ok){var u,d;if(e.method!=="HEAD"){var f;const b=await r.text();b===""||(e.headers.get("Accept")==="text/csv"||e.headers.get("Accept")&&(!((f=e.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?a=b:a=JSON.parse(b))}const g=(u=e.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),m=(d=r.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");g&&m&&m.length>1&&(l=parseInt(m[1])),e.isMaybeSingle&&e.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,c=406,h="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var p;const g=await r.text();try{o=JSON.parse(g),Array.isArray(o)&&r.status===404&&(a=[],o=null,c=200,h="OK")}catch{r.status===404&&g===""?(c=204,h="No Content"):o={message:g}}if(o&&e.isMaybeSingle&&(!(o==null||(p=o.details)===null||p===void 0)&&p.includes("0 rows"))&&(o=null,c=200,h="OK"),o&&e.shouldThrowOnError)throw new mg(o)}return{error:o,data:a,count:l,status:c,statusText:h}});return this.shouldThrowOnError||(n=n.catch(r=>{var o;let a="",l="",c="";const h=r?.cause;if(h){var u,d,f,p;const b=(u=h?.message)!==null&&u!==void 0?u:"",y=(d=h?.code)!==null&&d!==void 0?d:"";a=`${(f=r?.name)!==null&&f!==void 0?f:"FetchError"}: ${r?.message}`,a+=`

Caused by: ${(p=h?.name)!==null&&p!==void 0?p:"Error"}: ${b}`,y&&(a+=` (${y})`),h?.stack&&(a+=`
${h.stack}`)}else{var g;a=(g=r?.stack)!==null&&g!==void 0?g:""}const m=this.url.toString().length;return r?.name==="AbortError"||r?.code==="ABORT_ERR"?(c="",l="Request was aborted (timeout or manual cancellation)",m>this.urlLengthLimit&&(l+=`. Note: Your request URL is ${m} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):(h?.name==="HeadersOverflowError"||h?.code==="UND_ERR_HEADERS_OVERFLOW")&&(c="",l="HTTP headers exceeded server limits (typically 16KB)",m>this.urlLengthLimit&&(l+=`. Your request URL is ${m} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(o=r?.name)!==null&&o!==void 0?o:"FetchError"}: ${r?.message}`,details:a,hint:l,code:c},data:null,count:null,status:0,statusText:""}})),n.then(s,t)}returns(){return this}overrideTypes(){return this}},yg=class extends bg{select(s){let t=!1;const e=(s??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",e),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:t=!0,nullsFirst:e,foreignTable:i,referencedTable:n=i}={}){const r=n?`${n}.order`:"order",o=this.url.searchParams.get(r);return this.url.searchParams.set(r,`${o?`${o},`:""}${s}.${t?"asc":"desc"}${e===void 0?"":e?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:t,referencedTable:e=t}={}){const i=typeof e>"u"?"limit":`${e}.limit`;return this.url.searchParams.set(i,`${s}`),this}range(s,t,{foreignTable:e,referencedTable:i=e}={}){const n=typeof i>"u"?"offset":`${i}.offset`,r=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(n,`${s}`),this.url.searchParams.set(r,`${t-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:t=!1,settings:e=!1,buffers:i=!1,wal:n=!1,format:r="text"}={}){var o;const a=[s?"analyze":null,t?"verbose":null,e?"settings":null,i?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${r}; for="${l}"; options=${a};`),r==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}};const Ao=new RegExp("[,()]");var $e=class extends yg{eq(s,t){return this.url.searchParams.append(s,`eq.${t}`),this}neq(s,t){return this.url.searchParams.append(s,`neq.${t}`),this}gt(s,t){return this.url.searchParams.append(s,`gt.${t}`),this}gte(s,t){return this.url.searchParams.append(s,`gte.${t}`),this}lt(s,t){return this.url.searchParams.append(s,`lt.${t}`),this}lte(s,t){return this.url.searchParams.append(s,`lte.${t}`),this}like(s,t){return this.url.searchParams.append(s,`like.${t}`),this}likeAllOf(s,t){return this.url.searchParams.append(s,`like(all).{${t.join(",")}}`),this}likeAnyOf(s,t){return this.url.searchParams.append(s,`like(any).{${t.join(",")}}`),this}ilike(s,t){return this.url.searchParams.append(s,`ilike.${t}`),this}ilikeAllOf(s,t){return this.url.searchParams.append(s,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(s,t){return this.url.searchParams.append(s,`ilike(any).{${t.join(",")}}`),this}regexMatch(s,t){return this.url.searchParams.append(s,`match.${t}`),this}regexIMatch(s,t){return this.url.searchParams.append(s,`imatch.${t}`),this}is(s,t){return this.url.searchParams.append(s,`is.${t}`),this}isDistinct(s,t){return this.url.searchParams.append(s,`isdistinct.${t}`),this}in(s,t){const e=Array.from(new Set(t)).map(i=>typeof i=="string"&&Ao.test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(s,`in.(${e})`),this}notIn(s,t){const e=Array.from(new Set(t)).map(i=>typeof i=="string"&&Ao.test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(s,`not.in.(${e})`),this}contains(s,t){return typeof t=="string"?this.url.searchParams.append(s,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(s,`cs.{${t.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(t)}`),this}containedBy(s,t){return typeof t=="string"?this.url.searchParams.append(s,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(s,`cd.{${t.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(t)}`),this}rangeGt(s,t){return this.url.searchParams.append(s,`sr.${t}`),this}rangeGte(s,t){return this.url.searchParams.append(s,`nxl.${t}`),this}rangeLt(s,t){return this.url.searchParams.append(s,`sl.${t}`),this}rangeLte(s,t){return this.url.searchParams.append(s,`nxr.${t}`),this}rangeAdjacent(s,t){return this.url.searchParams.append(s,`adj.${t}`),this}overlaps(s,t){return typeof t=="string"?this.url.searchParams.append(s,`ov.${t}`):this.url.searchParams.append(s,`ov.{${t.join(",")}}`),this}textSearch(s,t,{config:e,type:i}={}){let n="";i==="plain"?n="pl":i==="phrase"?n="ph":i==="websearch"&&(n="w");const r=e===void 0?"":`(${e})`;return this.url.searchParams.append(s,`${n}fts${r}.${t}`),this}match(s){return Object.entries(s).forEach(([t,e])=>{this.url.searchParams.append(t,`eq.${e}`)}),this}not(s,t,e){return this.url.searchParams.append(s,`not.${t}.${e}`),this}or(s,{foreignTable:t,referencedTable:e=t}={}){const i=e?`${e}.or`:"or";return this.url.searchParams.append(i,`(${s})`),this}filter(s,t,e){return this.url.searchParams.append(s,`${t}.${e}`),this}},_g=class{constructor(s,{headers:t={},schema:e,fetch:i,urlLengthLimit:n=8e3}){this.url=s,this.headers=new Headers(t),this.schema=e,this.fetch=i,this.urlLengthLimit=n}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(s,t){const{head:e=!1,count:i}=t??{},n=e?"HEAD":"GET";let r=!1;const o=(s??"*").split("").map(c=>/\s/.test(c)&&!r?"":(c==='"'&&(r=!r),c)).join(""),{url:a,headers:l}=this.cloneRequestState();return a.searchParams.set("select",o),i&&l.append("Prefer",`count=${i}`),new $e({method:n,url:a,headers:l,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(s,{count:t,defaultToNull:e=!0}={}){var i;const n="POST",{url:r,headers:o}=this.cloneRequestState();if(t&&o.append("Prefer",`count=${t}`),e||o.append("Prefer","missing=default"),Array.isArray(s)){const a=s.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(a.length>0){const l=[...new Set(a)].map(c=>`"${c}"`);r.searchParams.set("columns",l.join(","))}}return new $e({method:n,url:r,headers:o,schema:this.schema,body:s,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(s,{onConflict:t,ignoreDuplicates:e=!1,count:i,defaultToNull:n=!0}={}){var r;const o="POST",{url:a,headers:l}=this.cloneRequestState();if(l.append("Prefer",`resolution=${e?"ignore":"merge"}-duplicates`),t!==void 0&&a.searchParams.set("on_conflict",t),i&&l.append("Prefer",`count=${i}`),n||l.append("Prefer","missing=default"),Array.isArray(s)){const c=s.reduce((h,u)=>h.concat(Object.keys(u)),[]);if(c.length>0){const h=[...new Set(c)].map(u=>`"${u}"`);a.searchParams.set("columns",h.join(","))}}return new $e({method:o,url:a,headers:l,schema:this.schema,body:s,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}update(s,{count:t}={}){var e;const i="PATCH",{url:n,headers:r}=this.cloneRequestState();return t&&r.append("Prefer",`count=${t}`),new $e({method:i,url:n,headers:r,schema:this.schema,body:s,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:s}={}){var t;const e="DELETE",{url:i,headers:n}=this.cloneRequestState();return s&&n.append("Prefer",`count=${s}`),new $e({method:e,url:i,headers:n,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch,urlLengthLimit:this.urlLengthLimit})}};function xs(s){"@babel/helpers - typeof";return xs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xs(s)}function vg(s,t){if(xs(s)!="object"||!s)return s;var e=s[Symbol.toPrimitive];if(e!==void 0){var i=e.call(s,t);if(xs(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function wg(s){var t=vg(s,"string");return xs(t)=="symbol"?t:t+""}function xg(s,t,e){return(t=wg(t))in s?Object.defineProperty(s,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[t]=e,s}function Oo(s,t){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),e.push.apply(e,i)}return e}function qs(s){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Oo(Object(e),!0).forEach(function(i){xg(s,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):Oo(Object(e)).forEach(function(i){Object.defineProperty(s,i,Object.getOwnPropertyDescriptor(e,i))})}return s}var Sg=class el{constructor(t,{headers:e={},schema:i,fetch:n,timeout:r,urlLengthLimit:o=8e3}={}){this.url=t,this.headers=new Headers(e),this.schemaName=i,this.urlLengthLimit=o;const a=n??globalThis.fetch;r!==void 0&&r>0?this.fetch=(l,c)=>{const h=new AbortController,u=setTimeout(()=>h.abort(),r),d=c?.signal;if(d){if(d.aborted)return clearTimeout(u),a(l,c);const f=()=>{clearTimeout(u),h.abort()};return d.addEventListener("abort",f,{once:!0}),a(l,qs(qs({},c),{},{signal:h.signal})).finally(()=>{clearTimeout(u),d.removeEventListener("abort",f)})}return a(l,qs(qs({},c),{},{signal:h.signal})).finally(()=>clearTimeout(u))}:this.fetch=a}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new _g(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(t){return new el(this.url,{headers:this.headers,schema:t,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(t,e={},{head:i=!1,get:n=!1,count:r}={}){var o;let a;const l=new URL(`${this.url}/rpc/${t}`);let c;const h=f=>f!==null&&typeof f=="object"&&(!Array.isArray(f)||f.some(h)),u=i&&Object.values(e).some(h);u?(a="POST",c=e):i||n?(a=i?"HEAD":"GET",Object.entries(e).filter(([f,p])=>p!==void 0).map(([f,p])=>[f,Array.isArray(p)?`{${p.join(",")}}`:`${p}`]).forEach(([f,p])=>{l.searchParams.append(f,p)})):(a="POST",c=e);const d=new Headers(this.headers);return u?d.set("Prefer",r?`count=${r},return=minimal`:"return=minimal"):r&&d.set("Prefer",`count=${r}`),new $e({method:a,url:l,headers:d,schema:this.schemaName,body:c,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}};class kg{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const e=globalThis.process;if(e){const i=e.versions;if(i&&i.node){const n=i.node,r=parseInt(n.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let e=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(e+=`

Suggested solution: ${t.workaround}`),new Error(e)}static createWebSocket(t,e){const i=this.getWebSocketConstructor();return new i(t,e)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const Eg="2.95.3",Tg=`realtime-js/${Eg}`,Ag="1.0.0",sl="2.0.0",Co=sl,mn=1e4,Og=1e3,Cg=100;var Ht;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(Ht||(Ht={}));var Q;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(Q||(Q={}));var Tt;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(Tt||(Tt={}));var bn;(function(s){s.websocket="websocket"})(bn||(bn={}));var ye;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(ye||(ye={}));class Pg{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,e){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return e(this._binaryEncodeUserBroadcastPush(t));let i=[t.join_ref,t.ref,t.topic,t.event,t.payload];return e(JSON.stringify(i))}_binaryEncodeUserBroadcastPush(t){var e;return this._isArrayBuffer((e=t.payload)===null||e===void 0?void 0:e.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var e,i;const n=(i=(e=t.payload)===null||e===void 0?void 0:e.payload)!==null&&i!==void 0?i:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,n)}_encodeJsonUserBroadcastPush(t){var e,i;const n=(i=(e=t.payload)===null||e===void 0?void 0:e.payload)!==null&&i!==void 0?i:{},o=new TextEncoder().encode(JSON.stringify(n)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(t,e,i){var n,r;const o=t.topic,a=(n=t.ref)!==null&&n!==void 0?n:"",l=(r=t.join_ref)!==null&&r!==void 0?r:"",c=t.payload.event,h=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},u=Object.keys(h).length===0?"":JSON.stringify(h);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`metadata length ${u.length} exceeds maximum of 255`);const d=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+c.length+u.length,f=new ArrayBuffer(this.HEADER_LENGTH+d);let p=new DataView(f),g=0;p.setUint8(g++,this.KINDS.userBroadcastPush),p.setUint8(g++,l.length),p.setUint8(g++,a.length),p.setUint8(g++,o.length),p.setUint8(g++,c.length),p.setUint8(g++,u.length),p.setUint8(g++,e),Array.from(l,b=>p.setUint8(g++,b.charCodeAt(0))),Array.from(a,b=>p.setUint8(g++,b.charCodeAt(0))),Array.from(o,b=>p.setUint8(g++,b.charCodeAt(0))),Array.from(c,b=>p.setUint8(g++,b.charCodeAt(0))),Array.from(u,b=>p.setUint8(g++,b.charCodeAt(0)));var m=new Uint8Array(f.byteLength+i.byteLength);return m.set(new Uint8Array(f),0),m.set(new Uint8Array(i),f.byteLength),m.buffer}decode(t,e){if(this._isArrayBuffer(t)){let i=this._binaryDecode(t);return e(i)}if(typeof t=="string"){const i=JSON.parse(t),[n,r,o,a,l]=i;return e({join_ref:n,ref:r,topic:o,event:a,payload:l})}return e({})}_binaryDecode(t){const e=new DataView(t),i=e.getUint8(0),n=new TextDecoder;if(i===this.KINDS.userBroadcast)return this._decodeUserBroadcast(t,e,n)}_decodeUserBroadcast(t,e,i){const n=e.getUint8(1),r=e.getUint8(2),o=e.getUint8(3),a=e.getUint8(4);let l=this.HEADER_LENGTH+4;const c=i.decode(t.slice(l,l+n));l=l+n;const h=i.decode(t.slice(l,l+r));l=l+r;const u=i.decode(t.slice(l,l+o));l=l+o;const d=t.slice(l,t.byteLength),f=a===this.JSON_ENCODING?JSON.parse(i.decode(d)):d,p={type:this.BROADCAST_EVENT,event:h,payload:f};return o>0&&(p.meta=JSON.parse(u)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:p}}_isArrayBuffer(t){var e;return t instanceof ArrayBuffer||((e=t?.constructor)===null||e===void 0?void 0:e.name)==="ArrayBuffer"}_pick(t,e){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([i])=>e.includes(i)))}}class il{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var W;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(W||(W={}));const Po=(s,t,e={})=>{var i;const n=(i=e.skipTypes)!==null&&i!==void 0?i:[];return t?Object.keys(t).reduce((r,o)=>(r[o]=Rg(o,s,t,n),r),{}):{}},Rg=(s,t,e,i)=>{const n=t.find(a=>a.name===s),r=n?.type,o=e[s];return r&&!i.includes(r)?nl(r,o):yn(o)},nl=(s,t)=>{if(s.charAt(0)==="_"){const e=s.slice(1,s.length);return Ig(t,e)}switch(s){case W.bool:return Mg(t);case W.float4:case W.float8:case W.int2:case W.int4:case W.int8:case W.numeric:case W.oid:return Lg(t);case W.json:case W.jsonb:return Dg(t);case W.timestamp:return jg(t);case W.abstime:case W.date:case W.daterange:case W.int4range:case W.int8range:case W.money:case W.reltime:case W.text:case W.time:case W.timestamptz:case W.timetz:case W.tsrange:case W.tstzrange:return yn(t);default:return yn(t)}},yn=s=>s,Mg=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},Lg=s=>{if(typeof s=="string"){const t=parseFloat(s);if(!Number.isNaN(t))return t}return s},Dg=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch{return s}return s},Ig=(s,t)=>{if(typeof s!="string")return s;const e=s.length-1,i=s[e];if(s[0]==="{"&&i==="}"){let r;const o=s.slice(1,e);try{r=JSON.parse("["+o+"]")}catch{r=o?o.split(","):[]}return r.map(a=>nl(t,a))}return s},jg=s=>typeof s=="string"?s.replace(" ","T"):s,rl=s=>{const t=new URL(s);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Hi{constructor(t,e,i={},n=mn){this.channel=t,this.event=e,this.payload=i,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var i;return this._hasReceived(t)&&e((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:e}){this.recHooks.filter(i=>i.status===t).forEach(i=>i.callback(e))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Ro;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(Ro||(Ro={}));class fs{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=e?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},n=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=fs.syncState(this.state,n,r,o),this.pendingDiffs.forEach(l=>{this.state=fs.syncDiff(this.state,l,r,o)}),this.pendingDiffs=[],a()}),this.channel._on(i.diff,{},n=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=fs.syncDiff(this.state,n,r,o),a())}),this.onJoin((n,r,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:r,newPresences:o})}),this.onLeave((n,r,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:r,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,e,i,n){const r=this.cloneDeep(t),o=this.transformState(e),a={},l={};return this.map(r,(c,h)=>{o[c]||(l[c]=h)}),this.map(o,(c,h)=>{const u=r[c];if(u){const d=h.map(m=>m.presence_ref),f=u.map(m=>m.presence_ref),p=h.filter(m=>f.indexOf(m.presence_ref)<0),g=u.filter(m=>d.indexOf(m.presence_ref)<0);p.length>0&&(a[c]=p),g.length>0&&(l[c]=g)}else a[c]=h}),this.syncDiff(r,{joins:a,leaves:l},i,n)}static syncDiff(t,e,i,n){const{joins:r,leaves:o}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return i||(i=()=>{}),n||(n=()=>{}),this.map(r,(a,l)=>{var c;const h=(c=t[a])!==null&&c!==void 0?c:[];if(t[a]=this.cloneDeep(l),h.length>0){const u=t[a].map(f=>f.presence_ref),d=h.filter(f=>u.indexOf(f.presence_ref)<0);t[a].unshift(...d)}i(a,h,l)}),this.map(o,(a,l)=>{let c=t[a];if(!c)return;const h=l.map(u=>u.presence_ref);c=c.filter(u=>h.indexOf(u.presence_ref)<0),t[a]=c,n(a,c,l),c.length===0&&delete t[a]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(i=>e(i,t[i]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,i)=>{const n=t[i];return"metas"in n?e[i]=n.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):e[i]=n,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Mo;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(Mo||(Mo={}));var gs;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(gs||(gs={}));var $t;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})($t||($t={}));class Ue{constructor(t,e={config:{}},i){var n,r;if(this.topic=t,this.params=e,this.socket=i,this.bindings={},this.state=Q.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new Hi(this,Tt.join,this.params,this.timeout),this.rejoinTimer=new il(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Q.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Q.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Q.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Q.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Q.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Tt.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new fs(this),this.broadcastEndpointURL=rl(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((r=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||r===void 0)&&r.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,e=this.timeout){var i,n,r;if(this.socket.isConnected()||this.socket.connect(),this.state==Q.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(n=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map(f=>f.filter))!==null&&n!==void 0?n:[],h=!!this.bindings[gs.PRESENCE]&&this.bindings[gs.PRESENCE].length>0||((r=this.params.config.presence)===null||r===void 0?void 0:r.enabled)===!0,u={},d={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:h}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(f=>t?.($t.CHANNEL_ERROR,f)),this._onClose(()=>t?.($t.CLOSED)),this.updateJoinPayload(Object.assign({config:d},u)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",async({postgres_changes:f})=>{var p;if(this.socket._isManualToken()||this.socket.setAuth(),f===void 0){t?.($t.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,m=(p=g?.length)!==null&&p!==void 0?p:0,b=[];for(let y=0;y<m;y++){const _=g[y],{filter:{event:v,schema:x,table:S,filter:k}}=_,E=f&&f[y];if(E&&E.event===v&&Ue.isFilterValueEqual(E.schema,x)&&Ue.isFilterValueEqual(E.table,S)&&Ue.isFilterValueEqual(E.filter,k))b.push(Object.assign(Object.assign({},_),{id:E.id}));else{this.unsubscribe(),this.state=Q.errored,t?.($t.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=b,t&&t($t.SUBSCRIBED);return}}).receive("error",f=>{this.state=Q.errored,t?.($t.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{t?.($t.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,e={}){return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,e,i){return this.state===Q.joined&&t===gs.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,e,i)}async httpSend(t,e,i={}){var n;if(e==null)return Promise.reject("Payload is required for httpSend()");const r={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(r.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:r,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:e,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(n=i.timeout)!==null&&n!==void 0?n:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const c=await a.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(t,e={}){var i,n;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:r,payload:o}=t,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(i=e.timeout)!==null&&i!==void 0?i:this.timeout);return await((n=c.body)===null||n===void 0?void 0:n.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var o,a,l;const c=this._push(t.type,t,e.timeout||this.timeout);t.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&r("ok"),c.receive("ok",()=>r("ok")),c.receive("error",()=>r("error")),c.receive("timeout",()=>r("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Q.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Tt.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(n=>{i=new Hi(this,Tt.leave,{},t),i.receive("ok",()=>{e(),n("ok")}).receive("timeout",()=>{e(),n("timed out")}).receive("error",()=>{n("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Q.closed,this.bindings={}}async _fetchWithTimeout(t,e,i){const n=new AbortController,r=setTimeout(()=>n.abort(),i),o=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:n.signal}));return clearTimeout(r),o}_push(t,e,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Hi(this,t,e,i);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>Cg){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(t,e,i){return e}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,e,i){var n,r;const o=t.toLocaleLowerCase(),{close:a,error:l,leave:c,join:h}=Tt;if(i&&[a,l,c,h].indexOf(o)>=0&&i!==this._joinRef())return;let d=this._onMessage(o,e,i);if(e&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(f=>{var p,g,m;return((p=f.filter)===null||p===void 0?void 0:p.event)==="*"||((m=(g=f.filter)===null||g===void 0?void 0:g.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===o}).map(f=>f.callback(d,i)):(r=this.bindings[o])===null||r===void 0||r.filter(f=>{var p,g,m,b,y,_;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const v=f.id,x=(p=f.filter)===null||p===void 0?void 0:p.event;return v&&((g=e.ids)===null||g===void 0?void 0:g.includes(v))&&(x==="*"||x?.toLocaleLowerCase()===((m=e.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{const v=(y=(b=f?.filter)===null||b===void 0?void 0:b.event)===null||y===void 0?void 0:y.toLocaleLowerCase();return v==="*"||v===((_=e?.event)===null||_===void 0?void 0:_.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof d=="object"&&"ids"in d){const p=d.data,{schema:g,table:m,commit_timestamp:b,type:y,errors:_}=p;d=Object.assign(Object.assign({},{schema:g,table:m,commit_timestamp:b,eventType:y,new:{},old:{},errors:_}),this._getPayloadRecords(p))}f.callback(d,i)})}_isClosed(){return this.state===Q.closed}_isJoined(){return this.state===Q.joined}_isJoining(){return this.state===Q.joining}_isLeaving(){return this.state===Q.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,e,i){const n=t.toLocaleLowerCase(),r={type:n,filter:e,callback:i};return this.bindings[n]?this.bindings[n].push(r):this.bindings[n]=[r],this}_off(t,e){const i=t.toLocaleLowerCase();return this.bindings[i]&&(this.bindings[i]=this.bindings[i].filter(n=>{var r;return!(((r=n.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===i&&Ue.isEqual(n.filter,e))})),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(t[i]!==e[i])return!1;return!0}static isFilterValueEqual(t,e){return(t??void 0)===(e??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Tt.close,{},t)}_onError(t){this._on(Tt.error,{},e=>t(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Q.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const e={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(e.new=Po(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(e.old=Po(t.columns,t.old_record)),e}}const qi=()=>{},Ks={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},$g=[1e3,2e3,5e3,1e4],Ng=1e4,Bg=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Fg{constructor(t,e){var i;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=mn,this.transport=null,this.heartbeatIntervalMs=Ks.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=qi,this.ref=0,this.reconnectTimer=null,this.vsn=Co,this.logger=qi,this.conn=null,this.sendBuffer=[],this.serializer=new Pg,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=n=>n?(...r)=>n(...r):(...r)=>fetch(...r),!(!((i=e?.params)===null||i===void 0)&&i.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=e.params.apikey,this.endPoint=`${t}/${bn.websocket}`,this.httpEndpoint=rl(t),this._initializeOptions(e),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(e?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=kg.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const e=t.message;throw e.includes("Node.js")?new Error(`${e}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${e}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,e){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const i=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(i),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,e??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return e==="ok"&&this._remove(t),this.channels.length===0&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,e,i){this.logger(t,e,i)}connectionState(){switch(this.conn&&this.conn.readyState){case Ht.connecting:return ye.Connecting;case Ht.open:return ye.Open;case Ht.closing:return ye.Closing;default:return ye.Closed}}isConnected(){return this.connectionState()===ye.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,e={config:{}}){const i=`realtime:${t}`,n=this.getChannels().find(r=>r.topic===i);if(n)return n;{const r=new Ue(`realtime:${t}`,e,this);return this.channels.push(r),r}}push(t){const{topic:e,event:i,payload:n,ref:r}=t,o=()=>{this.encode(t,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${e} ${i} (${r})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(Og,"heartbeat timeout"),setTimeout(()=>{var e;this.isConnected()||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout()},Ks.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let e=this.channels.find(i=>i.topic===t&&(i._isJoined()||i._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}_remove(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,e=>{if(e.topic==="phoenix"&&e.event==="phx_reply"&&e.ref&&e.ref===this.pendingHeartbeatRef){const c=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(e.payload.status==="ok"?"ok":"error",c)}catch(h){this.log("error","error in heartbeat callback",h)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:i,event:n,payload:r,ref:o}=e,a=o?`(${o})`:"",l=r.status||"";this.log("receive",`${l} ${i} ${n} ${a}`.trim(),r),this.channels.filter(c=>c._isMember(i)).forEach(c=>c._trigger(n,r,o)),this._triggerStateCallbacks("message",e)})}_clearTimer(t){var e;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((e=this.reconnectTimer)===null||e===void 0||e.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===Ht.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Ht.open||this.conn.readyState===Ht.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this._terminateWorker()},this.workerRef.onmessage=e=>{e.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var e;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t);try{this.heartbeatCallback("error")}catch(e){this.log("error","error in heartbeat callback",e)}}_triggerChanError(){this.channels.forEach(t=>t._trigger(Tt.error))}_appendParams(t,e){if(Object.keys(e).length===0)return t;const i=t.match(/\?/)?"&":"?",n=new URLSearchParams(e);return`${t}${i}${n}`}_workerObjectUrl(t){let e;if(t)e=t;else{const i=new Blob([Bg],{type:"application/javascript"});e=URL.createObjectURL(i)}return e}_setConnectionState(t,e=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=e)}async _performAuth(t=null){let e,i=!1;if(t)e=t,i=!0;else if(this.accessToken)try{e=await this.accessToken()}catch(n){this.log("error","Error fetching access token from callback",n),e=this.accessTokenValue}else e=this.accessTokenValue;i?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(n=>{const r={access_token:e,version:Tg};e&&n.updateJoinPayload(r),n.joinedOnce&&n._isJoined()&&n._push(Tt.access_token,{access_token:e})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(e=>{this.log("error",`Error setting auth in ${t}`,e)})}_triggerStateCallbacks(t,e){try{this.stateChangeCallbacks[t].forEach(i=>{try{i(e)}catch(n){this.log("error",`error in ${t} callback`,n)}})}catch(i){this.log("error",`error triggering ${t} callbacks`,i)}}_setupReconnectionTimer(){this.reconnectTimer=new il(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ks.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var e,i,n,r,o,a,l,c,h,u,d,f;switch(this.transport=(e=t?.transport)!==null&&e!==void 0?e:null,this.timeout=(i=t?.timeout)!==null&&i!==void 0?i:mn,this.heartbeatIntervalMs=(n=t?.heartbeatIntervalMs)!==null&&n!==void 0?n:Ks.HEARTBEAT_INTERVAL,this.worker=(r=t?.worker)!==null&&r!==void 0?r:!1,this.accessToken=(o=t?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=t?.heartbeatCallback)!==null&&a!==void 0?a:qi,this.vsn=(l=t?.vsn)!==null&&l!==void 0?l:Co,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=t?.reconnectAfterMs)!==null&&c!==void 0?c:(p=>$g[p-1]||Ng),this.vsn){case Ag:this.encode=(h=t?.encode)!==null&&h!==void 0?h:((p,g)=>g(JSON.stringify(p))),this.decode=(u=t?.decode)!==null&&u!==void 0?u:((p,g)=>g(JSON.parse(p)));break;case sl:this.encode=(d=t?.encode)!==null&&d!==void 0?d:this.serializer.encode.bind(this.serializer),this.decode=(f=t?.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}var Ss=class extends Error{constructor(s,t){super(s),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Ug(s,t,e){const i=new URL(t,s);if(e)for(const[n,r]of Object.entries(e))r!==void 0&&i.searchParams.set(n,r);return i.toString()}async function Wg(s){return!s||s.type==="none"?{}:s.type==="bearer"?{Authorization:`Bearer ${s.token}`}:s.type==="header"?{[s.name]:s.value}:s.type==="custom"?await s.getHeaders():{}}function zg(s){const t=s.fetchImpl??globalThis.fetch;return{async request({method:e,path:i,query:n,body:r,headers:o}){const a=Ug(s.baseUrl,i,n),l=await Wg(s.auth),c=await t(a,{method:e,headers:{...r?{"Content-Type":"application/json"}:{},...l,...o},body:r?JSON.stringify(r):void 0}),h=await c.text(),u=(c.headers.get("content-type")||"").includes("application/json"),d=u&&h?JSON.parse(h):h;if(!c.ok){const f=u?d:void 0,p=f?.error;throw new Ss(p?.message??`Request failed with status ${c.status}`,{status:c.status,icebergType:p?.type,icebergCode:p?.code,details:f})}return{status:c.status,headers:c.headers,data:d}}}}function Gs(s){return s.join("")}var Vg=class{constructor(s,t=""){this.client=s,this.prefix=t}async listNamespaces(s){const t=s?{parent:Gs(s.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(i=>({namespace:i}))}async createNamespace(s,t){const e={namespace:s.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:e})).data}async dropNamespace(s){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Gs(s.namespace)}`})}async loadNamespaceMetadata(s){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Gs(s.namespace)}`})).data.properties}}async namespaceExists(s){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Gs(s.namespace)}`}),!0}catch(t){if(t instanceof Ss&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(s,t){try{return await this.createNamespace(s,t)}catch(e){if(e instanceof Ss&&e.status===409)return;throw e}}};function Re(s){return s.join("")}var Hg=class{constructor(s,t="",e){this.client=s,this.prefix=t,this.accessDelegation=e}async listTables(s){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Re(s.namespace)}/tables`})).data.identifiers}async createTable(s,t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Re(s.namespace)}/tables`,body:t,headers:e})).data.metadata}async updateTable(s,t){const e=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Re(s.namespace)}/tables/${s.name}`,body:t});return{"metadata-location":e.data["metadata-location"],metadata:e.data.metadata}}async dropTable(s,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Re(s.namespace)}/tables/${s.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(s){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Re(s.namespace)}/tables/${s.name}`,headers:t})).data.metadata}async tableExists(s){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Re(s.namespace)}/tables/${s.name}`,headers:t}),!0}catch(e){if(e instanceof Ss&&e.status===404)return!1;throw e}}async createTableIfNotExists(s,t){try{return await this.createTable(s,t)}catch(e){if(e instanceof Ss&&e.status===409)return await this.loadTable({namespace:s.namespace,name:t.name});throw e}}},qg=class{constructor(s){let t="v1";s.catalogName&&(t+=`/${s.catalogName}`);const e=s.baseUrl.endsWith("/")?s.baseUrl:`${s.baseUrl}/`;this.client=zg({baseUrl:e,auth:s.auth,fetchImpl:s.fetch}),this.accessDelegation=s.accessDelegation?.join(","),this.namespaceOps=new Vg(this.client,t),this.tableOps=new Hg(this.client,t,this.accessDelegation)}async listNamespaces(s){return this.namespaceOps.listNamespaces(s)}async createNamespace(s,t){return this.namespaceOps.createNamespace(s,t)}async dropNamespace(s){await this.namespaceOps.dropNamespace(s)}async loadNamespaceMetadata(s){return this.namespaceOps.loadNamespaceMetadata(s)}async listTables(s){return this.tableOps.listTables(s)}async createTable(s,t){return this.tableOps.createTable(s,t)}async updateTable(s,t){return this.tableOps.updateTable(s,t)}async dropTable(s,t){await this.tableOps.dropTable(s,t)}async loadTable(s){return this.tableOps.loadTable(s)}async namespaceExists(s){return this.namespaceOps.namespaceExists(s)}async tableExists(s){return this.tableOps.tableExists(s)}async createNamespaceIfNotExists(s,t){return this.namespaceOps.createNamespaceIfNotExists(s,t)}async createTableIfNotExists(s,t){return this.tableOps.createTableIfNotExists(s,t)}},Ai=class extends Error{constructor(s,t="storage",e,i){super(s),this.__isStorageError=!0,this.namespace=t,this.name=t==="vectors"?"StorageVectorsError":"StorageError",this.status=e,this.statusCode=i}};function Oi(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}var Js=class extends Ai{constructor(s,t,e,i="storage"){super(s,i,t,e),this.name=i==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=t,this.statusCode=e}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},ol=class extends Ai{constructor(s,t,e="storage"){super(s,e),this.name=e==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=t}};const Kg=s=>s?(...t)=>s(...t):(...t)=>fetch(...t),Gg=s=>{if(typeof s!="object"||s===null)return!1;const t=Object.getPrototypeOf(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},_n=s=>{if(Array.isArray(s))return s.map(e=>_n(e));if(typeof s=="function"||s!==Object(s))return s;const t={};return Object.entries(s).forEach(([e,i])=>{const n=e.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace(/[-_]/g,""));t[n]=_n(i)}),t},Jg=s=>!s||typeof s!="string"||s.length===0||s.length>100||s.trim()!==s||s.includes("/")||s.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(s);function ks(s){"@babel/helpers - typeof";return ks=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ks(s)}function Yg(s,t){if(ks(s)!="object"||!s)return s;var e=s[Symbol.toPrimitive];if(e!==void 0){var i=e.call(s,t);if(ks(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Xg(s){var t=Yg(s,"string");return ks(t)=="symbol"?t:t+""}function Zg(s,t,e){return(t=Xg(t))in s?Object.defineProperty(s,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[t]=e,s}function Lo(s,t){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),e.push.apply(e,i)}return e}function C(s){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Lo(Object(e),!0).forEach(function(i){Zg(s,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):Lo(Object(e)).forEach(function(i){Object.defineProperty(s,i,Object.getOwnPropertyDescriptor(e,i))})}return s}const Do=s=>{var t;return s.msg||s.message||s.error_description||(typeof s.error=="string"?s.error:(t=s.error)===null||t===void 0?void 0:t.message)||JSON.stringify(s)},Qg=async(s,t,e,i)=>{if(s&&typeof s=="object"&&"status"in s&&"ok"in s&&typeof s.status=="number"&&!e?.noResolveJson){const n=s,r=n.status||500;if(typeof n.json=="function")n.json().then(o=>{const a=o?.statusCode||o?.code||r+"";t(new Js(Do(o),r,a,i))}).catch(()=>{if(i==="vectors"){const o=r+"";t(new Js(n.statusText||`HTTP ${r} error`,r,o,i))}else{const o=r+"";t(new Js(n.statusText||`HTTP ${r} error`,r,o,i))}});else{const o=r+"";t(new Js(n.statusText||`HTTP ${r} error`,r,o,i))}}else t(new ol(Do(s),s,i))},tp=(s,t,e,i)=>{const n={method:s,headers:t?.headers||{}};return s==="GET"||s==="HEAD"||!i?C(C({},n),e):(Gg(i)?(n.headers=C({"Content-Type":"application/json"},t?.headers),n.body=JSON.stringify(i)):n.body=i,t?.duplex&&(n.duplex=t.duplex),C(C({},n),e))};async function es(s,t,e,i,n,r,o){return new Promise((a,l)=>{s(e,tp(t,i,n,r)).then(c=>{if(!c.ok)throw c;if(i?.noResolveJson)return c;if(o==="vectors"){const h=c.headers.get("content-type");if(c.headers.get("content-length")==="0"||c.status===204)return{};if(!h||!h.includes("application/json"))return{}}return c.json()}).then(c=>a(c)).catch(c=>Qg(c,l,i,o))})}function al(s="storage"){return{get:async(t,e,i,n)=>es(t,"GET",e,i,n,void 0,s),post:async(t,e,i,n,r)=>es(t,"POST",e,n,r,i,s),put:async(t,e,i,n,r)=>es(t,"PUT",e,n,r,i,s),head:async(t,e,i,n)=>es(t,"HEAD",e,C(C({},i),{},{noResolveJson:!0}),n,void 0,s),remove:async(t,e,i,n,r)=>es(t,"DELETE",e,n,r,i,s)}}const ep=al("storage"),{get:Es,post:Et,put:vn,head:sp,remove:qn}=ep,_t=al("vectors");var Ke=class{constructor(s,t={},e,i="storage"){this.shouldThrowOnError=!1,this.url=s,this.headers=t,this.fetch=Kg(e),this.namespace=i}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(s){var t=this;try{return{data:await s(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Oi(e))return{data:null,error:e};throw e}}},ip=class{constructor(s,t){this.downloadFn=s,this.shouldThrowOnError=t}then(s,t){return this.execute().then(s,t)}async execute(){var s=this;try{return{data:(await s.downloadFn()).body,error:null}}catch(t){if(s.shouldThrowOnError)throw t;if(Oi(t))return{data:null,error:t};throw t}}};let ll;ll=Symbol.toStringTag;var np=class{constructor(s,t){this.downloadFn=s,this.shouldThrowOnError=t,this[ll]="BlobDownloadBuilder",this.promise=null}asStream(){return new ip(this.downloadFn,this.shouldThrowOnError)}then(s,t){return this.getPromise().then(s,t)}catch(s){return this.getPromise().catch(s)}finally(s){return this.getPromise().finally(s)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var s=this;try{return{data:await(await s.downloadFn()).blob(),error:null}}catch(t){if(s.shouldThrowOnError)throw t;if(Oi(t))return{data:null,error:t};throw t}}};const rp={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Io={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var op=class extends Ke{constructor(s,t={},e,i){super(s,t,i,"storage"),this.bucketId=e}async uploadOrUpdate(s,t,e,i){var n=this;return n.handleOperation(async()=>{let r;const o=C(C({},Io),i);let a=C(C({},n.headers),s==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&e instanceof Blob?(r=new FormData,r.append("cacheControl",o.cacheControl),l&&r.append("metadata",n.encodeMetadata(l)),r.append("",e)):typeof FormData<"u"&&e instanceof FormData?(r=e,r.has("cacheControl")||r.append("cacheControl",o.cacheControl),l&&!r.has("metadata")&&r.append("metadata",n.encodeMetadata(l))):(r=e,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=n.toBase64(n.encodeMetadata(l))),(typeof ReadableStream<"u"&&r instanceof ReadableStream||r&&typeof r=="object"&&"pipe"in r&&typeof r.pipe=="function")&&!o.duplex&&(o.duplex="half")),i?.headers&&(a=C(C({},a),i.headers));const c=n._removeEmptyFolders(t),h=n._getFinalPath(c),u=await(s=="PUT"?vn:Et)(n.fetch,`${n.url}/object/${h}`,r,C({headers:a},o?.duplex?{duplex:o.duplex}:{}));return{path:c,id:u.Id,fullPath:u.Key}})}async upload(s,t,e){return this.uploadOrUpdate("POST",s,t,e)}async uploadToSignedUrl(s,t,e,i){var n=this;const r=n._removeEmptyFolders(s),o=n._getFinalPath(r),a=new URL(n.url+`/object/upload/sign/${o}`);return a.searchParams.set("token",t),n.handleOperation(async()=>{let l;const c=C({upsert:Io.upsert},i),h=C(C({},n.headers),{"x-upsert":String(c.upsert)});return typeof Blob<"u"&&e instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",e)):typeof FormData<"u"&&e instanceof FormData?(l=e,l.append("cacheControl",c.cacheControl)):(l=e,h["cache-control"]=`max-age=${c.cacheControl}`,h["content-type"]=c.contentType),{path:r,fullPath:(await vn(n.fetch,a.toString(),l,{headers:h})).Key}})}async createSignedUploadUrl(s,t){var e=this;return e.handleOperation(async()=>{let i=e._getFinalPath(s);const n=C({},e.headers);t?.upsert&&(n["x-upsert"]="true");const r=await Et(e.fetch,`${e.url}/object/upload/sign/${i}`,{},{headers:n}),o=new URL(e.url+r.url),a=o.searchParams.get("token");if(!a)throw new Ai("No token returned by API");return{signedUrl:o.toString(),path:s,token:a}})}async update(s,t,e){return this.uploadOrUpdate("PUT",s,t,e)}async move(s,t,e){var i=this;return i.handleOperation(async()=>await Et(i.fetch,`${i.url}/object/move`,{bucketId:i.bucketId,sourceKey:s,destinationKey:t,destinationBucket:e?.destinationBucket},{headers:i.headers}))}async copy(s,t,e){var i=this;return i.handleOperation(async()=>({path:(await Et(i.fetch,`${i.url}/object/copy`,{bucketId:i.bucketId,sourceKey:s,destinationKey:t,destinationBucket:e?.destinationBucket},{headers:i.headers})).Key}))}async createSignedUrl(s,t,e){var i=this;return i.handleOperation(async()=>{let n=i._getFinalPath(s),r=await Et(i.fetch,`${i.url}/object/sign/${n}`,C({expiresIn:t},e?.transform?{transform:e.transform}:{}),{headers:i.headers});const o=e?.download?`&download=${e.download===!0?"":e.download}`:"";return{signedUrl:encodeURI(`${i.url}${r.signedURL}${o}`)}})}async createSignedUrls(s,t,e){var i=this;return i.handleOperation(async()=>{const n=await Et(i.fetch,`${i.url}/object/sign/${i.bucketId}`,{expiresIn:t,paths:s},{headers:i.headers}),r=e?.download?`&download=${e.download===!0?"":e.download}`:"";return n.map(o=>C(C({},o),{},{signedUrl:o.signedURL?encodeURI(`${i.url}${o.signedURL}${r}`):null}))})}download(s,t,e){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString(t?.transform||{}),r=n?`?${n}`:"",o=this._getFinalPath(s),a=()=>Es(this.fetch,`${this.url}/${i}/${o}${r}`,{headers:this.headers,noResolveJson:!0},e);return new np(a,this.shouldThrowOnError)}async info(s){var t=this;const e=t._getFinalPath(s);return t.handleOperation(async()=>_n(await Es(t.fetch,`${t.url}/object/info/${e}`,{headers:t.headers})))}async exists(s){var t=this;const e=t._getFinalPath(s);try{return await sp(t.fetch,`${t.url}/object/${e}`,{headers:t.headers}),{data:!0,error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Oi(i)&&i instanceof ol){const n=i.originalError;if([400,404].includes(n?.status))return{data:!1,error:i}}throw i}}getPublicUrl(s,t){const e=this._getFinalPath(s),i=[],n=t?.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&i.push(n);const r=typeof t?.transform<"u"?"render/image":"object",o=this.transformOptsToQueryString(t?.transform||{});o!==""&&i.push(o);let a=i.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${r}/public/${e}${a}`)}}}async remove(s){var t=this;return t.handleOperation(async()=>await qn(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:s},{headers:t.headers}))}async list(s,t,e){var i=this;return i.handleOperation(async()=>{const n=C(C(C({},rp),t),{},{prefix:s||""});return await Et(i.fetch,`${i.url}/object/list/${i.bucketId}`,n,{headers:i.headers},e)})}async listV2(s,t){var e=this;return e.handleOperation(async()=>{const i=C({},s);return await Et(e.fetch,`${e.url}/object/list-v2/${e.bucketId}`,i,{headers:e.headers},t)})}encodeMetadata(s){return JSON.stringify(s)}toBase64(s){return typeof Buffer<"u"?Buffer.from(s).toString("base64"):btoa(s)}_getFinalPath(s){return`${this.bucketId}/${s.replace(/^\/+/,"")}`}_removeEmptyFolders(s){return s.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(s){const t=[];return s.width&&t.push(`width=${s.width}`),s.height&&t.push(`height=${s.height}`),s.resize&&t.push(`resize=${s.resize}`),s.format&&t.push(`format=${s.format}`),s.quality&&t.push(`quality=${s.quality}`),t.join("&")}};const ap="2.95.3",Rs={"X-Client-Info":`storage-js/${ap}`};var lp=class extends Ke{constructor(s,t={},e,i){const n=new URL(s);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase."));const r=n.href.replace(/\/$/,""),o=C(C({},Rs),t);super(r,o,e,"storage")}async listBuckets(s){var t=this;return t.handleOperation(async()=>{const e=t.listBucketOptionsToQueryString(s);return await Es(t.fetch,`${t.url}/bucket${e}`,{headers:t.headers})})}async getBucket(s){var t=this;return t.handleOperation(async()=>await Es(t.fetch,`${t.url}/bucket/${s}`,{headers:t.headers}))}async createBucket(s,t={public:!1}){var e=this;return e.handleOperation(async()=>await Et(e.fetch,`${e.url}/bucket`,{id:s,name:s,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:e.headers}))}async updateBucket(s,t){var e=this;return e.handleOperation(async()=>await vn(e.fetch,`${e.url}/bucket/${s}`,{id:s,name:s,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:e.headers}))}async emptyBucket(s){var t=this;return t.handleOperation(async()=>await Et(t.fetch,`${t.url}/bucket/${s}/empty`,{},{headers:t.headers}))}async deleteBucket(s){var t=this;return t.handleOperation(async()=>await qn(t.fetch,`${t.url}/bucket/${s}`,{},{headers:t.headers}))}listBucketOptionsToQueryString(s){const t={};return s&&("limit"in s&&(t.limit=String(s.limit)),"offset"in s&&(t.offset=String(s.offset)),s.search&&(t.search=s.search),s.sortColumn&&(t.sortColumn=s.sortColumn),s.sortOrder&&(t.sortOrder=s.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},cp=class extends Ke{constructor(s,t={},e){const i=s.replace(/\/$/,""),n=C(C({},Rs),t);super(i,n,e,"storage")}async createBucket(s){var t=this;return t.handleOperation(async()=>await Et(t.fetch,`${t.url}/bucket`,{name:s},{headers:t.headers}))}async listBuckets(s){var t=this;return t.handleOperation(async()=>{const e=new URLSearchParams;s?.limit!==void 0&&e.set("limit",s.limit.toString()),s?.offset!==void 0&&e.set("offset",s.offset.toString()),s?.sortColumn&&e.set("sortColumn",s.sortColumn),s?.sortOrder&&e.set("sortOrder",s.sortOrder),s?.search&&e.set("search",s.search);const i=e.toString(),n=i?`${t.url}/bucket?${i}`:`${t.url}/bucket`;return await Es(t.fetch,n,{headers:t.headers})})}async deleteBucket(s){var t=this;return t.handleOperation(async()=>await qn(t.fetch,`${t.url}/bucket/${s}`,{},{headers:t.headers}))}from(s){var t=this;if(!Jg(s))throw new Ai("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const e=new qg({baseUrl:this.url,catalogName:s,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),i=this.shouldThrowOnError;return new Proxy(e,{get(n,r){const o=n[r];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(n,a),error:null}}catch(l){if(i)throw l;return{data:null,error:l}}}}})}},hp=class extends Ke{constructor(s,t={},e){const i=s.replace(/\/$/,""),n=C(C({},Rs),{},{"Content-Type":"application/json"},t);super(i,n,e,"vectors")}async createIndex(s){var t=this;return t.handleOperation(async()=>await _t.post(t.fetch,`${t.url}/CreateIndex`,s,{headers:t.headers})||{})}async getIndex(s,t){var e=this;return e.handleOperation(async()=>await _t.post(e.fetch,`${e.url}/GetIndex`,{vectorBucketName:s,indexName:t},{headers:e.headers}))}async listIndexes(s){var t=this;return t.handleOperation(async()=>await _t.post(t.fetch,`${t.url}/ListIndexes`,s,{headers:t.headers}))}async deleteIndex(s,t){var e=this;return e.handleOperation(async()=>await _t.post(e.fetch,`${e.url}/DeleteIndex`,{vectorBucketName:s,indexName:t},{headers:e.headers})||{})}},up=class extends Ke{constructor(s,t={},e){const i=s.replace(/\/$/,""),n=C(C({},Rs),{},{"Content-Type":"application/json"},t);super(i,n,e,"vectors")}async putVectors(s){var t=this;if(s.vectors.length<1||s.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return t.handleOperation(async()=>await _t.post(t.fetch,`${t.url}/PutVectors`,s,{headers:t.headers})||{})}async getVectors(s){var t=this;return t.handleOperation(async()=>await _t.post(t.fetch,`${t.url}/GetVectors`,s,{headers:t.headers}))}async listVectors(s){var t=this;if(s.segmentCount!==void 0){if(s.segmentCount<1||s.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(s.segmentIndex!==void 0&&(s.segmentIndex<0||s.segmentIndex>=s.segmentCount))throw new Error(`segmentIndex must be between 0 and ${s.segmentCount-1}`)}return t.handleOperation(async()=>await _t.post(t.fetch,`${t.url}/ListVectors`,s,{headers:t.headers}))}async queryVectors(s){var t=this;return t.handleOperation(async()=>await _t.post(t.fetch,`${t.url}/QueryVectors`,s,{headers:t.headers}))}async deleteVectors(s){var t=this;if(s.keys.length<1||s.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return t.handleOperation(async()=>await _t.post(t.fetch,`${t.url}/DeleteVectors`,s,{headers:t.headers})||{})}},dp=class extends Ke{constructor(s,t={},e){const i=s.replace(/\/$/,""),n=C(C({},Rs),{},{"Content-Type":"application/json"},t);super(i,n,e,"vectors")}async createBucket(s){var t=this;return t.handleOperation(async()=>await _t.post(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:s},{headers:t.headers})||{})}async getBucket(s){var t=this;return t.handleOperation(async()=>await _t.post(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:s},{headers:t.headers}))}async listBuckets(s={}){var t=this;return t.handleOperation(async()=>await _t.post(t.fetch,`${t.url}/ListVectorBuckets`,s,{headers:t.headers}))}async deleteBucket(s){var t=this;return t.handleOperation(async()=>await _t.post(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:s},{headers:t.headers})||{})}},fp=class extends dp{constructor(s,t={}){super(s,t.headers||{},t.fetch)}from(s){return new gp(this.url,this.headers,s,this.fetch)}async createBucket(s){var t=()=>super.createBucket,e=this;return t().call(e,s)}async getBucket(s){var t=()=>super.getBucket,e=this;return t().call(e,s)}async listBuckets(s={}){var t=()=>super.listBuckets,e=this;return t().call(e,s)}async deleteBucket(s){var t=()=>super.deleteBucket,e=this;return t().call(e,s)}},gp=class extends hp{constructor(s,t,e,i){super(s,t,i),this.vectorBucketName=e}async createIndex(s){var t=()=>super.createIndex,e=this;return t().call(e,C(C({},s),{},{vectorBucketName:e.vectorBucketName}))}async listIndexes(s={}){var t=()=>super.listIndexes,e=this;return t().call(e,C(C({},s),{},{vectorBucketName:e.vectorBucketName}))}async getIndex(s){var t=()=>super.getIndex,e=this;return t().call(e,e.vectorBucketName,s)}async deleteIndex(s){var t=()=>super.deleteIndex,e=this;return t().call(e,e.vectorBucketName,s)}index(s){return new pp(this.url,this.headers,this.vectorBucketName,s,this.fetch)}},pp=class extends up{constructor(s,t,e,i,n){super(s,t,n),this.vectorBucketName=e,this.indexName=i}async putVectors(s){var t=()=>super.putVectors,e=this;return t().call(e,C(C({},s),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async getVectors(s){var t=()=>super.getVectors,e=this;return t().call(e,C(C({},s),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async listVectors(s={}){var t=()=>super.listVectors,e=this;return t().call(e,C(C({},s),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async queryVectors(s){var t=()=>super.queryVectors,e=this;return t().call(e,C(C({},s),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async deleteVectors(s){var t=()=>super.deleteVectors,e=this;return t().call(e,C(C({},s),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}},mp=class extends lp{constructor(s,t={},e,i){super(s,t,e,i)}from(s){return new op(this.url,this.headers,s,this.fetch)}get vectors(){return new fp(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new cp(this.url+"/iceberg",this.headers,this.fetch)}};const cl="2.95.3",Ne=30*1e3,wn=3,Ki=wn*Ne,bp="http://localhost:9999",yp="supabase.auth.token",_p={"X-Client-Info":`gotrue-js/${cl}`},xn="X-Supabase-Api-Version",hl={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},vp=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,wp=600*1e3;class Ts extends Error{constructor(t,e,i){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=i}}function A(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class xp extends Ts{constructor(t,e,i){super(t,e,i),this.name="AuthApiError",this.status=e,this.code=i}}function Sp(s){return A(s)&&s.name==="AuthApiError"}class _e extends Ts{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class Vt extends Ts{constructor(t,e,i,n){super(t,i,n),this.name=e,this.status=i}}class bt extends Vt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Gi(s){return A(s)&&s.name==="AuthSessionMissingError"}class Me extends Vt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ys extends Vt{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Xs extends Vt{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function kp(s){return A(s)&&s.name==="AuthImplicitGrantRedirectError"}class jo extends Vt{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ep extends Vt{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Sn extends Vt{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}}function Ji(s){return A(s)&&s.name==="AuthRetryableFetchError"}class $o extends Vt{constructor(t,e,i){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=i}}class kn extends Vt{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const di="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),No=` 	
\r=`.split(""),Tp=(()=>{const s=new Array(128);for(let t=0;t<s.length;t+=1)s[t]=-1;for(let t=0;t<No.length;t+=1)s[No[t].charCodeAt(0)]=-2;for(let t=0;t<di.length;t+=1)s[di[t].charCodeAt(0)]=t;return s})();function Bo(s,t,e){if(s!==null)for(t.queue=t.queue<<8|s,t.queuedBits+=8;t.queuedBits>=6;){const i=t.queue>>t.queuedBits-6&63;e(di[i]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const i=t.queue>>t.queuedBits-6&63;e(di[i]),t.queuedBits-=6}}function ul(s,t,e){const i=Tp[s];if(i>-1)for(t.queue=t.queue<<6|i,t.queuedBits+=6;t.queuedBits>=8;)e(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(i===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function Fo(s){const t=[],e=o=>{t.push(String.fromCodePoint(o))},i={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},r=o=>{Cp(o,i,e)};for(let o=0;o<s.length;o+=1)ul(s.charCodeAt(o),n,r);return t.join("")}function Ap(s,t){if(s<=127){t(s);return}else if(s<=2047){t(192|s>>6),t(128|s&63);return}else if(s<=65535){t(224|s>>12),t(128|s>>6&63),t(128|s&63);return}else if(s<=1114111){t(240|s>>18),t(128|s>>12&63),t(128|s>>6&63),t(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function Op(s,t){for(let e=0;e<s.length;e+=1){let i=s.charCodeAt(e);if(i>55295&&i<=56319){const n=(i-55296)*1024&65535;i=(s.charCodeAt(e+1)-56320&65535|n)+65536,e+=1}Ap(i,t)}}function Cp(s,t,e){if(t.utf8seq===0){if(s<=127){e(s);return}for(let i=1;i<6;i+=1)if((s>>7-i&1)===0){t.utf8seq=i;break}if(t.utf8seq===2)t.codepoint=s&31;else if(t.utf8seq===3)t.codepoint=s&15;else if(t.utf8seq===4)t.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|s&63,t.utf8seq-=1,t.utf8seq===0&&e(t.codepoint)}}function ze(s){const t=[],e={queue:0,queuedBits:0},i=n=>{t.push(n)};for(let n=0;n<s.length;n+=1)ul(s.charCodeAt(n),e,i);return new Uint8Array(t)}function Pp(s){const t=[];return Op(s,e=>t.push(e)),new Uint8Array(t)}function we(s){const t=[],e={queue:0,queuedBits:0},i=n=>{t.push(n)};return s.forEach(n=>Bo(n,e,i)),Bo(null,e,i),t.join("")}function Rp(s){return Math.round(Date.now()/1e3)+s}function Mp(){return Symbol("auth-callback")}const rt=()=>typeof window<"u"&&typeof document<"u",de={tested:!1,writable:!1},dl=()=>{if(!rt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(de.tested)return de.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),de.tested=!0,de.writable=!0}catch{de.tested=!0,de.writable=!1}return de.writable};function Lp(s){const t={},e=new URL(s);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((n,r)=>{t[r]=n})}catch{}return e.searchParams.forEach((i,n)=>{t[n]=i}),t}const fl=s=>s?(...t)=>s(...t):(...t)=>fetch(...t),Dp=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",Be=async(s,t,e)=>{await s.setItem(t,JSON.stringify(e))},fe=async(s,t)=>{const e=await s.getItem(t);if(!e)return null;try{return JSON.parse(e)}catch{return e}},nt=async(s,t)=>{await s.removeItem(t)};class Ci{constructor(){this.promise=new Ci.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}}Ci.promiseConstructor=Promise;function Zs(s){const t=s.split(".");if(t.length!==3)throw new kn("Invalid JWT structure");for(let i=0;i<t.length;i++)if(!vp.test(t[i]))throw new kn("JWT not in base64url format");return{header:JSON.parse(Fo(t[0])),payload:JSON.parse(Fo(t[1])),signature:ze(t[2]),raw:{header:t[0],payload:t[1]}}}async function Ip(s){return await new Promise(t=>{setTimeout(()=>t(null),s)})}function jp(s,t){return new Promise((i,n)=>{(async()=>{for(let r=0;r<1/0;r++)try{const o=await s(r);if(!t(r,null,o)){i(o);return}}catch(o){if(!t(r,o)){n(o);return}}})()})}function $p(s){return("0"+s.toString(16)).substr(-2)}function Np(){const t=new Uint32Array(56);if(typeof crypto>"u"){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=e.length;let n="";for(let r=0;r<56;r++)n+=e.charAt(Math.floor(Math.random()*i));return n}return crypto.getRandomValues(t),Array.from(t,$p).join("")}async function Bp(s){const e=new TextEncoder().encode(s),i=await crypto.subtle.digest("SHA-256",e),n=new Uint8Array(i);return Array.from(n).map(r=>String.fromCharCode(r)).join("")}async function Fp(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const e=await Bp(s);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Le(s,t,e=!1){const i=Np();let n=i;e&&(n+="/PASSWORD_RECOVERY"),await Be(s,`${t}-code-verifier`,n);const r=await Fp(i);return[r,i===r?"plain":"s256"]}const Up=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Wp(s){const t=s.headers.get(xn);if(!t||!t.match(Up))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function zp(s){if(!s)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(s<=t)throw new Error("JWT has expired")}function Vp(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Hp=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function De(s){if(!Hp.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Yi(){const s={};return new Proxy(s,{get:(t,e)=>{if(e==="__isUserNotAvailableProxy")return!0;if(typeof e=="symbol"){const i=e.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function qp(s,t){return new Proxy(s,{get:(e,i,n)=>{if(i==="__isInsecureUserWarningProxy")return!0;if(typeof i=="symbol"){const r=i.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)"||r==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(e,i,n)}return!t.value&&typeof i=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(e,i,n)}})}function Uo(s){return JSON.parse(JSON.stringify(s))}const be=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),Kp=[502,503,504];async function Wo(s){var t;if(!Dp(s))throw new Sn(be(s),0);if(Kp.includes(s.status))throw new Sn(be(s),s.status);let e;try{e=await s.json()}catch(r){throw new _e(be(r),r)}let i;const n=Wp(s);if(n&&n.getTime()>=hl["2024-01-01"].timestamp&&typeof e=="object"&&e&&typeof e.code=="string"?i=e.code:typeof e=="object"&&e&&typeof e.error_code=="string"&&(i=e.error_code),i){if(i==="weak_password")throw new $o(be(e),s.status,((t=e.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(i==="session_not_found")throw new bt}else if(typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((r,o)=>r&&typeof o=="string",!0))throw new $o(be(e),s.status,e.weak_password.reasons);throw new xp(be(e),s.status||500,i)}const Gp=(s,t,e,i)=>{const n={method:s,headers:t?.headers||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),n.body=JSON.stringify(i),Object.assign(Object.assign({},n),e))};async function O(s,t,e,i){var n;const r=Object.assign({},i?.headers);r[xn]||(r[xn]=hl["2024-01-01"].name),i?.jwt&&(r.Authorization=`Bearer ${i.jwt}`);const o=(n=i?.query)!==null&&n!==void 0?n:{};i?.redirectTo&&(o.redirect_to=i.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await Jp(s,t,e+a,{headers:r,noResolveJson:i?.noResolveJson},{},i?.body);return i?.xform?i?.xform(l):{data:Object.assign({},l),error:null}}async function Jp(s,t,e,i,n,r){const o=Gp(t,i,n,r);let a;try{a=await s(e,Object.assign({},o))}catch(l){throw console.error(l),new Sn(be(l),0)}if(a.ok||await Wo(a),i?.noResolveJson)return a;try{return await a.json()}catch(l){await Wo(l)}}function kt(s){var t;let e=null;Zp(s)&&(e=Object.assign({},s),s.expires_at||(e.expires_at=Rp(s.expires_in)));const i=(t=s.user)!==null&&t!==void 0?t:s;return{data:{session:e,user:i},error:null}}function zo(s){const t=kt(s);return!t.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((e,i)=>e&&typeof i=="string",!0)&&(t.data.weak_password=s.weak_password),t}function qt(s){var t;return{data:{user:(t=s.user)!==null&&t!==void 0?t:s},error:null}}function Yp(s){return{data:s,error:null}}function Xp(s){const{action_link:t,email_otp:e,hashed_token:i,redirect_to:n,verification_type:r}=s,o=Ti(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:t,email_otp:e,hashed_token:i,redirect_to:n,verification_type:r},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function Vo(s){return s}function Zp(s){return s.access_token&&s.refresh_token&&s.expires_in}const Xi=["global","local","others"];class Qp{constructor({url:t="",headers:e={},fetch:i}){this.url=t,this.headers=e,this.fetch=fl(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,e=Xi[0]){if(Xi.indexOf(e)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Xi.join(", ")}`);try{return await O(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(i){if(A(i))return{data:null,error:i};throw i}}async inviteUserByEmail(t,e={}){try{return await O(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:qt})}catch(i){if(A(i))return{data:{user:null},error:i};throw i}}async generateLink(t){try{const{options:e}=t,i=Ti(t,["options"]),n=Object.assign(Object.assign({},i),e);return"newEmail"in i&&(n.new_email=i?.newEmail,delete n.newEmail),await O(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Xp,redirectTo:e?.redirectTo})}catch(e){if(A(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(t){try{return await O(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:qt})}catch(e){if(A(e))return{data:{user:null},error:e};throw e}}async listUsers(t){var e,i,n,r,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},h=await O(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(e=t?.page)===null||e===void 0?void 0:e.toString())!==null&&i!==void 0?i:"",per_page:(r=(n=t?.perPage)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:""},xform:Vo});if(h.error)throw h.error;const u=await h.json(),d=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(p=>{const g=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(p.split(";")[1].split("=")[1]);c[`${m}Page`]=g}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(A(c))return{data:{users:[]},error:c};throw c}}async getUserById(t){De(t);try{return await O(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:qt})}catch(e){if(A(e))return{data:{user:null},error:e};throw e}}async updateUserById(t,e){De(t);try{return await O(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:qt})}catch(i){if(A(i))return{data:{user:null},error:i};throw i}}async deleteUser(t,e=!1){De(t);try{return await O(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:qt})}catch(i){if(A(i))return{data:{user:null},error:i};throw i}}async _listFactors(t){De(t.userId);try{const{data:e,error:i}=await O(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:e,error:i}}catch(e){if(A(e))return{data:null,error:e};throw e}}async _deleteFactor(t){De(t.userId),De(t.id);try{return{data:await O(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(A(e))return{data:null,error:e};throw e}}async _listOAuthClients(t){var e,i,n,r,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},h=await O(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(e=t?.page)===null||e===void 0?void 0:e.toString())!==null&&i!==void 0?i:"",per_page:(r=(n=t?.perPage)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:""},xform:Vo});if(h.error)throw h.error;const u=await h.json(),d=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(p=>{const g=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(p.split(";")[1].split("=")[1]);c[`${m}Page`]=g}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(A(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(t){try{return await O(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(A(e))return{data:null,error:e};throw e}}async _getOAuthClient(t){try{return await O(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(A(e))return{data:null,error:e};throw e}}async _updateOAuthClient(t,e){try{return await O(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:e,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(A(i))return{data:null,error:i};throw i}}async _deleteOAuthClient(t){try{return await O(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(A(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(t){try{return await O(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(A(e))return{data:null,error:e};throw e}}}function Ho(s={}){return{getItem:t=>s[t]||null,setItem:(t,e)=>{s[t]=e},removeItem:t=>{delete s[t]}}}const Ie={debug:!!(globalThis&&dl()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class gl extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class tm extends gl{}async function em(s,t,e){Ie.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,t);const i=new globalThis.AbortController;return t>0&&setTimeout(()=>{i.abort(),Ie.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async n=>{if(n){Ie.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,n.name);try{return await e()}finally{Ie.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,n.name)}}else{if(t===0)throw Ie.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new tm(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(Ie.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await e()}}))}function sm(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function pl(s){if(!/^0x[a-fA-F0-9]{40}$/.test(s))throw new Error(`@supabase/auth-js: Address "${s}" is invalid.`);return s.toLowerCase()}function im(s){return parseInt(s,16)}function nm(s){const t=new TextEncoder().encode(s);return"0x"+Array.from(t,i=>i.toString(16).padStart(2,"0")).join("")}function rm(s){var t;const{chainId:e,domain:i,expirationTime:n,issuedAt:r=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:h,uri:u,version:d}=s;{if(!Number.isInteger(e))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${e}`);if(!i)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(d!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(!((t=s.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${s.statement}`)}const f=pl(s.address),p=h?`${h}://${i}`:i,g=s.statement?`${s.statement}
`:"",m=`${p} wants you to sign in with your Ethereum account:
${f}

${g}`;let b=`URI: ${u}
Version: ${d}
Chain ID: ${e}${o?`
Nonce: ${o}`:""}
Issued At: ${r.toISOString()}`;if(n&&(b+=`
Expiration Time: ${n.toISOString()}`),a&&(b+=`
Not Before: ${a.toISOString()}`),l&&(b+=`
Request ID: ${l}`),c){let y=`
Resources:`;for(const _ of c){if(!_||typeof _!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${_}`);y+=`
- ${_}`}b+=y}return`${m}
${b}`}class Z extends Error{constructor({message:t,code:e,cause:i,name:n}){var r;super(t,{cause:i}),this.__isWebAuthnError=!0,this.name=(r=n??(i instanceof Error?i.name:void 0))!==null&&r!==void 0?r:"Unknown Error",this.code=e}}class fi extends Z{constructor(t,e){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e,message:t}),this.name="WebAuthnUnknownError",this.originalError=e}}function om({error:s,options:t}){var e,i,n;const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Z({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else if(s.name==="ConstraintError"){if(((e=r.authenticatorSelection)===null||e===void 0?void 0:e.requireResidentKey)===!0)return new Z({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:s});if(t.mediation==="conditional"&&((i=r.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new Z({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:s});if(((n=r.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Z({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:s})}else{if(s.name==="InvalidStateError")return new Z({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:s});if(s.name==="NotAllowedError")return new Z({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="NotSupportedError")return r.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new Z({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:s}):new Z({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:s});if(s.name==="SecurityError"){const o=window.location.hostname;if(ml(o)){if(r.rp.id!==o)return new Z({message:`The RP ID "${r.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new Z({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="TypeError"){if(r.user.id.byteLength<1||r.user.id.byteLength>64)return new Z({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:s})}else if(s.name==="UnknownError")return new Z({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new Z({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}function am({error:s,options:t}){const{publicKey:e}=t;if(!e)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Z({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else{if(s.name==="NotAllowedError")return new Z({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="SecurityError"){const i=window.location.hostname;if(ml(i)){if(e.rpId!==i)return new Z({message:`The RP ID "${e.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new Z({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="UnknownError")return new Z({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new Z({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}class lm{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const cm=new lm;function hm(s){if(!s)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(s);const{challenge:t,user:e,excludeCredentials:i}=s,n=Ti(s,["challenge","user","excludeCredentials"]),r=ze(t).buffer,o=Object.assign(Object.assign({},e),{id:ze(e.id).buffer}),a=Object.assign(Object.assign({},n),{challenge:r,user:o});if(i&&i.length>0){a.excludeCredentials=new Array(i.length);for(let l=0;l<i.length;l++){const c=i[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:ze(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function um(s){if(!s)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(s);const{challenge:t,allowCredentials:e}=s,i=Ti(s,["challenge","allowCredentials"]),n=ze(t).buffer,r=Object.assign(Object.assign({},i),{challenge:n});if(e&&e.length>0){r.allowCredentials=new Array(e.length);for(let o=0;o<e.length;o++){const a=e[o];r.allowCredentials[o]=Object.assign(Object.assign({},a),{id:ze(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return r}function dm(s){var t;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const e=s;return{id:s.id,rawId:s.id,response:{attestationObject:we(new Uint8Array(s.response.attestationObject)),clientDataJSON:we(new Uint8Array(s.response.clientDataJSON))},type:"public-key",clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function fm(s){var t;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const e=s,i=s.getClientExtensionResults(),n=s.response;return{id:s.id,rawId:s.id,response:{authenticatorData:we(new Uint8Array(n.authenticatorData)),clientDataJSON:we(new Uint8Array(n.clientDataJSON)),signature:we(new Uint8Array(n.signature)),userHandle:n.userHandle?we(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:i,authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function ml(s){return s==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(s)}function qo(){var s,t;return!!(rt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((s=navigator?.credentials)===null||s===void 0?void 0:s.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function gm(s){try{const t=await navigator.credentials.create(s);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new fi("Browser returned unexpected credential type",t)}:{data:null,error:new fi("Empty credential response",t)}}catch(t){return{data:null,error:om({error:t,options:s})}}}async function pm(s){try{const t=await navigator.credentials.get(s);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new fi("Browser returned unexpected credential type",t)}:{data:null,error:new fi("Empty credential response",t)}}catch(t){return{data:null,error:am({error:t,options:s})}}}const mm={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},bm={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function gi(...s){const t=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),e=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),i={};for(const n of s)if(n)for(const r in n){const o=n[r];if(o!==void 0)if(Array.isArray(o))i[r]=o;else if(e(o))i[r]=o;else if(t(o)){const a=i[r];t(a)?i[r]=gi(a,o):i[r]=gi(o)}else i[r]=o}return i}function ym(s,t){return gi(mm,s,t||{})}function _m(s,t){return gi(bm,s,t||{})}class vm{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:e,friendlyName:i,signal:n},r){var o;try{const{data:a,error:l}=await this.client.mfa.challenge({factorId:t,webauthn:e});if(!a)return{data:null,error:l};const c=n??cm.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:h}=a.webauthn.credential_options.publicKey;if(!h.name){const u=i;if(u)h.name=`${h.id}:${u}`;else{const f=(await this.client.getUser()).data.user,p=((o=f?.user_metadata)===null||o===void 0?void 0:o.name)||f?.email||f?.id||"User";h.name=`${h.id}:${p}`}}h.displayName||(h.displayName=h.name)}switch(a.webauthn.type){case"create":{const h=ym(a.webauthn.credential_options.publicKey,r?.create),{data:u,error:d}=await gm({publicKey:h,signal:c});return u?{data:{factorId:t,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:d}}case"request":{const h=_m(a.webauthn.credential_options.publicKey,r?.request),{data:u,error:d}=await pm(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:h,signal:c}));return u?{data:{factorId:t,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:d}}}}catch(a){return A(a)?{data:null,error:a}:{data:null,error:new _e("Unexpected error in challenge",a)}}}async _verify({challengeId:t,factorId:e,webauthn:i}){return this.client.mfa.verify({factorId:e,challengeId:t,webauthn:i})}async _authenticate({factorId:t,webauthn:{rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},r){if(!e)return{data:null,error:new Ts("rpId is required for WebAuthn authentication")};try{if(!qo())return{data:null,error:new _e("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:t,webauthn:{rpId:e,rpOrigins:i},signal:n},{request:r});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:t,challengeId:o.challengeId,webauthn:{type:l.type,rpId:e,rpOrigins:i,credential_response:l.credential_response}})}catch(o){return A(o)?{data:null,error:o}:{data:null,error:new _e("Unexpected error in authenticate",o)}}}async _register({friendlyName:t,webauthn:{rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},r){if(!e)return{data:null,error:new Ts("rpId is required for WebAuthn registration")};try{if(!qo())return{data:null,error:new _e("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:t});if(!o)return await this.client.mfa.listFactors().then(h=>{var u;return(u=h.data)===null||u===void 0?void 0:u.all.find(d=>d.factor_type==="webauthn"&&d.friendly_name===t&&d.status!=="unverified")}).then(h=>h?this.client.mfa.unenroll({factorId:h?.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:e,rpOrigins:i},signal:n},{create:r});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:e,rpOrigins:i,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(o){return A(o)?{data:null,error:o}:{data:null,error:new _e("Unexpected error in register",o)}}}}sm();const wm={url:bp,storageKey:yp,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:_p,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function Ko(s,t,e){return await e()}const je={};class As{get jwks(){var t,e;return(e=(t=je[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&e!==void 0?e:{keys:[]}}set jwks(t){je[this.storageKey]=Object.assign(Object.assign({},je[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,e;return(e=(t=je[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&e!==void 0?e:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){je[this.storageKey]=Object.assign(Object.assign({},je[this.storageKey]),{cachedAt:t})}constructor(t){var e,i,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const r=Object.assign(Object.assign({},wm),t);if(this.storageKey=r.storageKey,this.instanceID=(e=As.nextInstanceID[this.storageKey])!==null&&e!==void 0?e:0,As.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.instanceID>0&&rt()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=r.persistSession,this.autoRefreshToken=r.autoRefreshToken,this.admin=new Qp({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=fl(r.fetch),this.lock=r.lock||Ko,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,this.throwOnError=r.throwOnError,this.lockAcquireTimeout=r.lockAcquireTimeout,r.lock?this.lock=r.lock:this.persistSession&&rt()&&(!((i=globalThis?.navigator)===null||i===void 0)&&i.locks)?this.lock=em:this.lock=Ko,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new vm(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:dl()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Ho(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=Ho(this.memoryStorage)),rt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o);try{await this._notifyAllSubscribers(o.data.event,o.data.session,!1)}catch(a){this._debug("#broadcastChannel","error",a)}})}this.initialize().catch(o=>{this._debug("#initialize()","error",o)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${cl}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let e={},i="none";if(rt()&&(e=Lp(window.location.href),this._isImplicitGrantCallback(e)?i="implicit":await this._isPKCECallback(e)&&(i="pkce")),rt()&&this.detectSessionInUrl&&i!=="none"){const{data:n,error:r}=await this._getSessionFromURL(e,i);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),kp(r)){const l=(t=r.details)===null||t===void 0?void 0:t.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:r}}return{error:r}}const{session:o,redirectType:a}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return A(e)?this._returnResult({error:e}):this._returnResult({error:new _e("Unexpected error during initialization",e)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var e,i,n;try{const r=await O(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(i=(e=t?.options)===null||e===void 0?void 0:e.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:(n=t?.options)===null||n===void 0?void 0:n.captchaToken}},xform:kt}),{data:o,error:a}=r;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(r){if(A(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signUp(t){var e,i,n;try{let r;if("email"in t){const{email:h,password:u,options:d}=t;let f=null,p=null;this.flowType==="pkce"&&([f,p]=await Le(this.storage,this.storageKey)),r=await O(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d?.emailRedirectTo,body:{email:h,password:u,data:(e=d?.data)!==null&&e!==void 0?e:{},gotrue_meta_security:{captcha_token:d?.captchaToken},code_challenge:f,code_challenge_method:p},xform:kt})}else if("phone"in t){const{phone:h,password:u,options:d}=t;r=await O(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:u,data:(i=d?.data)!==null&&i!==void 0?i:{},channel:(n=d?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:kt})}else throw new Ys("You must provide either an email or phone number and a password");const{data:o,error:a}=r;if(a||!o)return await nt(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(r){if(await nt(this.storage,`${this.storageKey}-code-verifier`),A(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithPassword(t){try{let e;if("email"in t){const{email:r,password:o,options:a}=t;e=await O(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:zo})}else if("phone"in t){const{phone:r,password:o,options:a}=t;e=await O(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:zo})}else throw new Ys("You must provide either an email or phone number and a password");const{data:i,error:n}=e;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!i||!i.session||!i.user){const r=new Me;return this._returnResult({data:{user:null,session:null},error:r})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:n})}catch(e){if(A(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOAuth(t){var e,i,n,r;return await this._handleProviderSignIn(t.provider,{redirectTo:(e=t.options)===null||e===void 0?void 0:e.redirectTo,scopes:(i=t.options)===null||i===void 0?void 0:i.scopes,queryParams:(n=t.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(r=t.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:e}=t;switch(e){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${e}"`)}}async signInWithEthereum(t){var e,i,n,r,o,a,l,c,h,u,d;let f,p;if("message"in t)f=t.message,p=t.signature;else{const{chain:g,wallet:m,statement:b,options:y}=t;let _;if(rt())if(typeof m=="object")_=m;else{const T=window;if("ethereum"in T&&typeof T.ethereum=="object"&&"request"in T.ethereum&&typeof T.ethereum.request=="function")_=T.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!y?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");_=m}const v=new URL((e=y?.url)!==null&&e!==void 0?e:window.location.href),x=await _.request({method:"eth_requestAccounts"}).then(T=>T).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!x||x.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const S=pl(x[0]);let k=(i=y?.signInWithEthereum)===null||i===void 0?void 0:i.chainId;if(!k){const T=await _.request({method:"eth_chainId"});k=im(T)}const E={domain:v.host,address:S,statement:b,uri:v.href,version:"1",chainId:k,nonce:(n=y?.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(o=(r=y?.signInWithEthereum)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=y?.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=y?.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=y?.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(h=y?.signInWithEthereum)===null||h===void 0?void 0:h.resources};f=rm(E),p=await _.request({method:"personal_sign",params:[nm(f),S]})}try{const{data:g,error:m}=await O(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:p},!((u=t.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:(d=t.options)===null||d===void 0?void 0:d.captchaToken}}:null),xform:kt});if(m)throw m;if(!g||!g.session||!g.user){const b=new Me;return this._returnResult({data:{user:null,session:null},error:b})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:Object.assign({},g),error:m})}catch(g){if(A(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async signInWithSolana(t){var e,i,n,r,o,a,l,c,h,u,d,f;let p,g;if("message"in t)p=t.message,g=t.signature;else{const{chain:m,wallet:b,statement:y,options:_}=t;let v;if(rt())if(typeof b=="object")v=b;else{const S=window;if("solana"in S&&typeof S.solana=="object"&&("signIn"in S.solana&&typeof S.solana.signIn=="function"||"signMessage"in S.solana&&typeof S.solana.signMessage=="function"))v=S.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!_?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=b}const x=new URL((e=_?.url)!==null&&e!==void 0?e:window.location.href);if("signIn"in v&&v.signIn){const S=await v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},_?.signInWithSolana),{version:"1",domain:x.host,uri:x.href}),y?{statement:y}:null));let k;if(Array.isArray(S)&&S[0]&&typeof S[0]=="object")k=S[0];else if(S&&typeof S=="object"&&"signedMessage"in S&&"signature"in S)k=S;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in k&&"signature"in k&&(typeof k.signedMessage=="string"||k.signedMessage instanceof Uint8Array)&&k.signature instanceof Uint8Array)p=typeof k.signedMessage=="string"?k.signedMessage:new TextDecoder().decode(k.signedMessage),g=k.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in v)||typeof v.signMessage!="function"||!("publicKey"in v)||typeof v!="object"||!v.publicKey||!("toBase58"in v.publicKey)||typeof v.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${x.host} wants you to sign in with your Solana account:`,v.publicKey.toBase58(),...y?["",y,""]:[""],"Version: 1",`URI: ${x.href}`,`Issued At: ${(n=(i=_?.signInWithSolana)===null||i===void 0?void 0:i.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((r=_?.signInWithSolana)===null||r===void 0)&&r.notBefore?[`Not Before: ${_.signInWithSolana.notBefore}`]:[],...!((o=_?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${_.signInWithSolana.expirationTime}`]:[],...!((a=_?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${_.signInWithSolana.chainId}`]:[],...!((l=_?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${_.signInWithSolana.nonce}`]:[],...!((c=_?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${_.signInWithSolana.requestId}`]:[],...!((u=(h=_?.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||u===void 0)&&u.length?["Resources",..._.signInWithSolana.resources.map(k=>`- ${k}`)]:[]].join(`
`);const S=await v.signMessage(new TextEncoder().encode(p),"utf8");if(!S||!(S instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=S}}try{const{data:m,error:b}=await O(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:we(g)},!((d=t.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(f=t.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:kt});if(b)throw b;if(!m||!m.session||!m.user){const y=new Me;return this._returnResult({data:{user:null,session:null},error:y})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:Object.assign({},m),error:b})}catch(m){if(A(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async _exchangeCodeForSession(t){const e=await fe(this.storage,`${this.storageKey}-code-verifier`),[i,n]=(e??"").split("/");try{if(!i&&this.flowType==="pkce")throw new Ep;const{data:r,error:o}=await O(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:i},xform:kt});if(await nt(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!r||!r.session||!r.user){const a=new Me;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign(Object.assign({},r),{redirectType:n??null}),error:o})}catch(r){if(await nt(this.storage,`${this.storageKey}-code-verifier`),A(r))return this._returnResult({data:{user:null,session:null,redirectType:null},error:r});throw r}}async signInWithIdToken(t){try{const{options:e,provider:i,token:n,access_token:r,nonce:o}=t,a=await O(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:n,access_token:r,nonce:o,gotrue_meta_security:{captcha_token:e?.captchaToken}},xform:kt}),{data:l,error:c}=a;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const h=new Me;return this._returnResult({data:{user:null,session:null},error:h})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(e){if(A(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOtp(t){var e,i,n,r,o;try{if("email"in t){const{email:a,options:l}=t;let c=null,h=null;this.flowType==="pkce"&&([c,h]=await Le(this.storage,this.storageKey));const{error:u}=await O(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(e=l?.data)!==null&&e!==void 0?e:{},create_user:(i=l?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:h},redirectTo:l?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:u})}if("phone"in t){const{phone:a,options:l}=t,{data:c,error:h}=await O(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(r=l?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(o=l?.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c?.message_id},error:h})}throw new Ys("You must provide either an email or phone number.")}catch(a){if(await nt(this.storage,`${this.storageKey}-code-verifier`),A(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(t){var e,i;try{let n,r;"options"in t&&(n=(e=t.options)===null||e===void 0?void 0:e.redirectTo,r=(i=t.options)===null||i===void 0?void 0:i.captchaToken);const{data:o,error:a}=await O(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:r}}),redirectTo:n,xform:kt});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(n){if(A(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithSSO(t){var e,i,n,r,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await Le(this.storage,this.storageKey));const c=await O(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(i=(e=t.options)===null||e===void 0?void 0:e.redirectTo)!==null&&i!==void 0?i:void 0}),!((n=t?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:Yp});return!((r=c.data)===null||r===void 0)&&r.url&&rt()&&!(!((o=t.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(a){if(await nt(this.storage,`${this.storageKey}-code-verifier`),A(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:e},error:i}=t;if(i)throw i;if(!e)throw new bt;const{error:n}=await O(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(t){if(A(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const e=`${this.url}/resend`;if("email"in t){const{email:i,type:n,options:r}=t,{error:o}=await O(this.fetch,"POST",e,{headers:this.headers,body:{email:i,type:n,gotrue_meta_security:{captcha_token:r?.captchaToken}},redirectTo:r?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in t){const{phone:i,type:n,options:r}=t,{data:o,error:a}=await O(this.fetch,"POST",e,{headers:this.headers,body:{phone:i,type:n,gotrue_meta_security:{captcha_token:r?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o?.message_id},error:a})}throw new Ys("You must provide either an email or phone number and a type")}catch(e){if(A(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async e=>e))}async _acquireLock(t,e){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const i=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await i,await e()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const i=e();for(this.pendingInLock.push((async()=>{try{await i}catch{}})()),await i;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await i}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const e=await this.__loadSession();return await t(e)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const e=await fe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",e),e!==null&&(this._isValidSession(e)?t=e:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const i=t.expires_at?t.expires_at*1e3-Date.now()<Ki:!1;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",t.expires_at),!i){if(this.userStorage){const o=await fe(this.userStorage,this.storageKey+"-user");o?.user?t.user=o.user:t.user=Yi()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};t.user=qp(t.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:n,error:r}=await this._callRefreshToken(t.refresh_token);return r?this._returnResult({data:{session:null},error:r}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const e=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return e.data.user&&(this.suppressGetSessionWarning=!0),e}async _getUser(t){try{return t?await O(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:qt}):await this._useSession(async e=>{var i,n,r;const{data:o,error:a}=e;if(a)throw a;return!(!((i=o.session)===null||i===void 0)&&i.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new bt}:await O(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&r!==void 0?r:void 0,xform:qt})})}catch(e){if(A(e))return Gi(e)&&(await this._removeSession(),await nt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:e});throw e}}async updateUser(t,e={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(t,e))}async _updateUser(t,e={}){try{return await this._useSession(async i=>{const{data:n,error:r}=i;if(r)throw r;if(!n.session)throw new bt;const o=n.session;let a=null,l=null;this.flowType==="pkce"&&t.email!=null&&([a,l]=await Le(this.storage,this.storageKey));const{data:c,error:h}=await O(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:e?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:qt});if(h)throw h;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(i){if(await nt(this.storage,`${this.storageKey}-code-verifier`),A(i))return this._returnResult({data:{user:null},error:i});throw i}}async setSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new bt;const e=Date.now()/1e3;let i=e,n=!0,r=null;const{payload:o}=Zs(t.access_token);if(o.exp&&(i=o.exp,n=i<=e),n){const{data:a,error:l}=await this._callRefreshToken(t.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};r=a}else{const{data:a,error:l}=await this._getUser(t.access_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});r={access_token:t.access_token,refresh_token:t.refresh_token,user:a.user,token_type:"bearer",expires_in:i-e,expires_at:i},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return this._returnResult({data:{user:r.user,session:r},error:null})}catch(e){if(A(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async e=>{var i;if(!t){const{data:o,error:a}=e;if(a)throw a;t=(i=o.session)!==null&&i!==void 0?i:void 0}if(!t?.refresh_token)throw new bt;const{data:n,error:r}=await this._callRefreshToken(t.refresh_token);return r?this._returnResult({data:{user:null,session:null},error:r}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(e){if(A(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _getSessionFromURL(t,e){try{if(!rt())throw new Xs("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Xs(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(e){case"implicit":if(this.flowType==="pkce")throw new jo("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Xs("Not a valid implicit grant flow url.");break;default:}if(e==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new jo("No code detected.");const{data:y,error:_}=await this._exchangeCodeForSession(t.code);if(_)throw _;const v=new URL(window.location.href);return v.searchParams.delete("code"),window.history.replaceState(window.history.state,"",v.toString()),{data:{session:y.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:n,access_token:r,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=t;if(!r||!a||!o||!c)throw new Xs("No session defined in URL");const h=Math.round(Date.now()/1e3),u=parseInt(a);let d=h+u;l&&(d=parseInt(l));const f=d-h;f*1e3<=Ne&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${u}s`);const p=d-u;h-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,h):h-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,d,h);const{data:g,error:m}=await this._getUser(r);if(m)throw m;const b={provider_token:i,provider_refresh_token:n,access_token:r,expires_in:u,expires_at:d,refresh_token:o,token_type:c,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:b,redirectType:t.type},error:null})}catch(i){if(A(i))return this._returnResult({data:{session:null,redirectType:null},error:i});throw i}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const e=await fe(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&e)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async e=>{var i;const{data:n,error:r}=e;if(r&&!Gi(r))return this._returnResult({error:r});const o=(i=n.session)===null||i===void 0?void 0:i.access_token;if(o){const{error:a}=await this.admin.signOut(o,t);if(a&&!(Sp(a)&&(a.status===404||a.status===401||a.status===403)||Gi(a)))return this._returnResult({error:a})}return t!=="others"&&(await this._removeSession(),await nt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const e=Mp(),i={id:e,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this._debug("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,i),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(e)})))(),{data:{subscription:i}}}async _emitInitialSession(t){return await this._useSession(async e=>{var i,n;try{const{data:{session:r},error:o}=e;if(o)throw o;await((i=this.stateChangeEmitters.get(t))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",t,"session",r)}catch(r){await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",r),console.error(r)}})}async resetPasswordForEmail(t,e={}){let i=null,n=null;this.flowType==="pkce"&&([i,n]=await Le(this.storage,this.storageKey,!0));try{return await O(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:i,code_challenge_method:n,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(r){if(await nt(this.storage,`${this.storageKey}-code-verifier`),A(r))return this._returnResult({data:null,error:r});throw r}}async getUserIdentities(){var t;try{const{data:e,error:i}=await this.getUser();if(i)throw i;return this._returnResult({data:{identities:(t=e.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var e;try{const{data:i,error:n}=await this._useSession(async r=>{var o,a,l,c,h;const{data:u,error:d}=r;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(o=t.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=t.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await O(this.fetch,"GET",f,{headers:this.headers,jwt:(h=(c=u.session)===null||c===void 0?void 0:c.access_token)!==null&&h!==void 0?h:void 0})});if(n)throw n;return rt()&&!(!((e=t.options)===null||e===void 0)&&e.skipBrowserRedirect)&&window.location.assign(i?.url),this._returnResult({data:{provider:t.provider,url:i?.url},error:null})}catch(i){if(A(i))return this._returnResult({data:{provider:t.provider,url:null},error:i});throw i}}async linkIdentityIdToken(t){return await this._useSession(async e=>{var i;try{const{error:n,data:{session:r}}=e;if(n)throw n;const{options:o,provider:a,token:l,access_token:c,nonce:h}=t,u=await O(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(i=r?.access_token)!==null&&i!==void 0?i:void 0,body:{provider:a,id_token:l,access_token:c,nonce:h,link_identity:!0,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:kt}),{data:d,error:f}=u;return f?this._returnResult({data:{user:null,session:null},error:f}):!d||!d.session||!d.user?this._returnResult({data:{user:null,session:null},error:new Me}):(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("USER_UPDATED",d.session)),this._returnResult({data:d,error:f}))}catch(n){if(await nt(this.storage,`${this.storageKey}-code-verifier`),A(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}})}async unlinkIdentity(t){try{return await this._useSession(async e=>{var i,n;const{data:r,error:o}=e;if(o)throw o;return await O(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(n=(i=r.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0})})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}}async _refreshAccessToken(t){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(e,"begin");try{const i=Date.now();return await jp(async n=>(n>0&&await Ip(200*Math.pow(2,n-1)),this._debug(e,"refreshing attempt",n),await O(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:kt})),(n,r)=>{const o=200*Math.pow(2,n);return r&&Ji(r)&&Date.now()+o-i<Ne})}catch(i){if(this._debug(e,"error",i),A(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}finally{this._debug(e,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,e){const i=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",e,"url",i),rt()&&!e.skipBrowserRedirect&&window.location.assign(i),{data:{provider:t,url:i},error:null}}async _recoverAndRefresh(){var t,e;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const n=await fe(this.storage,this.storageKey);if(n&&this.userStorage){let o=await fe(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},await Be(this.userStorage,this.storageKey+"-user",o)),n.user=(t=o?.user)!==null&&t!==void 0?t:Yi()}else if(n&&!n.user&&!n.user){const o=await fe(this.storage,this.storageKey+"-user");o&&o?.user?(n.user=o.user,await nt(this.storage,this.storageKey+"-user"),await Be(this.storage,this.storageKey,n)):n.user=Yi()}if(this._debug(i,"session from storage",n),!this._isValidSession(n)){this._debug(i,"session is not valid"),n!==null&&await this._removeSession();return}const r=((e=n.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Ki;if(this._debug(i,`session has${r?"":" not"} expired with margin of ${Ki}s`),r){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),Ji(o)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(n.access_token);!a&&o?.user?(n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(i,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(i,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(i,"error",n),console.error(n);return}finally{this._debug(i,"end")}}async _callRefreshToken(t){var e,i;if(!t)throw new bt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Ci;const{data:r,error:o}=await this._refreshAccessToken(t);if(o)throw o;if(!r.session)throw new bt;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const a={data:r.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(r){if(this._debug(n,"error",r),A(r)){const o={data:null,error:r};return Ji(r)||await this._removeSession(),(e=this.refreshingDeferred)===null||e===void 0||e.resolve(o),o}throw(i=this.refreshingDeferred)===null||i===void 0||i.reject(r),r}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(t,e,i=!0){const n=`#_notifyAllSubscribers(${t})`;this._debug(n,"begin",e,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:t,session:e});const r=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(t,e)}catch(l){r.push(l)}});if(await Promise.all(o),r.length>0){for(let a=0;a<r.length;a+=1)console.error(r[a]);throw r[0]}}finally{this._debug(n,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await nt(this.storage,`${this.storageKey}-code-verifier`);const e=Object.assign({},t),i=e.user&&e.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!i&&e.user&&await Be(this.userStorage,this.storageKey+"-user",{user:e.user});const n=Object.assign({},e);delete n.user;const r=Uo(n);await Be(this.storage,this.storageKey,r)}else{const n=Uo(e);await Be(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await nt(this.storage,this.storageKey),await nt(this.storage,this.storageKey+"-code-verifier"),await nt(this.storage,this.storageKey+"-user"),this.userStorage&&await nt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&rt()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Ne);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t);const e=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);const e=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,e&&clearTimeout(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:i}}=e;if(!i||!i.refresh_token||!i.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((i.expires_at*1e3-t)/Ne);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${Ne}ms, refresh threshold is ${wn} ticks`),n<=wn&&await this._callRefreshToken(i.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof gl)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!rt()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(t){this._debug("#visibilityChangedCallback","error",t)}},window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const e=`#_onVisibilityChanged(${t})`;this._debug(e,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,e,i){const n=[`provider=${encodeURIComponent(e)}`];if(i?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),i?.scopes&&n.push(`scopes=${encodeURIComponent(i.scopes)}`),this.flowType==="pkce"){const[r,o]=await Le(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(r)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(a.toString())}if(i?.queryParams){const r=new URLSearchParams(i.queryParams);n.push(r.toString())}return i?.skipBrowserRedirect&&n.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${t}?${n.join("&")}`}async _unenroll(t){try{return await this._useSession(async e=>{var i;const{data:n,error:r}=e;return r?this._returnResult({data:null,error:r}):await O(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token})})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}}async _enroll(t){try{return await this._useSession(async e=>{var i,n;const{data:r,error:o}=e;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:l,error:c}=await O(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(i=r?.session)===null||i===void 0?void 0:i.access_token});return c?this._returnResult({data:null,error:c}):(t.factorType==="totp"&&l.type==="totp"&&(!((n=l?.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}}async _verify(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async e=>{var i;const{data:n,error:r}=e;if(r)return this._returnResult({data:null,error:r});const o=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?dm(t.webauthn.credential_response):fm(t.webauthn.credential_response)})}:{code:t.code}),{data:a,error:l}=await O(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:o,headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}})}async _challenge(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async e=>{var i;const{data:n,error:r}=e;if(r)return this._returnResult({data:null,error:r});const o=await O(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:hm(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:um(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}})}async _challengeAndVerify(t){const{data:e,error:i}=await this._challenge({factorId:t.factorId});return i?this._returnResult({data:null,error:i}):await this._verify({factorId:t.factorId,challengeId:e.id,code:t.code})}async _listFactors(){var t;const{data:{user:e},error:i}=await this.getUser();if(i)return{data:null,error:i};const n={all:[],phone:[],totp:[],webauthn:[]};for(const r of(t=e?.factors)!==null&&t!==void 0?t:[])n.all.push(r),r.status==="verified"&&n[r.factor_type].push(r);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(t){var e,i,n,r;if(t)try{const{payload:f}=Zs(t);let p=null;f.aal&&(p=f.aal);let g=p;const{data:{user:m},error:b}=await this.getUser(t);if(b)return this._returnResult({data:null,error:b});((i=(e=m?.factors)===null||e===void 0?void 0:e.filter(v=>v.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(g="aal2");const _=f.amr||[];return{data:{currentLevel:p,nextLevel:g,currentAuthenticationMethods:_},error:null}}catch(f){if(A(f))return this._returnResult({data:null,error:f});throw f}const{data:{session:o},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=Zs(o.access_token);let c=null;l.aal&&(c=l.aal);let h=c;((r=(n=o.user.factors)===null||n===void 0?void 0:n.filter(f=>f.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(h="aal2");const d=l.amr||[];return{data:{currentLevel:c,nextLevel:h,currentAuthenticationMethods:d},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async e=>{const{data:{session:i},error:n}=e;return n?this._returnResult({data:null,error:n}):i?await O(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:i.access_token,xform:r=>({data:r,error:null})}):this._returnResult({data:null,error:new bt})})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}}async _approveAuthorization(t,e){try{return await this._useSession(async i=>{const{data:{session:n},error:r}=i;if(r)return this._returnResult({data:null,error:r});if(!n)return this._returnResult({data:null,error:new bt});const o=await O(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&rt()&&!e?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(i){if(A(i))return this._returnResult({data:null,error:i});throw i}}async _denyAuthorization(t,e){try{return await this._useSession(async i=>{const{data:{session:n},error:r}=i;if(r)return this._returnResult({data:null,error:r});if(!n)return this._returnResult({data:null,error:new bt});const o=await O(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&rt()&&!e?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(i){if(A(i))return this._returnResult({data:null,error:i});throw i}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:e},error:i}=t;return i?this._returnResult({data:null,error:i}):e?await O(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:e.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new bt})})}catch(t){if(A(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async e=>{const{data:{session:i},error:n}=e;return n?this._returnResult({data:null,error:n}):i?(await O(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:i.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new bt})})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}}async fetchJwk(t,e={keys:[]}){let i=e.keys.find(a=>a.kid===t);if(i)return i;const n=Date.now();if(i=this.jwks.keys.find(a=>a.kid===t),i&&this.jwks_cached_at+wp>n)return i;const{data:r,error:o}=await O(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!r.keys||r.keys.length===0||(this.jwks=r,this.jwks_cached_at=n,i=r.keys.find(a=>a.kid===t),!i)?null:i}async getClaims(t,e={}){try{let i=t;if(!i){const{data:f,error:p}=await this.getSession();if(p||!f.session)return this._returnResult({data:null,error:p});i=f.session.access_token}const{header:n,payload:r,signature:o,raw:{header:a,payload:l}}=Zs(i);e?.allowExpired||zp(r.exp);const c=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,e?.keys?{keys:e.keys}:e?.jwks);if(!c){const{error:f}=await this.getUser(i);if(f)throw f;return{data:{claims:r,header:n,signature:o},error:null}}const h=Vp(n.alg),u=await crypto.subtle.importKey("jwk",c,h,!0,["verify"]);if(!await crypto.subtle.verify(h,u,o,Pp(`${a}.${l}`)))throw new kn("Invalid JWT signature");return{data:{claims:r,header:n,signature:o},error:null}}catch(i){if(A(i))return this._returnResult({data:null,error:i});throw i}}}As.nextInstanceID={};const xm=As,Sm="2.95.3";let ls="";typeof Deno<"u"?ls="deno":typeof document<"u"?ls="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ls="react-native":ls="node";const km={"X-Client-Info":`supabase-js-${ls}/${Sm}`},Em={headers:km},Tm={schema:"public"},Am={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Om={};function Os(s){"@babel/helpers - typeof";return Os=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Os(s)}function Cm(s,t){if(Os(s)!="object"||!s)return s;var e=s[Symbol.toPrimitive];if(e!==void 0){var i=e.call(s,t);if(Os(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Pm(s){var t=Cm(s,"string");return Os(t)=="symbol"?t:t+""}function Rm(s,t,e){return(t=Pm(t))in s?Object.defineProperty(s,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[t]=e,s}function Go(s,t){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),e.push.apply(e,i)}return e}function G(s){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Go(Object(e),!0).forEach(function(i){Rm(s,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):Go(Object(e)).forEach(function(i){Object.defineProperty(s,i,Object.getOwnPropertyDescriptor(e,i))})}return s}const Mm=s=>s?(...t)=>s(...t):(...t)=>fetch(...t),Lm=()=>Headers,Dm=(s,t,e)=>{const i=Mm(e),n=Lm();return async(r,o)=>{var a;const l=(a=await t())!==null&&a!==void 0?a:s;let c=new n(o?.headers);return c.has("apikey")||c.set("apikey",s),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),i(r,G(G({},o),{},{headers:c}))}};function Im(s){return s.endsWith("/")?s:s+"/"}function jm(s,t){var e,i;const{db:n,auth:r,realtime:o,global:a}=s,{db:l,auth:c,realtime:h,global:u}=t,d={db:G(G({},l),n),auth:G(G({},c),r),realtime:G(G({},h),o),storage:{},global:G(G(G({},u),a),{},{headers:G(G({},(e=u?.headers)!==null&&e!==void 0?e:{}),(i=a?.headers)!==null&&i!==void 0?i:{})}),accessToken:async()=>""};return s.accessToken?d.accessToken=s.accessToken:delete d.accessToken,d}function $m(s){const t=s?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Im(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var Nm=class extends xm{constructor(s){super(s)}},Bm=class{constructor(s,t,e){var i,n;this.supabaseUrl=s,this.supabaseKey=t;const r=$m(s);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",r),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",r),this.storageUrl=new URL("storage/v1",r),this.functionsUrl=new URL("functions/v1",r);const o=`sb-${r.hostname.split(".")[0]}-auth-token`,a={db:Tm,realtime:Om,auth:G(G({},Am),{},{storageKey:o}),global:Em},l=jm(e??{},a);if(this.storageKey=(i=l.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(n=l.global.headers)!==null&&n!==void 0?n:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(h,u)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(u)} is not possible`)}});else{var c;this.auth=this._initSupabaseAuthClient((c=l.auth)!==null&&c!==void 0?c:{},this.headers,l.global.fetch)}this.fetch=Dm(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(G({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(h=>this.realtime.setAuth(h)).catch(h=>console.warn("Failed to set initial Realtime auth token:",h)),this.rest=new Sg(new URL("rest/v1",r).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch,timeout:l.db.timeout,urlLengthLimit:l.db.urlLengthLimit}),this.storage=new mp(this.storageUrl.href,this.headers,this.fetch,e?.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new pg(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(s){return this.rest.from(s)}schema(s){return this.rest.schema(s)}rpc(s,t={},e={head:!1,get:!1,count:void 0}){return this.rest.rpc(s,t,e)}channel(s,t={config:{}}){return this.realtime.channel(s,t)}getChannels(){return this.realtime.getChannels()}removeChannel(s){return this.realtime.removeChannel(s)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var s=this,t,e;if(s.accessToken)return await s.accessToken();const{data:i}=await s.auth.getSession();return(t=(e=i.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:s.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:s,persistSession:t,detectSessionInUrl:e,storage:i,userStorage:n,storageKey:r,flowType:o,lock:a,debug:l,throwOnError:c},h,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Nm({url:this.authUrl.href,headers:G(G({},d),h),storageKey:r,autoRefreshToken:s,persistSession:t,detectSessionInUrl:e,storage:i,userStorage:n,flowType:o,lock:a,debug:l,throwOnError:c,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(s){return new Fg(this.realtimeUrl.href,G(G({},s),{},{params:G(G({},{apikey:this.supabaseKey}),s?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,t)=>{this._handleTokenChanged(s,"CLIENT",t?.access_token)})}_handleTokenChanged(s,t,e){(s==="TOKEN_REFRESHED"||s==="SIGNED_IN")&&this.changedAccessToken!==e?(this.changedAccessToken=e,this.realtime.setAuth(e)):s==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const Fm=(s,t,e)=>new Bm(s,t,e);function Um(){if(typeof window<"u")return!1;const s=globalThis.process;if(!s)return!1;const t=s.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Um()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");let $=null;function Kn(){return $=Fm("https://pwvudnaueupwbhfprmyg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3dnVkbmF1ZXVwd2JoZnBybXlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1ODMyNTMsImV4cCI6MjA4NjE1OTI1M30.KcER7BEPPoClh5LKpNxO6axrtAoXNDnERJOZy1jpsjE"),!0}function bl(s,t){return localStorage.setItem("fg_supabase_url",s),localStorage.setItem("fg_supabase_key",t),Kn()}function Wm(){return $}function st(){return $!==null}async function yl(){if(!$)return[];const{data:s,error:t}=await $.from("wallets").select("*").order("created_at");return t?(console.error("fetchWallets error:",t),[]):s||[]}async function _l(s){if(!$)return null;const{data:t,error:e}=await $.from("wallets").insert(s).select().single();return e?(console.error("createWallet error:",e),null):t}async function vl(s){if(!$)return[];let t=$.from("categories").select("*").order("sort_order");const{data:e,error:i}=await t;return i?(console.error("fetchCategories error:",i),[]):e||[]}async function zm(s){if(!$)return null;const{data:t,error:e}=await $.from("categories").insert(s).select().single();return e?(console.error("createCategory error:",e),null):t}async function En(s,t,e,i="desc"){if(!$)return[];const n=i==="asc";let r=$.from("transactions").select("*, categories(name, icon)").order("date",{ascending:n}).order("created_at",{ascending:n});s&&(r=r.eq("wallet_id",s)),t&&(r=r.gte("date",t)),e&&(r=r.lte("date",e));const{data:o,error:a}=await r;return a?(console.error("fetchTransactions error:",a),[]):o||[]}async function wl(s,t=5){if(!$||!s)return[];const{data:e,error:i}=await $.from("transactions").select("*, categories(name, icon)").ilike("description",`%${s}%`).order("date",{ascending:!1}).order("created_at",{ascending:!1}).limit(t);return i?(console.error("Historical search error:",i),[]):e||[]}async function xl(s){if(!$)return null;const{data:t,error:e}=await $.from("transactions").insert(s).select("*, categories(name, icon)").single();return e?(console.error("createTransaction error:",e),null):t}async function Sl(s,t){if(!$)return null;const{data:e,error:i}=await $.from("transactions").update(t).eq("id",s).select("*, categories(name, icon)").single();return i?(console.error("updateTransaction error:",i),null):e}async function kl(s){if(!$)return!1;const{error:t}=await $.from("transactions").delete().eq("id",s);return t?(console.error("deleteTransaction error:",t),!1):!0}async function El(s){if(!$)return[];let t=$.from("goals").select("*").order("created_at");s&&(t=t.eq("wallet_id",s));const{data:e,error:i}=await t;return i?(console.error("fetchGoals error:",i),[]):e||[]}async function Vm(s){if(!$)return null;const{data:t,error:e}=await $.from("goals").insert(s).select().single();return e?(console.error("createGoal error:",e),null):t}async function Hm(s,t){if(!$)return null;const{data:e,error:i}=await $.from("goals").update(t).eq("id",s).select().single();return i?(console.error("updateGoal error:",i),null):e}async function Gn(){if(!$)return[];const{data:s,error:t}=await $.from("fiat_accounts").select("*").order("created_at");return t?(console.error("fetchAccounts error:",t),[]):s||[]}async function Jn(){if(!$)return null;try{const[s,t,e,i]=await Promise.all([yl(),vl(),Gn(),El()]);if(s.length===0)return null;const n={};return s.forEach(r=>{n[r.id]=[]}),t.forEach(r=>{n[r.wallet_id]&&n[r.wallet_id].push(r)}),{wallets:s,categories:n,accounts:e,goals:i}}catch(s){return console.error("syncFromSupabase error:",s),null}}function Tl(s){return $?$.channel("custom-all-channel").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},t=>{console.log("Realtime transaction update:",t),s(t)}).subscribe():null}Kn();const ie=Object.freeze(Object.defineProperty({__proto__:null,createCategory:zm,createGoal:Vm,createTransaction:xl,createWallet:_l,deleteTransaction:kl,fetchAccounts:Gn,fetchCategories:vl,fetchGoals:El,fetchTransactions:En,fetchWallets:yl,getSupabase:Wm,initSupabase:Kn,isConnected:st,saveSupabaseConfig:bl,searchHistoricalTransactions:wl,subscribeToTransactions:Tl,syncFromSupabase:Jn,updateGoal:Hm,updateTransaction:Sl},Symbol.toStringTag,{value:"Module"}));function Yn(s,t=[],e=[],i=[]){if(!s)return{category:"Por Clasificar",type:"expense",isFallback:!0,walletId:null};const n=s.toLowerCase().trim();for(const o of e)if(n.includes(o.keywords[0]||o.keywords)){const a=t.find(l=>l.name.toLowerCase()===(o.category||"").toLowerCase());if(a)return{category:a.name,type:o.type||a.type,isFallback:!1,walletId:null}}const r=i.find(o=>o.description&&o.description.toLowerCase().trim()===n&&(o.categories?.name||o.category_name));if(r){const o=r.categories?.name||r.category_name,a=t.find(l=>l.name===o);return{category:a?a.name:o,type:r.type,isFallback:!1,walletId:r.wallet_id}}return{category:"Por Clasificar",type:"expense",isFallback:!0,walletId:null}}function qm(s,t=[],e=[],i=[]){const n={...s};if(!n.category_name&&n.description){const r=Yn(n.description,t,e,i);r.category&&(n.category_name=r.category,!n.type&&r.type&&(n.type=r.type))}return n.date||(n.date=new Date().toISOString().split("T")[0]),n}const w=s=>document.getElementById(s),Zi=w("walletSwitcher"),Km=w("monthLabel"),Gm=w("totalIncome"),Jm=w("totalExpense"),Jo=w("totalBalance"),Qi=w("profitCard"),Ym=w("profitAmount"),Xm=w("profitMargin"),Yo=w("budgetFill"),Zm=w("budgetSpent"),Qm=w("budgetTotal"),tb=w("recentTransactions");w("allTransactions");const Qt=w("categoryChips"),ge=w("autoSuggest"),xt=w("quickEntryModal"),ve=w("addWalletModal"),Fe=w("addGoalModal"),eb=w("accountsList"),Xo=w("settingsWallets"),ss=w("toast");let tn=null,is="all",si="desc",At=null;async function Al(){window.addEventListener("unhandledrejection",i=>{document.body.innerHTML=`<h1 style="color:red;z-index:9999;position:fixed">UNHANDLED: ${i.reason}</h1>`}),window.onerror=(i,n,r)=>{document.body.innerHTML=`<h1 style="color:red;z-index:9999;position:fixed">ERROR: ${i} line ${r}</h1>`};const s=B();if(document.documentElement.setAttribute("data-theme",s.theme),hb(s.theme),og(),st()){const i=await Jn();i&&Pt({wallets:i.wallets.map(n=>({id:n.id,name:n.name,emoji:n.emoji,color:n.color,wallet_type:n.wallet_type,monthly_budget:Number(n.monthly_budget)||0})),categories:Object.fromEntries(Object.entries(i.categories).map(([n,r])=>[n,r.map(o=>({id:o.id,name:o.name,icon:o.icon,type:o.type}))])),accounts:i.accounts.map(n=>({id:n.id,name:n.name,institution:n.institution||"",balance:Number(n.balance)||0,currency:n.currency||"MXN"})),activeWalletId:i.wallets[0]?.id||s.activeWalletId,supabaseConnected:!0})}pi(),w("entryDate").value=new Date().toISOString().split("T")[0],Tn(),await Ot(),window.addEventListener("online",()=>{U("Conexin restaurada",null,null),w("submitEntry").disabled=!1,Ot()}),window.addEventListener("offline",()=>{U("Ests desconectado",null,null),w("submitEntry").disabled=!0}),navigator.onLine||(U("Sin conexin",null,null),w("submitEntry").disabled=!0);const t="https://pwvudnaueupwbhfprmyg.supabase.co",e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3dnVkbmF1ZXVwd2JoZnBybXlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1ODMyNTMsImV4cCI6MjA4NjE1OTI1M30.KcER7BEPPoClh5LKpNxO6axrtAoXNDnERJOZy1jpsjE";w("supabaseUrl").value=t,w("supabaseKey").value=e,ub(),lg((i,n)=>{(n.has("activeWalletId")||n.has("wallets"))&&(pi(),Ot()),n.has("currentMonth")&&(Tn(),Ot())}),st()&&Tl(i=>{Ot()})}function pi(){const s=B();Zi.innerHTML=s.wallets.map(e=>`
    <button class="wallet-tab ${e.id===s.activeWalletId?"active":""}" data-wallet="${e.id}">
      <span class="emoji">${e.emoji}</span>
      <span>${e.name}</span>
    </button>
  `).join("")+'<button class="wallet-tab add-wallet" id="addWalletTab">+</button>',Zi.querySelectorAll(".wallet-tab:not(.add-wallet)").forEach(e=>{e.addEventListener("click",()=>{Pt({activeWalletId:e.dataset.wallet})})});const t=Zi.querySelector(".add-wallet");t&&t.addEventListener("click",()=>Bt(ve))}let en=!1;async function Ot(){if(!en){en=!0;try{const s=B(),t=Qa(),{start:e,end:i}=hg();let n=[];st()?n=await En(null,null,null):n=s.transactions||[];const r=n.filter(g=>g.type==="income").reduce((g,m)=>g+Number(m.amount),0),o=n.filter(g=>g.type==="expense").reduce((g,m)=>g+Number(m.amount),0),a=r-o,l=w("globalBalance");l&&(l.textContent=at(a),l.className=`global-balance-amount ${a>=0?"income":"expense"}`);let c=[];st()?(c=await En(t.id,e,i),s.transactions=c,pt()):c=s.transactions.filter(g=>g.wallet_id===t.id&&g.date>=e&&g.date<=i);const h=c.filter(g=>g.type==="income").reduce((g,m)=>g+Number(m.amount),0),u=c.filter(g=>g.type==="expense").reduce((g,m)=>g+Number(m.amount),0),d=h-u;if(Gm.textContent=at(h),Jm.textContent=at(u),Jo.textContent=at(d),Jo.className=`balance-amount ${d>=0?"income":"expense"}`,t.wallet_type==="business"){Qi.classList.remove("hidden");const g=h>0?(d/h*100).toFixed(1):0;Ym.textContent=at(d),Xm.textContent=`${g}%`,Qi.className=`profit-card ${d<0?"negative":""}`}else Qi.classList.add("hidden");const f=t.monthly_budget||0;if(f>0){const g=Math.min(u/f*100,100);Yo.style.width=`${g}%`,Yo.className=`budget-fill ${g>90?"danger":g>70?"warning":""}`,Zm.textContent=at(u),Qm.textContent=at(f),w("budgetSection").classList.remove("hidden")}else w("budgetSection").classList.add("hidden");sb(c),Ol(tb,c.slice(0,8)),xt.classList.contains("active")||(Kt(),Cl()),Xn(c),Zn(),rb(),Pi()}finally{en=!1}}}function sb(s){const t={};s.filter(o=>o.type==="expense").forEach(o=>{const a=o.categories?.name||o.category_name||"Sin categora";t[a]=(t[a]||0)+Number(o.amount)});const e=Object.keys(t),i=Object.values(t),n=["#C8B560","#6EC6A0","#E07A5F","#7BA3C9","#B88BA5","#8B9D83","#D4A853","#A3A3C9","#C9946B","#8BC99B","#C96B8B","#6BC9C9"];tn&&tn.destroy();const r=w("categoryChart");if(r){if(e.length===0){r.style.display="none";return}r.style.display="block",tn=new zn(r,{type:"doughnut",data:{labels:e,datasets:[{data:i,backgroundColor:n.slice(0,e.length),borderWidth:0,hoverOffset:10,borderRadius:8,spacing:4}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"75%",plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0,pointStyleWidth:10,font:{family:"'Inter', sans-serif",size:12},color:"#9BA1A6"}},tooltip:{backgroundColor:"rgba(5, 5, 5, 0.95)",titleColor:"#F8F9FA",bodyColor:"#9BA1A6",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,padding:16,cornerRadius:12,displayColors:!0,boxPadding:8,titleFont:{family:"'Inter', sans-serif",size:13,weight:"bold"},bodyFont:{family:"'Inter', sans-serif",size:14},callbacks:{label:o=>` ${o.label}: ${at(o.raw)}`}}}}})}}function Ol(s,t){if(t.length===0){s.innerHTML=`
      <div class="tx-empty">
        <span class="empty-icon"></span>
        <p>No hay registros este mes</p>
        <p style="margin-top:4px;font-size:0.75rem;">Toca + para agregar uno</p>
      </div>`;return}const e={};t.forEach(i=>{const n=i.date;e[n]||(e[n]=[]),e[n].push(i)}),s.innerHTML=Object.entries(e).map(([i,n])=>`
    <div class="tx-date-group">
      <div class="tx-date-header">${tl(i)}</div>
      ${n.map(r=>{const o=r.categories?.name||r.category_name||"",a=r.categories?.icon||r.category_icon||"";return`
          <div class="tx-item-wrapper" data-id="${r.id}">
            <div class="tx-item">
              <div class="tx-icon ${r.type}">${a}</div>
              <div class="tx-info">
                <div class="tx-description">
                  ${r.description||o||"Sin descripcin"}
                  ${r.is_fixed?'<span class="fixed-tag" title="Gasto Fijo"></span>':""}
                </div>
                <div class="tx-category">${o}${r.account?"  "+r.account:""}</div>
              </div>
              <div class="tx-amount ${r.type}">
                ${r.type==="expense"?"-":"+"}${at(Math.abs(r.amount))}
              </div>
            </div>
            <div class="tx-actions">
              <button class="tx-action-btn tx-edit-btn" data-id="${r.id}" title="Editar"></button>
              <button class="tx-action-btn tx-delete-btn" data-id="${r.id}" title="Eliminar"></button>
            </div>
          </div>`}).join("")}
    </div>
  `).join(""),s.querySelectorAll(".tx-edit-btn").forEach(i=>{i.addEventListener("click",n=>{n.stopPropagation(),db(i.dataset.id)})}),s.querySelectorAll(".tx-delete-btn").forEach(i=>{i.addEventListener("click",n=>{n.stopPropagation(),gb(i.dataset.id)})}),s.querySelectorAll(".tx-item-wrapper").forEach(i=>{i.querySelector(".tx-item").addEventListener("click",n=>{s.querySelectorAll(".tx-item-wrapper.active").forEach(r=>{r!==i&&r.classList.remove("active")}),i.classList.toggle("active")})})}function Xn(s){let t=[...s];const e=w("searchTx")?.value?.toLowerCase()||"";e&&(t=t.filter(r=>(r.description||"").toLowerCase().includes(e)||(r.categories?.name||r.category_name||"").toLowerCase().includes(e))),is!=="all"&&(t=t.filter(r=>(r.categories?.name||r.category_name)===is)),t.sort((r,o)=>{const a=new Date(r.date),l=new Date(o.date);return si==="asc"?a-l:l-a}),Ol(w("allTransactions"),t);const i=[...new Set(s.map(r=>r.categories?.name||r.category_name).filter(Boolean))],n=w("filterChips");n&&(n.innerHTML=`
      <button class="filter-chip ${is==="all"?"active":""}" data-filter="all">Todas</button>
      ${i.map(r=>`
        <button class="filter-chip ${is===r?"active":""}" data-filter="${r}">${r}</button>
      `).join("")}
    `,n.querySelectorAll(".filter-chip").forEach(r=>{r.addEventListener("click",()=>{is=r.dataset.filter,Xn(s)})}))}function Kt(){const s=B(),t=document.querySelector(".type-btn.active")?.dataset.type||"expense",e=Ei(s.activeWalletId,t);Qt.innerHTML=e.map(i=>`
    <button type="button" class="category-chip" data-category="${i.name}" data-icon="${i.icon}">
      ${i.icon} ${i.name}
    </button>
  `).join(""),Qt.querySelectorAll(".category-chip").forEach(i=>{i.addEventListener("click",()=>{Qt.querySelectorAll(".category-chip").forEach(n=>n.classList.remove("active")),i.classList.add("active"),cb(i.dataset.category,t)})})}function Cl(){const s=B(),t=w("entryAccount");t.innerHTML='<option value="">Seleccionar cuenta</option>'+s.accounts.map(e=>`<option value="${e.name}">${e.name}</option>`).join("")}async function Zn(){const s=B();let t=[];if(st()){const{fetchGoals:i}=await te(async()=>{const{fetchGoals:n}=await Promise.resolve().then(()=>ie);return{fetchGoals:n}},void 0);t=await i(s.activeWalletId)}else t=s.goals.filter(i=>i.wallet_id===s.activeWalletId);const e=w("goalsList");if(e){if(t.length===0){e.innerHTML=`
      <div class="tx-empty">
        <span class="empty-icon"></span>
        <p>No hay metas activas</p>
      </div>`;return}e.innerHTML=t.map(i=>{const n=Math.min(i.current_amount/i.target_amount*100,100),r=n.toFixed(1),o=i.current_amount>=i.target_amount;let a="#10B981";return n<30?a="#EF4444":n<70&&(a="#F59E0B"),`
      <div class="goal-card ${o?"completed-goal glow-effect":""}">
        <div class="goal-header">
          <div class="goal-info-left">
            <span class="goal-icon">${i.icon||""}</span>
            <div class="goal-titles">
              <span class="goal-name">${i.name}</span>
              ${i.category_type?`<span class="goal-type">${i.category_type}</span>`:""}
            </div>
          </div>
          <div class="goal-score" style="color: ${a}; text-shadow: 0 0 10px ${a}40;">
            ${Math.round(r)}%
          </div>
        </div>
        
        <div class="goal-progress-track">
          <div class="goal-progress-fill" style="width: ${r}%; background: ${a}; box-shadow: 0 0 12px ${a}60;"></div>
        </div>
        
        <div class="goal-footer">
          <span class="goal-amounts">${at(i.current_amount)} / ${at(i.target_amount)}</span>
          ${o?'<span class="goal-done-icon"></span>':`
            <button class="add-fund-btn" data-id="${i.id}">+</button>
          `}
        </div>
        ${i.deadline?`<div class="goal-deadline"> Lmite: ${tl(i.deadline)}</div>`:""}
      </div>`}).join(""),e.querySelectorAll(".add-fund-btn").forEach(i=>{i.onclick=n=>{n.stopPropagation(),ib(i.dataset.id)}})}}async function ib(s){const t=prompt("Monto a agregar:");if(!t)return;const e=parseFloat(t);if(isNaN(e)||e<=0)return;const i=B(),n=i.goals.find(o=>o.id===s)||(await te(async()=>{const{fetchGoals:o}=await Promise.resolve().then(()=>ie);return{fetchGoals:o}},void 0)).fetchGoals(i.activeWalletId).then(o=>o.find(a=>a.id===s));if(!n)return;const r=parseFloat(n.current_amount)+e;if(st()){const{updateGoal:o}=await te(async()=>{const{updateGoal:l}=await Promise.resolve().then(()=>ie);return{updateGoal:l}},void 0);await o(s,{current_amount:r});const a=i.goals.findIndex(l=>l.id===s);a!==-1&&(i.goals[a].current_amount=r)}else n.current_amount=r,pt();r>=n.target_amount?(U(" Felicidades! Meta alcanzada"),nb()):U(` Agregado ${at(e)} a ${n.name}`),Zn()}function nb(){const s=document.createElement("div");s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="100vw",s.style.height="100vh",s.style.pointerEvents="none",s.style.zIndex="9999",s.innerHTML='<div style="display:flex;justify-content:center;align-items:center;height:100%;font-size:5rem;">  </div>',document.body.appendChild(s),setTimeout(()=>s.remove(),3e3)}async function rb(){let t=B().accounts;if(st()){const e=await Gn();e.length>0&&(t=e)}eb.innerHTML=t.map(e=>`
    <div class="account-card">
      <div class="account-icon"></div>
      <div class="account-info">
        <div class="account-name">${e.name}</div>
        <div class="account-inst">${e.institution||""}</div>
      </div>
      <div class="account-balance">${at(e.balance||0)}</div>
    </div>
  `).join("")}function Pi(){const s=B();Xo.innerHTML=s.wallets.map(t=>`
    <div class="settings-wallet-item" data-id="${t.id}">
      <div class="settings-wallet-info">
        <span>${t.emoji}</span>
        <span>${t.name}</span>
        <span style="color:var(--text-muted);font-size:0.75rem;">${t.wallet_type==="business"?"Negocio":"Personal"}</span>
      </div>
      <div style="display:flex;align-items:center;gap:8px;">
        <span style="color:var(--text-muted);font-size:0.75rem;">${at(t.monthly_budget||0)}/mes</span>
        <button class="icon-btn edit-wallet-btn" data-id="${t.id}"></button>
      </div>
    </div>
  `).join(""),Xo.querySelectorAll(".edit-wallet-btn").forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation(),Pl(t.dataset.id)})})}function Pl(s){const e=B().wallets.find(r=>r.id===s);if(!e)return;w("editWalletId").value=e.id,w("editWalletName").value=e.name,w("editWalletEmoji").value=e.emoji,w("editWalletBudget").value=e.monthly_budget,Bt(w("editWalletModal"));const i=w("deleteWalletBtn");i.onclick=()=>lb(s);const n=w("manageCategoriesBtn");n.onclick=()=>ob(s)}function ob(s){ot(w("editWalletModal")),Bt(w("manageCategoriesModal")),ii(s),w("backToEditWallet").onclick=()=>{ot(w("manageCategoriesModal")),Pl(s)};const t=w("addCategoryForm");t.onsubmit=async e=>{e.preventDefault();const i=w("newCatName").value.trim(),n=w("newCatEmoji").value.trim()||"";if(i)if(st()){const{createCategory:r}=await te(async()=>{const{createCategory:a}=await Promise.resolve().then(()=>ie);return{createCategory:a}},void 0),o=await r({wallet_id:s,name:i,icon:n,type:"expense"});if(o){const a=B();a.categories[s]||(a.categories[s]=[]),a.categories[s].push(o),pt(),ii(s),w("newCatName").value="",w("newCatEmoji").value=""}}else{const r=B();r.categories[s]||(r.categories[s]=[]),r.categories[s].push({id:crypto.randomUUID(),name:i,icon:n,type:"expense"}),pt(),ii(s),w("newCatName").value="",w("newCatEmoji").value=""}}}function ii(s){const e=B().categories[s]||[],i=w("manageCategoriesList");i.innerHTML=e.map(n=>`
    <div class="category-manage-item">
      <span>${n.icon} ${n.name}</span>
      <button class="icon-btn delete-cat-btn" data-id="${n.id}"></button>
    </div>
  `).join(""),i.querySelectorAll(".delete-cat-btn").forEach(n=>{n.addEventListener("click",()=>ab(s,n.dataset.id))})}async function ab(s,t){if(!confirm("Eliminar categora?"))return;const e=B();if(e.categories[s]=e.categories[s].filter(i=>i.id!==t),pt(),ii(s),st()){const{getSupabase:i}=await te(async()=>{const{getSupabase:n}=await Promise.resolve().then(()=>ie);return{getSupabase:n}},void 0);await i().from("categories").delete().eq("id",t)}}async function lb(s){const t=B(),e=t.wallets.find(i=>i.id===s);if(confirm(`Ests seguro de eliminar la cartera "${e.name}" y todas sus transacciones?`)){if(st()){const{getSupabase:i}=await te(async()=>{const{getSupabase:n}=await Promise.resolve().then(()=>ie);return{getSupabase:n}},void 0);await i().from("wallets").delete().eq("id",s)}t.wallets=t.wallets.filter(i=>i.id!==s),t.activeWalletId===s&&(t.activeWalletId=t.wallets[0]?.id||null),pt(),ot(w("editWalletModal")),pi(),Ot(),Pi(),U("Cartera eliminada")}}w("editWalletForm").addEventListener("submit",async s=>{s.preventDefault();const t=w("editWalletId").value,e={name:w("editWalletName").value,emoji:w("editWalletEmoji").value,monthly_budget:Number(w("editWalletBudget").value)};if(st()){const{getSupabase:r}=await te(async()=>{const{getSupabase:o}=await Promise.resolve().then(()=>ie);return{getSupabase:o}},void 0);await r().from("wallets").update(e).eq("id",t)}const i=B(),n=i.wallets.findIndex(r=>r.id===t);n>=0&&(i.wallets[n]={...i.wallets[n],...e},pt()),ot(w("editWalletModal")),pi(),Pi(),U("Cartera actualizada")});function Tn(){const s=B();Km.textContent=ug(s.currentMonth)}function mi(s){const t=B(),[e,i]=t.currentMonth.split("-").map(Number),n=new Date(e,i-1+s,1);Pt({currentMonth:`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`}),Tn()}function Bt(s){s.classList.add("active"),document.body.style.overflow="hidden"}function ot(s){s.classList.remove("active"),document.body.style.overflow=""}function Rl(){At=null,w("quickEntryForm").reset(),w("entryDate").value=new Date().toISOString().split("T")[0],Qt.querySelectorAll(".category-chip").forEach(i=>i.classList.remove("active")),document.querySelectorAll(".type-btn").forEach(i=>{i.classList.toggle("active",i.dataset.type==="expense")});const s=w("moveTransactionBtn");s&&s.remove(),Kt();const t=xt.querySelector(".modal-header h2"),e=w("submitEntry")?.querySelector(".btn-text");t&&(t.textContent="Nuevo Registro"),e&&(e.textContent="Guardar")}function Qs(s){document.querySelectorAll(".page").forEach(n=>n.classList.remove("active"));const t=w(s);t&&t.classList.add("active");const e=document.createElement("button");e.type="button",e.className="secondary-btn full-width mt-4",e.id="moveTransactionBtn",e.innerText="Mover a otra cartera",e.onclick=()=>moveTransaction(At);const i=w("moveTransactionBtn");i&&i.remove(),At&&w("quickEntryForm").appendChild(e),document.querySelectorAll(".nav-item").forEach(n=>{n.classList.toggle("active",n.dataset.page===s)})}let Zo;function U(s,t=null,e=null){if(ss.innerHTML=`<span>${s}</span>`,t&&e){const i=document.createElement("button");i.className="toast-action",i.textContent=t,i.onclick=()=>{e(),ss.classList.remove("visible")},ss.appendChild(i)}ss.classList.add("visible"),clearTimeout(Zo),Zo=setTimeout(()=>ss.classList.remove("visible"),4e3)}function cb(s,t){const e=w("entryDescription").value.trim();if(!e)return;const i=B(),n=Ei(i.activeWalletId,t);if(Yn(e,n,i.userRules||[],i.transactions||[]).category!==s){const o=e.length<20?e.toLowerCase():e.split(" ")[0].toLowerCase();U(`Recordar para "${o}"?`,"Guardar",()=>{const a={keywords:[o],category:s,type:t},l=[...i.userRules||[],a];Pt({userRules:l}),U(" Regla guardada")})}}function hb(s){const t=w("themeToggle");if(!t)return;const e=t.querySelector(".icon");e&&(e.textContent=s==="dark"?"":"")}function ub(){w("prevMonth").addEventListener("click",()=>mi(-1)),w("nextMonth").addEventListener("click",()=>mi(1)),w("fabAdd").addEventListener("click",()=>{const i=w("moveTransactionBtn");i&&i.remove(),At=null,Rl(),Kt(),Cl(),Bt(xt),w("entryAmount").focus()}),w("closeModal").addEventListener("click",()=>ot(xt)),xt.addEventListener("click",i=>{i.target===xt&&ot(xt)}),document.querySelectorAll(".close-wallet-modal").forEach(i=>{i.addEventListener("click",()=>ot(ve))}),ve.addEventListener("click",i=>{i.target===ve&&ot(ve)}),document.querySelectorAll(".close-goal-modal").forEach(i=>{i.addEventListener("click",()=>ot(Fe))}),Fe.addEventListener("click",i=>{i.target===Fe&&ot(Fe)});const s=w("addGoalBtn");s&&s.addEventListener("click",()=>{Bt(Fe),w("goalName").focus()}),w("addGoalForm").addEventListener("submit",async i=>{i.preventDefault(),await mb()}),w("closeEditWalletModal").addEventListener("click",()=>ot(w("editWalletModal"))),w("editWalletModal").addEventListener("click",i=>{i.target===w("editWalletModal")&&ot(w("editWalletModal"))}),w("closeCategoriesModal").addEventListener("click",()=>ot(w("manageCategoriesModal"))),w("manageCategoriesModal").addEventListener("click",i=>{i.target===w("manageCategoriesModal")&&ot(w("manageCategoriesModal"))}),document.querySelectorAll(".type-btn").forEach(i=>{i.addEventListener("click",()=>{document.querySelectorAll(".type-btn").forEach(n=>n.classList.remove("active")),i.classList.add("active"),Kt()})});let t;w("entryDescription").addEventListener("input",i=>{clearTimeout(t);const n=i.target.value.trim();if(!n||n.length<2){ge.classList.remove("visible");return}const r=B(),o=document.querySelector(".type-btn.active")?.dataset.type||"expense",a=Ei(r.activeWalletId,o);t=setTimeout(async()=>{let l=[];st()?l=await wl(n,5):l=r.transactions.filter(h=>h.description&&h.description.toLowerCase().includes(n.toLowerCase())).slice(0,5);const c=[...new Set(l.map(h=>h.description))];c.length>0?(ge.innerHTML=c.map(h=>`
          <div class="auto-suggest-item">${h}</div>
        `).join(""),ge.classList.add("visible"),ge.querySelectorAll(".auto-suggest-item").forEach(h=>{h.addEventListener("click",()=>{w("entryDescription").value=h.textContent,ge.classList.remove("visible"),Qo(h.textContent,a,l)})})):ge.classList.remove("visible"),Qo(n,a,l)},300)}),w("entryDescription").addEventListener("blur",()=>{setTimeout(()=>ge.classList.remove("visible"),200)}),w("quickEntryForm").addEventListener("submit",async i=>{i.preventDefault(),await fb()}),document.querySelectorAll(".nav-item[data-page]").forEach(i=>{i.addEventListener("click",()=>Qs(i.dataset.page))}),w("viewAllTx")?.addEventListener("click",()=>Qs("pageTransactions"));const e=w("sortTxBtn");e&&e.addEventListener("click",()=>{si=si==="desc"?"asc":"desc",e.textContent=si==="desc"?"":"",Xn(B().transactions)}),w("backFromTx")?.addEventListener("click",()=>Qs("pageDashboard")),w("searchTx")?.addEventListener("input",()=>Ot()),w("addWalletForm").addEventListener("submit",async i=>{i.preventDefault(),await pb()}),w("addWalletBtn")?.addEventListener("click",()=>Bt(ve)),w("saveSupabase")?.addEventListener("click",()=>{const i=w("supabaseUrl").value.trim(),n=w("supabaseKey").value.trim();i&&n&&(bl(i,n)?(Pt({supabaseConnected:!0}),U(" Supabase conectado"),Ot()):U(" Error de conexin"))}),w("exportCSV")?.addEventListener("click",bb),w("qaExpense")?.addEventListener("click",()=>{Kt(),document.querySelectorAll(".type-btn").forEach(i=>i.classList.remove("active")),document.querySelector('.type-btn[data-type="expense"]')?.classList.add("active"),Kt(),Bt(xt),w("entryAmount").focus()}),w("qaIncome")?.addEventListener("click",()=>{document.querySelectorAll(".type-btn").forEach(i=>i.classList.remove("active")),document.querySelector('.type-btn[data-type="income"]')?.classList.add("active"),Kt(),Bt(xt),w("entryAmount").focus()}),w("qaTransactions")?.addEventListener("click",()=>{Qs("pageTransactions")})}function Qo(s,t,e=[]){const i=B(),n=Yn(s,t,i.userRules||[],e);n.category&&(Qt.querySelectorAll(".category-chip").forEach(r=>{r.classList.toggle("active",r.dataset.category===n.category)}),n.isFallback&&U(' Categora no detectada, asignando "Por Clasificar"'),n.walletId&&(n.walletId,i.activeWalletId))}function db(s){const e=B().transactions.find(c=>c.id===s);if(!e)return;At=e,w("entryAmount").value=Math.abs(e.amount),w("entryDescription").value=e.description||"",w("entryAccount").value=e.account||"",w("entryDate").value=e.date,w("entryNotes").value=e.notes||"",w("entryFixed").checked=!!e.is_fixed;const i=e.categories?.name||e.category_name||"";Kt();const n=Qt.querySelector(`.category-chip[data-category="${i}"]`);n&&(Qt.querySelectorAll(".category-chip").forEach(c=>c.classList.remove("active")),n.classList.add("active")),document.querySelectorAll(".type-btn").forEach(c=>{c.classList.toggle("active",c.dataset.type===e.type)});const r=w("moveTransactionBtn");r&&r.remove();const o=document.createElement("button");o.type="button",o.className="secondary-btn full-width mt-4",o.id="moveTransactionBtn",o.innerText="Mover a otra cartera",o.onclick=()=>moveTransaction(At),w("quickEntryForm").appendChild(o);const a=xt.querySelector(".modal-header h2"),l=w("submitEntry").querySelector(".btn-text");a&&(a.textContent="Editar Registro"),l&&(l.textContent="Actualizar"),Bt(xt)}async function fb(){const s=B(),t=document.querySelector(".type-btn.active")?.dataset.type||"expense",e=parseFloat(w("entryAmount").value),i=w("entryDescription").value.trim(),n=Qt.querySelector(".category-chip.active"),r=n?.dataset.category||"",o=n?.dataset.icon||"",a=w("entryAccount").value,l=w("entryDate").value,c=w("entryNotes").value.trim();if(!e||e<=0){U("Ingresa un monto vlido");return}const h=w("submitEntry");h.querySelector(".btn-text").classList.add("hidden");const d=(s.categories[s.activeWalletId]||[]).find(f=>f.name===r);if(At){const f={type:t,amount:e,description:i||r,date:l||new Date().toISOString().split("T")[0],account:a,notes:c,is_fixed:w("entryFixed")?.checked||!1};if(d?.id&&(f.category_id=d.id),st()){const p=await Sl(At.id,f);p?(s.transactions=s.transactions.map(g=>g.id===At.id?p:g),pt(),U(" Transaccin actualizada")):(s.transactions=s.transactions.map(g=>g.id===At.id?{...g,...f,category_name:r,category_icon:o}:g),pt(),U(" Actualizado localmente"))}else s.transactions=s.transactions.map(p=>p.id===At.id?{...p,...f,category_name:r,category_icon:o}:p),pt(),U(" Transaccin actualizada")}else{const f={wallet_id:s.activeWalletId,type:t,amount:e,description:i||r,date:l||new Date().toISOString().split("T")[0],account:a,notes:c,is_fixed:w("entryFixed")?.checked||!1,created_at:new Date().toISOString()};d?.id&&(f.category_id=d.id);const p=qm(f,Ei(s.activeWalletId),s.userRules||[],s.transactions||[]);if(Object.assign(f,p),st()){const{created_at:g,category_name:m,category_icon:b,...y}=f,_=await xl(y);if(_)s.transactions=[_,...s.transactions],pt(),U(`${t==="income"?"":""} ${at(e)} registrado`);else{f.id=crypto.randomUUID(),f.category_name=r,f.category_icon=o;const v=[f,...s.transactions];Pt({transactions:v}),U(" Guardado localmente (error Supabase)")}}else{f.id=crypto.randomUUID(),f.category_name=r,f.category_icon=o;const g=[f,...s.transactions];Pt({transactions:g}),U(`${t==="income"?"":""} ${at(e)} registrado`)}}Rl(),ot(xt),h.querySelector(".btn-text").classList.remove("hidden"),h.querySelector(".btn-loading").classList.add("hidden"),h.disabled=!1,Ot()}async function gb(s){const t=B(),e=t.transactions.find(r=>r.id===s);if(!e)return;const i=e.description||e.categories?.name||"esta transaccin",n=at(e.amount);if(confirm(`Eliminar "${i}" (${e.type==="expense"?"-":"+"}${n})?`)){if(st())if(await kl(s))t.transactions=t.transactions.filter(o=>o.id!==s),pt(),U(" Transaccin eliminada");else{U(" Error al eliminar en Supabase");return}else t.transactions=t.transactions.filter(r=>r.id!==s),pt(),U(" Transaccin eliminada");Ot()}}async function pb(){const s=w("walletName").value.trim(),t=w("walletEmoji").value.trim()||"",e=w("walletType").value,i=parseFloat(w("walletBudget").value)||0;if(!s){U("Ingresa un nombre");return}const n={name:s,emoji:t,wallet_type:e,monthly_budget:i,color:"#C8B560"};if(st()){if(await _l(n)){const o=await Jn();o&&Pt({wallets:o.wallets.map(a=>({id:a.id,name:a.name,emoji:a.emoji,color:a.color,wallet_type:a.wallet_type,monthly_budget:Number(a.monthly_budget)||0})),categories:Object.fromEntries(Object.entries(o.categories).map(([a,l])=>[a,l.map(c=>({id:c.id,name:c.name,icon:c.icon,type:c.type}))]))})}}else{n.id=s.toLowerCase().replace(/\s+/g,"-");const r=B();Pt({wallets:[...r.wallets,n],categories:{...r.categories,[n.id]:e==="business"?[{name:"Ingresos",icon:"",type:"income"},{name:"Gastos",icon:"",type:"expense"}]:[{name:"General",icon:"",type:"expense"},{name:"Ingreso",icon:"",type:"income"}]}})}w("addWalletForm").reset(),ot(ve),U(`${t} ${s} creada`)}async function mb(){const s=B(),t={id:crypto.randomUUID(),wallet_id:s.activeWalletId,name:w("goalName").value.trim(),target_amount:parseFloat(w("goalTarget").value)||0,current_amount:0,category_type:w("goalType")?.value||"Ahorro",deadline:w("goalDeadline").value||null,status:"active",icon:w("goalIcon").value||"",created_at:new Date().toISOString()};if(!t.name||!t.target_amount){U("Completa nombre y monto");return}if(Pt({goals:[...s.goals,t]}),st()){const{createGoal:e}=await te(async()=>{const{createGoal:r}=await Promise.resolve().then(()=>ie);return{createGoal:r}},void 0),{id:i,...n}=t;await e(n)}w("addGoalForm").reset(),ot(Fe),U(" Meta creada"),Zn()}function bb(){const s=B(),t=Qa(),e=s.transactions.filter(c=>c.wallet_id===t.id);if(e.length===0){U("No hay datos para exportar");return}const i=["Fecha","Tipo","Categora","Descripcin","Monto","Cuenta","Notas"],n=e.map(c=>[c.date,c.type==="income"?"Ingreso":"Gasto",c.category_name||"",c.description||"",c.amount,c.account||"",c.notes||""]),r=[i,...n].map(c=>c.map(h=>`"${h}"`).join(",")).join(`
`),o=new Blob(["\uFEFF"+r],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(o),l=document.createElement("a");l.href=a,l.download=`fg_${t.name}_${s.currentMonth}.csv`,l.click(),URL.revokeObjectURL(a),U(" CSV exportado")}function yb(){let s=0,t=0;const e=50,i=30;document.addEventListener("touchstart",n=>{s=n.changedTouches[0].screenX,t=n.changedTouches[0].screenY},{passive:!0}),document.addEventListener("touchend",n=>{const r=n.changedTouches[0].screenX,o=n.changedTouches[0].screenY,a=r-s,l=o-t;if(Math.abs(a)>e&&Math.abs(l)<i){if(!document.getElementById("pageDashboard").classList.contains("active"))return;a>0?mi(-1):mi(1)}},{passive:!0})}window.fgDebug={getState:B,setState:Pt,renderSettings:Pi,refreshData:Ot,init:Al};console.log("Main.js executing...");Al();yb();
