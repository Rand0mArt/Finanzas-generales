(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();function ks(s){return s+.5|0}const Wt=(s,t,e)=>Math.max(Math.min(s,e),t);function Qe(s){return Wt(ks(s*2.55),0,255)}function Kt(s){return Wt(ks(s*255),0,255)}function Dt(s){return Wt(ks(s/2.55)/100,0,1)}function Un(s){return Wt(ks(s*100),0,100)}const bt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Ki=[..."0123456789ABCDEF"],gl=s=>Ki[s&15],pl=s=>Ki[(s&240)>>4]+Ki[s&15],Os=s=>(s&240)>>4===(s&15),ml=s=>Os(s.r)&&Os(s.g)&&Os(s.b)&&Os(s.a);function bl(s){var t=s.length,e;return s[0]==="#"&&(t===4||t===5?e={r:255&bt[s[1]]*17,g:255&bt[s[2]]*17,b:255&bt[s[3]]*17,a:t===5?bt[s[4]]*17:255}:(t===7||t===9)&&(e={r:bt[s[1]]<<4|bt[s[2]],g:bt[s[3]]<<4|bt[s[4]],b:bt[s[5]]<<4|bt[s[6]],a:t===9?bt[s[7]]<<4|bt[s[8]]:255})),e}const yl=(s,t)=>s<255?t(s):"";function _l(s){var t=ml(s)?gl:pl;return s?"#"+t(s.r)+t(s.g)+t(s.b)+yl(s.a,t):void 0}const vl=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Uo(s,t,e){const i=t*Math.min(e,1-e),n=(r,o=(r+s/30)%12)=>e-i*Math.max(Math.min(o-3,9-o,1),-1);return[n(0),n(8),n(4)]}function wl(s,t,e){const i=(n,r=(n+s/60)%6)=>e-e*t*Math.max(Math.min(r,4-r,1),0);return[i(5),i(3),i(1)]}function xl(s,t,e){const i=Uo(s,1,.5);let n;for(t+e>1&&(n=1/(t+e),t*=n,e*=n),n=0;n<3;n++)i[n]*=1-t-e,i[n]+=t;return i}function Sl(s,t,e,i,n){return s===n?(t-e)/i+(t<e?6:0):t===n?(e-s)/i+2:(s-t)/i+4}function bn(s){const e=s.r/255,i=s.g/255,n=s.b/255,r=Math.max(e,i,n),o=Math.min(e,i,n),a=(r+o)/2;let l,c,h;return r!==o&&(h=r-o,c=a>.5?h/(2-r-o):h/(r+o),l=Sl(e,i,n,h,r),l=l*60+.5),[l|0,c||0,a]}function yn(s,t,e,i){return(Array.isArray(t)?s(t[0],t[1],t[2]):s(t,e,i)).map(Kt)}function _n(s,t,e){return yn(Uo,s,t,e)}function kl(s,t,e){return yn(xl,s,t,e)}function El(s,t,e){return yn(wl,s,t,e)}function zo(s){return(s%360+360)%360}function Tl(s){const t=vl.exec(s);let e=255,i;if(!t)return;t[5]!==i&&(e=t[6]?Qe(+t[5]):Kt(+t[5]));const n=zo(+t[2]),r=+t[3]/100,o=+t[4]/100;return t[1]==="hwb"?i=kl(n,r,o):t[1]==="hsv"?i=El(n,r,o):i=_n(n,r,o),{r:i[0],g:i[1],b:i[2],a:e}}function Al(s,t){var e=bn(s);e[0]=zo(e[0]+t),e=_n(e),s.r=e[0],s.g=e[1],s.b=e[2]}function Ol(s){if(!s)return;const t=bn(s),e=t[0],i=Un(t[1]),n=Un(t[2]);return s.a<255?`hsla(${e}, ${i}%, ${n}%, ${Dt(s.a)})`:`hsl(${e}, ${i}%, ${n}%)`}const zn={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Wn={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Cl(){const s={},t=Object.keys(Wn),e=Object.keys(zn);let i,n,r,o,a;for(i=0;i<t.length;i++){for(o=a=t[i],n=0;n<e.length;n++)r=e[n],a=a.replace(r,zn[r]);r=parseInt(Wn[o],16),s[a]=[r>>16&255,r>>8&255,r&255]}return s}let Cs;function Pl(s){Cs||(Cs=Cl(),Cs.transparent=[0,0,0,0]);const t=Cs[s.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const Rl=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Ml(s){const t=Rl.exec(s);let e=255,i,n,r;if(t){if(t[7]!==i){const o=+t[7];e=t[8]?Qe(o):Wt(o*255,0,255)}return i=+t[1],n=+t[3],r=+t[5],i=255&(t[2]?Qe(i):Wt(i,0,255)),n=255&(t[4]?Qe(n):Wt(n,0,255)),r=255&(t[6]?Qe(r):Wt(r,0,255)),{r:i,g:n,b:r,a:e}}}function Dl(s){return s&&(s.a<255?`rgba(${s.r}, ${s.g}, ${s.b}, ${Dt(s.a)})`:`rgb(${s.r}, ${s.g}, ${s.b})`)}const wi=s=>s<=.0031308?s*12.92:Math.pow(s,1/2.4)*1.055-.055,Se=s=>s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4);function Il(s,t,e){const i=Se(Dt(s.r)),n=Se(Dt(s.g)),r=Se(Dt(s.b));return{r:Kt(wi(i+e*(Se(Dt(t.r))-i))),g:Kt(wi(n+e*(Se(Dt(t.g))-n))),b:Kt(wi(r+e*(Se(Dt(t.b))-r))),a:s.a+e*(t.a-s.a)}}function Ps(s,t,e){if(s){let i=bn(s);i[t]=Math.max(0,Math.min(i[t]+i[t]*e,t===0?360:1)),i=_n(i),s.r=i[0],s.g=i[1],s.b=i[2]}}function Wo(s,t){return s&&Object.assign(t||{},s)}function Vn(s){var t={r:0,g:0,b:0,a:255};return Array.isArray(s)?s.length>=3&&(t={r:s[0],g:s[1],b:s[2],a:255},s.length>3&&(t.a=Kt(s[3]))):(t=Wo(s,{r:0,g:0,b:0,a:1}),t.a=Kt(t.a)),t}function Ll(s){return s.charAt(0)==="r"?Ml(s):Tl(s)}class hs{constructor(t){if(t instanceof hs)return t;const e=typeof t;let i;e==="object"?i=Vn(t):e==="string"&&(i=bl(t)||Pl(t)||Ll(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=Wo(this._rgb);return t&&(t.a=Dt(t.a)),t}set rgb(t){this._rgb=Vn(t)}rgbString(){return this._valid?Dl(this._rgb):void 0}hexString(){return this._valid?_l(this._rgb):void 0}hslString(){return this._valid?Ol(this._rgb):void 0}mix(t,e){if(t){const i=this.rgb,n=t.rgb;let r;const o=e===r?.5:e,a=2*o-1,l=i.a-n.a,c=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;r=1-c,i.r=255&c*i.r+r*n.r+.5,i.g=255&c*i.g+r*n.g+.5,i.b=255&c*i.b+r*n.b+.5,i.a=o*i.a+(1-o)*n.a,this.rgb=i}return this}interpolate(t,e){return t&&(this._rgb=Il(this._rgb,t._rgb,e)),this}clone(){return new hs(this.rgb)}alpha(t){return this._rgb.a=Kt(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=ks(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Ps(this._rgb,2,t),this}darken(t){return Ps(this._rgb,2,-t),this}saturate(t){return Ps(this._rgb,1,t),this}desaturate(t){return Ps(this._rgb,1,-t),this}rotate(t){return Al(this._rgb,t),this}}function Ot(){}const jl=(()=>{let s=0;return()=>s++})();function D(s){return s==null}function W(s){if(Array.isArray&&Array.isArray(s))return!0;const t=Object.prototype.toString.call(s);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function I(s){return s!==null&&Object.prototype.toString.call(s)==="[object Object]"}function q(s){return(typeof s=="number"||s instanceof Number)&&isFinite(+s)}function pt(s,t){return q(s)?s:t}function P(s,t){return typeof s>"u"?t:s}const $l=(s,t)=>typeof s=="string"&&s.endsWith("%")?parseFloat(s)/100:+s/t,Vo=(s,t)=>typeof s=="string"&&s.endsWith("%")?parseFloat(s)/100*t:+s;function F(s,t,e){if(s&&typeof s.call=="function")return s.apply(e,t)}function $(s,t,e,i){let n,r,o;if(W(s))for(r=s.length,n=0;n<r;n++)t.call(e,s[n],n);else if(I(s))for(o=Object.keys(s),r=o.length,n=0;n<r;n++)t.call(e,s[o[n]],o[n])}function Zs(s,t){let e,i,n,r;if(!s||!t||s.length!==t.length)return!1;for(e=0,i=s.length;e<i;++e)if(n=s[e],r=t[e],n.datasetIndex!==r.datasetIndex||n.index!==r.index)return!1;return!0}function Qs(s){if(W(s))return s.map(Qs);if(I(s)){const t=Object.create(null),e=Object.keys(s),i=e.length;let n=0;for(;n<i;++n)t[e[n]]=Qs(s[e[n]]);return t}return s}function Ho(s){return["__proto__","prototype","constructor"].indexOf(s)===-1}function Nl(s,t,e,i){if(!Ho(s))return;const n=t[s],r=e[s];I(n)&&I(r)?us(n,r,i):t[s]=Qs(r)}function us(s,t,e){const i=W(t)?t:[t],n=i.length;if(!I(s))return s;e=e||{};const r=e.merger||Nl;let o;for(let a=0;a<n;++a){if(o=i[a],!I(o))continue;const l=Object.keys(o);for(let c=0,h=l.length;c<h;++c)r(l[c],s,o,e)}return s}function ns(s,t){return us(s,t,{merger:Bl})}function Bl(s,t,e){if(!Ho(s))return;const i=t[s],n=e[s];I(i)&&I(n)?ns(i,n):Object.prototype.hasOwnProperty.call(t,s)||(t[s]=Qs(n))}const Hn={"":s=>s,x:s=>s.x,y:s=>s.y};function Fl(s){const t=s.split("."),e=[];let i="";for(const n of t)i+=n,i.endsWith("\\")?i=i.slice(0,-1)+".":(e.push(i),i="");return e}function Ul(s){const t=Fl(s);return e=>{for(const i of t){if(i==="")break;e=e&&e[i]}return e}}function Jt(s,t){return(Hn[t]||(Hn[t]=Ul(t)))(s)}function vn(s){return s.charAt(0).toUpperCase()+s.slice(1)}const ds=s=>typeof s<"u",Yt=s=>typeof s=="function",qn=(s,t)=>{if(s.size!==t.size)return!1;for(const e of s)if(!t.has(e))return!1;return!0};function zl(s){return s.type==="mouseup"||s.type==="click"||s.type==="contextmenu"}const j=Math.PI,U=2*j,Wl=U+j,ti=Number.POSITIVE_INFINITY,Vl=j/180,G=j/2,ee=j/4,Kn=j*2/3,Vt=Math.log10,Tt=Math.sign;function rs(s,t,e){return Math.abs(s-t)<e}function Gn(s){const t=Math.round(s);s=rs(s,t,s/1e3)?t:s;const e=Math.pow(10,Math.floor(Vt(s))),i=s/e;return(i<=1?1:i<=2?2:i<=5?5:10)*e}function Hl(s){const t=[],e=Math.sqrt(s);let i;for(i=1;i<e;i++)s%i===0&&(t.push(i),t.push(s/i));return e===(e|0)&&t.push(e),t.sort((n,r)=>n-r).pop(),t}function ql(s){return typeof s=="symbol"||typeof s=="object"&&s!==null&&!(Symbol.toPrimitive in s||"toString"in s||"valueOf"in s)}function Fe(s){return!ql(s)&&!isNaN(parseFloat(s))&&isFinite(s)}function Kl(s,t){const e=Math.round(s);return e-t<=s&&e+t>=s}function qo(s,t,e){let i,n,r;for(i=0,n=s.length;i<n;i++)r=s[i][e],isNaN(r)||(t.min=Math.min(t.min,r),t.max=Math.max(t.max,r))}function St(s){return s*(j/180)}function wn(s){return s*(180/j)}function Jn(s){if(!q(s))return;let t=1,e=0;for(;Math.round(s*t)/t!==s;)t*=10,e++;return e}function Ko(s,t){const e=t.x-s.x,i=t.y-s.y,n=Math.sqrt(e*e+i*i);let r=Math.atan2(i,e);return r<-.5*j&&(r+=U),{angle:r,distance:n}}function Gi(s,t){return Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2))}function Gl(s,t){return(s-t+Wl)%U-j}function ot(s){return(s%U+U)%U}function fs(s,t,e,i){const n=ot(s),r=ot(t),o=ot(e),a=ot(r-n),l=ot(o-n),c=ot(n-r),h=ot(n-o);return n===r||n===o||i&&r===o||a>l&&c<h}function Q(s,t,e){return Math.max(t,Math.min(e,s))}function Jl(s){return Q(s,-32768,32767)}function Lt(s,t,e,i=1e-6){return s>=Math.min(t,e)-i&&s<=Math.max(t,e)+i}function xn(s,t,e){e=e||(o=>s[o]<t);let i=s.length-1,n=0,r;for(;i-n>1;)r=n+i>>1,e(r)?n=r:i=r;return{lo:n,hi:i}}const jt=(s,t,e,i)=>xn(s,e,i?n=>{const r=s[n][t];return r<e||r===e&&s[n+1][t]===e}:n=>s[n][t]<e),Yl=(s,t,e)=>xn(s,e,i=>s[i][t]>=e);function Xl(s,t,e){let i=0,n=s.length;for(;i<n&&s[i]<t;)i++;for(;n>i&&s[n-1]>e;)n--;return i>0||n<s.length?s.slice(i,n):s}const Go=["push","pop","shift","splice","unshift"];function Zl(s,t){if(s._chartjs){s._chartjs.listeners.push(t);return}Object.defineProperty(s,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),Go.forEach(e=>{const i="_onData"+vn(e),n=s[e];Object.defineProperty(s,e,{configurable:!0,enumerable:!1,value(...r){const o=n.apply(this,r);return s._chartjs.listeners.forEach(a=>{typeof a[i]=="function"&&a[i](...r)}),o}})})}function Yn(s,t){const e=s._chartjs;if(!e)return;const i=e.listeners,n=i.indexOf(t);n!==-1&&i.splice(n,1),!(i.length>0)&&(Go.forEach(r=>{delete s[r]}),delete s._chartjs)}function Jo(s){const t=new Set(s);return t.size===s.length?s:Array.from(t)}const Yo=(function(){return typeof window>"u"?function(s){return s()}:window.requestAnimationFrame})();function Xo(s,t){let e=[],i=!1;return function(...n){e=n,i||(i=!0,Yo.call(window,()=>{i=!1,s.apply(t,e)}))}}function Ql(s,t){let e;return function(...i){return t?(clearTimeout(e),e=setTimeout(s,t,i)):s.apply(this,i),t}}const Sn=s=>s==="start"?"left":s==="end"?"right":"center",rt=(s,t,e)=>s==="start"?t:s==="end"?e:(t+e)/2,tc=(s,t,e,i)=>s===(i?"left":"right")?e:s==="center"?(t+e)/2:t;function Zo(s,t,e){const i=t.length;let n=0,r=i;if(s._sorted){const{iScale:o,vScale:a,_parsed:l}=s,c=s.dataset&&s.dataset.options?s.dataset.options.spanGaps:null,h=o.axis,{min:u,max:d,minDefined:f,maxDefined:g}=o.getUserBounds();if(f){if(n=Math.min(jt(l,h,u).lo,e?i:jt(t,h,o.getPixelForValue(u)).lo),c){const p=l.slice(0,n+1).reverse().findIndex(m=>!D(m[a.axis]));n-=Math.max(0,p)}n=Q(n,0,i-1)}if(g){let p=Math.max(jt(l,o.axis,d,!0).hi+1,e?0:jt(t,h,o.getPixelForValue(d),!0).hi+1);if(c){const m=l.slice(p-1).findIndex(b=>!D(b[a.axis]));p+=Math.max(0,m)}r=Q(p,n,i)-n}else r=i-n}return{start:n,count:r}}function Qo(s){const{xScale:t,yScale:e,_scaleRanges:i}=s,n={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!i)return s._scaleRanges=n,!0;const r=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==e.min||i.ymax!==e.max;return Object.assign(i,n),r}const Rs=s=>s===0||s===1,Xn=(s,t,e)=>-(Math.pow(2,10*(s-=1))*Math.sin((s-t)*U/e)),Zn=(s,t,e)=>Math.pow(2,-10*s)*Math.sin((s-t)*U/e)+1,os={linear:s=>s,easeInQuad:s=>s*s,easeOutQuad:s=>-s*(s-2),easeInOutQuad:s=>(s/=.5)<1?.5*s*s:-.5*(--s*(s-2)-1),easeInCubic:s=>s*s*s,easeOutCubic:s=>(s-=1)*s*s+1,easeInOutCubic:s=>(s/=.5)<1?.5*s*s*s:.5*((s-=2)*s*s+2),easeInQuart:s=>s*s*s*s,easeOutQuart:s=>-((s-=1)*s*s*s-1),easeInOutQuart:s=>(s/=.5)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2),easeInQuint:s=>s*s*s*s*s,easeOutQuint:s=>(s-=1)*s*s*s*s+1,easeInOutQuint:s=>(s/=.5)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2),easeInSine:s=>-Math.cos(s*G)+1,easeOutSine:s=>Math.sin(s*G),easeInOutSine:s=>-.5*(Math.cos(j*s)-1),easeInExpo:s=>s===0?0:Math.pow(2,10*(s-1)),easeOutExpo:s=>s===1?1:-Math.pow(2,-10*s)+1,easeInOutExpo:s=>Rs(s)?s:s<.5?.5*Math.pow(2,10*(s*2-1)):.5*(-Math.pow(2,-10*(s*2-1))+2),easeInCirc:s=>s>=1?s:-(Math.sqrt(1-s*s)-1),easeOutCirc:s=>Math.sqrt(1-(s-=1)*s),easeInOutCirc:s=>(s/=.5)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1),easeInElastic:s=>Rs(s)?s:Xn(s,.075,.3),easeOutElastic:s=>Rs(s)?s:Zn(s,.075,.3),easeInOutElastic(s){return Rs(s)?s:s<.5?.5*Xn(s*2,.1125,.45):.5+.5*Zn(s*2-1,.1125,.45)},easeInBack(s){return s*s*((1.70158+1)*s-1.70158)},easeOutBack(s){return(s-=1)*s*((1.70158+1)*s+1.70158)+1},easeInOutBack(s){let t=1.70158;return(s/=.5)<1?.5*(s*s*(((t*=1.525)+1)*s-t)):.5*((s-=2)*s*(((t*=1.525)+1)*s+t)+2)},easeInBounce:s=>1-os.easeOutBounce(1-s),easeOutBounce(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},easeInOutBounce:s=>s<.5?os.easeInBounce(s*2)*.5:os.easeOutBounce(s*2-1)*.5+.5};function kn(s){if(s&&typeof s=="object"){const t=s.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function Qn(s){return kn(s)?s:new hs(s)}function xi(s){return kn(s)?s:new hs(s).saturate(.5).darken(.1).hexString()}const ec=["x","y","borderWidth","radius","tension"],sc=["color","borderColor","backgroundColor"];function ic(s){s.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),s.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),s.set("animations",{colors:{type:"color",properties:sc},numbers:{type:"number",properties:ec}}),s.describe("animations",{_fallback:"animation"}),s.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function nc(s){s.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const tr=new Map;function rc(s,t){t=t||{};const e=s+JSON.stringify(t);let i=tr.get(e);return i||(i=new Intl.NumberFormat(s,t),tr.set(e,i)),i}function Es(s,t,e){return rc(t,e).format(s)}const ta={values(s){return W(s)?s:""+s},numeric(s,t,e){if(s===0)return"0";const i=this.chart.options.locale;let n,r=s;if(e.length>1){const c=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(c<1e-4||c>1e15)&&(n="scientific"),r=oc(s,e)}const o=Vt(Math.abs(r)),a=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:n,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),Es(s,i,l)},logarithmic(s,t,e){if(s===0)return"0";const i=e[t].significand||s/Math.pow(10,Math.floor(Vt(s)));return[1,2,3,5,10,15].includes(i)||t>.8*e.length?ta.numeric.call(this,s,t,e):""}};function oc(s,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&s!==Math.floor(s)&&(e=s-Math.floor(s)),e}var ci={formatters:ta};function ac(s){s.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:ci.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),s.route("scale.ticks","color","","color"),s.route("scale.grid","color","","borderColor"),s.route("scale.border","color","","borderColor"),s.route("scale.title","color","","color"),s.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),s.describe("scales",{_fallback:"scale"}),s.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const be=Object.create(null),Ji=Object.create(null);function as(s,t){if(!t)return s;const e=t.split(".");for(let i=0,n=e.length;i<n;++i){const r=e[i];s=s[r]||(s[r]=Object.create(null))}return s}function Si(s,t,e){return typeof t=="string"?us(as(s,t),e):us(as(s,""),t)}class lc{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,n)=>xi(n.backgroundColor),this.hoverBorderColor=(i,n)=>xi(n.borderColor),this.hoverColor=(i,n)=>xi(n.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return Si(this,t,e)}get(t){return as(this,t)}describe(t,e){return Si(Ji,t,e)}override(t,e){return Si(be,t,e)}route(t,e,i,n){const r=as(this,t),o=as(this,i),a="_"+e;Object.defineProperties(r,{[a]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const l=this[a],c=o[n];return I(l)?Object.assign({},c,l):P(l,c)},set(l){this[a]=l}}})}apply(t){t.forEach(e=>e(this))}}var V=new lc({_scriptable:s=>!s.startsWith("on"),_indexable:s=>s!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[ic,nc,ac]);function cc(s){return!s||D(s.size)||D(s.family)?null:(s.style?s.style+" ":"")+(s.weight?s.weight+" ":"")+s.size+"px "+s.family}function ei(s,t,e,i,n){let r=t[n];return r||(r=t[n]=s.measureText(n).width,e.push(n)),r>i&&(i=r),i}function hc(s,t,e,i){i=i||{};let n=i.data=i.data||{},r=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(n=i.data={},r=i.garbageCollect=[],i.font=t),s.save(),s.font=t;let o=0;const a=e.length;let l,c,h,u,d;for(l=0;l<a;l++)if(u=e[l],u!=null&&!W(u))o=ei(s,n,r,o,u);else if(W(u))for(c=0,h=u.length;c<h;c++)d=u[c],d!=null&&!W(d)&&(o=ei(s,n,r,o,d));s.restore();const f=r.length/2;if(f>e.length){for(l=0;l<f;l++)delete n[r[l]];r.splice(0,f)}return o}function se(s,t,e){const i=s.currentDevicePixelRatio,n=e!==0?Math.max(e/2,.5):0;return Math.round((t-n)*i)/i+n}function er(s,t){!t&&!s||(t=t||s.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,s.width,s.height),t.restore())}function Yi(s,t,e,i){ea(s,t,e,i,null)}function ea(s,t,e,i,n){let r,o,a,l,c,h,u,d;const f=t.pointStyle,g=t.rotation,p=t.radius;let m=(g||0)*Vl;if(f&&typeof f=="object"&&(r=f.toString(),r==="[object HTMLImageElement]"||r==="[object HTMLCanvasElement]")){s.save(),s.translate(e,i),s.rotate(m),s.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),s.restore();return}if(!(isNaN(p)||p<=0)){switch(s.beginPath(),f){default:n?s.ellipse(e,i,n/2,p,0,0,U):s.arc(e,i,p,0,U),s.closePath();break;case"triangle":h=n?n/2:p,s.moveTo(e+Math.sin(m)*h,i-Math.cos(m)*p),m+=Kn,s.lineTo(e+Math.sin(m)*h,i-Math.cos(m)*p),m+=Kn,s.lineTo(e+Math.sin(m)*h,i-Math.cos(m)*p),s.closePath();break;case"rectRounded":c=p*.516,l=p-c,o=Math.cos(m+ee)*l,u=Math.cos(m+ee)*(n?n/2-c:l),a=Math.sin(m+ee)*l,d=Math.sin(m+ee)*(n?n/2-c:l),s.arc(e-u,i-a,c,m-j,m-G),s.arc(e+d,i-o,c,m-G,m),s.arc(e+u,i+a,c,m,m+G),s.arc(e-d,i+o,c,m+G,m+j),s.closePath();break;case"rect":if(!g){l=Math.SQRT1_2*p,h=n?n/2:l,s.rect(e-h,i-l,2*h,2*l);break}m+=ee;case"rectRot":u=Math.cos(m)*(n?n/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,d=Math.sin(m)*(n?n/2:p),s.moveTo(e-u,i-a),s.lineTo(e+d,i-o),s.lineTo(e+u,i+a),s.lineTo(e-d,i+o),s.closePath();break;case"crossRot":m+=ee;case"cross":u=Math.cos(m)*(n?n/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,d=Math.sin(m)*(n?n/2:p),s.moveTo(e-u,i-a),s.lineTo(e+u,i+a),s.moveTo(e+d,i-o),s.lineTo(e-d,i+o);break;case"star":u=Math.cos(m)*(n?n/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,d=Math.sin(m)*(n?n/2:p),s.moveTo(e-u,i-a),s.lineTo(e+u,i+a),s.moveTo(e+d,i-o),s.lineTo(e-d,i+o),m+=ee,u=Math.cos(m)*(n?n/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,d=Math.sin(m)*(n?n/2:p),s.moveTo(e-u,i-a),s.lineTo(e+u,i+a),s.moveTo(e+d,i-o),s.lineTo(e-d,i+o);break;case"line":o=n?n/2:Math.cos(m)*p,a=Math.sin(m)*p,s.moveTo(e-o,i-a),s.lineTo(e+o,i+a);break;case"dash":s.moveTo(e,i),s.lineTo(e+Math.cos(m)*(n?n/2:p),i+Math.sin(m)*p);break;case!1:s.closePath();break}s.fill(),t.borderWidth>0&&s.stroke()}}function $t(s,t,e){return e=e||.5,!t||s&&s.x>t.left-e&&s.x<t.right+e&&s.y>t.top-e&&s.y<t.bottom+e}function hi(s,t){s.save(),s.beginPath(),s.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),s.clip()}function ui(s){s.restore()}function uc(s,t,e,i,n){if(!t)return s.lineTo(e.x,e.y);if(n==="middle"){const r=(t.x+e.x)/2;s.lineTo(r,t.y),s.lineTo(r,e.y)}else n==="after"!=!!i?s.lineTo(t.x,e.y):s.lineTo(e.x,t.y);s.lineTo(e.x,e.y)}function dc(s,t,e,i){if(!t)return s.lineTo(e.x,e.y);s.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?e.cp2x:e.cp1x,i?e.cp2y:e.cp1y,e.x,e.y)}function fc(s,t){t.translation&&s.translate(t.translation[0],t.translation[1]),D(t.rotation)||s.rotate(t.rotation),t.color&&(s.fillStyle=t.color),t.textAlign&&(s.textAlign=t.textAlign),t.textBaseline&&(s.textBaseline=t.textBaseline)}function gc(s,t,e,i,n){if(n.strikethrough||n.underline){const r=s.measureText(i),o=t-r.actualBoundingBoxLeft,a=t+r.actualBoundingBoxRight,l=e-r.actualBoundingBoxAscent,c=e+r.actualBoundingBoxDescent,h=n.strikethrough?(l+c)/2:c;s.strokeStyle=s.fillStyle,s.beginPath(),s.lineWidth=n.decorationWidth||2,s.moveTo(o,h),s.lineTo(a,h),s.stroke()}}function pc(s,t){const e=s.fillStyle;s.fillStyle=t.color,s.fillRect(t.left,t.top,t.width,t.height),s.fillStyle=e}function ye(s,t,e,i,n,r={}){const o=W(t)?t:[t],a=r.strokeWidth>0&&r.strokeColor!=="";let l,c;for(s.save(),s.font=n.string,fc(s,r),l=0;l<o.length;++l)c=o[l],r.backdrop&&pc(s,r.backdrop),a&&(r.strokeColor&&(s.strokeStyle=r.strokeColor),D(r.strokeWidth)||(s.lineWidth=r.strokeWidth),s.strokeText(c,e,i,r.maxWidth)),s.fillText(c,e,i,r.maxWidth),gc(s,e,i,c,r),i+=Number(n.lineHeight);s.restore()}function gs(s,t){const{x:e,y:i,w:n,h:r,radius:o}=t;s.arc(e+o.topLeft,i+o.topLeft,o.topLeft,1.5*j,j,!0),s.lineTo(e,i+r-o.bottomLeft),s.arc(e+o.bottomLeft,i+r-o.bottomLeft,o.bottomLeft,j,G,!0),s.lineTo(e+n-o.bottomRight,i+r),s.arc(e+n-o.bottomRight,i+r-o.bottomRight,o.bottomRight,G,0,!0),s.lineTo(e+n,i+o.topRight),s.arc(e+n-o.topRight,i+o.topRight,o.topRight,0,-G,!0),s.lineTo(e+o.topLeft,i)}const mc=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,bc=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function yc(s,t){const e=(""+s).match(mc);if(!e||e[1]==="normal")return t*1.2;switch(s=+e[2],e[3]){case"px":return s;case"%":s/=100;break}return t*s}const _c=s=>+s||0;function En(s,t){const e={},i=I(t),n=i?Object.keys(t):t,r=I(s)?i?o=>P(s[o],s[t[o]]):o=>s[o]:()=>s;for(const o of n)e[o]=_c(r(o));return e}function sa(s){return En(s,{top:"y",right:"x",bottom:"y",left:"x"})}function ge(s){return En(s,["topLeft","topRight","bottomLeft","bottomRight"])}function lt(s){const t=sa(s);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function X(s,t){s=s||{},t=t||V.font;let e=P(s.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let i=P(s.style,t.style);i&&!(""+i).match(bc)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const n={family:P(s.family,t.family),lineHeight:yc(P(s.lineHeight,t.lineHeight),e),size:e,style:i,weight:P(s.weight,t.weight),string:""};return n.string=cc(n),n}function ts(s,t,e,i){let n,r,o;for(n=0,r=s.length;n<r;++n)if(o=s[n],o!==void 0&&o!==void 0)return o}function vc(s,t,e){const{min:i,max:n}=s,r=Vo(t,(n-i)/2),o=(a,l)=>e&&a===0?0:a+l;return{min:o(i,-Math.abs(r)),max:o(n,r)}}function Xt(s,t){return Object.assign(Object.create(s),t)}function Tn(s,t=[""],e,i,n=()=>s[0]){const r=e||s;typeof i>"u"&&(i=oa("_fallback",s));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:s,_rootScopes:r,_fallback:i,_getTarget:n,override:a=>Tn([a,...s],t,r,i)};return new Proxy(o,{deleteProperty(a,l){return delete a[l],delete a._keys,delete s[0][l],!0},get(a,l){return na(a,l,()=>Oc(l,t,s,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(s[0])},has(a,l){return ir(a).includes(l)},ownKeys(a){return ir(a)},set(a,l,c){const h=a._storage||(a._storage=n());return a[l]=h[l]=c,delete a._keys,!0}})}function Ue(s,t,e,i){const n={_cacheable:!1,_proxy:s,_context:t,_subProxy:e,_stack:new Set,_descriptors:ia(s,i),setContext:r=>Ue(s,r,e,i),override:r=>Ue(s.override(r),t,e,i)};return new Proxy(n,{deleteProperty(r,o){return delete r[o],delete s[o],!0},get(r,o,a){return na(r,o,()=>xc(r,o,a))},getOwnPropertyDescriptor(r,o){return r._descriptors.allKeys?Reflect.has(s,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(s,o)},getPrototypeOf(){return Reflect.getPrototypeOf(s)},has(r,o){return Reflect.has(s,o)},ownKeys(){return Reflect.ownKeys(s)},set(r,o,a){return s[o]=a,delete r[o],!0}})}function ia(s,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:i=t.indexable,_allKeys:n=t.allKeys}=s;return{allKeys:n,scriptable:e,indexable:i,isScriptable:Yt(e)?e:()=>e,isIndexable:Yt(i)?i:()=>i}}const wc=(s,t)=>s?s+vn(t):t,An=(s,t)=>I(t)&&s!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function na(s,t,e){if(Object.prototype.hasOwnProperty.call(s,t)||t==="constructor")return s[t];const i=e();return s[t]=i,i}function xc(s,t,e){const{_proxy:i,_context:n,_subProxy:r,_descriptors:o}=s;let a=i[t];return Yt(a)&&o.isScriptable(t)&&(a=Sc(t,a,s,e)),W(a)&&a.length&&(a=kc(t,a,s,o.isIndexable)),An(t,a)&&(a=Ue(a,n,r&&r[t],o)),a}function Sc(s,t,e,i){const{_proxy:n,_context:r,_subProxy:o,_stack:a}=e;if(a.has(s))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+s);a.add(s);let l=t(r,o||i);return a.delete(s),An(s,l)&&(l=On(n._scopes,n,s,l)),l}function kc(s,t,e,i){const{_proxy:n,_context:r,_subProxy:o,_descriptors:a}=e;if(typeof r.index<"u"&&i(s))return t[r.index%t.length];if(I(t[0])){const l=t,c=n._scopes.filter(h=>h!==l);t=[];for(const h of l){const u=On(c,n,s,h);t.push(Ue(u,r,o&&o[s],a))}}return t}function ra(s,t,e){return Yt(s)?s(t,e):s}const Ec=(s,t)=>s===!0?t:typeof s=="string"?Jt(t,s):void 0;function Tc(s,t,e,i,n){for(const r of t){const o=Ec(e,r);if(o){s.add(o);const a=ra(o._fallback,e,n);if(typeof a<"u"&&a!==e&&a!==i)return a}else if(o===!1&&typeof i<"u"&&e!==i)return null}return!1}function On(s,t,e,i){const n=t._rootScopes,r=ra(t._fallback,e,i),o=[...s,...n],a=new Set;a.add(i);let l=sr(a,o,e,r||e,i);return l===null||typeof r<"u"&&r!==e&&(l=sr(a,o,r,l,i),l===null)?!1:Tn(Array.from(a),[""],n,r,()=>Ac(t,e,i))}function sr(s,t,e,i,n){for(;e;)e=Tc(s,t,e,i,n);return e}function Ac(s,t,e){const i=s._getTarget();t in i||(i[t]={});const n=i[t];return W(n)&&I(e)?e:n||{}}function Oc(s,t,e,i){let n;for(const r of t)if(n=oa(wc(r,s),e),typeof n<"u")return An(s,n)?On(e,i,s,n):n}function oa(s,t){for(const e of t){if(!e)continue;const i=e[s];if(typeof i<"u")return i}}function ir(s){let t=s._keys;return t||(t=s._keys=Cc(s._scopes)),t}function Cc(s){const t=new Set;for(const e of s)for(const i of Object.keys(e).filter(n=>!n.startsWith("_")))t.add(i);return Array.from(t)}function aa(s,t,e,i){const{iScale:n}=s,{key:r="r"}=this._parsing,o=new Array(i);let a,l,c,h;for(a=0,l=i;a<l;++a)c=a+e,h=t[c],o[a]={r:n.parse(Jt(h,r),c)};return o}const Pc=Number.EPSILON||1e-14,ze=(s,t)=>t<s.length&&!s[t].skip&&s[t],la=s=>s==="x"?"y":"x";function Rc(s,t,e,i){const n=s.skip?t:s,r=t,o=e.skip?t:e,a=Gi(r,n),l=Gi(o,r);let c=a/(a+l),h=l/(a+l);c=isNaN(c)?0:c,h=isNaN(h)?0:h;const u=i*c,d=i*h;return{previous:{x:r.x-u*(o.x-n.x),y:r.y-u*(o.y-n.y)},next:{x:r.x+d*(o.x-n.x),y:r.y+d*(o.y-n.y)}}}function Mc(s,t,e){const i=s.length;let n,r,o,a,l,c=ze(s,0);for(let h=0;h<i-1;++h)if(l=c,c=ze(s,h+1),!(!l||!c)){if(rs(t[h],0,Pc)){e[h]=e[h+1]=0;continue}n=e[h]/t[h],r=e[h+1]/t[h],a=Math.pow(n,2)+Math.pow(r,2),!(a<=9)&&(o=3/Math.sqrt(a),e[h]=n*o*t[h],e[h+1]=r*o*t[h])}}function Dc(s,t,e="x"){const i=la(e),n=s.length;let r,o,a,l=ze(s,0);for(let c=0;c<n;++c){if(o=a,a=l,l=ze(s,c+1),!a)continue;const h=a[e],u=a[i];o&&(r=(h-o[e])/3,a[`cp1${e}`]=h-r,a[`cp1${i}`]=u-r*t[c]),l&&(r=(l[e]-h)/3,a[`cp2${e}`]=h+r,a[`cp2${i}`]=u+r*t[c])}}function Ic(s,t="x"){const e=la(t),i=s.length,n=Array(i).fill(0),r=Array(i);let o,a,l,c=ze(s,0);for(o=0;o<i;++o)if(a=l,l=c,c=ze(s,o+1),!!l){if(c){const h=c[t]-l[t];n[o]=h!==0?(c[e]-l[e])/h:0}r[o]=a?c?Tt(n[o-1])!==Tt(n[o])?0:(n[o-1]+n[o])/2:n[o-1]:n[o]}Mc(s,n,r),Dc(s,r,t)}function Ms(s,t,e){return Math.max(Math.min(s,e),t)}function Lc(s,t){let e,i,n,r,o,a=$t(s[0],t);for(e=0,i=s.length;e<i;++e)o=r,r=a,a=e<i-1&&$t(s[e+1],t),r&&(n=s[e],o&&(n.cp1x=Ms(n.cp1x,t.left,t.right),n.cp1y=Ms(n.cp1y,t.top,t.bottom)),a&&(n.cp2x=Ms(n.cp2x,t.left,t.right),n.cp2y=Ms(n.cp2y,t.top,t.bottom)))}function jc(s,t,e,i,n){let r,o,a,l;if(t.spanGaps&&(s=s.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")Ic(s,n);else{let c=i?s[s.length-1]:s[0];for(r=0,o=s.length;r<o;++r)a=s[r],l=Rc(c,a,s[Math.min(r+1,o-(i?0:1))%o],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,c=a}t.capBezierPoints&&Lc(s,e)}function Cn(){return typeof window<"u"&&typeof document<"u"}function Pn(s){let t=s.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function si(s,t,e){let i;return typeof s=="string"?(i=parseInt(s,10),s.indexOf("%")!==-1&&(i=i/100*t.parentNode[e])):i=s,i}const di=s=>s.ownerDocument.defaultView.getComputedStyle(s,null);function $c(s,t){return di(s).getPropertyValue(t)}const Nc=["top","right","bottom","left"];function pe(s,t,e){const i={};e=e?"-"+e:"";for(let n=0;n<4;n++){const r=Nc[n];i[r]=parseFloat(s[t+"-"+r+e])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const Bc=(s,t,e)=>(s>0||t>0)&&(!e||!e.shadowRoot);function Fc(s,t){const e=s.touches,i=e&&e.length?e[0]:s,{offsetX:n,offsetY:r}=i;let o=!1,a,l;if(Bc(n,r,s.target))a=n,l=r;else{const c=t.getBoundingClientRect();a=i.clientX-c.left,l=i.clientY-c.top,o=!0}return{x:a,y:l,box:o}}function ae(s,t){if("native"in s)return s;const{canvas:e,currentDevicePixelRatio:i}=t,n=di(e),r=n.boxSizing==="border-box",o=pe(n,"padding"),a=pe(n,"border","width"),{x:l,y:c,box:h}=Fc(s,e),u=o.left+(h&&a.left),d=o.top+(h&&a.top);let{width:f,height:g}=t;return r&&(f-=o.width+a.width,g-=o.height+a.height),{x:Math.round((l-u)/f*e.width/i),y:Math.round((c-d)/g*e.height/i)}}function Uc(s,t,e){let i,n;if(t===void 0||e===void 0){const r=s&&Pn(s);if(!r)t=s.clientWidth,e=s.clientHeight;else{const o=r.getBoundingClientRect(),a=di(r),l=pe(a,"border","width"),c=pe(a,"padding");t=o.width-c.width-l.width,e=o.height-c.height-l.height,i=si(a.maxWidth,r,"clientWidth"),n=si(a.maxHeight,r,"clientHeight")}}return{width:t,height:e,maxWidth:i||ti,maxHeight:n||ti}}const Ht=s=>Math.round(s*10)/10;function zc(s,t,e,i){const n=di(s),r=pe(n,"margin"),o=si(n.maxWidth,s,"clientWidth")||ti,a=si(n.maxHeight,s,"clientHeight")||ti,l=Uc(s,t,e);let{width:c,height:h}=l;if(n.boxSizing==="content-box"){const d=pe(n,"border","width"),f=pe(n,"padding");c-=f.width+d.width,h-=f.height+d.height}return c=Math.max(0,c-r.width),h=Math.max(0,i?c/i:h-r.height),c=Ht(Math.min(c,o,l.maxWidth)),h=Ht(Math.min(h,a,l.maxHeight)),c&&!h&&(h=Ht(c/2)),(t!==void 0||e!==void 0)&&i&&l.height&&h>l.height&&(h=l.height,c=Ht(Math.floor(h*i))),{width:c,height:h}}function nr(s,t,e){const i=t||1,n=Ht(s.height*i),r=Ht(s.width*i);s.height=Ht(s.height),s.width=Ht(s.width);const o=s.canvas;return o.style&&(e||!o.style.height&&!o.style.width)&&(o.style.height=`${s.height}px`,o.style.width=`${s.width}px`),s.currentDevicePixelRatio!==i||o.height!==n||o.width!==r?(s.currentDevicePixelRatio=i,o.height=n,o.width=r,s.ctx.setTransform(i,0,0,i,0,0),!0):!1}const Wc=(function(){let s=!1;try{const t={get passive(){return s=!0,!1}};Cn()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return s})();function rr(s,t){const e=$c(s,t),i=e&&e.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function le(s,t,e,i){return{x:s.x+e*(t.x-s.x),y:s.y+e*(t.y-s.y)}}function Vc(s,t,e,i){return{x:s.x+e*(t.x-s.x),y:i==="middle"?e<.5?s.y:t.y:i==="after"?e<1?s.y:t.y:e>0?t.y:s.y}}function Hc(s,t,e,i){const n={x:s.cp2x,y:s.cp2y},r={x:t.cp1x,y:t.cp1y},o=le(s,n,e),a=le(n,r,e),l=le(r,t,e),c=le(o,a,e),h=le(a,l,e);return le(c,h,e)}const qc=function(s,t){return{x(e){return s+s+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,i){return e-i},leftForLtr(e,i){return e-i}}},Kc=function(){return{x(s){return s},setWidth(s){},textAlign(s){return s},xPlus(s,t){return s+t},leftForLtr(s,t){return s}}};function Ne(s,t,e){return s?qc(t,e):Kc()}function ca(s,t){let e,i;(t==="ltr"||t==="rtl")&&(e=s.canvas.style,i=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),s.prevTextDirection=i)}function ha(s,t){t!==void 0&&(delete s.prevTextDirection,s.canvas.style.setProperty("direction",t[0],t[1]))}function ua(s){return s==="angle"?{between:fs,compare:Gl,normalize:ot}:{between:Lt,compare:(t,e)=>t-e,normalize:t=>t}}function or({start:s,end:t,count:e,loop:i,style:n}){return{start:s%e,end:t%e,loop:i&&(t-s+1)%e===0,style:n}}function Gc(s,t,e){const{property:i,start:n,end:r}=e,{between:o,normalize:a}=ua(i),l=t.length;let{start:c,end:h,loop:u}=s,d,f;if(u){for(c+=l,h+=l,d=0,f=l;d<f&&o(a(t[c%l][i]),n,r);++d)c--,h--;c%=l,h%=l}return h<c&&(h+=l),{start:c,end:h,loop:u,style:s.style}}function da(s,t,e){if(!e)return[s];const{property:i,start:n,end:r}=e,o=t.length,{compare:a,between:l,normalize:c}=ua(i),{start:h,end:u,loop:d,style:f}=Gc(s,t,e),g=[];let p=!1,m=null,b,y,_;const v=()=>l(n,_,b)&&a(n,_)!==0,w=()=>a(r,b)===0||l(r,_,b),x=()=>p||v(),S=()=>!p||w();for(let E=h,T=h;E<=u;++E)y=t[E%o],!y.skip&&(b=c(y[i]),b!==_&&(p=l(b,n,r),m===null&&x()&&(m=a(b,n)===0?E:T),m!==null&&S()&&(g.push(or({start:m,end:E,loop:d,count:o,style:f})),m=null),T=E,_=b));return m!==null&&g.push(or({start:m,end:u,loop:d,count:o,style:f})),g}function fa(s,t){const e=[],i=s.segments;for(let n=0;n<i.length;n++){const r=da(i[n],s.points,t);r.length&&e.push(...r)}return e}function Jc(s,t,e,i){let n=0,r=t-1;if(e&&!i)for(;n<t&&!s[n].skip;)n++;for(;n<t&&s[n].skip;)n++;for(n%=t,e&&(r+=n);r>n&&s[r%t].skip;)r--;return r%=t,{start:n,end:r}}function Yc(s,t,e,i){const n=s.length,r=[];let o=t,a=s[t],l;for(l=t+1;l<=e;++l){const c=s[l%n];c.skip||c.stop?a.skip||(i=!1,r.push({start:t%n,end:(l-1)%n,loop:i}),t=o=c.stop?l:null):(o=l,a.skip&&(t=l)),a=c}return o!==null&&r.push({start:t%n,end:o%n,loop:i}),r}function Xc(s,t){const e=s.points,i=s.options.spanGaps,n=e.length;if(!n)return[];const r=!!s._loop,{start:o,end:a}=Jc(e,n,r,i);if(i===!0)return ar(s,[{start:o,end:a,loop:r}],e,t);const l=a<o?a+n:a,c=!!s._fullLoop&&o===0&&a===n-1;return ar(s,Yc(e,o,l,c),e,t)}function ar(s,t,e,i){return!i||!i.setContext||!e?t:Zc(s,t,e,i)}function Zc(s,t,e,i){const n=s._chart.getContext(),r=lr(s.options),{_datasetIndex:o,options:{spanGaps:a}}=s,l=e.length,c=[];let h=r,u=t[0].start,d=u;function f(g,p,m,b){const y=a?-1:1;if(g!==p){for(g+=l;e[g%l].skip;)g-=y;for(;e[p%l].skip;)p+=y;g%l!==p%l&&(c.push({start:g%l,end:p%l,loop:m,style:b}),h=b,u=p%l)}}for(const g of t){u=a?u:g.start;let p=e[u%l],m;for(d=u+1;d<=g.end;d++){const b=e[d%l];m=lr(i.setContext(Xt(n,{type:"segment",p0:p,p1:b,p0DataIndex:(d-1)%l,p1DataIndex:d%l,datasetIndex:o}))),Qc(m,h)&&f(u,d-1,g.loop,h),p=b,h=m}u<d-1&&f(u,d-1,g.loop,h)}return c}function lr(s){return{backgroundColor:s.backgroundColor,borderCapStyle:s.borderCapStyle,borderDash:s.borderDash,borderDashOffset:s.borderDashOffset,borderJoinStyle:s.borderJoinStyle,borderWidth:s.borderWidth,borderColor:s.borderColor}}function Qc(s,t){if(!t)return!1;const e=[],i=function(n,r){return kn(r)?(e.includes(r)||e.push(r),e.indexOf(r)):r};return JSON.stringify(s,i)!==JSON.stringify(t,i)}function Ds(s,t,e){return s.options.clip?s[e]:t[e]}function th(s,t){const{xScale:e,yScale:i}=s;return e&&i?{left:Ds(e,t,"left"),right:Ds(e,t,"right"),top:Ds(i,t,"top"),bottom:Ds(i,t,"bottom")}:t}function ga(s,t){const e=t._clip;if(e.disabled)return!1;const i=th(t,s.chartArea);return{left:e.left===!1?0:i.left-(e.left===!0?0:e.left),right:e.right===!1?s.width:i.right+(e.right===!0?0:e.right),top:e.top===!1?0:i.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?s.height:i.bottom+(e.bottom===!0?0:e.bottom)}}class eh{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,n){const r=e.listeners[n],o=e.duration;r.forEach(a=>a({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(i-e.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=Yo.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((i,n)=>{if(!i.running||!i.items.length)return;const r=i.items;let o=r.length-1,a=!1,l;for(;o>=0;--o)l=r[o],l._active?(l._total>i.duration&&(i.duration=l._total),l.tick(t),a=!0):(r[o]=r[r.length-1],r.pop());a&&(n.draw(),this._notify(n,i,t,"progress")),r.length||(i.running=!1,this._notify(n,i,t,"complete"),i.initial=!1),e+=r.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((i,n)=>Math.max(i,n._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let n=i.length-1;for(;n>=0;--n)i[n].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Ct=new eh;const cr="transparent",sh={boolean(s,t,e){return e>.5?t:s},color(s,t,e){const i=Qn(s||cr),n=i.valid&&Qn(t||cr);return n&&n.valid?n.mix(i,e).hexString():t},number(s,t,e){return s+(t-s)*e}};class ih{constructor(t,e,i,n){const r=e[i];n=ts([t.to,n,r,t.from]);const o=ts([t.from,r,n]);this._active=!0,this._fn=t.fn||sh[t.type||typeof o],this._easing=os[t.easing]||os.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=o,this._to=n,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const n=this._target[this._prop],r=i-this._start,o=this._duration-r;this._start=i,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=ts([t.to,e,n,t.from]),this._from=ts([t.from,n,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,n=this._prop,r=this._from,o=this._loop,a=this._to;let l;if(this._active=r!==a&&(o||e<i),!this._active){this._target[n]=a,this._notify(!0);return}if(e<0){this._target[n]=r;return}l=e/i%2,l=o&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[n]=this._fn(r,a,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,i)=>{t.push({res:e,rej:i})})}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let n=0;n<i.length;n++)i[n][e]()}}class pa{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!I(t))return;const e=Object.keys(V.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(n=>{const r=t[n];if(!I(r))return;const o={};for(const a of e)o[a]=r[a];(W(r.properties)&&r.properties||[n]).forEach(a=>{(a===n||!i.has(a))&&i.set(a,o)})})}_animateOptions(t,e){const i=e.options,n=rh(t,i);if(!n)return[];const r=this._createAnimations(n,i);return i.$shared&&nh(t.options.$animations,i).then(()=>{t.options=i},()=>{}),r}_createAnimations(t,e){const i=this._properties,n=[],r=t.$animations||(t.$animations={}),o=Object.keys(e),a=Date.now();let l;for(l=o.length-1;l>=0;--l){const c=o[l];if(c.charAt(0)==="$")continue;if(c==="options"){n.push(...this._animateOptions(t,e));continue}const h=e[c];let u=r[c];const d=i.get(c);if(u)if(d&&u.active()){u.update(d,h,a);continue}else u.cancel();if(!d||!d.duration){t[c]=h;continue}r[c]=u=new ih(d,t,c,h),n.push(u)}return n}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const i=this._createAnimations(t,e);if(i.length)return Ct.add(this._chart,i),!0}}function nh(s,t){const e=[],i=Object.keys(t);for(let n=0;n<i.length;n++){const r=s[i[n]];r&&r.active()&&e.push(r.wait())}return Promise.all(e)}function rh(s,t){if(!t)return;let e=s.options;if(!e){s.options=t;return}return e.$shared&&(s.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function hr(s,t){const e=s&&s.options||{},i=e.reverse,n=e.min===void 0?t:0,r=e.max===void 0?t:0;return{start:i?r:n,end:i?n:r}}function oh(s,t,e){if(e===!1)return!1;const i=hr(s,e),n=hr(t,e);return{top:n.end,right:i.end,bottom:n.start,left:i.start}}function ah(s){let t,e,i,n;return I(s)?(t=s.top,e=s.right,i=s.bottom,n=s.left):t=e=i=n=s,{top:t,right:e,bottom:i,left:n,disabled:s===!1}}function ma(s,t){const e=[],i=s._getSortedDatasetMetas(t);let n,r;for(n=0,r=i.length;n<r;++n)e.push(i[n].index);return e}function ur(s,t,e,i={}){const n=s.keys,r=i.mode==="single";let o,a,l,c;if(t===null)return;let h=!1;for(o=0,a=n.length;o<a;++o){if(l=+n[o],l===e){if(h=!0,i.all)continue;break}c=s.values[l],q(c)&&(r||t===0||Tt(t)===Tt(c))&&(t+=c)}return!h&&!i.all?0:t}function lh(s,t){const{iScale:e,vScale:i}=t,n=e.axis==="x"?"x":"y",r=i.axis==="x"?"x":"y",o=Object.keys(s),a=new Array(o.length);let l,c,h;for(l=0,c=o.length;l<c;++l)h=o[l],a[l]={[n]:h,[r]:s[h]};return a}function ki(s,t){const e=s&&s.options.stacked;return e||e===void 0&&t.stack!==void 0}function ch(s,t,e){return`${s.id}.${t.id}.${e.stack||e.type}`}function hh(s){const{min:t,max:e,minDefined:i,maxDefined:n}=s.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:n?e:Number.POSITIVE_INFINITY}}function uh(s,t,e){const i=s[t]||(s[t]={});return i[e]||(i[e]={})}function dr(s,t,e,i){for(const n of t.getMatchingVisibleMetas(i).reverse()){const r=s[n.index];if(e&&r>0||!e&&r<0)return n.index}return null}function fr(s,t){const{chart:e,_cachedMeta:i}=s,n=e._stacks||(e._stacks={}),{iScale:r,vScale:o,index:a}=i,l=r.axis,c=o.axis,h=ch(r,o,i),u=t.length;let d;for(let f=0;f<u;++f){const g=t[f],{[l]:p,[c]:m}=g,b=g._stacks||(g._stacks={});d=b[c]=uh(n,h,p),d[a]=m,d._top=dr(d,o,!0,i.type),d._bottom=dr(d,o,!1,i.type);const y=d._visualValues||(d._visualValues={});y[a]=m}}function Ei(s,t){const e=s.scales;return Object.keys(e).filter(i=>e[i].axis===t).shift()}function dh(s,t){return Xt(s,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function fh(s,t,e){return Xt(s,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function qe(s,t){const e=s.controller.index,i=s.vScale&&s.vScale.axis;if(i){t=t||s._parsed;for(const n of t){const r=n._stacks;if(!r||r[i]===void 0||r[i][e]===void 0)return;delete r[i][e],r[i]._visualValues!==void 0&&r[i]._visualValues[e]!==void 0&&delete r[i]._visualValues[e]}}}const Ti=s=>s==="reset"||s==="none",gr=(s,t)=>t?s:Object.assign({},s),gh=(s,t,e)=>s&&!t.hidden&&t._stacked&&{keys:ma(e,!0),values:null};class Zt{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=ki(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&qe(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),n=(u,d,f,g)=>u==="x"?d:u==="r"?g:f,r=e.xAxisID=P(i.xAxisID,Ei(t,"x")),o=e.yAxisID=P(i.yAxisID,Ei(t,"y")),a=e.rAxisID=P(i.rAxisID,Ei(t,"r")),l=e.indexAxis,c=e.iAxisID=n(l,r,o,a),h=e.vAxisID=n(l,o,r,a);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(c),e.vScale=this.getScaleForId(h)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Yn(this._data,this),t._stacked&&qe(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(I(e)){const n=this._cachedMeta;this._data=lh(e,n)}else if(i!==e){if(i){Yn(i,this);const n=this._cachedMeta;qe(n),n._parsed=[]}e&&Object.isExtensible(e)&&Zl(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let n=!1;this._dataCheck();const r=e._stacked;e._stacked=ki(e.vScale,e),e.stack!==i.stack&&(n=!0,qe(e),e.stack=i.stack),this._resyncElements(t),(n||r!==e._stacked)&&(fr(this,e._parsed),e._stacked=ki(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:n}=this,{iScale:r,_stacked:o}=i,a=r.axis;let l=t===0&&e===n.length?!0:i._sorted,c=t>0&&i._parsed[t-1],h,u,d;if(this._parsing===!1)i._parsed=n,i._sorted=!0,d=n;else{W(n[t])?d=this.parseArrayData(i,n,t,e):I(n[t])?d=this.parseObjectData(i,n,t,e):d=this.parsePrimitiveData(i,n,t,e);const f=()=>u[a]===null||c&&u[a]<c[a];for(h=0;h<e;++h)i._parsed[h+t]=u=d[h],l&&(f()&&(l=!1),c=u);i._sorted=l}o&&fr(this,d)}parsePrimitiveData(t,e,i,n){const{iScale:r,vScale:o}=t,a=r.axis,l=o.axis,c=r.getLabels(),h=r===o,u=new Array(n);let d,f,g;for(d=0,f=n;d<f;++d)g=d+i,u[d]={[a]:h||r.parse(c[g],g),[l]:o.parse(e[g],g)};return u}parseArrayData(t,e,i,n){const{xScale:r,yScale:o}=t,a=new Array(n);let l,c,h,u;for(l=0,c=n;l<c;++l)h=l+i,u=e[h],a[l]={x:r.parse(u[0],h),y:o.parse(u[1],h)};return a}parseObjectData(t,e,i,n){const{xScale:r,yScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=new Array(n);let h,u,d,f;for(h=0,u=n;h<u;++h)d=h+i,f=e[d],c[h]={x:r.parse(Jt(f,a),d),y:o.parse(Jt(f,l),d)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const n=this.chart,r=this._cachedMeta,o=e[t.axis],a={keys:ma(n,!0),values:e._stacks[t.axis]._visualValues};return ur(a,o,r.index,{mode:i})}updateRangeFromParsed(t,e,i,n){const r=i[e.axis];let o=r===null?NaN:r;const a=n&&i._stacks[e.axis];n&&a&&(n.values=a,o=ur(n,r,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const i=this._cachedMeta,n=i._parsed,r=i._sorted&&t===i.iScale,o=n.length,a=this._getOtherScale(t),l=gh(e,i,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:h,max:u}=hh(a);let d,f;function g(){f=n[d];const p=f[a.axis];return!q(f[t.axis])||h>p||u<p}for(d=0;d<o&&!(!g()&&(this.updateRangeFromParsed(c,t,f,l),r));++d);if(r){for(d=o-1;d>=0;--d)if(!g()){this.updateRangeFromParsed(c,t,f,l);break}}return c}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let n,r,o;for(n=0,r=e.length;n<r;++n)o=e[n][t.axis],q(o)&&i.push(o);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,n=e.vScale,r=this.getParsed(t);return{label:i?""+i.getLabelForValue(r[i.axis]):"",value:n?""+n.getLabelForValue(r[n.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=ah(P(this.options.clip,oh(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,n=i.data||[],r=e.chartArea,o=[],a=this._drawStart||0,l=this._drawCount||n.length-a,c=this.options.drawActiveElementsOnTop;let h;for(i.dataset&&i.dataset.draw(t,r,a,l),h=a;h<a+l;++h){const u=n[h];u.hidden||(u.active&&c?o.push(u):u.draw(t,r))}for(h=0;h<o.length;++h)o[h].draw(t,r)}getStyle(t,e){const i=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const n=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const o=this._cachedMeta.data[t];r=o.$context||(o.$context=fh(this.getContext(),t,o)),r.parsed=this.getParsed(t),r.raw=n.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=dh(this.chart.getContext(),this.index)),r.dataset=n,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=i,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const n=e==="active",r=this._cachedDataOpts,o=t+"-"+e,a=r[o],l=this.enableOptionSharing&&ds(i);if(a)return gr(a,l);const c=this.chart.config,h=c.datasetElementScopeKeys(this._type,t),u=n?[`${t}Hover`,"hover",t,""]:[t,""],d=c.getOptionScopes(this.getDataset(),h),f=Object.keys(V.elements[t]),g=()=>this.getContext(i,n,e),p=c.resolveNamedOptions(d,f,g,u);return p.$shared&&(p.$shared=l,r[o]=Object.freeze(gr(p,l))),p}_resolveAnimations(t,e,i){const n=this.chart,r=this._cachedDataOpts,o=`animation-${e}`,a=r[o];if(a)return a;let l;if(n.options.animation!==!1){const h=this.chart.config,u=h.datasetAnimationScopeKeys(this._type,e),d=h.getOptionScopes(this.getDataset(),u);l=h.createResolver(d,this.getContext(t,i,e))}const c=new pa(n,l&&l.animations);return l&&l._cacheable&&(r[o]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||Ti(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const i=this.resolveDataElementOptions(t,e),n=this._sharedOptions,r=this.getSharedOptions(i),o=this.includeOptions(e,r)||r!==n;return this.updateSharedOptions(r,e,i),{sharedOptions:r,includeOptions:o}}updateElement(t,e,i,n){Ti(n)?Object.assign(t,i):this._resolveAnimations(e,n).update(t,i)}updateSharedOptions(t,e,i){t&&!Ti(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,n){t.active=n;const r=this.getStyle(e,n);this._resolveAnimations(e,i,n).update(t,{options:!n&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[a,l,c]of this._syncList)this[a](l,c);this._syncList=[];const n=i.length,r=e.length,o=Math.min(r,n);o&&this.parse(0,o),r>n?this._insertElements(n,r-n,t):r<n&&this._removeElements(r,n-r)}_insertElements(t,e,i=!0){const n=this._cachedMeta,r=n.data,o=t+e;let a;const l=c=>{for(c.length+=e,a=c.length-1;a>=o;a--)c[a]=c[a-e]};for(l(r),a=t;a<o;++a)r[a]=new this.dataElementType;this._parsing&&l(n._parsed),this.parse(t,e),i&&this.updateElements(r,t,e,"reset")}updateElements(t,e,i,n){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const n=i._parsed.splice(t,e);i._stacked&&qe(i,n)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,n]=t;this[e](i,n)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function ph(s,t){if(!s._cache.$bar){const e=s.getMatchingVisibleMetas(t);let i=[];for(let n=0,r=e.length;n<r;n++)i=i.concat(e[n].controller.getAllParsedValues(s));s._cache.$bar=Jo(i.sort((n,r)=>n-r))}return s._cache.$bar}function mh(s){const t=s.iScale,e=ph(t,s.type);let i=t._length,n,r,o,a;const l=()=>{o===32767||o===-32768||(ds(a)&&(i=Math.min(i,Math.abs(o-a)||i)),a=o)};for(n=0,r=e.length;n<r;++n)o=t.getPixelForValue(e[n]),l();for(a=void 0,n=0,r=t.ticks.length;n<r;++n)o=t.getPixelForTick(n),l();return i}function bh(s,t,e,i){const n=e.barThickness;let r,o;return D(n)?(r=t.min*e.categoryPercentage,o=e.barPercentage):(r=n*i,o=1),{chunk:r/i,ratio:o,start:t.pixels[s]-r/2}}function yh(s,t,e,i){const n=t.pixels,r=n[s];let o=s>0?n[s-1]:null,a=s<n.length-1?n[s+1]:null;const l=e.categoryPercentage;o===null&&(o=r-(a===null?t.end-t.start:a-r)),a===null&&(a=r+r-o);const c=r-(r-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/i,ratio:e.barPercentage,start:c}}function _h(s,t,e,i){const n=e.parse(s[0],i),r=e.parse(s[1],i),o=Math.min(n,r),a=Math.max(n,r);let l=o,c=a;Math.abs(o)>Math.abs(a)&&(l=a,c=o),t[e.axis]=c,t._custom={barStart:l,barEnd:c,start:n,end:r,min:o,max:a}}function ba(s,t,e,i){return W(s)?_h(s,t,e,i):t[e.axis]=e.parse(s,i),t}function pr(s,t,e,i){const n=s.iScale,r=s.vScale,o=n.getLabels(),a=n===r,l=[];let c,h,u,d;for(c=e,h=e+i;c<h;++c)d=t[c],u={},u[n.axis]=a||n.parse(o[c],c),l.push(ba(d,u,r,c));return l}function Ai(s){return s&&s.barStart!==void 0&&s.barEnd!==void 0}function vh(s,t,e){return s!==0?Tt(s):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function wh(s){let t,e,i,n,r;return s.horizontal?(t=s.base>s.x,e="left",i="right"):(t=s.base<s.y,e="bottom",i="top"),t?(n="end",r="start"):(n="start",r="end"),{start:e,end:i,reverse:t,top:n,bottom:r}}function xh(s,t,e,i){let n=t.borderSkipped;const r={};if(!n){s.borderSkipped=r;return}if(n===!0){s.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:o,end:a,reverse:l,top:c,bottom:h}=wh(s);n==="middle"&&e&&(s.enableBorderRadius=!0,(e._top||0)===i?n=c:(e._bottom||0)===i?n=h:(r[mr(h,o,a,l)]=!0,n=c)),r[mr(n,o,a,l)]=!0,s.borderSkipped=r}function mr(s,t,e,i){return i?(s=Sh(s,t,e),s=br(s,e,t)):s=br(s,t,e),s}function Sh(s,t,e){return s===t?e:s===e?t:s}function br(s,t,e){return s==="start"?t:s==="end"?e:s}function kh(s,{inflateAmount:t},e){s.inflateAmount=t==="auto"?e===1?.33:0:t}class Eh extends Zt{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(t,e,i,n){return pr(t,e,i,n)}parseArrayData(t,e,i,n){return pr(t,e,i,n)}parseObjectData(t,e,i,n){const{iScale:r,vScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=r.axis==="x"?a:l,h=o.axis==="x"?a:l,u=[];let d,f,g,p;for(d=i,f=i+n;d<f;++d)p=e[d],g={},g[r.axis]=r.parse(Jt(p,c),d),u.push(ba(Jt(p,h),g,o,d));return u}updateRangeFromParsed(t,e,i,n){super.updateRangeFromParsed(t,e,i,n);const r=i._custom;r&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:i,vScale:n}=e,r=this.getParsed(t),o=r._custom,a=Ai(o)?"["+o.start+", "+o.end+"]":""+n.getLabelForValue(r[n.axis]);return{label:""+i.getLabelForValue(r[i.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,i,n){const r=n==="reset",{index:o,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),c=a.isHorizontal(),h=this._getRuler(),{sharedOptions:u,includeOptions:d}=this._getSharedOptions(e,n);for(let f=e;f<e+i;f++){const g=this.getParsed(f),p=r||D(g[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,h),b=(g._stacks||{})[a.axis],y={horizontal:c,base:p.base,enableBorderRadius:!b||Ai(g._custom)||o===b._top||o===b._bottom,x:c?p.head:m.center,y:c?m.center:p.head,height:c?m.size:Math.abs(p.size),width:c?Math.abs(p.size):m.size};d&&(y.options=u||this.resolveDataElementOptions(f,t[f].active?"active":n));const _=y.options||t[f].options;xh(y,_,b,o),kh(y,_,h.ratio),this.updateElement(t[f],f,y,n)}}_getStacks(t,e){const{iScale:i}=this._cachedMeta,n=i.getMatchingVisibleMetas(this._type).filter(h=>h.controller.options.grouped),r=i.options.stacked,o=[],a=this._cachedMeta.controller.getParsed(e),l=a&&a[i.axis],c=h=>{const u=h._parsed.find(f=>f[i.axis]===l),d=u&&u[h.vScale.axis];if(D(d)||isNaN(d))return!0};for(const h of n)if(!(e!==void 0&&c(h))&&((r===!1||o.indexOf(h.stack)===-1||r===void 0&&h.stack===void 0)&&o.push(h.stack),h.index===t))break;return o.length||o.push(void 0),o}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(i=>t[i].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const i of this.chart.data.datasets)t[P(this.chart.options.indexAxis==="x"?i.xAxisID:i.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,i){const n=this._getStacks(t,i),r=e!==void 0?n.indexOf(e):-1;return r===-1?n.length-1:r}_getRuler(){const t=this.options,e=this._cachedMeta,i=e.iScale,n=[];let r,o;for(r=0,o=e.data.length;r<o;++r)n.push(i.getPixelForValue(this.getParsed(r)[i.axis],r));const a=t.barThickness;return{min:a||mh(e),pixels:n,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:i,index:n},options:{base:r,minBarLength:o}}=this,a=r||0,l=this.getParsed(t),c=l._custom,h=Ai(c);let u=l[e.axis],d=0,f=i?this.applyStack(e,l,i):u,g,p;f!==u&&(d=f-u,f=u),h&&(u=c.barStart,f=c.barEnd-c.barStart,u!==0&&Tt(u)!==Tt(c.barEnd)&&(d=0),d+=u);const m=!D(r)&&!h?r:d;let b=e.getPixelForValue(m);if(this.chart.getDataVisibility(t)?g=e.getPixelForValue(d+f):g=b,p=g-b,Math.abs(p)<o){p=vh(p,e,a)*o,u===a&&(b-=p/2);const y=e.getPixelForDecimal(0),_=e.getPixelForDecimal(1),v=Math.min(y,_),w=Math.max(y,_);b=Math.max(Math.min(b,w),v),g=b+p,i&&!h&&(l._stacks[e.axis]._visualValues[n]=e.getValueForPixel(g)-e.getValueForPixel(b))}if(b===e.getPixelForValue(a)){const y=Tt(p)*e.getLineWidthForValue(a)/2;b+=y,p-=y}return{size:p,base:b,head:g,center:g+p/2}}_calculateBarIndexPixels(t,e){const i=e.scale,n=this.options,r=n.skipNull,o=P(n.maxBarThickness,1/0);let a,l;const c=this._getAxisCount();if(e.grouped){const h=r?this._getStackCount(t):e.stackCount,u=n.barThickness==="flex"?yh(t,e,n,h*c):bh(t,e,n,h*c),d=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,f=this._getAxis().indexOf(P(d,this.getFirstScaleIdForIndexAxis())),g=this._getStackIndex(this.index,this._cachedMeta.stack,r?t:void 0)+f;a=u.start+u.chunk*g+u.chunk/2,l=Math.min(o,u.chunk*u.ratio)}else a=i.getPixelForValue(this.getParsed(t)[i.axis],t),l=Math.min(o,e.min*e.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const t=this._cachedMeta,e=t.vScale,i=t.data,n=i.length;let r=0;for(;r<n;++r)this.getParsed(r)[e.axis]!==null&&!i[r].hidden&&i[r].draw(this._ctx)}}class Th extends Zt{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,i,n){const r=super.parsePrimitiveData(t,e,i,n);for(let o=0;o<r.length;o++)r[o]._custom=this.resolveDataElementOptions(o+i).radius;return r}parseArrayData(t,e,i,n){const r=super.parseArrayData(t,e,i,n);for(let o=0;o<r.length;o++){const a=e[i+o];r[o]._custom=P(a[2],this.resolveDataElementOptions(o+i).radius)}return r}parseObjectData(t,e,i,n){const r=super.parseObjectData(t,e,i,n);for(let o=0;o<r.length;o++){const a=e[i+o];r[o]._custom=P(a&&a.r&&+a.r,this.resolveDataElementOptions(o+i).radius)}return r}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:r}=e,o=this.getParsed(t),a=n.getLabelForValue(o.x),l=r.getLabelForValue(o.y),c=o._custom;return{label:i[t]||"",value:"("+a+", "+l+(c?", "+c:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,i,n){const r=n==="reset",{iScale:o,vScale:a}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(e,n),h=o.axis,u=a.axis;for(let d=e;d<e+i;d++){const f=t[d],g=!r&&this.getParsed(d),p={},m=p[h]=r?o.getPixelForDecimal(.5):o.getPixelForValue(g[h]),b=p[u]=r?a.getBasePixel():a.getPixelForValue(g[u]);p.skip=isNaN(m)||isNaN(b),c&&(p.options=l||this.resolveDataElementOptions(d,f.active?"active":n),r&&(p.options.radius=0)),this.updateElement(f,d,p,n)}}resolveDataElementOptions(t,e){const i=this.getParsed(t);let n=super.resolveDataElementOptions(t,e);n.$shared&&(n=Object.assign({},n,{$shared:!1}));const r=n.radius;return e!=="active"&&(n.radius=0),n.radius+=P(i&&i._custom,r),n}}function Ah(s,t,e){let i=1,n=1,r=0,o=0;if(t<U){const a=s,l=a+t,c=Math.cos(a),h=Math.sin(a),u=Math.cos(l),d=Math.sin(l),f=(_,v,w)=>fs(_,a,l,!0)?1:Math.max(v,v*e,w,w*e),g=(_,v,w)=>fs(_,a,l,!0)?-1:Math.min(v,v*e,w,w*e),p=f(0,c,u),m=f(G,h,d),b=g(j,c,u),y=g(j+G,h,d);i=(p-b)/2,n=(m-y)/2,r=-(p+b)/2,o=-(m+y)/2}return{ratioX:i,ratioY:n,offsetX:r,offsetY:o}}class Rn extends Zt{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data,{labels:{pointStyle:i,textAlign:n,color:r,useBorderRadius:o,borderRadius:a}}=t.legend.options;return e.labels.length&&e.datasets.length?e.labels.map((l,c)=>{const u=t.getDatasetMeta(0).controller.getStyle(c);return{text:l,fillStyle:u.backgroundColor,fontColor:r,hidden:!t.getDataVisibility(c),lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:u.borderWidth,strokeStyle:u.borderColor,textAlign:n,pointStyle:i,borderRadius:o&&(a||u.borderRadius),index:c}}):[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}}};constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const i=this.getDataset().data,n=this._cachedMeta;if(this._parsing===!1)n._parsed=i;else{let r=l=>+i[l];if(I(i[t])){const{key:l="value"}=this._parsing;r=c=>+Jt(i[c],l)}let o,a;for(o=t,a=t+e;o<a;++o)n._parsed[o]=r(o)}}_getRotation(){return St(this.options.rotation-90)}_getCircumference(){return St(this.options.circumference)}_getRotationExtents(){let t=U,e=-U;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const n=this.chart.getDatasetMeta(i).controller,r=n._getRotation(),o=n._getCircumference();t=Math.min(t,r),e=Math.max(e,r+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:i}=e,n=this._cachedMeta,r=n.data,o=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,a=Math.max((Math.min(i.width,i.height)-o)/2,0),l=Math.min($l(this.options.cutout,a),1),c=this._getRingWeight(this.index),{circumference:h,rotation:u}=this._getRotationExtents(),{ratioX:d,ratioY:f,offsetX:g,offsetY:p}=Ah(u,h,l),m=(i.width-o)/d,b=(i.height-o)/f,y=Math.max(Math.min(m,b)/2,0),_=Vo(this.options.radius,y),v=Math.max(_*l,0),w=(_-v)/this._getVisibleDatasetWeightTotal();this.offsetX=g*_,this.offsetY=p*_,n.total=this.calculateTotal(),this.outerRadius=_-w*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-w*c,0),this.updateElements(r,0,r.length,t)}_circumference(t,e){const i=this.options,n=this._cachedMeta,r=this._getCircumference();return e&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||n._parsed[t]===null||n.data[t].hidden?0:this.calculateCircumference(n._parsed[t]*r/U)}updateElements(t,e,i,n){const r=n==="reset",o=this.chart,a=o.chartArea,c=o.options.animation,h=(a.left+a.right)/2,u=(a.top+a.bottom)/2,d=r&&c.animateScale,f=d?0:this.innerRadius,g=d?0:this.outerRadius,{sharedOptions:p,includeOptions:m}=this._getSharedOptions(e,n);let b=this._getRotation(),y;for(y=0;y<e;++y)b+=this._circumference(y,r);for(y=e;y<e+i;++y){const _=this._circumference(y,r),v=t[y],w={x:h+this.offsetX,y:u+this.offsetY,startAngle:b,endAngle:b+_,circumference:_,outerRadius:g,innerRadius:f};m&&(w.options=p||this.resolveDataElementOptions(y,v.active?"active":n)),b+=_,this.updateElement(v,y,w,n)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let i=0,n;for(n=0;n<e.length;n++){const r=t._parsed[n];r!==null&&!isNaN(r)&&this.chart.getDataVisibility(n)&&!e[n].hidden&&(i+=Math.abs(r))}return i}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?U*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,n=i.data.labels||[],r=Es(e._parsed[t],i.options.locale);return{label:n[t]||"",value:r}}getMaxBorderWidth(t){let e=0;const i=this.chart;let n,r,o,a,l;if(!t){for(n=0,r=i.data.datasets.length;n<r;++n)if(i.isDatasetVisible(n)){o=i.getDatasetMeta(n),t=o.data,a=o.controller;break}}if(!t)return 0;for(n=0,r=t.length;n<r;++n)l=a.resolveDataElementOptions(n),l.borderAlign!=="inner"&&(e=Math.max(e,l.borderWidth||0,l.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let i=0,n=t.length;i<n;++i){const r=this.resolveDataElementOptions(i);e=Math.max(e,r.offset||0,r.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e}_getRingWeight(t){return Math.max(P(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class Oh extends Zt{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:n=[],_dataset:r}=e,o=this.chart._animationsDisabled;let{start:a,count:l}=Zo(e,n,o);this._drawStart=a,this._drawCount=l,Qo(e)&&(a=0,l=n.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!r._decimated,i.points=n;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(i,void 0,{animated:!o,options:c},t),this.updateElements(n,a,l,t)}updateElements(t,e,i,n){const r=n==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:h,includeOptions:u}=this._getSharedOptions(e,n),d=o.axis,f=a.axis,{spanGaps:g,segment:p}=this.options,m=Fe(g)?g:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||r||n==="none",y=e+i,_=t.length;let v=e>0&&this.getParsed(e-1);for(let w=0;w<_;++w){const x=t[w],S=b?x:{};if(w<e||w>=y){S.skip=!0;continue}const E=this.getParsed(w),T=D(E[f]),R=S[d]=o.getPixelForValue(E[d],w),M=S[f]=r||T?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,E,l):E[f],w);S.skip=isNaN(R)||isNaN(M)||T,S.stop=w>0&&Math.abs(E[d]-v[d])>m,p&&(S.parsed=E,S.raw=c.data[w]),u&&(S.options=h||this.resolveDataElementOptions(w,x.active?"active":n)),b||this.updateElement(x,w,S,n),v=E}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,n=t.data||[];if(!n.length)return i;const r=n[0].size(this.resolveDataElementOptions(0)),o=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(i,r,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}class ya extends Zt{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:n}}=t.legend.options;return e.labels.map((r,o)=>{const l=t.getDatasetMeta(0).controller.getStyle(o);return{text:r,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:n,lineWidth:l.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(o),index:o}})}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,n=i.data.labels||[],r=Es(e._parsed[t].r,i.options.locale);return{label:n[t]||"",value:r}}parseObjectData(t,e,i,n){return aa.bind(this)(t,e,i,n)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,n)=>{const r=this.getParsed(n).r;!isNaN(r)&&this.chart.getDataVisibility(n)&&(r<e.min&&(e.min=r),r>e.max&&(e.max=r))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,i=t.options,n=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(n/2,0),o=Math.max(i.cutoutPercentage?r/100*i.cutoutPercentage:1,0),a=(r-o)/t.getVisibleDatasetCount();this.outerRadius=r-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,i,n){const r=n==="reset",o=this.chart,l=o.options.animation,c=this._cachedMeta.rScale,h=c.xCenter,u=c.yCenter,d=c.getIndexAngle(0)-.5*j;let f=d,g;const p=360/this.countVisibleElements();for(g=0;g<e;++g)f+=this._computeAngle(g,n,p);for(g=e;g<e+i;g++){const m=t[g];let b=f,y=f+this._computeAngle(g,n,p),_=o.getDataVisibility(g)?c.getDistanceFromCenterForValue(this.getParsed(g).r):0;f=y,r&&(l.animateScale&&(_=0),l.animateRotate&&(b=y=d));const v={x:h,y:u,innerRadius:0,outerRadius:_,startAngle:b,endAngle:y,options:this.resolveDataElementOptions(g,m.active?"active":n)};this.updateElement(m,g,v,n)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((i,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&e++}),e}_computeAngle(t,e,i){return this.chart.getDataVisibility(t)?St(this.resolveDataElementOptions(t,e).angle||i):0}}class Ch extends Rn{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}class Ph extends Zt{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(t){const e=this._cachedMeta.vScale,i=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(i[e.axis])}}parseObjectData(t,e,i,n){return aa.bind(this)(t,e,i,n)}update(t){const e=this._cachedMeta,i=e.dataset,n=e.data||[],r=e.iScale.getLabels();if(i.points=n,t!=="resize"){const o=this.resolveDatasetElementOptions(t);this.options.showLine||(o.borderWidth=0);const a={_loop:!0,_fullLoop:r.length===n.length,options:o};this.updateElement(i,void 0,a,t)}this.updateElements(n,0,n.length,t)}updateElements(t,e,i,n){const r=this._cachedMeta.rScale,o=n==="reset";for(let a=e;a<e+i;a++){const l=t[a],c=this.resolveDataElementOptions(a,l.active?"active":n),h=r.getPointPositionForValue(a,this.getParsed(a).r),u=o?r.xCenter:h.x,d=o?r.yCenter:h.y,f={x:u,y:d,angle:h.angle,skip:isNaN(u)||isNaN(d),options:c};this.updateElement(l,a,f,n)}}}class Rh extends Zt{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:r}=e,o=this.getParsed(t),a=n.getLabelForValue(o.x),l=r.getLabelForValue(o.y);return{label:i[t]||"",value:"("+a+", "+l+")"}}update(t){const e=this._cachedMeta,{data:i=[]}=e,n=this.chart._animationsDisabled;let{start:r,count:o}=Zo(e,i,n);if(this._drawStart=r,this._drawCount=o,Qo(e)&&(r=0,o=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:l}=e;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!l._decimated,a.points=i;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(a,void 0,{animated:!n,options:c},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(i,r,o,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,i,n){const r=n==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,h=this.resolveDataElementOptions(e,n),u=this.getSharedOptions(h),d=this.includeOptions(n,u),f=o.axis,g=a.axis,{spanGaps:p,segment:m}=this.options,b=Fe(p)?p:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||r||n==="none";let _=e>0&&this.getParsed(e-1);for(let v=e;v<e+i;++v){const w=t[v],x=this.getParsed(v),S=y?w:{},E=D(x[g]),T=S[f]=o.getPixelForValue(x[f],v),R=S[g]=r||E?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,x,l):x[g],v);S.skip=isNaN(T)||isNaN(R)||E,S.stop=v>0&&Math.abs(x[f]-_[f])>b,m&&(S.parsed=x,S.raw=c.data[v]),d&&(S.options=u||this.resolveDataElementOptions(v,w.active?"active":n)),y||this.updateElement(w,v,S,n),_=x}this.updateSharedOptions(u,n,h)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let a=0;for(let l=e.length-1;l>=0;--l)a=Math.max(a,e[l].size(this.resolveDataElementOptions(l))/2);return a>0&&a}const i=t.dataset,n=i.options&&i.options.borderWidth||0;if(!e.length)return n;const r=e[0].size(this.resolveDataElementOptions(0)),o=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(n,r,o)/2}}var Mh=Object.freeze({__proto__:null,BarController:Eh,BubbleController:Th,DoughnutController:Rn,LineController:Oh,PieController:Ch,PolarAreaController:ya,RadarController:Ph,ScatterController:Rh});function ie(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Mn{static override(t){Object.assign(Mn.prototype,t)}options;constructor(t){this.options=t||{}}init(){}formats(){return ie()}parse(){return ie()}format(){return ie()}add(){return ie()}diff(){return ie()}startOf(){return ie()}endOf(){return ie()}}var Dh={_date:Mn};function Ih(s,t,e,i){const{controller:n,data:r,_sorted:o}=s,a=n._cachedMeta.iScale,l=s.dataset&&s.dataset.options?s.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&o&&r.length){const c=a._reversePixels?Yl:jt;if(i){if(n._sharedOptions){const h=r[0],u=typeof h.getRange=="function"&&h.getRange(t);if(u){const d=c(r,t,e-u),f=c(r,t,e+u);return{lo:d.lo,hi:f.hi}}}}else{const h=c(r,t,e);if(l){const{vScale:u}=n._cachedMeta,{_parsed:d}=s,f=d.slice(0,h.lo+1).reverse().findIndex(p=>!D(p[u.axis]));h.lo-=Math.max(0,f);const g=d.slice(h.hi).findIndex(p=>!D(p[u.axis]));h.hi+=Math.max(0,g)}return h}}return{lo:0,hi:r.length-1}}function fi(s,t,e,i,n){const r=s.getSortedVisibleDatasetMetas(),o=e[t];for(let a=0,l=r.length;a<l;++a){const{index:c,data:h}=r[a],{lo:u,hi:d}=Ih(r[a],t,o,n);for(let f=u;f<=d;++f){const g=h[f];g.skip||i(g,c,f)}}}function Lh(s){const t=s.indexOf("x")!==-1,e=s.indexOf("y")!==-1;return function(i,n){const r=t?Math.abs(i.x-n.x):0,o=e?Math.abs(i.y-n.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))}}function Oi(s,t,e,i,n){const r=[];return!n&&!s.isPointInArea(t)||fi(s,e,t,function(a,l,c){!n&&!$t(a,s.chartArea,0)||a.inRange(t.x,t.y,i)&&r.push({element:a,datasetIndex:l,index:c})},!0),r}function jh(s,t,e,i){let n=[];function r(o,a,l){const{startAngle:c,endAngle:h}=o.getProps(["startAngle","endAngle"],i),{angle:u}=Ko(o,{x:t.x,y:t.y});fs(u,c,h)&&n.push({element:o,datasetIndex:a,index:l})}return fi(s,e,t,r),n}function $h(s,t,e,i,n,r){let o=[];const a=Lh(e);let l=Number.POSITIVE_INFINITY;function c(h,u,d){const f=h.inRange(t.x,t.y,n);if(i&&!f)return;const g=h.getCenterPoint(n);if(!(!!r||s.isPointInArea(g))&&!f)return;const m=a(t,g);m<l?(o=[{element:h,datasetIndex:u,index:d}],l=m):m===l&&o.push({element:h,datasetIndex:u,index:d})}return fi(s,e,t,c),o}function Ci(s,t,e,i,n,r){return!r&&!s.isPointInArea(t)?[]:e==="r"&&!i?jh(s,t,e,n):$h(s,t,e,i,n,r)}function yr(s,t,e,i,n){const r=[],o=e==="x"?"inXRange":"inYRange";let a=!1;return fi(s,e,t,(l,c,h)=>{l[o]&&l[o](t[e],n)&&(r.push({element:l,datasetIndex:c,index:h}),a=a||l.inRange(t.x,t.y,n))}),i&&!a?[]:r}var Nh={modes:{index(s,t,e,i){const n=ae(t,s),r=e.axis||"x",o=e.includeInvisible||!1,a=e.intersect?Oi(s,n,r,i,o):Ci(s,n,r,!1,i,o),l=[];return a.length?(s.getSortedVisibleDatasetMetas().forEach(c=>{const h=a[0].index,u=c.data[h];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:h})}),l):[]},dataset(s,t,e,i){const n=ae(t,s),r=e.axis||"xy",o=e.includeInvisible||!1;let a=e.intersect?Oi(s,n,r,i,o):Ci(s,n,r,!1,i,o);if(a.length>0){const l=a[0].datasetIndex,c=s.getDatasetMeta(l).data;a=[];for(let h=0;h<c.length;++h)a.push({element:c[h],datasetIndex:l,index:h})}return a},point(s,t,e,i){const n=ae(t,s),r=e.axis||"xy",o=e.includeInvisible||!1;return Oi(s,n,r,i,o)},nearest(s,t,e,i){const n=ae(t,s),r=e.axis||"xy",o=e.includeInvisible||!1;return Ci(s,n,r,e.intersect,i,o)},x(s,t,e,i){const n=ae(t,s);return yr(s,n,"x",e.intersect,i)},y(s,t,e,i){const n=ae(t,s);return yr(s,n,"y",e.intersect,i)}}};const _a=["left","top","right","bottom"];function Ke(s,t){return s.filter(e=>e.pos===t)}function _r(s,t){return s.filter(e=>_a.indexOf(e.pos)===-1&&e.box.axis===t)}function Ge(s,t){return s.sort((e,i)=>{const n=t?i:e,r=t?e:i;return n.weight===r.weight?n.index-r.index:n.weight-r.weight})}function Bh(s){const t=[];let e,i,n,r,o,a;for(e=0,i=(s||[]).length;e<i;++e)n=s[e],{position:r,options:{stack:o,stackWeight:a=1}}=n,t.push({index:e,box:n,pos:r,horizontal:n.isHorizontal(),weight:n.weight,stack:o&&r+o,stackWeight:a});return t}function Fh(s){const t={};for(const e of s){const{stack:i,pos:n,stackWeight:r}=e;if(!i||!_a.includes(n))continue;const o=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=r}return t}function Uh(s,t){const e=Fh(s),{vBoxMaxWidth:i,hBoxMaxHeight:n}=t;let r,o,a;for(r=0,o=s.length;r<o;++r){a=s[r];const{fullSize:l}=a.box,c=e[a.stack],h=c&&a.stackWeight/c.weight;a.horizontal?(a.width=h?h*i:l&&t.availableWidth,a.height=n):(a.width=i,a.height=h?h*n:l&&t.availableHeight)}return e}function zh(s){const t=Bh(s),e=Ge(t.filter(c=>c.box.fullSize),!0),i=Ge(Ke(t,"left"),!0),n=Ge(Ke(t,"right")),r=Ge(Ke(t,"top"),!0),o=Ge(Ke(t,"bottom")),a=_r(t,"x"),l=_r(t,"y");return{fullSize:e,leftAndTop:i.concat(r),rightAndBottom:n.concat(l).concat(o).concat(a),chartArea:Ke(t,"chartArea"),vertical:i.concat(n).concat(l),horizontal:r.concat(o).concat(a)}}function vr(s,t,e,i){return Math.max(s[e],t[e])+Math.max(s[i],t[i])}function va(s,t){s.top=Math.max(s.top,t.top),s.left=Math.max(s.left,t.left),s.bottom=Math.max(s.bottom,t.bottom),s.right=Math.max(s.right,t.right)}function Wh(s,t,e,i){const{pos:n,box:r}=e,o=s.maxPadding;if(!I(n)){e.size&&(s[n]-=e.size);const u=i[e.stack]||{size:0,count:1};u.size=Math.max(u.size,e.horizontal?r.height:r.width),e.size=u.size/u.count,s[n]+=e.size}r.getPadding&&va(o,r.getPadding());const a=Math.max(0,t.outerWidth-vr(o,s,"left","right")),l=Math.max(0,t.outerHeight-vr(o,s,"top","bottom")),c=a!==s.w,h=l!==s.h;return s.w=a,s.h=l,e.horizontal?{same:c,other:h}:{same:h,other:c}}function Vh(s){const t=s.maxPadding;function e(i){const n=Math.max(t[i]-s[i],0);return s[i]+=n,n}s.y+=e("top"),s.x+=e("left"),e("right"),e("bottom")}function Hh(s,t){const e=t.maxPadding;function i(n){const r={left:0,top:0,right:0,bottom:0};return n.forEach(o=>{r[o]=Math.max(t[o],e[o])}),r}return i(s?["left","right"]:["top","bottom"])}function es(s,t,e,i){const n=[];let r,o,a,l,c,h;for(r=0,o=s.length,c=0;r<o;++r){a=s[r],l=a.box,l.update(a.width||t.w,a.height||t.h,Hh(a.horizontal,t));const{same:u,other:d}=Wh(t,e,a,i);c|=u&&n.length,h=h||d,l.fullSize||n.push(a)}return c&&es(n,t,e,i)||h}function Is(s,t,e,i,n){s.top=e,s.left=t,s.right=t+i,s.bottom=e+n,s.width=i,s.height=n}function wr(s,t,e,i){const n=e.padding;let{x:r,y:o}=t;for(const a of s){const l=a.box,c=i[a.stack]||{placed:0,weight:1},h=a.stackWeight/c.weight||1;if(a.horizontal){const u=t.w*h,d=c.size||l.height;ds(c.start)&&(o=c.start),l.fullSize?Is(l,n.left,o,e.outerWidth-n.right-n.left,d):Is(l,t.left+c.placed,o,u,d),c.start=o,c.placed+=u,o=l.bottom}else{const u=t.h*h,d=c.size||l.width;ds(c.start)&&(r=c.start),l.fullSize?Is(l,r,n.top,d,e.outerHeight-n.bottom-n.top):Is(l,r,t.top+c.placed,d,u),c.start=r,c.placed+=u,r=l.right}}t.x=r,t.y=o}var at={addBox(s,t){s.boxes||(s.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},s.boxes.push(t)},removeBox(s,t){const e=s.boxes?s.boxes.indexOf(t):-1;e!==-1&&s.boxes.splice(e,1)},configure(s,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(s,t,e,i){if(!s)return;const n=lt(s.options.layout.padding),r=Math.max(t-n.width,0),o=Math.max(e-n.height,0),a=zh(s.boxes),l=a.vertical,c=a.horizontal;$(s.boxes,p=>{typeof p.beforeLayout=="function"&&p.beforeLayout()});const h=l.reduce((p,m)=>m.box.options&&m.box.options.display===!1?p:p+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:e,padding:n,availableWidth:r,availableHeight:o,vBoxMaxWidth:r/2/h,hBoxMaxHeight:o/2}),d=Object.assign({},n);va(d,lt(i));const f=Object.assign({maxPadding:d,w:r,h:o,x:n.left,y:n.top},n),g=Uh(l.concat(c),u);es(a.fullSize,f,u,g),es(l,f,u,g),es(c,f,u,g)&&es(l,f,u,g),Vh(f),wr(a.leftAndTop,f,u,g),f.x+=f.w,f.y+=f.h,wr(a.rightAndBottom,f,u,g),s.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},$(a.chartArea,p=>{const m=p.box;Object.assign(m,s.chartArea),m.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class wa{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,n){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,n?Math.floor(e/n):i)}}isAttached(t){return!0}updateConfig(t){}}class qh extends wa{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Js="$chartjs",Kh={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},xr=s=>s===null||s==="";function Gh(s,t){const e=s.style,i=s.getAttribute("height"),n=s.getAttribute("width");if(s[Js]={initial:{height:i,width:n,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",xr(n)){const r=rr(s,"width");r!==void 0&&(s.width=r)}if(xr(i))if(s.style.height==="")s.height=s.width/(t||2);else{const r=rr(s,"height");r!==void 0&&(s.height=r)}return s}const xa=Wc?{passive:!0}:!1;function Jh(s,t,e){s&&s.addEventListener(t,e,xa)}function Yh(s,t,e){s&&s.canvas&&s.canvas.removeEventListener(t,e,xa)}function Xh(s,t){const e=Kh[s.type]||s.type,{x:i,y:n}=ae(s,t);return{type:e,chart:t,native:s,x:i!==void 0?i:null,y:n!==void 0?n:null}}function ii(s,t){for(const e of s)if(e===t||e.contains(t))return!0}function Zh(s,t,e){const i=s.canvas,n=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||ii(a.addedNodes,i),o=o&&!ii(a.removedNodes,i);o&&e()});return n.observe(document,{childList:!0,subtree:!0}),n}function Qh(s,t,e){const i=s.canvas,n=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||ii(a.removedNodes,i),o=o&&!ii(a.addedNodes,i);o&&e()});return n.observe(document,{childList:!0,subtree:!0}),n}const ps=new Map;let Sr=0;function Sa(){const s=window.devicePixelRatio;s!==Sr&&(Sr=s,ps.forEach((t,e)=>{e.currentDevicePixelRatio!==s&&t()}))}function tu(s,t){ps.size||window.addEventListener("resize",Sa),ps.set(s,t)}function eu(s){ps.delete(s),ps.size||window.removeEventListener("resize",Sa)}function su(s,t,e){const i=s.canvas,n=i&&Pn(i);if(!n)return;const r=Xo((a,l)=>{const c=n.clientWidth;e(a,l),c<n.clientWidth&&e()},window),o=new ResizeObserver(a=>{const l=a[0],c=l.contentRect.width,h=l.contentRect.height;c===0&&h===0||r(c,h)});return o.observe(n),tu(s,r),o}function Pi(s,t,e){e&&e.disconnect(),t==="resize"&&eu(s)}function iu(s,t,e){const i=s.canvas,n=Xo(r=>{s.ctx!==null&&e(Xh(r,s))},s);return Jh(i,t,n),n}class nu extends wa{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(Gh(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e[Js])return!1;const i=e[Js].initial;["height","width"].forEach(r=>{const o=i[r];D(o)?e.removeAttribute(r):e.setAttribute(r,o)});const n=i.style||{};return Object.keys(n).forEach(r=>{e.style[r]=n[r]}),e.width=e.width,delete e[Js],!0}addEventListener(t,e,i){this.removeEventListener(t,e);const n=t.$proxies||(t.$proxies={}),o={attach:Zh,detach:Qh,resize:su}[e]||iu;n[e]=o(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),n=i[e];if(!n)return;({attach:Pi,detach:Pi,resize:Pi}[e]||Yh)(t,e,n),i[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,n){return zc(t,e,i,n)}isAttached(t){const e=t&&Pn(t);return!!(e&&e.isConnected)}}function ru(s){return!Cn()||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas?qh:nu}class Nt{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return Fe(this.x)&&Fe(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const n={};return t.forEach(r=>{n[r]=i[r]&&i[r].active()?i[r]._to:this[r]}),n}}function ou(s,t){const e=s.options.ticks,i=au(s),n=Math.min(e.maxTicksLimit||i,i),r=e.major.enabled?cu(t):[],o=r.length,a=r[0],l=r[o-1],c=[];if(o>n)return hu(t,c,r,o/n),c;const h=lu(r,t,n);if(o>0){let u,d;const f=o>1?Math.round((l-a)/(o-1)):null;for(Ls(t,c,h,D(f)?0:a-f,a),u=0,d=o-1;u<d;u++)Ls(t,c,h,r[u],r[u+1]);return Ls(t,c,h,l,D(f)?t.length:l+f),c}return Ls(t,c,h),c}function au(s){const t=s.options.offset,e=s._tickSize(),i=s._length/e+(t?0:1),n=s._maxLength/e;return Math.floor(Math.min(i,n))}function lu(s,t,e){const i=uu(s),n=t.length/e;if(!i)return Math.max(n,1);const r=Hl(i);for(let o=0,a=r.length-1;o<a;o++){const l=r[o];if(l>n)return l}return Math.max(n,1)}function cu(s){const t=[];let e,i;for(e=0,i=s.length;e<i;e++)s[e].major&&t.push(e);return t}function hu(s,t,e,i){let n=0,r=e[0],o;for(i=Math.ceil(i),o=0;o<s.length;o++)o===r&&(t.push(s[o]),n++,r=e[n*i])}function Ls(s,t,e,i,n){const r=P(i,0),o=Math.min(P(n,s.length),s.length);let a=0,l,c,h;for(e=Math.ceil(e),n&&(l=n-i,e=l/Math.floor(l/e)),h=r;h<0;)a++,h=Math.round(r+a*e);for(c=Math.max(r,0);c<o;c++)c===h&&(t.push(s[c]),a++,h=Math.round(r+a*e))}function uu(s){const t=s.length;let e,i;if(t<2)return!1;for(i=s[0],e=1;e<t;++e)if(s[e]-s[e-1]!==i)return!1;return i}const du=s=>s==="left"?"right":s==="right"?"left":s,kr=(s,t,e)=>t==="top"||t==="left"?s[t]+e:s[t]-e,Er=(s,t)=>Math.min(t||s,s);function Tr(s,t){const e=[],i=s.length/t,n=s.length;let r=0;for(;r<n;r+=i)e.push(s[Math.floor(r)]);return e}function fu(s,t,e){const i=s.ticks.length,n=Math.min(t,i-1),r=s._startPixel,o=s._endPixel,a=1e-6;let l=s.getPixelForTick(n),c;if(!(e&&(i===1?c=Math.max(l-r,o-l):t===0?c=(s.getPixelForTick(1)-l)/2:c=(l-s.getPixelForTick(n-1))/2,l+=n<t?c:-c,l<r-a||l>o+a)))return l}function gu(s,t){$(s,e=>{const i=e.gc,n=i.length/2;let r;if(n>t){for(r=0;r<n;++r)delete e.data[i[r]];i.splice(0,n)}})}function Je(s){return s.drawTicks?s.tickLength:0}function Ar(s,t){if(!s.display)return 0;const e=X(s.font,t),i=lt(s.padding);return(W(s.text)?s.text.length:1)*e.lineHeight+i.height}function pu(s,t){return Xt(s,{scale:t,type:"scale"})}function mu(s,t,e){return Xt(s,{tick:e,index:t,type:"tick"})}function bu(s,t,e){let i=Sn(s);return(e&&t!=="right"||!e&&t==="right")&&(i=du(i)),i}function yu(s,t,e,i){const{top:n,left:r,bottom:o,right:a,chart:l}=s,{chartArea:c,scales:h}=l;let u=0,d,f,g;const p=o-n,m=a-r;if(s.isHorizontal()){if(f=rt(i,r,a),I(e)){const b=Object.keys(e)[0],y=e[b];g=h[b].getPixelForValue(y)+p-t}else e==="center"?g=(c.bottom+c.top)/2+p-t:g=kr(s,e,t);d=a-r}else{if(I(e)){const b=Object.keys(e)[0],y=e[b];f=h[b].getPixelForValue(y)-m+t}else e==="center"?f=(c.left+c.right)/2-m+t:f=kr(s,e,t);g=rt(i,o,n),u=e==="left"?-G:G}return{titleX:f,titleY:g,maxWidth:d,rotation:u}}class _e extends Nt{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:n}=this;return t=pt(t,Number.POSITIVE_INFINITY),e=pt(e,Number.NEGATIVE_INFINITY),i=pt(i,Number.POSITIVE_INFINITY),n=pt(n,Number.NEGATIVE_INFINITY),{min:pt(t,i),max:pt(e,n),minDefined:q(t),maxDefined:q(e)}}getMinMax(t){let{min:e,max:i,minDefined:n,maxDefined:r}=this.getUserBounds(),o;if(n&&r)return{min:e,max:i};const a=this.getMatchingVisibleMetas();for(let l=0,c=a.length;l<c;++l)o=a[l].controller.getMinMax(this,t),n||(e=Math.min(e,o.min)),r||(i=Math.max(i,o.max));return e=r&&e>i?i:e,i=n&&e>i?e:i,{min:pt(e,pt(i,e)),max:pt(i,pt(e,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){F(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:n,grace:r,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=vc(this,r,n),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?Tr(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=ou(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,i;this.isHorizontal()?(e=this.left,i=this.right):(e=this.top,i=this.bottom,t=!t),this._startPixel=e,this._endPixel=i,this._reversePixels=t,this._length=i-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){F(this.options.afterUpdate,[this])}beforeSetDimensions(){F(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){F(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),F(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){F(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,n,r;for(i=0,n=t.length;i<n;i++)r=t[i],r.label=F(e.callback,[r.value,i,t],this)}afterTickToLabelConversion(){F(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){F(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=Er(this.ticks.length,t.ticks.maxTicksLimit),n=e.minRotation||0,r=e.maxRotation;let o=n,a,l,c;if(!this._isVisible()||!e.display||n>=r||i<=1||!this.isHorizontal()){this.labelRotation=n;return}const h=this._getLabelSizes(),u=h.widest.width,d=h.highest.height,f=Q(this.chart.width-u,0,this.maxWidth);a=t.offset?this.maxWidth/i:f/(i-1),u+6>a&&(a=f/(i-(t.offset?.5:1)),l=this.maxHeight-Je(t.grid)-e.padding-Ar(t.title,this.chart.options.font),c=Math.sqrt(u*u+d*d),o=wn(Math.min(Math.asin(Q((h.highest.height+6)/a,-1,1)),Math.asin(Q(l/c,-1,1))-Math.asin(Q(d/c,-1,1)))),o=Math.max(n,Math.min(r,o))),this.labelRotation=o}afterCalculateLabelRotation(){F(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){F(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:n,grid:r}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const l=Ar(n,e.options.font);if(a?(t.width=this.maxWidth,t.height=Je(r)+l):(t.height=this.maxHeight,t.width=Je(r)+l),i.display&&this.ticks.length){const{first:c,last:h,widest:u,highest:d}=this._getLabelSizes(),f=i.padding*2,g=St(this.labelRotation),p=Math.cos(g),m=Math.sin(g);if(a){const b=i.mirror?0:m*u.width+p*d.height;t.height=Math.min(this.maxHeight,t.height+b+f)}else{const b=i.mirror?0:p*u.width+m*d.height;t.width=Math.min(this.maxWidth,t.width+b+f)}this._calculatePadding(c,h,m,p)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,n){const{ticks:{align:r,padding:o},position:a}=this.options,l=this.labelRotation!==0,c=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const h=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let d=0,f=0;l?c?(d=n*t.width,f=i*e.height):(d=i*t.height,f=n*e.width):r==="start"?f=e.width:r==="end"?d=t.width:r!=="inner"&&(d=t.width/2,f=e.width/2),this.paddingLeft=Math.max((d-h+o)*this.width/(this.width-h),0),this.paddingRight=Math.max((f-u+o)*this.width/(this.width-u),0)}else{let h=e.height/2,u=t.height/2;r==="start"?(h=0,u=t.height):r==="end"&&(h=e.height,u=0),this.paddingTop=h+o,this.paddingBottom=u+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){F(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,i;for(e=0,i=t.length;e<i;e++)D(t[e].label)&&(t.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=Tr(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,i){const{ctx:n,_longestTextCache:r}=this,o=[],a=[],l=Math.floor(e/Er(e,i));let c=0,h=0,u,d,f,g,p,m,b,y,_,v,w;for(u=0;u<e;u+=l){if(g=t[u].label,p=this._resolveTickFontOptions(u),n.font=m=p.string,b=r[m]=r[m]||{data:{},gc:[]},y=p.lineHeight,_=v=0,!D(g)&&!W(g))_=ei(n,b.data,b.gc,_,g),v=y;else if(W(g))for(d=0,f=g.length;d<f;++d)w=g[d],!D(w)&&!W(w)&&(_=ei(n,b.data,b.gc,_,w),v+=y);o.push(_),a.push(v),c=Math.max(_,c),h=Math.max(v,h)}gu(r,e);const x=o.indexOf(c),S=a.indexOf(h),E=T=>({width:o[T]||0,height:a[T]||0});return{first:E(0),last:E(e-1),widest:E(x),highest:E(S),widths:o,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return Jl(this._alignToPixels?se(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=mu(this.getContext(),t,i))}return this.$context||(this.$context=pu(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=St(this.labelRotation),i=Math.abs(Math.cos(e)),n=Math.abs(Math.sin(e)),r=this._getLabelSizes(),o=t.autoSkipPadding||0,a=r?r.widest.width+o:0,l=r?r.highest.height+o:0;return this.isHorizontal()?l*i>a*n?a/i:l/n:l*n<a*i?l/i:a/n}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,n=this.options,{grid:r,position:o,border:a}=n,l=r.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),d=Je(r),f=[],g=a.setContext(this.getContext()),p=g.display?g.width:0,m=p/2,b=function(z){return se(i,z,p)};let y,_,v,w,x,S,E,T,R,M,L,et;if(o==="top")y=b(this.bottom),S=this.bottom-d,T=y-m,M=b(t.top)+m,et=t.bottom;else if(o==="bottom")y=b(this.top),M=t.top,et=b(t.bottom)-m,S=y+m,T=this.top+d;else if(o==="left")y=b(this.right),x=this.right-d,E=y-m,R=b(t.left)+m,L=t.right;else if(o==="right")y=b(this.left),R=t.left,L=b(t.right)-m,x=y+m,E=this.left+d;else if(e==="x"){if(o==="center")y=b((t.top+t.bottom)/2+.5);else if(I(o)){const z=Object.keys(o)[0],K=o[z];y=b(this.chart.scales[z].getPixelForValue(K))}M=t.top,et=t.bottom,S=y+m,T=S+d}else if(e==="y"){if(o==="center")y=b((t.left+t.right)/2);else if(I(o)){const z=Object.keys(o)[0],K=o[z];y=b(this.chart.scales[z].getPixelForValue(K))}x=y-m,E=x-d,R=t.left,L=t.right}const ft=P(n.ticks.maxTicksLimit,u),N=Math.max(1,Math.ceil(u/ft));for(_=0;_<u;_+=N){const z=this.getContext(_),K=r.setContext(z),_t=a.setContext(z),nt=K.lineWidth,we=K.color,As=_t.dash||[],xe=_t.dashOffset,Ve=K.tickWidth,Qt=K.tickColor,He=K.tickBorderDash||[],te=K.tickBorderDashOffset;v=fu(this,_,l),v!==void 0&&(w=se(i,v,nt),c?x=E=R=L=w:S=T=M=et=w,f.push({tx1:x,ty1:S,tx2:E,ty2:T,x1:R,y1:M,x2:L,y2:et,width:nt,color:we,borderDash:As,borderDashOffset:xe,tickWidth:Ve,tickColor:Qt,tickBorderDash:He,tickBorderDashOffset:te}))}return this._ticksLength=u,this._borderValue=y,f}_computeLabelItems(t){const e=this.axis,i=this.options,{position:n,ticks:r}=i,o=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:c,padding:h,mirror:u}=r,d=Je(i.grid),f=d+h,g=u?-h:f,p=-St(this.labelRotation),m=[];let b,y,_,v,w,x,S,E,T,R,M,L,et="middle";if(n==="top")x=this.bottom-g,S=this._getXAxisLabelAlignment();else if(n==="bottom")x=this.top+g,S=this._getXAxisLabelAlignment();else if(n==="left"){const N=this._getYAxisLabelAlignment(d);S=N.textAlign,w=N.x}else if(n==="right"){const N=this._getYAxisLabelAlignment(d);S=N.textAlign,w=N.x}else if(e==="x"){if(n==="center")x=(t.top+t.bottom)/2+f;else if(I(n)){const N=Object.keys(n)[0],z=n[N];x=this.chart.scales[N].getPixelForValue(z)+f}S=this._getXAxisLabelAlignment()}else if(e==="y"){if(n==="center")w=(t.left+t.right)/2-f;else if(I(n)){const N=Object.keys(n)[0],z=n[N];w=this.chart.scales[N].getPixelForValue(z)}S=this._getYAxisLabelAlignment(d).textAlign}e==="y"&&(l==="start"?et="top":l==="end"&&(et="bottom"));const ft=this._getLabelSizes();for(b=0,y=a.length;b<y;++b){_=a[b],v=_.label;const N=r.setContext(this.getContext(b));E=this.getPixelForTick(b)+r.labelOffset,T=this._resolveTickFontOptions(b),R=T.lineHeight,M=W(v)?v.length:1;const z=M/2,K=N.color,_t=N.textStrokeColor,nt=N.textStrokeWidth;let we=S;o?(w=E,S==="inner"&&(b===y-1?we=this.options.reverse?"left":"right":b===0?we=this.options.reverse?"right":"left":we="center"),n==="top"?c==="near"||p!==0?L=-M*R+R/2:c==="center"?L=-ft.highest.height/2-z*R+R:L=-ft.highest.height+R/2:c==="near"||p!==0?L=R/2:c==="center"?L=ft.highest.height/2-z*R:L=ft.highest.height-M*R,u&&(L*=-1),p!==0&&!N.showLabelBackdrop&&(w+=R/2*Math.sin(p))):(x=E,L=(1-M)*R/2);let As;if(N.showLabelBackdrop){const xe=lt(N.backdropPadding),Ve=ft.heights[b],Qt=ft.widths[b];let He=L-xe.top,te=0-xe.left;switch(et){case"middle":He-=Ve/2;break;case"bottom":He-=Ve;break}switch(S){case"center":te-=Qt/2;break;case"right":te-=Qt;break;case"inner":b===y-1?te-=Qt:b>0&&(te-=Qt/2);break}As={left:te,top:He,width:Qt+xe.width,height:Ve+xe.height,color:N.backdropColor}}m.push({label:v,font:T,textOffset:L,options:{rotation:p,color:K,strokeColor:_t,strokeWidth:nt,textAlign:we,textBaseline:et,translation:[w,x],backdrop:As}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-St(this.labelRotation))return t==="top"?"left":"right";let n="center";return e.align==="start"?n="left":e.align==="end"?n="right":e.align==="inner"&&(n="inner"),n}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:n,padding:r}}=this.options,o=this._getLabelSizes(),a=t+r,l=o.widest.width;let c,h;return e==="left"?n?(h=this.right+r,i==="near"?c="left":i==="center"?(c="center",h+=l/2):(c="right",h+=l)):(h=this.right-a,i==="near"?c="right":i==="center"?(c="center",h-=l/2):(c="left",h=this.left)):e==="right"?n?(h=this.left+r,i==="near"?c="right":i==="center"?(c="center",h-=l/2):(c="left",h-=l)):(h=this.left+a,i==="near"?c="left":i==="center"?(c="center",h+=l/2):(c="right",h=this.right)):c="right",{textAlign:c,x:h}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:n,width:r,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,n,r,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const n=this.ticks.findIndex(r=>r.value===t);return n>=0?e.setContext(this.getContext(n)).lineWidth:0}drawGrid(t){const e=this.options.grid,i=this.ctx,n=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,o;const a=(l,c,h)=>{!h.width||!h.color||(i.save(),i.lineWidth=h.width,i.strokeStyle=h.color,i.setLineDash(h.borderDash||[]),i.lineDashOffset=h.borderDashOffset,i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(c.x,c.y),i.stroke(),i.restore())};if(e.display)for(r=0,o=n.length;r<o;++r){const l=n[r];e.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),e.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:i,grid:n}}=this,r=i.setContext(this.getContext()),o=i.display?r.width:0;if(!o)return;const a=n.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,h,u,d;this.isHorizontal()?(c=se(t,this.left,o)-o/2,h=se(t,this.right,a)+a/2,u=d=l):(u=se(t,this.top,o)-o/2,d=se(t,this.bottom,a)+a/2,c=h=l),e.save(),e.lineWidth=r.width,e.strokeStyle=r.color,e.beginPath(),e.moveTo(c,u),e.lineTo(h,d),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,n=this._computeLabelArea();n&&hi(i,n);const r=this.getLabelItems(t);for(const o of r){const a=o.options,l=o.font,c=o.label,h=o.textOffset;ye(i,c,0,h,l,a)}n&&ui(i)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:n}}=this;if(!i.display)return;const r=X(i.font),o=lt(i.padding),a=i.align;let l=r.lineHeight/2;e==="bottom"||e==="center"||I(e)?(l+=o.bottom,W(i.text)&&(l+=r.lineHeight*(i.text.length-1))):l+=o.top;const{titleX:c,titleY:h,maxWidth:u,rotation:d}=yu(this,l,e,a);ye(t,i.text,0,0,r,{color:i.color,maxWidth:u,rotation:d,textAlign:bu(a,e,n),textBaseline:"middle",translation:[c,h]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=P(t.grid&&t.grid.z,-1),n=P(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==_e.prototype.draw?[{z:e,draw:r=>{this.draw(r)}}]:[{z:i,draw:r=>{this.drawBackground(),this.drawGrid(r),this.drawTitle()}},{z:n,draw:()=>{this.drawBorder()}},{z:e,draw:r=>{this.drawLabels(r)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",n=[];let r,o;for(r=0,o=e.length;r<o;++r){const a=e[r];a[i]===this.id&&(!t||a.type===t)&&n.push(a)}return n}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return X(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class js{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;wu(e)&&(i=this.register(e));const n=this.items,r=t.id,o=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in n||(n[r]=t,_u(t,o,i),this.override&&V.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,n=this.scope;i in e&&delete e[i],n&&i in V[n]&&(delete V[n][i],this.override&&delete be[i])}}function _u(s,t,e){const i=us(Object.create(null),[e?V.get(e):{},V.get(t),s.defaults]);V.set(t,i),s.defaultRoutes&&vu(t,s.defaultRoutes),s.descriptors&&V.describe(t,s.descriptors)}function vu(s,t){Object.keys(t).forEach(e=>{const i=e.split("."),n=i.pop(),r=[s].concat(i).join("."),o=t[e].split("."),a=o.pop(),l=o.join(".");V.route(r,n,l,a)})}function wu(s){return"id"in s&&"defaults"in s}class xu{constructor(){this.controllers=new js(Zt,"datasets",!0),this.elements=new js(Nt,"elements"),this.plugins=new js(Object,"plugins"),this.scales=new js(_e,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach(n=>{const r=i||this._getRegistryForType(n);i||r.isForType(n)||r===this.plugins&&n.id?this._exec(t,r,n):$(n,o=>{const a=i||this._getRegistryForType(o);this._exec(t,a,o)})})}_exec(t,e,i){const n=vn(t);F(i["before"+n],[],i),e[t](i),F(i["after"+n],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const n=e.get(t);if(n===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return n}}var Et=new xu;class Su{constructor(){this._init=void 0}notify(t,e,i,n){if(e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const r=n?this._descriptors(t).filter(n):this._descriptors(t),o=this._notify(r,t,e,i);return e==="afterDestroy"&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),o}_notify(t,e,i,n){n=n||{};for(const r of t){const o=r.plugin,a=o[i],l=[e,n,r.options];if(F(a,l,o)===!1&&n.cancelable)return!1}return!0}invalidate(){D(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,n=P(i.options&&i.options.plugins,{}),r=ku(i);return n===!1&&!e?[]:Tu(t,r,n,e)}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,n=(r,o)=>r.filter(a=>!o.some(l=>a.plugin.id===l.plugin.id));this._notify(n(e,i),t,"stop"),this._notify(n(i,e),t,"start")}}function ku(s){const t={},e=[],i=Object.keys(Et.plugins.items);for(let r=0;r<i.length;r++)e.push(Et.getPlugin(i[r]));const n=s.plugins||[];for(let r=0;r<n.length;r++){const o=n[r];e.indexOf(o)===-1&&(e.push(o),t[o.id]=!0)}return{plugins:e,localIds:t}}function Eu(s,t){return!t&&s===!1?null:s===!0?{}:s}function Tu(s,{plugins:t,localIds:e},i,n){const r=[],o=s.getContext();for(const a of t){const l=a.id,c=Eu(i[l],n);c!==null&&r.push({plugin:a,options:Au(s.config,{plugin:a,local:e[l]},c,o)})}return r}function Au(s,{plugin:t,local:e},i,n){const r=s.pluginScopeKeys(t),o=s.getOptionScopes(i,r);return e&&t.defaults&&o.push(t.defaults),s.createResolver(o,n,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Xi(s,t){const e=V.datasets[s]||{};return((t.datasets||{})[s]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function Ou(s,t){let e=s;return s==="_index_"?e=t:s==="_value_"&&(e=t==="x"?"y":"x"),e}function Cu(s,t){return s===t?"_index_":"_value_"}function Or(s){if(s==="x"||s==="y"||s==="r")return s}function Pu(s){if(s==="top"||s==="bottom")return"x";if(s==="left"||s==="right")return"y"}function Zi(s,...t){if(Or(s))return s;for(const e of t){const i=e.axis||Pu(e.position)||s.length>1&&Or(s[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${s}' axis. Please provide 'axis' or 'position' option.`)}function Cr(s,t,e){if(e[t+"AxisID"]===s)return{axis:t}}function Ru(s,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(i=>i.xAxisID===s||i.yAxisID===s);if(e.length)return Cr(s,"x",e[0])||Cr(s,"y",e[0])}return{}}function Mu(s,t){const e=be[s.type]||{scales:{}},i=t.scales||{},n=Xi(s.type,t),r=Object.create(null);return Object.keys(i).forEach(o=>{const a=i[o];if(!I(a))return console.error(`Invalid scale configuration for scale: ${o}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const l=Zi(o,a,Ru(o,s),V.scales[a.type]),c=Cu(l,n),h=e.scales||{};r[o]=ns(Object.create(null),[{axis:l},a,h[l],h[c]])}),s.data.datasets.forEach(o=>{const a=o.type||s.type,l=o.indexAxis||Xi(a,t),h=(be[a]||{}).scales||{};Object.keys(h).forEach(u=>{const d=Ou(u,l),f=o[d+"AxisID"]||d;r[f]=r[f]||Object.create(null),ns(r[f],[{axis:d},i[f],h[u]])})}),Object.keys(r).forEach(o=>{const a=r[o];ns(a,[V.scales[a.type],V.scale])}),r}function ka(s){const t=s.options||(s.options={});t.plugins=P(t.plugins,{}),t.scales=Mu(s,t)}function Ea(s){return s=s||{},s.datasets=s.datasets||[],s.labels=s.labels||[],s}function Du(s){return s=s||{},s.data=Ea(s.data),ka(s),s}const Pr=new Map,Ta=new Set;function $s(s,t){let e=Pr.get(s);return e||(e=t(),Pr.set(s,e),Ta.add(e)),e}const Ye=(s,t,e)=>{const i=Jt(t,e);i!==void 0&&s.add(i)};class Iu{constructor(t){this._config=Du(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=Ea(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),ka(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return $s(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return $s(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return $s(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,i=this.type;return $s(`${i}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const i=this._scopeCache;let n=i.get(t);return(!n||e)&&(n=new Map,i.set(t,n)),n}getOptionScopes(t,e,i){const{options:n,type:r}=this,o=this._cachedScopes(t,i),a=o.get(e);if(a)return a;const l=new Set;e.forEach(h=>{t&&(l.add(t),h.forEach(u=>Ye(l,t,u))),h.forEach(u=>Ye(l,n,u)),h.forEach(u=>Ye(l,be[r]||{},u)),h.forEach(u=>Ye(l,V,u)),h.forEach(u=>Ye(l,Ji,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),Ta.has(e)&&o.set(e,c),c}chartOptionScopes(){const{options:t,type:e}=this;return[t,be[e]||{},V.datasets[e]||{},{type:e},V,Ji]}resolveNamedOptions(t,e,i,n=[""]){const r={$shared:!0},{resolver:o,subPrefixes:a}=Rr(this._resolverCache,t,n);let l=o;if(ju(o,e)){r.$shared=!1,i=Yt(i)?i():i;const c=this.createResolver(t,i,a);l=Ue(o,i,c)}for(const c of e)r[c]=l[c];return r}createResolver(t,e,i=[""],n){const{resolver:r}=Rr(this._resolverCache,t,i);return I(e)?Ue(r,e,void 0,n):r}}function Rr(s,t,e){let i=s.get(t);i||(i=new Map,s.set(t,i));const n=e.join();let r=i.get(n);return r||(r={resolver:Tn(t,e),subPrefixes:e.filter(a=>!a.toLowerCase().includes("hover"))},i.set(n,r)),r}const Lu=s=>I(s)&&Object.getOwnPropertyNames(s).some(t=>Yt(s[t]));function ju(s,t){const{isScriptable:e,isIndexable:i}=ia(s);for(const n of t){const r=e(n),o=i(n),a=(o||r)&&s[n];if(r&&(Yt(a)||Lu(a))||o&&W(a))return!0}return!1}var $u="4.5.1";const Nu=["top","bottom","left","right","chartArea"];function Mr(s,t){return s==="top"||s==="bottom"||Nu.indexOf(s)===-1&&t==="x"}function Dr(s,t){return function(e,i){return e[s]===i[s]?e[t]-i[t]:e[s]-i[s]}}function Ir(s){const t=s.chart,e=t.options.animation;t.notifyPlugins("afterRender"),F(e&&e.onComplete,[s],t)}function Bu(s){const t=s.chart,e=t.options.animation;F(e&&e.onProgress,[s],t)}function Aa(s){return Cn()&&typeof s=="string"?s=document.getElementById(s):s&&s.length&&(s=s[0]),s&&s.canvas&&(s=s.canvas),s}const Ys={},Lr=s=>{const t=Aa(s);return Object.values(Ys).filter(e=>e.canvas===t).pop()};function Fu(s,t,e){const i=Object.keys(s);for(const n of i){const r=+n;if(r>=t){const o=s[n];delete s[n],(e>0||r>t)&&(s[r+e]=o)}}}function Uu(s,t,e,i){return!e||s.type==="mouseout"?null:i?t:s}class Dn{static defaults=V;static instances=Ys;static overrides=be;static registry=Et;static version=$u;static getChart=Lr;static register(...t){Et.add(...t),jr()}static unregister(...t){Et.remove(...t),jr()}constructor(t,e){const i=this.config=new Iu(e),n=Aa(t),r=Lr(n);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const o=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||ru(n)),this.platform.updateConfig(i);const a=this.platform.acquireContext(n,o.aspectRatio),l=a&&a.canvas,c=l&&l.height,h=l&&l.width;if(this.id=jl(),this.ctx=a,this.canvas=l,this.width=h,this.height=c,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Su,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Ql(u=>this.update(u),o.resizeDelay||0),this._dataChanges=[],Ys[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Ct.listen(this,"complete",Ir),Ct.listen(this,"progress",Bu),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:i,height:n,_aspectRatio:r}=this;return D(t)?e&&r?r:n?i/n:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Et}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():nr(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return er(this.canvas,this.ctx),this}stop(){return Ct.stop(this),this}resize(t,e){Ct.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,n=this.canvas,r=i.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(n,t,e,r),a=i.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,nr(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),F(i.onResize,[this,o],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};$(e,(i,n)=>{i.id=n})}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,n=Object.keys(i).reduce((o,a)=>(o[a]=!1,o),{});let r=[];e&&(r=r.concat(Object.keys(e).map(o=>{const a=e[o],l=Zi(o,a),c=l==="r",h=l==="x";return{options:a,dposition:c?"chartArea":h?"bottom":"left",dtype:c?"radialLinear":h?"category":"linear"}}))),$(r,o=>{const a=o.options,l=a.id,c=Zi(l,a),h=P(a.type,o.dtype);(a.position===void 0||Mr(a.position,c)!==Mr(o.dposition))&&(a.position=o.dposition),n[l]=!0;let u=null;if(l in i&&i[l].type===h)u=i[l];else{const d=Et.getScale(h);u=new d({id:l,type:h,ctx:this.ctx,chart:this}),i[u.id]=u}u.init(a,t)}),$(n,(o,a)=>{o||delete i[a]}),$(i,o=>{at.configure(this,o,o.options),at.addBox(this,o)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort((n,r)=>n.index-r.index),i>e){for(let n=e;n<i;++n)this._destroyDatasetMeta(n);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(Dr("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((i,n)=>{e.filter(r=>r===i._dataset).length===0&&this._destroyDatasetMeta(n)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,n;for(this._removeUnreferencedMetasets(),i=0,n=e.length;i<n;i++){const r=e[i];let o=this.getDatasetMeta(i);const a=r.type||this.config.type;if(o.type&&o.type!==a&&(this._destroyDatasetMeta(i),o=this.getDatasetMeta(i)),o.type=a,o.indexAxis=r.indexAxis||Xi(a,this.options),o.order=r.order||0,o.index=i,o.label=""+r.label,o.visible=this.isDatasetVisible(i),o.controller)o.controller.updateIndex(i),o.controller.linkScales();else{const l=Et.getController(a),{datasetElementType:c,dataElementType:h}=V.datasets[a];Object.assign(l,{dataElementType:Et.getElement(h),datasetElementType:c&&Et.getElement(c)}),o.controller=new l(this,i),t.push(o.controller)}}return this._updateMetasets(),t}_resetElements(){$(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),n=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let c=0,h=this.data.datasets.length;c<h;c++){const{controller:u}=this.getDatasetMeta(c),d=!n&&r.indexOf(u)===-1;u.buildOrUpdateElements(d),o=Math.max(+u.getMaxOverflow(),o)}o=this._minPadding=i.layout.autoPadding?o:0,this._updateLayout(o),n||$(r,c=>{c.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(Dr("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){$(this.scales,t=>{at.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!qn(e,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:n,count:r}of e){const o=i==="_removeElements"?-r:r;Fu(t,n,o)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=r=>new Set(t.filter(o=>o[0]===r).map((o,a)=>a+","+o.splice(1).join(","))),n=i(0);for(let r=1;r<e;r++)if(!qn(n,i(r)))return;return Array.from(n).map(r=>r.split(",")).map(r=>({method:r[1],start:+r[2],count:+r[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;at.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],$(this.boxes,n=>{i&&n.position==="chartArea"||(n.configure&&n.configure(),this._layers.push(...n._layers()))},this),this._layers.forEach((n,r)=>{n._idx=r}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,i=this.data.datasets.length;e<i;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,Yt(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),n={meta:i,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",n)!==!1&&(i.controller._update(e),n.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",n))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Ct.has(this)?this.attached&&!Ct.running(this)&&Ct.start(this):(this.draw(),Ir({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:n}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,n)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let n,r;for(n=0,r=e.length;n<r;++n){const o=e[n];(!t||o.visible)&&i.push(o)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i={meta:t,index:t.index,cancelable:!0},n=ga(this,t);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(n&&hi(e,n),t.controller.draw(),n&&ui(e),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return $t(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,i,n){const r=Nh.modes[e];return typeof r=="function"?r(this,t,i,n):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let n=i.filter(r=>r&&r._dataset===e).pop();return n||(n={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(n)),n}getContext(){return this.$context||(this.$context=Xt(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!e.hidden}setDatasetVisibility(t,e){const i=this.getDatasetMeta(t);i.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const n=i?"show":"hide",r=this.getDatasetMeta(t),o=r.controller._resolveAnimations(void 0,n);ds(e)?(r.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),o.update(r,{visible:i}),this.update(a=>a.datasetIndex===t?n:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),Ct.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),er(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete Ys[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(r,o)=>{e.addEventListener(this,r,o),t[r]=o},n=(r,o,a)=>{r.offsetX=o,r.offsetY=a,this._eventHandler(r)};$(this.options.events,r=>i(r,n))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(l,c)=>{e.addEventListener(this,l,c),t[l]=c},n=(l,c)=>{t[l]&&(e.removeEventListener(this,l,c),delete t[l])},r=(l,c)=>{this.canvas&&this.resize(l,c)};let o;const a=()=>{n("attach",a),this.attached=!0,this.resize(),i("resize",r),i("detach",o)};o=()=>{this.attached=!1,n("resize",r),this._stop(),this._resize(0,0),i("attach",a)},e.isAttached(this.canvas)?a():o()}unbindEvents(){$(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},$(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const n=i?"set":"remove";let r,o,a,l;for(e==="dataset"&&(r=this.getDatasetMeta(t[0].datasetIndex),r.controller["_"+n+"DatasetHoverStyle"]()),a=0,l=t.length;a<l;++a){o=t[a];const c=o&&this.getDatasetMeta(o.datasetIndex).controller;c&&c[n+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map(({datasetIndex:r,index:o})=>{const a=this.getDatasetMeta(r);if(!a)throw new Error("No dataset found at index "+r);return{datasetIndex:r,element:a.data[o],index:o}});!Zs(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,i){const n=this.options.hover,r=(l,c)=>l.filter(h=>!c.some(u=>h.datasetIndex===u.datasetIndex&&h.index===u.index)),o=r(e,t),a=i?t:r(t,e);o.length&&this.updateHoverStyle(o,n.mode,!1),a.length&&n.mode&&this.updateHoverStyle(a,n.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},n=o=>(o.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,n)===!1)return;const r=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,n),(r||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:n=[],options:r}=this,o=e,a=this._getActiveElements(t,n,i,o),l=zl(t),c=Uu(t,this._lastEvent,i,l);i&&(this._lastEvent=null,F(r.onHover,[t,a,this],this),l&&F(r.onClick,[t,a,this],this));const h=!Zs(a,n);return(h||e)&&(this._active=a,this._updateHoverStyles(a,n,e)),this._lastEvent=c,h}_getActiveElements(t,e,i,n){if(t.type==="mouseout")return[];if(!i)return e;const r=this.options.hover;return this.getElementsAtEventForMode(t,r.mode,r,n)}}function jr(){return $(Dn.instances,s=>s._plugins.invalidate())}function zu(s,t,e){const{startAngle:i,x:n,y:r,outerRadius:o,innerRadius:a,options:l}=t,{borderWidth:c,borderJoinStyle:h}=l,u=Math.min(c/o,ot(i-e));if(s.beginPath(),s.arc(n,r,o-c/2,i+u/2,e-u/2),a>0){const d=Math.min(c/a,ot(i-e));s.arc(n,r,a+c/2,e-d/2,i+d/2,!0)}else{const d=Math.min(c/2,o*ot(i-e));if(h==="round")s.arc(n,r,d,e-j/2,i+j/2,!0);else if(h==="bevel"){const f=2*d*d,g=-f*Math.cos(e+j/2)+n,p=-f*Math.sin(e+j/2)+r,m=f*Math.cos(i+j/2)+n,b=f*Math.sin(i+j/2)+r;s.lineTo(g,p),s.lineTo(m,b)}}s.closePath(),s.moveTo(0,0),s.rect(0,0,s.canvas.width,s.canvas.height),s.clip("evenodd")}function Wu(s,t,e){const{startAngle:i,pixelMargin:n,x:r,y:o,outerRadius:a,innerRadius:l}=t;let c=n/a;s.beginPath(),s.arc(r,o,a,i-c,e+c),l>n?(c=n/l,s.arc(r,o,l,e+c,i-c,!0)):s.arc(r,o,n,e+G,i-G),s.closePath(),s.clip()}function Vu(s){return En(s,["outerStart","outerEnd","innerStart","innerEnd"])}function Hu(s,t,e,i){const n=Vu(s.options.borderRadius),r=(e-t)/2,o=Math.min(r,i*t/2),a=l=>{const c=(e-Math.min(r,l))*i/2;return Q(l,0,Math.min(r,c))};return{outerStart:a(n.outerStart),outerEnd:a(n.outerEnd),innerStart:Q(n.innerStart,0,o),innerEnd:Q(n.innerEnd,0,o)}}function ke(s,t,e,i){return{x:e+s*Math.cos(t),y:i+s*Math.sin(t)}}function ni(s,t,e,i,n,r){const{x:o,y:a,startAngle:l,pixelMargin:c,innerRadius:h}=t,u=Math.max(t.outerRadius+i+e-c,0),d=h>0?h+i+e+c:0;let f=0;const g=n-l;if(i){const N=h>0?h-i:0,z=u>0?u-i:0,K=(N+z)/2,_t=K!==0?g*K/(K+i):g;f=(g-_t)/2}const p=Math.max(.001,g*u-e/j)/u,m=(g-p)/2,b=l+m+f,y=n-m-f,{outerStart:_,outerEnd:v,innerStart:w,innerEnd:x}=Hu(t,d,u,y-b),S=u-_,E=u-v,T=b+_/S,R=y-v/E,M=d+w,L=d+x,et=b+w/M,ft=y-x/L;if(s.beginPath(),r){const N=(T+R)/2;if(s.arc(o,a,u,T,N),s.arc(o,a,u,N,R),v>0){const nt=ke(E,R,o,a);s.arc(nt.x,nt.y,v,R,y+G)}const z=ke(L,y,o,a);if(s.lineTo(z.x,z.y),x>0){const nt=ke(L,ft,o,a);s.arc(nt.x,nt.y,x,y+G,ft+Math.PI)}const K=(y-x/d+(b+w/d))/2;if(s.arc(o,a,d,y-x/d,K,!0),s.arc(o,a,d,K,b+w/d,!0),w>0){const nt=ke(M,et,o,a);s.arc(nt.x,nt.y,w,et+Math.PI,b-G)}const _t=ke(S,b,o,a);if(s.lineTo(_t.x,_t.y),_>0){const nt=ke(S,T,o,a);s.arc(nt.x,nt.y,_,b-G,T)}}else{s.moveTo(o,a);const N=Math.cos(T)*u+o,z=Math.sin(T)*u+a;s.lineTo(N,z);const K=Math.cos(R)*u+o,_t=Math.sin(R)*u+a;s.lineTo(K,_t)}s.closePath()}function qu(s,t,e,i,n){const{fullCircles:r,startAngle:o,circumference:a}=t;let l=t.endAngle;if(r){ni(s,t,e,i,l,n);for(let c=0;c<r;++c)s.fill();isNaN(a)||(l=o+(a%U||U))}return ni(s,t,e,i,l,n),s.fill(),l}function Ku(s,t,e,i,n){const{fullCircles:r,startAngle:o,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:h,borderDash:u,borderDashOffset:d,borderRadius:f}=l,g=l.borderAlign==="inner";if(!c)return;s.setLineDash(u||[]),s.lineDashOffset=d,g?(s.lineWidth=c*2,s.lineJoin=h||"round"):(s.lineWidth=c,s.lineJoin=h||"bevel");let p=t.endAngle;if(r){ni(s,t,e,i,p,n);for(let m=0;m<r;++m)s.stroke();isNaN(a)||(p=o+(a%U||U))}g&&Wu(s,t,p),l.selfJoin&&p-o>=j&&f===0&&h!=="miter"&&zu(s,t,p),r||(ni(s,t,e,i,p,n),s.stroke())}class Gu extends Nt{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:t=>t!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,i){const n=this.getProps(["x","y"],i),{angle:r,distance:o}=Ko(n,{x:t,y:e}),{startAngle:a,endAngle:l,innerRadius:c,outerRadius:h,circumference:u}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),d=(this.options.spacing+this.options.borderWidth)/2,f=P(u,l-a),g=fs(r,a,l)&&a!==l,p=f>=U||g,m=Lt(o,c+d,h+d);return p&&m}getCenterPoint(t){const{x:e,y:i,startAngle:n,endAngle:r,innerRadius:o,outerRadius:a}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],t),{offset:l,spacing:c}=this.options,h=(n+r)/2,u=(o+a+c+l)/2;return{x:e+Math.cos(h)*u,y:i+Math.sin(h)*u}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:i}=this,n=(e.offset||0)/4,r=(e.spacing||0)/2,o=e.circular;if(this.pixelMargin=e.borderAlign==="inner"?.33:0,this.fullCircles=i>U?Math.floor(i/U):0,i===0||this.innerRadius<0||this.outerRadius<0)return;t.save();const a=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(a)*n,Math.sin(a)*n);const l=1-Math.sin(Math.min(j,i||0)),c=n*l;t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor,qu(t,this,c,r,o),Ku(t,this,c,r,o),t.restore()}}function Oa(s,t,e=t){s.lineCap=P(e.borderCapStyle,t.borderCapStyle),s.setLineDash(P(e.borderDash,t.borderDash)),s.lineDashOffset=P(e.borderDashOffset,t.borderDashOffset),s.lineJoin=P(e.borderJoinStyle,t.borderJoinStyle),s.lineWidth=P(e.borderWidth,t.borderWidth),s.strokeStyle=P(e.borderColor,t.borderColor)}function Ju(s,t,e){s.lineTo(e.x,e.y)}function Yu(s){return s.stepped?uc:s.tension||s.cubicInterpolationMode==="monotone"?dc:Ju}function Ca(s,t,e={}){const i=s.length,{start:n=0,end:r=i-1}=e,{start:o,end:a}=t,l=Math.max(n,o),c=Math.min(r,a),h=n<o&&r<o||n>a&&r>a;return{count:i,start:l,loop:t.loop,ilen:c<l&&!h?i+c-l:c-l}}function Xu(s,t,e,i){const{points:n,options:r}=t,{count:o,start:a,loop:l,ilen:c}=Ca(n,e,i),h=Yu(r);let{move:u=!0,reverse:d}=i||{},f,g,p;for(f=0;f<=c;++f)g=n[(a+(d?c-f:f))%o],!g.skip&&(u?(s.moveTo(g.x,g.y),u=!1):h(s,p,g,d,r.stepped),p=g);return l&&(g=n[(a+(d?c:0))%o],h(s,p,g,d,r.stepped)),!!l}function Zu(s,t,e,i){const n=t.points,{count:r,start:o,ilen:a}=Ca(n,e,i),{move:l=!0,reverse:c}=i||{};let h=0,u=0,d,f,g,p,m,b;const y=v=>(o+(c?a-v:v))%r,_=()=>{p!==m&&(s.lineTo(h,m),s.lineTo(h,p),s.lineTo(h,b))};for(l&&(f=n[y(0)],s.moveTo(f.x,f.y)),d=0;d<=a;++d){if(f=n[y(d)],f.skip)continue;const v=f.x,w=f.y,x=v|0;x===g?(w<p?p=w:w>m&&(m=w),h=(u*h+v)/++u):(_(),s.lineTo(v,w),g=x,u=0,p=m=w),b=w}_()}function Qi(s){const t=s.options,e=t.borderDash&&t.borderDash.length;return!s._decimated&&!s._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?Zu:Xu}function Qu(s){return s.stepped?Vc:s.tension||s.cubicInterpolationMode==="monotone"?Hc:le}function td(s,t,e,i){let n=t._path;n||(n=t._path=new Path2D,t.path(n,e,i)&&n.closePath()),Oa(s,t.options),s.stroke(n)}function ed(s,t,e,i){const{segments:n,options:r}=t,o=Qi(t);for(const a of n)Oa(s,r,a.style),s.beginPath(),o(s,t,a,{start:e,end:e+i-1})&&s.closePath(),s.stroke()}const sd=typeof Path2D=="function";function id(s,t,e,i){sd&&!t.options.segment?td(s,t,e,i):ed(s,t,e,i)}class gi extends Nt{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"};constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const n=i.spanGaps?this._loop:this._fullLoop;jc(this._points,i,t,n,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Xc(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,n=t[e],r=this.points,o=fa(this,{property:e,start:n,end:n});if(!o.length)return;const a=[],l=Qu(i);let c,h;for(c=0,h=o.length;c<h;++c){const{start:u,end:d}=o[c],f=r[u],g=r[d];if(f===g){a.push(f);continue}const p=Math.abs((n-f[e])/(g[e]-f[e])),m=l(f,g,p,i.stepped);m[e]=t[e],a.push(m)}return a.length===1?a[0]:a}pathSegment(t,e,i){return Qi(this)(t,this,e,i)}path(t,e,i){const n=this.segments,r=Qi(this);let o=this._loop;e=e||0,i=i||this.points.length-e;for(const a of n)o&=r(t,this,a,{start:e,end:e+i-1});return!!o}draw(t,e,i,n){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),id(t,this,i,n),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function $r(s,t,e,i){const n=s.options,{[e]:r}=s.getProps([e],i);return Math.abs(t-r)<n.radius+n.hitRadius}class nd extends Nt{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,i){const n=this.options,{x:r,y:o}=this.getProps(["x","y"],i);return Math.pow(t-r,2)+Math.pow(e-o,2)<Math.pow(n.hitRadius+n.radius,2)}inXRange(t,e){return $r(this,t,"x",e)}inYRange(t,e){return $r(this,t,"y",e)}getCenterPoint(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}size(t){t=t||this.options||{};let e=t.radius||0;e=Math.max(e,e&&t.hoverRadius||0);const i=e&&t.borderWidth||0;return(e+i)*2}draw(t,e){const i=this.options;this.skip||i.radius<.1||!$t(this,e,this.size(i)/2)||(t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.fillStyle=i.backgroundColor,Yi(t,i,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}function Pa(s,t){const{x:e,y:i,base:n,width:r,height:o}=s.getProps(["x","y","base","width","height"],t);let a,l,c,h,u;return s.horizontal?(u=o/2,a=Math.min(e,n),l=Math.max(e,n),c=i-u,h=i+u):(u=r/2,a=e-u,l=e+u,c=Math.min(i,n),h=Math.max(i,n)),{left:a,top:c,right:l,bottom:h}}function qt(s,t,e,i){return s?0:Q(t,e,i)}function rd(s,t,e){const i=s.options.borderWidth,n=s.borderSkipped,r=sa(i);return{t:qt(n.top,r.top,0,e),r:qt(n.right,r.right,0,t),b:qt(n.bottom,r.bottom,0,e),l:qt(n.left,r.left,0,t)}}function od(s,t,e){const{enableBorderRadius:i}=s.getProps(["enableBorderRadius"]),n=s.options.borderRadius,r=ge(n),o=Math.min(t,e),a=s.borderSkipped,l=i||I(n);return{topLeft:qt(!l||a.top||a.left,r.topLeft,0,o),topRight:qt(!l||a.top||a.right,r.topRight,0,o),bottomLeft:qt(!l||a.bottom||a.left,r.bottomLeft,0,o),bottomRight:qt(!l||a.bottom||a.right,r.bottomRight,0,o)}}function ad(s){const t=Pa(s),e=t.right-t.left,i=t.bottom-t.top,n=rd(s,e/2,i/2),r=od(s,e/2,i/2);return{outer:{x:t.left,y:t.top,w:e,h:i,radius:r},inner:{x:t.left+n.l,y:t.top+n.t,w:e-n.l-n.r,h:i-n.t-n.b,radius:{topLeft:Math.max(0,r.topLeft-Math.max(n.t,n.l)),topRight:Math.max(0,r.topRight-Math.max(n.t,n.r)),bottomLeft:Math.max(0,r.bottomLeft-Math.max(n.b,n.l)),bottomRight:Math.max(0,r.bottomRight-Math.max(n.b,n.r))}}}}function Ri(s,t,e,i){const n=t===null,r=e===null,a=s&&!(n&&r)&&Pa(s,i);return a&&(n||Lt(t,a.left,a.right))&&(r||Lt(e,a.top,a.bottom))}function ld(s){return s.topLeft||s.topRight||s.bottomLeft||s.bottomRight}function cd(s,t){s.rect(t.x,t.y,t.w,t.h)}function Mi(s,t,e={}){const i=s.x!==e.x?-t:0,n=s.y!==e.y?-t:0,r=(s.x+s.w!==e.x+e.w?t:0)-i,o=(s.y+s.h!==e.y+e.h?t:0)-n;return{x:s.x+i,y:s.y+n,w:s.w+r,h:s.h+o,radius:s.radius}}class hd extends Nt{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:i,backgroundColor:n}}=this,{inner:r,outer:o}=ad(this),a=ld(o.radius)?gs:cd;t.save(),(o.w!==r.w||o.h!==r.h)&&(t.beginPath(),a(t,Mi(o,e,r)),t.clip(),a(t,Mi(r,-e,o)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),a(t,Mi(r,e)),t.fillStyle=n,t.fill(),t.restore()}inRange(t,e,i){return Ri(this,t,e,i)}inXRange(t,e){return Ri(this,t,null,e)}inYRange(t,e){return Ri(this,null,t,e)}getCenterPoint(t){const{x:e,y:i,base:n,horizontal:r}=this.getProps(["x","y","base","horizontal"],t);return{x:r?(e+n)/2:e,y:r?i:(i+n)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}var ud=Object.freeze({__proto__:null,ArcElement:Gu,BarElement:hd,LineElement:gi,PointElement:nd});const tn=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Nr=tn.map(s=>s.replace("rgb(","rgba(").replace(")",", 0.5)"));function Ra(s){return tn[s%tn.length]}function Ma(s){return Nr[s%Nr.length]}function dd(s,t){return s.borderColor=Ra(t),s.backgroundColor=Ma(t),++t}function fd(s,t){return s.backgroundColor=s.data.map(()=>Ra(t++)),t}function gd(s,t){return s.backgroundColor=s.data.map(()=>Ma(t++)),t}function pd(s){let t=0;return(e,i)=>{const n=s.getDatasetMeta(i).controller;n instanceof Rn?t=fd(e,t):n instanceof ya?t=gd(e,t):n&&(t=dd(e,t))}}function Br(s){let t;for(t in s)if(s[t].borderColor||s[t].backgroundColor)return!0;return!1}function md(s){return s&&(s.borderColor||s.backgroundColor)}function bd(){return V.borderColor!=="rgba(0,0,0,0.1)"||V.backgroundColor!=="rgba(0,0,0,0.1)"}var yd={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(s,t,e){if(!e.enabled)return;const{data:{datasets:i},options:n}=s.config,{elements:r}=n,o=Br(i)||md(n)||r&&Br(r)||bd();if(!e.forceOverride&&o)return;const a=pd(s);i.forEach(a)}};function _d(s,t,e,i,n){const r=n.samples||i;if(r>=e)return s.slice(t,t+e);const o=[],a=(e-2)/(r-2);let l=0;const c=t+e-1;let h=t,u,d,f,g,p;for(o[l++]=s[h],u=0;u<r-2;u++){let m=0,b=0,y;const _=Math.floor((u+1)*a)+1+t,v=Math.min(Math.floor((u+2)*a)+1,e)+t,w=v-_;for(y=_;y<v;y++)m+=s[y].x,b+=s[y].y;m/=w,b/=w;const x=Math.floor(u*a)+1+t,S=Math.min(Math.floor((u+1)*a)+1,e)+t,{x:E,y:T}=s[h];for(f=g=-1,y=x;y<S;y++)g=.5*Math.abs((E-m)*(s[y].y-T)-(E-s[y].x)*(b-T)),g>f&&(f=g,d=s[y],p=y);o[l++]=d,h=p}return o[l++]=s[c],o}function vd(s,t,e,i){let n=0,r=0,o,a,l,c,h,u,d,f,g,p;const m=[],b=t+e-1,y=s[t].x,v=s[b].x-y;for(o=t;o<t+e;++o){a=s[o],l=(a.x-y)/v*i,c=a.y;const w=l|0;if(w===h)c<g?(g=c,u=o):c>p&&(p=c,d=o),n=(r*n+a.x)/++r;else{const x=o-1;if(!D(u)&&!D(d)){const S=Math.min(u,d),E=Math.max(u,d);S!==f&&S!==x&&m.push({...s[S],x:n}),E!==f&&E!==x&&m.push({...s[E],x:n})}o>0&&x!==f&&m.push(s[x]),m.push(a),h=w,r=0,g=p=c,u=d=f=o}}return m}function Da(s){if(s._decimated){const t=s._data;delete s._decimated,delete s._data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function Fr(s){s.data.datasets.forEach(t=>{Da(t)})}function wd(s,t){const e=t.length;let i=0,n;const{iScale:r}=s,{min:o,max:a,minDefined:l,maxDefined:c}=r.getUserBounds();return l&&(i=Q(jt(t,r.axis,o).lo,0,e-1)),c?n=Q(jt(t,r.axis,a).hi+1,i,e)-i:n=e-i,{start:i,count:n}}var xd={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(s,t,e)=>{if(!e.enabled){Fr(s);return}const i=s.width;s.data.datasets.forEach((n,r)=>{const{_data:o,indexAxis:a}=n,l=s.getDatasetMeta(r),c=o||n.data;if(ts([a,s.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const h=s.scales[l.xAxisID];if(h.type!=="linear"&&h.type!=="time"||s.options.parsing)return;let{start:u,count:d}=wd(l,c);const f=e.threshold||4*i;if(d<=f){Da(n);return}D(o)&&(n._data=c,delete n.data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(p){this._data=p}}));let g;switch(e.algorithm){case"lttb":g=_d(c,u,d,i,e);break;case"min-max":g=vd(c,u,d,i);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}n._decimated=g})},destroy(s){Fr(s)}};function Sd(s,t,e){const i=s.segments,n=s.points,r=t.points,o=[];for(const a of i){let{start:l,end:c}=a;c=pi(l,c,n);const h=en(e,n[l],n[c],a.loop);if(!t.segments){o.push({source:a,target:h,start:n[l],end:n[c]});continue}const u=fa(t,h);for(const d of u){const f=en(e,r[d.start],r[d.end],d.loop),g=da(a,n,f);for(const p of g)o.push({source:p,target:d,start:{[e]:Ur(h,f,"start",Math.max)},end:{[e]:Ur(h,f,"end",Math.min)}})}}return o}function en(s,t,e,i){if(i)return;let n=t[s],r=e[s];return s==="angle"&&(n=ot(n),r=ot(r)),{property:s,start:n,end:r}}function kd(s,t){const{x:e=null,y:i=null}=s||{},n=t.points,r=[];return t.segments.forEach(({start:o,end:a})=>{a=pi(o,a,n);const l=n[o],c=n[a];i!==null?(r.push({x:l.x,y:i}),r.push({x:c.x,y:i})):e!==null&&(r.push({x:e,y:l.y}),r.push({x:e,y:c.y}))}),r}function pi(s,t,e){for(;t>s;t--){const i=e[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function Ur(s,t,e,i){return s&&t?i(s[e],t[e]):s?s[e]:t?t[e]:0}function Ia(s,t){let e=[],i=!1;return W(s)?(i=!0,e=s):e=kd(s,t),e.length?new gi({points:e,options:{tension:0},_loop:i,_fullLoop:i}):null}function zr(s){return s&&s.fill!==!1}function Ed(s,t,e){let n=s[t].fill;const r=[t];let o;if(!e)return n;for(;n!==!1&&r.indexOf(n)===-1;){if(!q(n))return n;if(o=s[n],!o)return!1;if(o.visible)return n;r.push(n),n=o.fill}return!1}function Td(s,t,e){const i=Pd(s);if(I(i))return isNaN(i.value)?!1:i;let n=parseFloat(i);return q(n)&&Math.floor(n)===n?Ad(i[0],t,n,e):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function Ad(s,t,e,i){return(s==="-"||s==="+")&&(e=t+e),e===t||e<0||e>=i?!1:e}function Od(s,t){let e=null;return s==="start"?e=t.bottom:s==="end"?e=t.top:I(s)?e=t.getPixelForValue(s.value):t.getBasePixel&&(e=t.getBasePixel()),e}function Cd(s,t,e){let i;return s==="start"?i=e:s==="end"?i=t.options.reverse?t.min:t.max:I(s)?i=s.value:i=t.getBaseValue(),i}function Pd(s){const t=s.options,e=t.fill;let i=P(e&&e.target,e);return i===void 0&&(i=!!t.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function Rd(s){const{scale:t,index:e,line:i}=s,n=[],r=i.segments,o=i.points,a=Md(t,e);a.push(Ia({x:null,y:t.bottom},i));for(let l=0;l<r.length;l++){const c=r[l];for(let h=c.start;h<=c.end;h++)Dd(n,o[h],a)}return new gi({points:n,options:{}})}function Md(s,t){const e=[],i=s.getMatchingVisibleMetas("line");for(let n=0;n<i.length;n++){const r=i[n];if(r.index===t)break;r.hidden||e.unshift(r.dataset)}return e}function Dd(s,t,e){const i=[];for(let n=0;n<e.length;n++){const r=e[n],{first:o,last:a,point:l}=Id(r,t,"x");if(!(!l||o&&a)){if(o)i.unshift(l);else if(s.push(l),!a)break}}s.push(...i)}function Id(s,t,e){const i=s.interpolate(t,e);if(!i)return{};const n=i[e],r=s.segments,o=s.points;let a=!1,l=!1;for(let c=0;c<r.length;c++){const h=r[c],u=o[h.start][e],d=o[h.end][e];if(Lt(n,u,d)){a=n===u,l=n===d;break}}return{first:a,last:l,point:i}}class La{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,i){const{x:n,y:r,radius:o}=this;return e=e||{start:0,end:U},t.arc(n,r,o,e.end,e.start,!0),!i.bounds}interpolate(t){const{x:e,y:i,radius:n}=this,r=t.angle;return{x:e+Math.cos(r)*n,y:i+Math.sin(r)*n,angle:r}}}function Ld(s){const{chart:t,fill:e,line:i}=s;if(q(e))return jd(t,e);if(e==="stack")return Rd(s);if(e==="shape")return!0;const n=$d(s);return n instanceof La?n:Ia(n,i)}function jd(s,t){const e=s.getDatasetMeta(t);return e&&s.isDatasetVisible(t)?e.dataset:null}function $d(s){return(s.scale||{}).getPointPositionForValue?Bd(s):Nd(s)}function Nd(s){const{scale:t={},fill:e}=s,i=Od(e,t);if(q(i)){const n=t.isHorizontal();return{x:n?i:null,y:n?null:i}}return null}function Bd(s){const{scale:t,fill:e}=s,i=t.options,n=t.getLabels().length,r=i.reverse?t.max:t.min,o=Cd(e,t,r),a=[];if(i.grid.circular){const l=t.getPointPositionForValue(0,r);return new La({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(o)})}for(let l=0;l<n;++l)a.push(t.getPointPositionForValue(l,o));return a}function Di(s,t,e){const i=Ld(t),{chart:n,index:r,line:o,scale:a,axis:l}=t,c=o.options,h=c.fill,u=c.backgroundColor,{above:d=u,below:f=u}=h||{},g=n.getDatasetMeta(r),p=ga(n,g);i&&o.points.length&&(hi(s,e),Fd(s,{line:o,target:i,above:d,below:f,area:e,scale:a,axis:l,clip:p}),ui(s))}function Fd(s,t){const{line:e,target:i,above:n,below:r,area:o,scale:a,clip:l}=t,c=e._loop?"angle":t.axis;s.save();let h=r;r!==n&&(c==="x"?(Wr(s,i,o.top),Ii(s,{line:e,target:i,color:n,scale:a,property:c,clip:l}),s.restore(),s.save(),Wr(s,i,o.bottom)):c==="y"&&(Vr(s,i,o.left),Ii(s,{line:e,target:i,color:r,scale:a,property:c,clip:l}),s.restore(),s.save(),Vr(s,i,o.right),h=n)),Ii(s,{line:e,target:i,color:h,scale:a,property:c,clip:l}),s.restore()}function Wr(s,t,e){const{segments:i,points:n}=t;let r=!0,o=!1;s.beginPath();for(const a of i){const{start:l,end:c}=a,h=n[l],u=n[pi(l,c,n)];r?(s.moveTo(h.x,h.y),r=!1):(s.lineTo(h.x,e),s.lineTo(h.x,h.y)),o=!!t.pathSegment(s,a,{move:o}),o?s.closePath():s.lineTo(u.x,e)}s.lineTo(t.first().x,e),s.closePath(),s.clip()}function Vr(s,t,e){const{segments:i,points:n}=t;let r=!0,o=!1;s.beginPath();for(const a of i){const{start:l,end:c}=a,h=n[l],u=n[pi(l,c,n)];r?(s.moveTo(h.x,h.y),r=!1):(s.lineTo(e,h.y),s.lineTo(h.x,h.y)),o=!!t.pathSegment(s,a,{move:o}),o?s.closePath():s.lineTo(e,u.y)}s.lineTo(e,t.first().y),s.closePath(),s.clip()}function Ii(s,t){const{line:e,target:i,property:n,color:r,scale:o,clip:a}=t,l=Sd(e,i,n);for(const{source:c,target:h,start:u,end:d}of l){const{style:{backgroundColor:f=r}={}}=c,g=i!==!0;s.save(),s.fillStyle=f,Ud(s,o,a,g&&en(n,u,d)),s.beginPath();const p=!!e.pathSegment(s,c);let m;if(g){p?s.closePath():Hr(s,i,d,n);const b=!!i.pathSegment(s,h,{move:p,reverse:!0});m=p&&b,m||Hr(s,i,u,n)}s.closePath(),s.fill(m?"evenodd":"nonzero"),s.restore()}}function Ud(s,t,e,i){const n=t.chart.chartArea,{property:r,start:o,end:a}=i||{};if(r==="x"||r==="y"){let l,c,h,u;r==="x"?(l=o,c=n.top,h=a,u=n.bottom):(l=n.left,c=o,h=n.right,u=a),s.beginPath(),e&&(l=Math.max(l,e.left),h=Math.min(h,e.right),c=Math.max(c,e.top),u=Math.min(u,e.bottom)),s.rect(l,c,h-l,u-c),s.clip()}}function Hr(s,t,e,i){const n=t.interpolate(e,i);n&&s.lineTo(n.x,n.y)}var zd={id:"filler",afterDatasetsUpdate(s,t,e){const i=(s.data.datasets||[]).length,n=[];let r,o,a,l;for(o=0;o<i;++o)r=s.getDatasetMeta(o),a=r.dataset,l=null,a&&a.options&&a instanceof gi&&(l={visible:s.isDatasetVisible(o),index:o,fill:Td(a,o,i),chart:s,axis:r.controller.options.indexAxis,scale:r.vScale,line:a}),r.$filler=l,n.push(l);for(o=0;o<i;++o)l=n[o],!(!l||l.fill===!1)&&(l.fill=Ed(n,o,e.propagate))},beforeDraw(s,t,e){const i=e.drawTime==="beforeDraw",n=s.getSortedVisibleDatasetMetas(),r=s.chartArea;for(let o=n.length-1;o>=0;--o){const a=n[o].$filler;a&&(a.line.updateControlPoints(r,a.axis),i&&a.fill&&Di(s.ctx,a,r))}},beforeDatasetsDraw(s,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const i=s.getSortedVisibleDatasetMetas();for(let n=i.length-1;n>=0;--n){const r=i[n].$filler;zr(r)&&Di(s.ctx,r,s.chartArea)}},beforeDatasetDraw(s,t,e){const i=t.meta.$filler;!zr(i)||e.drawTime!=="beforeDatasetDraw"||Di(s.ctx,i,s.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const qr=(s,t)=>{let{boxHeight:e=t,boxWidth:i=t}=s;return s.usePointStyle&&(e=Math.min(e,t),i=s.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:e,itemHeight:Math.max(t,e)}},Wd=(s,t)=>s!==null&&t!==null&&s.datasetIndex===t.datasetIndex&&s.index===t.index;class Kr extends Nt{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=F(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(i=>t.filter(i,this.chart.data))),t.sort&&(e=e.sort((i,n)=>t.sort(i,n,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,n=X(i.font),r=n.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=qr(i,r);let c,h;e.font=n.string,this.isHorizontal()?(c=this.maxWidth,h=this._fitRows(o,r,a,l)+10):(h=this.maxHeight,c=this._fitCols(o,n,a,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(h,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,n){const{ctx:r,maxWidth:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],h=n+a;let u=t;r.textAlign="left",r.textBaseline="middle";let d=-1,f=-h;return this.legendItems.forEach((g,p)=>{const m=i+e/2+r.measureText(g.text).width;(p===0||c[c.length-1]+m+2*a>o)&&(u+=h,c[c.length-(p>0?0:1)]=0,f+=h,d++),l[p]={left:0,top:f,row:d,width:m,height:n},c[c.length-1]+=m+a}),u}_fitCols(t,e,i,n){const{ctx:r,maxHeight:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],h=o-t;let u=a,d=0,f=0,g=0,p=0;return this.legendItems.forEach((m,b)=>{const{itemWidth:y,itemHeight:_}=Vd(i,e,r,m,n);b>0&&f+_+2*a>h&&(u+=d+a,c.push({width:d,height:f}),g+=d+a,p++,d=f=0),l[b]={left:g,top:f,col:p,width:y,height:_},d=Math.max(d,y),f+=_+a}),u+=d,c.push({width:d,height:f}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:n},rtl:r}}=this,o=Ne(r,this.left,this.width);if(this.isHorizontal()){let a=0,l=rt(i,this.left+n,this.right-this.lineWidths[a]);for(const c of e)a!==c.row&&(a=c.row,l=rt(i,this.left+n,this.right-this.lineWidths[a])),c.top+=this.top+t+n,c.left=o.leftForLtr(o.x(l),c.width),l+=c.width+n}else{let a=0,l=rt(i,this.top+t+n,this.bottom-this.columnSizes[a].height);for(const c of e)c.col!==a&&(a=c.col,l=rt(i,this.top+t+n,this.bottom-this.columnSizes[a].height)),c.top=l,c.left+=this.left+n,c.left=o.leftForLtr(o.x(c.left),c.width),l+=c.height+n}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;hi(t,this),this._draw(),ui(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:n}=this,{align:r,labels:o}=t,a=V.color,l=Ne(t.rtl,this.left,this.width),c=X(o.font),{padding:h}=o,u=c.size,d=u/2;let f;this.drawTitle(),n.textAlign=l.textAlign("left"),n.textBaseline="middle",n.lineWidth=.5,n.font=c.string;const{boxWidth:g,boxHeight:p,itemHeight:m}=qr(o,u),b=function(x,S,E){if(isNaN(g)||g<=0||isNaN(p)||p<0)return;n.save();const T=P(E.lineWidth,1);if(n.fillStyle=P(E.fillStyle,a),n.lineCap=P(E.lineCap,"butt"),n.lineDashOffset=P(E.lineDashOffset,0),n.lineJoin=P(E.lineJoin,"miter"),n.lineWidth=T,n.strokeStyle=P(E.strokeStyle,a),n.setLineDash(P(E.lineDash,[])),o.usePointStyle){const R={radius:p*Math.SQRT2/2,pointStyle:E.pointStyle,rotation:E.rotation,borderWidth:T},M=l.xPlus(x,g/2),L=S+d;ea(n,R,M,L,o.pointStyleWidth&&g)}else{const R=S+Math.max((u-p)/2,0),M=l.leftForLtr(x,g),L=ge(E.borderRadius);n.beginPath(),Object.values(L).some(et=>et!==0)?gs(n,{x:M,y:R,w:g,h:p,radius:L}):n.rect(M,R,g,p),n.fill(),T!==0&&n.stroke()}n.restore()},y=function(x,S,E){ye(n,E.text,x,S+m/2,c,{strikethrough:E.hidden,textAlign:l.textAlign(E.textAlign)})},_=this.isHorizontal(),v=this._computeTitleHeight();_?f={x:rt(r,this.left+h,this.right-i[0]),y:this.top+h+v,line:0}:f={x:this.left+h,y:rt(r,this.top+v+h,this.bottom-e[0].height),line:0},ca(this.ctx,t.textDirection);const w=m+h;this.legendItems.forEach((x,S)=>{n.strokeStyle=x.fontColor,n.fillStyle=x.fontColor;const E=n.measureText(x.text).width,T=l.textAlign(x.textAlign||(x.textAlign=o.textAlign)),R=g+d+E;let M=f.x,L=f.y;l.setWidth(this.width),_?S>0&&M+R+h>this.right&&(L=f.y+=w,f.line++,M=f.x=rt(r,this.left+h,this.right-i[f.line])):S>0&&L+w>this.bottom&&(M=f.x=M+e[f.line].width+h,f.line++,L=f.y=rt(r,this.top+v+h,this.bottom-e[f.line].height));const et=l.x(M);if(b(et,L,x),M=tc(T,M+g+d,_?M+R:this.right,t.rtl),y(l.x(M),L,x),_)f.x+=R+h;else if(typeof x.text!="string"){const ft=c.lineHeight;f.y+=ja(x,ft)+h}else f.y+=w}),ha(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=X(e.font),n=lt(e.padding);if(!e.display)return;const r=Ne(t.rtl,this.left,this.width),o=this.ctx,a=e.position,l=i.size/2,c=n.top+l;let h,u=this.left,d=this.width;if(this.isHorizontal())d=Math.max(...this.lineWidths),h=this.top+c,u=rt(t.align,u,this.right-d);else{const g=this.columnSizes.reduce((p,m)=>Math.max(p,m.height),0);h=c+rt(t.align,this.top,this.bottom-g-t.labels.padding-this._computeTitleHeight())}const f=rt(a,u,u+d);o.textAlign=r.textAlign(Sn(a)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=i.string,ye(o,e.text,f,h,i)}_computeTitleHeight(){const t=this.options.title,e=X(t.font),i=lt(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,n,r;if(Lt(t,this.left,this.right)&&Lt(e,this.top,this.bottom)){for(r=this.legendHitBoxes,i=0;i<r.length;++i)if(n=r[i],Lt(t,n.left,n.left+n.width)&&Lt(e,n.top,n.top+n.height))return this.legendItems[i]}return null}handleEvent(t){const e=this.options;if(!Kd(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const n=this._hoveredItem,r=Wd(n,i);n&&!r&&F(e.onLeave,[t,n,this],this),this._hoveredItem=i,i&&!r&&F(e.onHover,[t,i,this],this)}else i&&F(e.onClick,[t,i,this],this)}}function Vd(s,t,e,i,n){const r=Hd(i,s,t,e),o=qd(n,i,t.lineHeight);return{itemWidth:r,itemHeight:o}}function Hd(s,t,e,i){let n=s.text;return n&&typeof n!="string"&&(n=n.reduce((r,o)=>r.length>o.length?r:o)),t+e.size/2+i.measureText(n).width}function qd(s,t,e){let i=s;return typeof t.text!="string"&&(i=ja(t,e)),i}function ja(s,t){const e=s.text?s.text.length:0;return t*e}function Kd(s,t){return!!((s==="mousemove"||s==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(s==="click"||s==="mouseup"))}var Gd={id:"legend",_element:Kr,start(s,t,e){const i=s.legend=new Kr({ctx:s.ctx,options:e,chart:s});at.configure(s,i,e),at.addBox(s,i)},stop(s){at.removeBox(s,s.legend),delete s.legend},beforeUpdate(s,t,e){const i=s.legend;at.configure(s,i,e),i.options=e},afterUpdate(s){const t=s.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(s,t){t.replay||s.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(s,t,e){const i=t.datasetIndex,n=e.chart;n.isDatasetVisible(i)?(n.hide(i),t.hidden=!0):(n.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:s=>s.chart.options.color,boxWidth:40,padding:10,generateLabels(s){const t=s.data.datasets,{labels:{usePointStyle:e,pointStyle:i,textAlign:n,color:r,useBorderRadius:o,borderRadius:a}}=s.legend.options;return s._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(e?0:void 0),h=lt(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:r,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(h.width+h.height)/4,strokeStyle:c.borderColor,pointStyle:i||c.pointStyle,rotation:c.rotation,textAlign:n||c.textAlign,borderRadius:o&&(a||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:s=>s.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:s=>!s.startsWith("on"),labels:{_scriptable:s=>!["generateLabels","filter","sort"].includes(s)}}};class In extends Nt{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const n=W(i.text)?i.text.length:1;this._padding=lt(i.padding);const r=n*X(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:i,bottom:n,right:r,options:o}=this,a=o.align;let l=0,c,h,u;return this.isHorizontal()?(h=rt(a,i,r),u=e+t,c=r-i):(o.position==="left"?(h=i+t,u=rt(a,n,e),l=j*-.5):(h=r-t,u=rt(a,e,n),l=j*.5),c=n-e),{titleX:h,titleY:u,maxWidth:c,rotation:l}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=X(e.font),r=i.lineHeight/2+this._padding.top,{titleX:o,titleY:a,maxWidth:l,rotation:c}=this._drawArgs(r);ye(t,e.text,0,0,i,{color:e.color,maxWidth:l,rotation:c,textAlign:Sn(e.align),textBaseline:"middle",translation:[o,a]})}}function Jd(s,t){const e=new In({ctx:s.ctx,options:t,chart:s});at.configure(s,e,t),at.addBox(s,e),s.titleBlock=e}var Yd={id:"title",_element:In,start(s,t,e){Jd(s,e)},stop(s){const t=s.titleBlock;at.removeBox(s,t),delete s.titleBlock},beforeUpdate(s,t,e){const i=s.titleBlock;at.configure(s,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ns=new WeakMap;var Xd={id:"subtitle",start(s,t,e){const i=new In({ctx:s.ctx,options:e,chart:s});at.configure(s,i,e),at.addBox(s,i),Ns.set(s,i)},stop(s){at.removeBox(s,Ns.get(s)),Ns.delete(s)},beforeUpdate(s,t,e){const i=Ns.get(s);at.configure(s,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const ss={average(s){if(!s.length)return!1;let t,e,i=new Set,n=0,r=0;for(t=0,e=s.length;t<e;++t){const a=s[t].element;if(a&&a.hasValue()){const l=a.tooltipPosition();i.add(l.x),n+=l.y,++r}}return r===0||i.size===0?!1:{x:[...i].reduce((a,l)=>a+l)/i.size,y:n/r}},nearest(s,t){if(!s.length)return!1;let e=t.x,i=t.y,n=Number.POSITIVE_INFINITY,r,o,a;for(r=0,o=s.length;r<o;++r){const l=s[r].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),h=Gi(t,c);h<n&&(n=h,a=l)}}if(a){const l=a.tooltipPosition();e=l.x,i=l.y}return{x:e,y:i}}};function kt(s,t){return t&&(W(t)?Array.prototype.push.apply(s,t):s.push(t)),s}function Pt(s){return(typeof s=="string"||s instanceof String)&&s.indexOf(`
`)>-1?s.split(`
`):s}function Zd(s,t){const{element:e,datasetIndex:i,index:n}=t,r=s.getDatasetMeta(i).controller,{label:o,value:a}=r.getLabelAndValue(n);return{chart:s,label:o,parsed:r.getParsed(n),raw:s.data.datasets[i].data[n],formattedValue:a,dataset:r.getDataset(),dataIndex:n,datasetIndex:i,element:e}}function Gr(s,t){const e=s.chart.ctx,{body:i,footer:n,title:r}=s,{boxWidth:o,boxHeight:a}=t,l=X(t.bodyFont),c=X(t.titleFont),h=X(t.footerFont),u=r.length,d=n.length,f=i.length,g=lt(t.padding);let p=g.height,m=0,b=i.reduce((v,w)=>v+w.before.length+w.lines.length+w.after.length,0);if(b+=s.beforeBody.length+s.afterBody.length,u&&(p+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),b){const v=t.displayColors?Math.max(a,l.lineHeight):l.lineHeight;p+=f*v+(b-f)*l.lineHeight+(b-1)*t.bodySpacing}d&&(p+=t.footerMarginTop+d*h.lineHeight+(d-1)*t.footerSpacing);let y=0;const _=function(v){m=Math.max(m,e.measureText(v).width+y)};return e.save(),e.font=c.string,$(s.title,_),e.font=l.string,$(s.beforeBody.concat(s.afterBody),_),y=t.displayColors?o+2+t.boxPadding:0,$(i,v=>{$(v.before,_),$(v.lines,_),$(v.after,_)}),y=0,e.font=h.string,$(s.footer,_),e.restore(),m+=g.width,{width:m,height:p}}function Qd(s,t){const{y:e,height:i}=t;return e<i/2?"top":e>s.height-i/2?"bottom":"center"}function tf(s,t,e,i){const{x:n,width:r}=i,o=e.caretSize+e.caretPadding;if(s==="left"&&n+r+o>t.width||s==="right"&&n-r-o<0)return!0}function ef(s,t,e,i){const{x:n,width:r}=e,{width:o,chartArea:{left:a,right:l}}=s;let c="center";return i==="center"?c=n<=(a+l)/2?"left":"right":n<=r/2?c="left":n>=o-r/2&&(c="right"),tf(c,s,t,e)&&(c="center"),c}function Jr(s,t,e){const i=e.yAlign||t.yAlign||Qd(s,e);return{xAlign:e.xAlign||t.xAlign||ef(s,t,e,i),yAlign:i}}function sf(s,t){let{x:e,width:i}=s;return t==="right"?e-=i:t==="center"&&(e-=i/2),e}function nf(s,t,e){let{y:i,height:n}=s;return t==="top"?i+=e:t==="bottom"?i-=n+e:i-=n/2,i}function Yr(s,t,e,i){const{caretSize:n,caretPadding:r,cornerRadius:o}=s,{xAlign:a,yAlign:l}=e,c=n+r,{topLeft:h,topRight:u,bottomLeft:d,bottomRight:f}=ge(o);let g=sf(t,a);const p=nf(t,l,c);return l==="center"?a==="left"?g+=c:a==="right"&&(g-=c):a==="left"?g-=Math.max(h,d)+n:a==="right"&&(g+=Math.max(u,f)+n),{x:Q(g,0,i.width-t.width),y:Q(p,0,i.height-t.height)}}function Bs(s,t,e){const i=lt(e.padding);return t==="center"?s.x+s.width/2:t==="right"?s.x+s.width-i.right:s.x+i.left}function Xr(s){return kt([],Pt(s))}function rf(s,t,e){return Xt(s,{tooltip:t,tooltipItems:e,type:"tooltip"})}function Zr(s,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?s.override(e):s}const $a={beforeTitle:Ot,title(s){if(s.length>0){const t=s[0],e=t.chart.data.labels,i=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return e[t.dataIndex]}return""},afterTitle:Ot,beforeBody:Ot,beforeLabel:Ot,label(s){if(this&&this.options&&this.options.mode==="dataset")return s.label+": "+s.formattedValue||s.formattedValue;let t=s.dataset.label||"";t&&(t+=": ");const e=s.formattedValue;return D(e)||(t+=e),t},labelColor(s){const e=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(s){const e=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Ot,afterBody:Ot,beforeFooter:Ot,footer:Ot,afterFooter:Ot};function ht(s,t,e,i){const n=s[t].call(e,i);return typeof n>"u"?$a[t].call(e,i):n}class Qr extends Nt{static positioners=ss;constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),n=i.enabled&&e.options.animation&&i.animations,r=new pa(this.chart,n);return n._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=rf(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:i}=e,n=ht(i,"beforeTitle",this,t),r=ht(i,"title",this,t),o=ht(i,"afterTitle",this,t);let a=[];return a=kt(a,Pt(n)),a=kt(a,Pt(r)),a=kt(a,Pt(o)),a}getBeforeBody(t,e){return Xr(ht(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:i}=e,n=[];return $(t,r=>{const o={before:[],lines:[],after:[]},a=Zr(i,r);kt(o.before,Pt(ht(a,"beforeLabel",this,r))),kt(o.lines,ht(a,"label",this,r)),kt(o.after,Pt(ht(a,"afterLabel",this,r))),n.push(o)}),n}getAfterBody(t,e){return Xr(ht(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:i}=e,n=ht(i,"beforeFooter",this,t),r=ht(i,"footer",this,t),o=ht(i,"afterFooter",this,t);let a=[];return a=kt(a,Pt(n)),a=kt(a,Pt(r)),a=kt(a,Pt(o)),a}_createItems(t){const e=this._active,i=this.chart.data,n=[],r=[],o=[];let a=[],l,c;for(l=0,c=e.length;l<c;++l)a.push(Zd(this.chart,e[l]));return t.filter&&(a=a.filter((h,u,d)=>t.filter(h,u,d,i))),t.itemSort&&(a=a.sort((h,u)=>t.itemSort(h,u,i))),$(a,h=>{const u=Zr(t.callbacks,h);n.push(ht(u,"labelColor",this,h)),r.push(ht(u,"labelPointStyle",this,h)),o.push(ht(u,"labelTextColor",this,h))}),this.labelColors=n,this.labelPointStyles=r,this.labelTextColors=o,this.dataPoints=a,a}update(t,e){const i=this.options.setContext(this.getContext()),n=this._active;let r,o=[];if(!n.length)this.opacity!==0&&(r={opacity:0});else{const a=ss[i.position].call(this,n,this._eventPosition);o=this._createItems(i),this.title=this.getTitle(o,i),this.beforeBody=this.getBeforeBody(o,i),this.body=this.getBody(o,i),this.afterBody=this.getAfterBody(o,i),this.footer=this.getFooter(o,i);const l=this._size=Gr(this,i),c=Object.assign({},a,l),h=Jr(this.chart,i,c),u=Yr(i,c,h,this.chart);this.xAlign=h.xAlign,this.yAlign=h.yAlign,r={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=o,this.$context=void 0,r&&this._resolveAnimations().update(this,r),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,n){const r=this.getCaretPosition(t,i,n);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}getCaretPosition(t,e,i){const{xAlign:n,yAlign:r}=this,{caretSize:o,cornerRadius:a}=i,{topLeft:l,topRight:c,bottomLeft:h,bottomRight:u}=ge(a),{x:d,y:f}=t,{width:g,height:p}=e;let m,b,y,_,v,w;return r==="center"?(v=f+p/2,n==="left"?(m=d,b=m-o,_=v+o,w=v-o):(m=d+g,b=m+o,_=v-o,w=v+o),y=m):(n==="left"?b=d+Math.max(l,h)+o:n==="right"?b=d+g-Math.max(c,u)-o:b=this.caretX,r==="top"?(_=f,v=_-o,m=b-o,y=b+o):(_=f+p,v=_+o,m=b+o,y=b-o),w=_),{x1:m,x2:b,x3:y,y1:_,y2:v,y3:w}}drawTitle(t,e,i){const n=this.title,r=n.length;let o,a,l;if(r){const c=Ne(i.rtl,this.x,this.width);for(t.x=Bs(this,i.titleAlign,i),e.textAlign=c.textAlign(i.titleAlign),e.textBaseline="middle",o=X(i.titleFont),a=i.titleSpacing,e.fillStyle=i.titleColor,e.font=o.string,l=0;l<r;++l)e.fillText(n[l],c.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+a,l+1===r&&(t.y+=i.titleMarginBottom-a)}}_drawColorBox(t,e,i,n,r){const o=this.labelColors[i],a=this.labelPointStyles[i],{boxHeight:l,boxWidth:c}=r,h=X(r.bodyFont),u=Bs(this,"left",r),d=n.x(u),f=l<h.lineHeight?(h.lineHeight-l)/2:0,g=e.y+f;if(r.usePointStyle){const p={radius:Math.min(c,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},m=n.leftForLtr(d,c)+c/2,b=g+l/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,Yi(t,p,m,b),t.strokeStyle=o.borderColor,t.fillStyle=o.backgroundColor,Yi(t,p,m,b)}else{t.lineWidth=I(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,t.strokeStyle=o.borderColor,t.setLineDash(o.borderDash||[]),t.lineDashOffset=o.borderDashOffset||0;const p=n.leftForLtr(d,c),m=n.leftForLtr(n.xPlus(d,1),c-2),b=ge(o.borderRadius);Object.values(b).some(y=>y!==0)?(t.beginPath(),t.fillStyle=r.multiKeyBackground,gs(t,{x:p,y:g,w:c,h:l,radius:b}),t.fill(),t.stroke(),t.fillStyle=o.backgroundColor,t.beginPath(),gs(t,{x:m,y:g+1,w:c-2,h:l-2,radius:b}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(p,g,c,l),t.strokeRect(p,g,c,l),t.fillStyle=o.backgroundColor,t.fillRect(m,g+1,c-2,l-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:n}=this,{bodySpacing:r,bodyAlign:o,displayColors:a,boxHeight:l,boxWidth:c,boxPadding:h}=i,u=X(i.bodyFont);let d=u.lineHeight,f=0;const g=Ne(i.rtl,this.x,this.width),p=function(E){e.fillText(E,g.x(t.x+f),t.y+d/2),t.y+=d+r},m=g.textAlign(o);let b,y,_,v,w,x,S;for(e.textAlign=o,e.textBaseline="middle",e.font=u.string,t.x=Bs(this,m,i),e.fillStyle=i.bodyColor,$(this.beforeBody,p),f=a&&m!=="right"?o==="center"?c/2+h:c+2+h:0,v=0,x=n.length;v<x;++v){for(b=n[v],y=this.labelTextColors[v],e.fillStyle=y,$(b.before,p),_=b.lines,a&&_.length&&(this._drawColorBox(e,t,v,g,i),d=Math.max(u.lineHeight,l)),w=0,S=_.length;w<S;++w)p(_[w]),d=u.lineHeight;$(b.after,p)}f=0,d=u.lineHeight,$(this.afterBody,p),t.y-=r}drawFooter(t,e,i){const n=this.footer,r=n.length;let o,a;if(r){const l=Ne(i.rtl,this.x,this.width);for(t.x=Bs(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=l.textAlign(i.footerAlign),e.textBaseline="middle",o=X(i.footerFont),e.fillStyle=i.footerColor,e.font=o.string,a=0;a<r;++a)e.fillText(n[a],l.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+i.footerSpacing}}drawBackground(t,e,i,n){const{xAlign:r,yAlign:o}=this,{x:a,y:l}=t,{width:c,height:h}=i,{topLeft:u,topRight:d,bottomLeft:f,bottomRight:g}=ge(n.cornerRadius);e.fillStyle=n.backgroundColor,e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.beginPath(),e.moveTo(a+u,l),o==="top"&&this.drawCaret(t,e,i,n),e.lineTo(a+c-d,l),e.quadraticCurveTo(a+c,l,a+c,l+d),o==="center"&&r==="right"&&this.drawCaret(t,e,i,n),e.lineTo(a+c,l+h-g),e.quadraticCurveTo(a+c,l+h,a+c-g,l+h),o==="bottom"&&this.drawCaret(t,e,i,n),e.lineTo(a+f,l+h),e.quadraticCurveTo(a,l+h,a,l+h-f),o==="center"&&r==="left"&&this.drawCaret(t,e,i,n),e.lineTo(a,l+u),e.quadraticCurveTo(a,l,a+u,l),e.closePath(),e.fill(),n.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,n=i&&i.x,r=i&&i.y;if(n||r){const o=ss[t.position].call(this,this._active,this._eventPosition);if(!o)return;const a=this._size=Gr(this,t),l=Object.assign({},o,this._size),c=Jr(e,t,l),h=Yr(t,l,c,e);(n._to!==h.x||r._to!==h.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=a.width,this.height=a.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,h))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const n={width:this.width,height:this.height},r={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const o=lt(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=i,this.drawBackground(r,t,n,e),ca(t,e.textDirection),r.y+=o.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),ha(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,n=t.map(({datasetIndex:a,index:l})=>{const c=this.chart.getDatasetMeta(a);if(!c)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:c.data[l],index:l}}),r=!Zs(i,n),o=this._positionChanged(n,e);(r||o)&&(this._active=n,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const n=this.options,r=this._active||[],o=this._getActiveElements(t,r,e,i),a=this._positionChanged(o,t),l=e||!Zs(o,r)||a;return l&&(this._active=o,(n.enabled||n.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),l}_getActiveElements(t,e,i,n){const r=this.options;if(t.type==="mouseout")return[];if(!n)return e.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const o=this.chart.getElementsAtEventForMode(t,r.mode,r,i);return r.reverse&&o.reverse(),o}_positionChanged(t,e){const{caretX:i,caretY:n,options:r}=this,o=ss[r.position].call(this,t,e);return o!==!1&&(i!==o.x||n!==o.y)}}var of={id:"tooltip",_element:Qr,positioners:ss,afterInit(s,t,e){e&&(s.tooltip=new Qr({chart:s,options:e}))},beforeUpdate(s,t,e){s.tooltip&&s.tooltip.initialize(e)},reset(s,t,e){s.tooltip&&s.tooltip.initialize(e)},afterDraw(s){const t=s.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(s.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(s.ctx),s.notifyPlugins("afterTooltipDraw",e)}},afterEvent(s,t){if(s.tooltip){const e=t.replay;s.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(s,t)=>t.bodyFont.size,boxWidth:(s,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:$a},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:s=>s!=="filter"&&s!=="itemSort"&&s!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},af=Object.freeze({__proto__:null,Colors:yd,Decimation:xd,Filler:zd,Legend:Gd,SubTitle:Xd,Title:Yd,Tooltip:of});const lf=(s,t,e,i)=>(typeof t=="string"?(e=s.push(t)-1,i.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function cf(s,t,e,i){const n=s.indexOf(t);if(n===-1)return lf(s,t,e,i);const r=s.lastIndexOf(t);return n!==r?e:n}const hf=(s,t)=>s===null?null:Q(Math.round(s),0,t);function to(s){const t=this.getLabels();return s>=0&&s<t.length?t[s]:s}class uf extends _e{static id="category";static defaults={ticks:{callback:to}};constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const i=this.getLabels();for(const{index:n,label:r}of e)i[n]===r&&i.splice(n,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(D(t))return null;const i=this.getLabels();return e=isFinite(e)&&i[e]===t?e:cf(i,t,P(e,t),this._addedLabels),hf(e,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:n}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),e||(n=this.getLabels().length-1)),this.min=i,this.max=n}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,n=[];let r=this.getLabels();r=t===0&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let o=t;o<=e;o++)n.push({value:o});return n}getLabelForValue(t){return to.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}function df(s,t){const e=[],{bounds:n,step:r,min:o,max:a,precision:l,count:c,maxTicks:h,maxDigits:u,includeBounds:d}=s,f=r||1,g=h-1,{min:p,max:m}=t,b=!D(o),y=!D(a),_=!D(c),v=(m-p)/(u+1);let w=Gn((m-p)/g/f)*f,x,S,E,T;if(w<1e-14&&!b&&!y)return[{value:p},{value:m}];T=Math.ceil(m/w)-Math.floor(p/w),T>g&&(w=Gn(T*w/g/f)*f),D(l)||(x=Math.pow(10,l),w=Math.ceil(w*x)/x),n==="ticks"?(S=Math.floor(p/w)*w,E=Math.ceil(m/w)*w):(S=p,E=m),b&&y&&r&&Kl((a-o)/r,w/1e3)?(T=Math.round(Math.min((a-o)/w,h)),w=(a-o)/T,S=o,E=a):_?(S=b?o:S,E=y?a:E,T=c-1,w=(E-S)/T):(T=(E-S)/w,rs(T,Math.round(T),w/1e3)?T=Math.round(T):T=Math.ceil(T));const R=Math.max(Jn(w),Jn(S));x=Math.pow(10,D(l)?R:l),S=Math.round(S*x)/x,E=Math.round(E*x)/x;let M=0;for(b&&(d&&S!==o?(e.push({value:o}),S<o&&M++,rs(Math.round((S+M*w)*x)/x,o,eo(o,v,s))&&M++):S<o&&M++);M<T;++M){const L=Math.round((S+M*w)*x)/x;if(y&&L>a)break;e.push({value:L})}return y&&d&&E!==a?e.length&&rs(e[e.length-1].value,a,eo(a,v,s))?e[e.length-1].value=a:e.push({value:a}):(!y||E===a)&&e.push({value:E}),e}function eo(s,t,{horizontal:e,minRotation:i}){const n=St(i),r=(e?Math.sin(n):Math.cos(n))||.001,o=.75*t*(""+s).length;return Math.min(t/r,o)}class ri extends _e{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return D(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:n,max:r}=this;const o=l=>n=e?n:l,a=l=>r=i?r:l;if(t){const l=Tt(n),c=Tt(r);l<0&&c<0?a(0):l>0&&c>0&&o(0)}if(n===r){let l=r===0?1:Math.abs(r*.05);a(r+l),t||o(n-l)}this.min=n,this.max=r}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:i}=t,n;return i?(n=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,n>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${n} ticks. Limiting to 1000.`),n=1e3)):(n=this.computeTickLimit(),e=e||11),e&&(n=Math.min(e,n)),n}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const n={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},r=this._range||this,o=df(n,r);return t.bounds==="ticks"&&qo(o,this,"value"),t.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const n=(i-e)/Math.max(t.length-1,1)/2;e-=n,i+=n}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return Es(t,this.chart.options.locale,this.options.ticks.format)}}class ff extends ri{static id="linear";static defaults={ticks:{callback:ci.formatters.numeric}};determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=q(t)?t:0,this.max=q(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=St(this.options.ticks.minRotation),n=(t?Math.sin(i):Math.cos(i))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/n))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}const ms=s=>Math.floor(Vt(s)),ne=(s,t)=>Math.pow(10,ms(s)+t);function so(s){return s/Math.pow(10,ms(s))===1}function io(s,t,e){const i=Math.pow(10,e),n=Math.floor(s/i);return Math.ceil(t/i)-n}function gf(s,t){const e=t-s;let i=ms(e);for(;io(s,t,i)>10;)i++;for(;io(s,t,i)<10;)i--;return Math.min(i,ms(s))}function pf(s,{min:t,max:e}){t=pt(s.min,t);const i=[],n=ms(t);let r=gf(t,e),o=r<0?Math.pow(10,Math.abs(r)):1;const a=Math.pow(10,r),l=n>r?Math.pow(10,n):0,c=Math.round((t-l)*o)/o,h=Math.floor((t-l)/a/10)*a*10;let u=Math.floor((c-h)/Math.pow(10,r)),d=pt(s.min,Math.round((l+h+u*Math.pow(10,r))*o)/o);for(;d<e;)i.push({value:d,major:so(d),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(r++,u=2,o=r>=0?1:o),d=Math.round((l+h+u*Math.pow(10,r))*o)/o;const f=pt(s.max,d);return i.push({value:f,major:so(f),significand:u}),i}class mf extends _e{static id="logarithmic";static defaults={ticks:{callback:ci.formatters.logarithmic,major:{enabled:!0}}};constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const i=ri.prototype.parse.apply(this,[t,e]);if(i===0){this._zero=!0;return}return q(i)&&i>0?i:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=q(t)?Math.max(0,t):null,this.max=q(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!q(this._userMin)&&(this.min=t===ne(this.min,0)?ne(this.min,-1):ne(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let i=this.min,n=this.max;const r=a=>i=t?i:a,o=a=>n=e?n:a;i===n&&(i<=0?(r(1),o(10)):(r(ne(i,-1)),o(ne(n,1)))),i<=0&&r(ne(n,-1)),n<=0&&o(ne(i,1)),this.min=i,this.max=n}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},i=pf(e,this);return t.bounds==="ticks"&&qo(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return t===void 0?"0":Es(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=Vt(t),this._valueRange=Vt(this.max)-Vt(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(Vt(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}function sn(s){const t=s.ticks;if(t.display&&s.display){const e=lt(t.backdropPadding);return P(t.font&&t.font.size,V.font.size)+e.height}return 0}function bf(s,t,e){return e=W(e)?e:[e],{w:hc(s,t.string,e),h:e.length*t.lineHeight}}function no(s,t,e,i,n){return s===i||s===n?{start:t-e/2,end:t+e/2}:s<i||s>n?{start:t-e,end:t}:{start:t,end:t+e}}function yf(s){const t={l:s.left+s._padding.left,r:s.right-s._padding.right,t:s.top+s._padding.top,b:s.bottom-s._padding.bottom},e=Object.assign({},t),i=[],n=[],r=s._pointLabels.length,o=s.options.pointLabels,a=o.centerPointLabels?j/r:0;for(let l=0;l<r;l++){const c=o.setContext(s.getPointLabelContext(l));n[l]=c.padding;const h=s.getPointPosition(l,s.drawingArea+n[l],a),u=X(c.font),d=bf(s.ctx,u,s._pointLabels[l]);i[l]=d;const f=ot(s.getIndexAngle(l)+a),g=Math.round(wn(f)),p=no(g,h.x,d.w,0,180),m=no(g,h.y,d.h,90,270);_f(e,t,f,p,m)}s.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),s._pointLabelItems=xf(s,i,n)}function _f(s,t,e,i,n){const r=Math.abs(Math.sin(e)),o=Math.abs(Math.cos(e));let a=0,l=0;i.start<t.l?(a=(t.l-i.start)/r,s.l=Math.min(s.l,t.l-a)):i.end>t.r&&(a=(i.end-t.r)/r,s.r=Math.max(s.r,t.r+a)),n.start<t.t?(l=(t.t-n.start)/o,s.t=Math.min(s.t,t.t-l)):n.end>t.b&&(l=(n.end-t.b)/o,s.b=Math.max(s.b,t.b+l))}function vf(s,t,e){const i=s.drawingArea,{extra:n,additionalAngle:r,padding:o,size:a}=e,l=s.getPointPosition(t,i+n+o,r),c=Math.round(wn(ot(l.angle+G))),h=Ef(l.y,a.h,c),u=Sf(c),d=kf(l.x,a.w,u);return{visible:!0,x:l.x,y:h,textAlign:u,left:d,top:h,right:d+a.w,bottom:h+a.h}}function wf(s,t){if(!t)return!0;const{left:e,top:i,right:n,bottom:r}=s;return!($t({x:e,y:i},t)||$t({x:e,y:r},t)||$t({x:n,y:i},t)||$t({x:n,y:r},t))}function xf(s,t,e){const i=[],n=s._pointLabels.length,r=s.options,{centerPointLabels:o,display:a}=r.pointLabels,l={extra:sn(r)/2,additionalAngle:o?j/n:0};let c;for(let h=0;h<n;h++){l.padding=e[h],l.size=t[h];const u=vf(s,h,l);i.push(u),a==="auto"&&(u.visible=wf(u,c),u.visible&&(c=u))}return i}function Sf(s){return s===0||s===180?"center":s<180?"left":"right"}function kf(s,t,e){return e==="right"?s-=t:e==="center"&&(s-=t/2),s}function Ef(s,t,e){return e===90||e===270?s-=t/2:(e>270||e<90)&&(s-=t),s}function Tf(s,t,e){const{left:i,top:n,right:r,bottom:o}=e,{backdropColor:a}=t;if(!D(a)){const l=ge(t.borderRadius),c=lt(t.backdropPadding);s.fillStyle=a;const h=i-c.left,u=n-c.top,d=r-i+c.width,f=o-n+c.height;Object.values(l).some(g=>g!==0)?(s.beginPath(),gs(s,{x:h,y:u,w:d,h:f,radius:l}),s.fill()):s.fillRect(h,u,d,f)}}function Af(s,t){const{ctx:e,options:{pointLabels:i}}=s;for(let n=t-1;n>=0;n--){const r=s._pointLabelItems[n];if(!r.visible)continue;const o=i.setContext(s.getPointLabelContext(n));Tf(e,o,r);const a=X(o.font),{x:l,y:c,textAlign:h}=r;ye(e,s._pointLabels[n],l,c+a.lineHeight/2,a,{color:o.color,textAlign:h,textBaseline:"middle"})}}function Na(s,t,e,i){const{ctx:n}=s;if(e)n.arc(s.xCenter,s.yCenter,t,0,U);else{let r=s.getPointPosition(0,t);n.moveTo(r.x,r.y);for(let o=1;o<i;o++)r=s.getPointPosition(o,t),n.lineTo(r.x,r.y)}}function Of(s,t,e,i,n){const r=s.ctx,o=t.circular,{color:a,lineWidth:l}=t;!o&&!i||!a||!l||e<0||(r.save(),r.strokeStyle=a,r.lineWidth=l,r.setLineDash(n.dash||[]),r.lineDashOffset=n.dashOffset,r.beginPath(),Na(s,e,o,i),r.closePath(),r.stroke(),r.restore())}function Cf(s,t,e){return Xt(s,{label:e,index:t,type:"pointLabel"})}class Pf extends ri{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:ci.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=lt(sn(this.options)/2),e=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=q(t)&&!isNaN(t)?t:0,this.max=q(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/sn(this.options))}generateTickLabels(t){ri.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,i)=>{const n=F(this.options.pointLabels.callback,[e,i],this);return n||n===0?n:""}).filter((e,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?yf(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,i,n){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((i-n)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,i,n))}getIndexAngle(t){const e=U/(this._pointLabels.length||1),i=this.options.startAngle||0;return ot(t*e+St(i))}getDistanceFromCenterForValue(t){if(D(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(D(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const i=e[t];return Cf(this.getContext(),t,i)}}getPointPosition(t,e,i=0){const n=this.getIndexAngle(t)-G+i;return{x:Math.cos(n)*e+this.xCenter,y:Math.sin(n)*e+this.yCenter,angle:n}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:i,right:n,bottom:r}=this._pointLabelItems[t];return{left:e,top:i,right:n,bottom:r}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),Na(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:i,grid:n,border:r}=e,o=this._pointLabels.length;let a,l,c;if(e.pointLabels.display&&Af(this,o),n.display&&this.ticks.forEach((h,u)=>{if(u!==0||u===0&&this.min<0){l=this.getDistanceFromCenterForValue(h.value);const d=this.getContext(u),f=n.setContext(d),g=r.setContext(d);Of(this,f,l,o,g)}}),i.display){for(t.save(),a=o-1;a>=0;a--){const h=i.setContext(this.getPointLabelContext(a)),{color:u,lineWidth:d}=h;!d||!u||(t.lineWidth=d,t.strokeStyle=u,t.setLineDash(h.borderDash),t.lineDashOffset=h.borderDashOffset,l=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),c=this.getPointPosition(a,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const n=this.getIndexAngle(0);let r,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(n),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&this.min>=0&&!e.reverse)return;const c=i.setContext(this.getContext(l)),h=X(c.font);if(r=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=h.string,o=t.measureText(a.label).width,t.fillStyle=c.backdropColor;const u=lt(c.backdropPadding);t.fillRect(-o/2-u.left,-r-h.size/2-u.top,o+u.width,h.size+u.height)}ye(t,a.label,0,-r,h,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}const mi={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},ut=Object.keys(mi);function ro(s,t){return s-t}function oo(s,t){if(D(t))return null;const e=s._adapter,{parser:i,round:n,isoWeekday:r}=s._parseOpts;let o=t;return typeof i=="function"&&(o=i(o)),q(o)||(o=typeof i=="string"?e.parse(o,i):e.parse(o)),o===null?null:(n&&(o=n==="week"&&(Fe(r)||r===!0)?e.startOf(o,"isoWeek",r):e.startOf(o,n)),+o)}function ao(s,t,e,i){const n=ut.length;for(let r=ut.indexOf(s);r<n-1;++r){const o=mi[ut[r]],a=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((e-t)/(a*o.size))<=i)return ut[r]}return ut[n-1]}function Rf(s,t,e,i,n){for(let r=ut.length-1;r>=ut.indexOf(e);r--){const o=ut[r];if(mi[o].common&&s._adapter.diff(n,i,o)>=t-1)return o}return ut[e?ut.indexOf(e):0]}function Mf(s){for(let t=ut.indexOf(s)+1,e=ut.length;t<e;++t)if(mi[ut[t]].common)return ut[t]}function lo(s,t,e){if(!e)s[t]=!0;else if(e.length){const{lo:i,hi:n}=xn(e,t),r=e[i]>=t?e[i]:e[n];s[r]=!0}}function Df(s,t,e,i){const n=s._adapter,r=+n.startOf(t[0].value,i),o=t[t.length-1].value;let a,l;for(a=r;a<=o;a=+n.add(a,1,i))l=e[a],l>=0&&(t[l].major=!0);return t}function co(s,t,e){const i=[],n={},r=t.length;let o,a;for(o=0;o<r;++o)a=t[o],n[a]=o,i.push({value:a,major:!1});return r===0||!e?i:Df(s,i,n,e)}class nn extends _e{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const i=t.time||(t.time={}),n=this._adapter=new Dh._date(t.adapters.date);n.init(e),ns(i.displayFormats,n.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:oo(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:n,max:r,minDefined:o,maxDefined:a}=this.getUserBounds();function l(c){!o&&!isNaN(c.min)&&(n=Math.min(n,c.min)),!a&&!isNaN(c.max)&&(r=Math.max(r,c.max))}(!o||!a)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),n=q(n)&&!isNaN(n)?n:+e.startOf(Date.now(),i),r=q(r)&&!isNaN(r)?r:+e.endOf(Date.now(),i)+1,this.min=Math.min(n,r-1),this.max=Math.max(n+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,n=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&n.length&&(this.min=this._userMin||n[0],this.max=this._userMax||n[n.length-1]);const r=this.min,o=this.max,a=Xl(n,r,o);return this._unit=e.unit||(i.autoSkip?ao(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):Rf(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:Mf(this._unit),this.initOffsets(n),t.reverse&&a.reverse(),co(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,i=0,n,r;this.options.offset&&t.length&&(n=this.getDecimalForValue(t[0]),t.length===1?e=1-n:e=(this.getDecimalForValue(t[1])-n)/2,r=this.getDecimalForValue(t[t.length-1]),t.length===1?i=r:i=(r-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;e=Q(e,0,o),i=Q(i,0,o),this._offsets={start:e,end:i,factor:1/(e+1+i)}}_generate(){const t=this._adapter,e=this.min,i=this.max,n=this.options,r=n.time,o=r.unit||ao(r.minUnit,e,i,this._getLabelCapacity(e)),a=P(n.ticks.stepSize,1),l=o==="week"?r.isoWeekday:!1,c=Fe(l)||l===!0,h={};let u=e,d,f;if(c&&(u=+t.startOf(u,"isoWeek",l)),u=+t.startOf(u,c?"day":o),t.diff(i,e,o)>1e5*a)throw new Error(e+" and "+i+" are too far apart with stepSize of "+a+" "+o);const g=n.ticks.source==="data"&&this.getDataTimestamps();for(d=u,f=0;d<i;d=+t.add(d,a,o),f++)lo(h,d,g);return(d===i||n.bounds==="ticks"||f===1)&&lo(h,d,g),Object.keys(h).sort(ro).map(p=>+p)}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}format(t,e){const n=this.options.time.displayFormats,r=this._unit,o=e||n[r];return this._adapter.format(t,o)}_tickFormatFunction(t,e,i,n){const r=this.options,o=r.ticks.callback;if(o)return F(o,[t,e,i],this);const a=r.time.displayFormats,l=this._unit,c=this._majorUnit,h=l&&a[l],u=c&&a[c],d=i[e],f=c&&u&&d&&d.major;return this._adapter.format(t,n||(f?u:h))}generateTickLabels(t){let e,i,n;for(e=0,i=t.length;e<i;++e)n=t[e],n.label=this._tickFormatFunction(n.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,n=St(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(n),o=Math.sin(n),a=this._resolveTickFontOptions(0).size;return{w:i*r+a*o,h:i*o+a*r}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,n=i[e.unit]||i.millisecond,r=this._tickFormatFunction(t,0,co(this,[t],this._majorUnit),n),o=this._getLabelSize(r),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],e,i;if(t.length)return t;const n=this.getMatchingVisibleMetas();if(this._normalized&&n.length)return this._cache.data=n[0].controller.getAllParsedValues(this);for(e=0,i=n.length;e<i;++e)t=t.concat(n[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const n=this.getLabels();for(e=0,i=n.length;e<i;++e)t.push(oo(this,n[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Jo(t.sort(ro))}}function Fs(s,t,e){let i=0,n=s.length-1,r,o,a,l;e?(t>=s[i].pos&&t<=s[n].pos&&({lo:i,hi:n}=jt(s,"pos",t)),{pos:r,time:a}=s[i],{pos:o,time:l}=s[n]):(t>=s[i].time&&t<=s[n].time&&({lo:i,hi:n}=jt(s,"time",t)),{time:r,pos:a}=s[i],{time:o,pos:l}=s[n]);const c=o-r;return c?a+(l-a)*(t-r)/c:a}class If extends nn{static id="timeseries";static defaults=nn.defaults;constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=Fs(e,this.min),this._tableRange=Fs(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,n=[],r=[];let o,a,l,c,h;for(o=0,a=t.length;o<a;++o)c=t[o],c>=e&&c<=i&&n.push(c);if(n.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(o=0,a=n.length;o<a;++o)h=n[o+1],l=n[o-1],c=n[o],Math.round((h+l)/2)!==c&&r.push({time:c,pos:o/(a-1)});return r}_generate(){const t=this.min,e=this.max;let i=super.getDataTimestamps();return(!i.includes(t)||!i.length)&&i.splice(0,0,t),(!i.includes(e)||i.length===1)&&i.push(e),i.sort((n,r)=>n-r)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return e.length&&i.length?t=this.normalize(e.concat(i)):t=e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(Fs(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return Fs(this._table,i*this._tableRange+this._minPos,!0)}}var Lf=Object.freeze({__proto__:null,CategoryScale:uf,LinearScale:ff,LogarithmicScale:mf,RadialLinearScale:Pf,TimeScale:nn,TimeSeriesScale:If});const jf=[Mh,ud,af,Lf];Dn.register(...jf);const Ba="fg_state",Ln="fg_draft_tx",$f=[{id:"hogar",name:"Hogar",emoji:"",color:"#E8956E",wallet_type:"personal",monthly_budget:2e4},{id:"random",name:"Random",emoji:"",color:"#5B8C5A",wallet_type:"business",monthly_budget:5e3},{id:"dhash",name:"Dhash",emoji:"",color:"#9B7EC8",wallet_type:"business",monthly_budget:1e4}],Nf={hogar:[{name:"Renta",icon:"",type:"expense"},{name:"Comida",icon:"",type:"expense"},{name:"Salud",icon:"",type:"expense"},{name:"Beb",icon:"",type:"expense"},{name:"Mantenimiento",icon:"",type:"expense"},{name:"Transporte",icon:"",type:"expense"},{name:"Servicios",icon:"",type:"expense"},{name:"Personal",icon:"",type:"expense"},{name:"Mascotas",icon:"",type:"expense"},{name:"Suscripciones",icon:"",type:"expense"},{name:"Entretenimiento",icon:"",type:"expense"},{name:"Otro Ingreso",icon:"",type:"income"}],random:[{name:"Servicios",icon:"",type:"income"},{name:"Comisiones",icon:"",type:"income"},{name:"Ventas",icon:"",type:"income"},{name:"Renta",icon:"",type:"expense"},{name:"Contabilidad",icon:"",type:"expense"},{name:"Servicios Op.",icon:"",type:"expense"},{name:"Suscripciones",icon:"",type:"expense"},{name:"Marketing",icon:"",type:"expense"},{name:"Materiales",icon:"",type:"expense"},{name:"Otros",icon:"",type:"expense"}],dhash:[{name:"Cuadros",icon:"",type:"income"},{name:"Murales",icon:"",type:"income"},{name:"Tattoo",icon:"",type:"income"},{name:"Diseo",icon:"",type:"income"},{name:"Materiales",icon:"",type:"expense"},{name:"Sueldos",icon:"",type:"expense"},{name:"Gastos Operativos",icon:"",type:"expense"},{name:"Suscripciones",icon:"",type:"expense"},{name:"Transporte",icon:"",type:"expense"},{name:"Otros",icon:"",type:"expense"}]},Bf=[{id:"mp-hogar",name:"Mercado Pago (Hogar)",institution:"Mercado Pago",balance:0,currency:"MXN"},{id:"mp-dhash",name:"Mercado Pago (Dhash)",institution:"Mercado Pago",balance:0,currency:"MXN"},{id:"mp-random",name:"Mercado Pago (Random)",institution:"Mercado Pago",balance:0,currency:"MXN"},{id:"bbva",name:"BBVA",institution:"BBVA",balance:0,currency:"MXN"}];let yt={wallets:[...$f],categories:{...Nf},accounts:[...Bf],transactions:[],debts:[],activeWalletId:"hogar",currentMonth:new Date().toISOString().slice(0,7),theme:"dark",supabaseConnected:!1};const rn=new Set;function Ff(){try{const s=localStorage.getItem(Ba);if(s){const t=JSON.parse(s);yt={...yt,...t}}}catch(s){console.warn("Failed to load state:",s)}return yt}function jn(){try{localStorage.setItem(Ba,JSON.stringify(yt))}catch(s){console.warn("Failed to save state:",s)}}function tt(){return yt}function At(s){const t=new Set(Object.keys(s));Object.assign(yt,s),jn(),rn.forEach(e=>e(yt,t))}function Uf(s){return rn.add(s),()=>rn.delete(s)}function zf(s){try{localStorage.setItem(Ln,JSON.stringify({...s,savedAt:Date.now()}))}catch(t){console.warn("Draft save failed:",t)}}function Wf(){try{const s=localStorage.getItem(Ln);if(s)return JSON.parse(s)}catch(s){console.warn("Draft load failed:",s)}return null}function $n(){localStorage.removeItem(Ln)}function Fa(){return yt.wallets.find(s=>s.id===yt.activeWalletId)||yt.wallets[0]}function Nn(s,t){const e=yt.categories[s]||[];return t?e.filter(i=>i.type===t):e}function Vf(){const[s,t]=yt.currentMonth.split("-").map(Number);return{year:s,month:t}}function Hf(){const{year:s,month:t}=Vf(),e=`${s}-${String(t).padStart(2,"0")}-01`,i=new Date(s,t,0).getDate(),n=`${s}-${String(t).padStart(2,"0")}-${i}`;return{start:e,end:n}}function qf(s){const[t,e]=s.split("-").map(Number);return`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][e-1]} ${t}`}function ct(s){return new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",minimumFractionDigits:0,maximumFractionDigits:2}).format(s)}function Kf(s){const t=new Date(s+"T12:00:00"),e=new Date,i=new Date(e);return i.setDate(i.getDate()-1),t.toDateString()===e.toDateString()?"Hoy":t.toDateString()===i.toDateString()?"Ayer":t.toLocaleDateString("es-MX",{day:"numeric",month:"short"})}Ff();function bi(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(s);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(s,i[n])&&(e[i[n]]=s[i[n]]);return e}function Gf(s,t,e,i){function n(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function a(h){try{c(i.next(h))}catch(u){o(u)}}function l(h){try{c(i.throw(h))}catch(u){o(u)}}function c(h){h.done?r(h.value):n(h.value).then(a,l)}c((i=i.apply(s,t||[])).next())})}const Jf=s=>s?(...t)=>s(...t):(...t)=>fetch(...t);class Bn extends Error{constructor(t,e="FunctionsError",i){super(t),this.name=e,this.context=i}}class Yf extends Bn{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class ho extends Bn{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class uo extends Bn{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var on;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(on||(on={}));class Xf{constructor(t,{headers:e={},customFetch:i,region:n=on.Any}={}){this.url=t,this.headers=e,this.region=n,this.fetch=Jf(i)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return Gf(this,arguments,void 0,function*(e,i={}){var n;let r,o;try{const{headers:a,method:l,body:c,signal:h,timeout:u}=i;let d={},{region:f}=i;f||(f=this.region);const g=new URL(`${this.url}/${e}`);f&&f!=="any"&&(d["x-region"]=f,g.searchParams.set("forceFunctionRegion",f));let p;c&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",p=c):typeof c=="string"?(d["Content-Type"]="text/plain",p=c):typeof FormData<"u"&&c instanceof FormData?p=c:(d["Content-Type"]="application/json",p=JSON.stringify(c)):c&&typeof c!="string"&&!(typeof Blob<"u"&&c instanceof Blob)&&!(c instanceof ArrayBuffer)&&!(typeof FormData<"u"&&c instanceof FormData)?p=JSON.stringify(c):p=c;let m=h;u&&(o=new AbortController,r=setTimeout(()=>o.abort(),u),h?(m=o.signal,h.addEventListener("abort",()=>o.abort())):m=o.signal);const b=yield this.fetch(g.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),a),body:p,signal:m}).catch(w=>{throw new Yf(w)}),y=b.headers.get("x-relay-error");if(y&&y==="true")throw new ho(b);if(!b.ok)throw new uo(b);let _=((n=b.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),v;return _==="application/json"?v=yield b.json():_==="application/octet-stream"||_==="application/pdf"?v=yield b.blob():_==="text/event-stream"?v=b:_==="multipart/form-data"?v=yield b.formData():v=yield b.text(),{data:v,error:null,response:b}}catch(a){return{data:null,error:a,response:a instanceof uo||a instanceof ho?a.context:void 0}}finally{r&&clearTimeout(r)}})}}var Zf=class extends Error{constructor(s){super(s.message),this.name="PostgrestError",this.details=s.details,this.hint=s.hint,this.code=s.code}},Qf=class{constructor(s){var t,e,i;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(t=s.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=s.signal,this.isMaybeSingle=(e=s.isMaybeSingle)!==null&&e!==void 0?e:!1,this.urlLengthLimit=(i=s.urlLengthLimit)!==null&&i!==void 0?i:8e3,s.fetch?this.fetch=s.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,t){return this.headers=new Headers(this.headers),this.headers.set(s,t),this}then(s,t){var e=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const i=this.fetch;let n=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{let o=null,a=null,l=null,c=r.status,h=r.statusText;if(r.ok){var u,d;if(e.method!=="HEAD"){var f;const b=await r.text();b===""||(e.headers.get("Accept")==="text/csv"||e.headers.get("Accept")&&(!((f=e.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?a=b:a=JSON.parse(b))}const p=(u=e.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),m=(d=r.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");p&&m&&m.length>1&&(l=parseInt(m[1])),e.isMaybeSingle&&e.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,c=406,h="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var g;const p=await r.text();try{o=JSON.parse(p),Array.isArray(o)&&r.status===404&&(a=[],o=null,c=200,h="OK")}catch{r.status===404&&p===""?(c=204,h="No Content"):o={message:p}}if(o&&e.isMaybeSingle&&(!(o==null||(g=o.details)===null||g===void 0)&&g.includes("0 rows"))&&(o=null,c=200,h="OK"),o&&e.shouldThrowOnError)throw new Zf(o)}return{error:o,data:a,count:l,status:c,statusText:h}});return this.shouldThrowOnError||(n=n.catch(r=>{var o;let a="",l="",c="";const h=r?.cause;if(h){var u,d,f,g;const b=(u=h?.message)!==null&&u!==void 0?u:"",y=(d=h?.code)!==null&&d!==void 0?d:"";a=`${(f=r?.name)!==null&&f!==void 0?f:"FetchError"}: ${r?.message}`,a+=`

Caused by: ${(g=h?.name)!==null&&g!==void 0?g:"Error"}: ${b}`,y&&(a+=` (${y})`),h?.stack&&(a+=`
${h.stack}`)}else{var p;a=(p=r?.stack)!==null&&p!==void 0?p:""}const m=this.url.toString().length;return r?.name==="AbortError"||r?.code==="ABORT_ERR"?(c="",l="Request was aborted (timeout or manual cancellation)",m>this.urlLengthLimit&&(l+=`. Note: Your request URL is ${m} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):(h?.name==="HeadersOverflowError"||h?.code==="UND_ERR_HEADERS_OVERFLOW")&&(c="",l="HTTP headers exceeded server limits (typically 16KB)",m>this.urlLengthLimit&&(l+=`. Your request URL is ${m} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(o=r?.name)!==null&&o!==void 0?o:"FetchError"}: ${r?.message}`,details:a,hint:l,code:c},data:null,count:null,status:0,statusText:""}})),n.then(s,t)}returns(){return this}overrideTypes(){return this}},tg=class extends Qf{select(s){let t=!1;const e=(s??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",e),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:t=!0,nullsFirst:e,foreignTable:i,referencedTable:n=i}={}){const r=n?`${n}.order`:"order",o=this.url.searchParams.get(r);return this.url.searchParams.set(r,`${o?`${o},`:""}${s}.${t?"asc":"desc"}${e===void 0?"":e?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:t,referencedTable:e=t}={}){const i=typeof e>"u"?"limit":`${e}.limit`;return this.url.searchParams.set(i,`${s}`),this}range(s,t,{foreignTable:e,referencedTable:i=e}={}){const n=typeof i>"u"?"offset":`${i}.offset`,r=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(n,`${s}`),this.url.searchParams.set(r,`${t-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:t=!1,settings:e=!1,buffers:i=!1,wal:n=!1,format:r="text"}={}){var o;const a=[s?"analyze":null,t?"verbose":null,e?"settings":null,i?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${r}; for="${l}"; options=${a};`),r==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}};const fo=new RegExp("[,()]");var Me=class extends tg{eq(s,t){return this.url.searchParams.append(s,`eq.${t}`),this}neq(s,t){return this.url.searchParams.append(s,`neq.${t}`),this}gt(s,t){return this.url.searchParams.append(s,`gt.${t}`),this}gte(s,t){return this.url.searchParams.append(s,`gte.${t}`),this}lt(s,t){return this.url.searchParams.append(s,`lt.${t}`),this}lte(s,t){return this.url.searchParams.append(s,`lte.${t}`),this}like(s,t){return this.url.searchParams.append(s,`like.${t}`),this}likeAllOf(s,t){return this.url.searchParams.append(s,`like(all).{${t.join(",")}}`),this}likeAnyOf(s,t){return this.url.searchParams.append(s,`like(any).{${t.join(",")}}`),this}ilike(s,t){return this.url.searchParams.append(s,`ilike.${t}`),this}ilikeAllOf(s,t){return this.url.searchParams.append(s,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(s,t){return this.url.searchParams.append(s,`ilike(any).{${t.join(",")}}`),this}regexMatch(s,t){return this.url.searchParams.append(s,`match.${t}`),this}regexIMatch(s,t){return this.url.searchParams.append(s,`imatch.${t}`),this}is(s,t){return this.url.searchParams.append(s,`is.${t}`),this}isDistinct(s,t){return this.url.searchParams.append(s,`isdistinct.${t}`),this}in(s,t){const e=Array.from(new Set(t)).map(i=>typeof i=="string"&&fo.test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(s,`in.(${e})`),this}notIn(s,t){const e=Array.from(new Set(t)).map(i=>typeof i=="string"&&fo.test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(s,`not.in.(${e})`),this}contains(s,t){return typeof t=="string"?this.url.searchParams.append(s,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(s,`cs.{${t.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(t)}`),this}containedBy(s,t){return typeof t=="string"?this.url.searchParams.append(s,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(s,`cd.{${t.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(t)}`),this}rangeGt(s,t){return this.url.searchParams.append(s,`sr.${t}`),this}rangeGte(s,t){return this.url.searchParams.append(s,`nxl.${t}`),this}rangeLt(s,t){return this.url.searchParams.append(s,`sl.${t}`),this}rangeLte(s,t){return this.url.searchParams.append(s,`nxr.${t}`),this}rangeAdjacent(s,t){return this.url.searchParams.append(s,`adj.${t}`),this}overlaps(s,t){return typeof t=="string"?this.url.searchParams.append(s,`ov.${t}`):this.url.searchParams.append(s,`ov.{${t.join(",")}}`),this}textSearch(s,t,{config:e,type:i}={}){let n="";i==="plain"?n="pl":i==="phrase"?n="ph":i==="websearch"&&(n="w");const r=e===void 0?"":`(${e})`;return this.url.searchParams.append(s,`${n}fts${r}.${t}`),this}match(s){return Object.entries(s).forEach(([t,e])=>{this.url.searchParams.append(t,`eq.${e}`)}),this}not(s,t,e){return this.url.searchParams.append(s,`not.${t}.${e}`),this}or(s,{foreignTable:t,referencedTable:e=t}={}){const i=e?`${e}.or`:"or";return this.url.searchParams.append(i,`(${s})`),this}filter(s,t,e){return this.url.searchParams.append(s,`${t}.${e}`),this}},eg=class{constructor(s,{headers:t={},schema:e,fetch:i,urlLengthLimit:n=8e3}){this.url=s,this.headers=new Headers(t),this.schema=e,this.fetch=i,this.urlLengthLimit=n}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(s,t){const{head:e=!1,count:i}=t??{},n=e?"HEAD":"GET";let r=!1;const o=(s??"*").split("").map(c=>/\s/.test(c)&&!r?"":(c==='"'&&(r=!r),c)).join(""),{url:a,headers:l}=this.cloneRequestState();return a.searchParams.set("select",o),i&&l.append("Prefer",`count=${i}`),new Me({method:n,url:a,headers:l,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(s,{count:t,defaultToNull:e=!0}={}){var i;const n="POST",{url:r,headers:o}=this.cloneRequestState();if(t&&o.append("Prefer",`count=${t}`),e||o.append("Prefer","missing=default"),Array.isArray(s)){const a=s.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(a.length>0){const l=[...new Set(a)].map(c=>`"${c}"`);r.searchParams.set("columns",l.join(","))}}return new Me({method:n,url:r,headers:o,schema:this.schema,body:s,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(s,{onConflict:t,ignoreDuplicates:e=!1,count:i,defaultToNull:n=!0}={}){var r;const o="POST",{url:a,headers:l}=this.cloneRequestState();if(l.append("Prefer",`resolution=${e?"ignore":"merge"}-duplicates`),t!==void 0&&a.searchParams.set("on_conflict",t),i&&l.append("Prefer",`count=${i}`),n||l.append("Prefer","missing=default"),Array.isArray(s)){const c=s.reduce((h,u)=>h.concat(Object.keys(u)),[]);if(c.length>0){const h=[...new Set(c)].map(u=>`"${u}"`);a.searchParams.set("columns",h.join(","))}}return new Me({method:o,url:a,headers:l,schema:this.schema,body:s,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}update(s,{count:t}={}){var e;const i="PATCH",{url:n,headers:r}=this.cloneRequestState();return t&&r.append("Prefer",`count=${t}`),new Me({method:i,url:n,headers:r,schema:this.schema,body:s,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:s}={}){var t;const e="DELETE",{url:i,headers:n}=this.cloneRequestState();return s&&n.append("Prefer",`count=${s}`),new Me({method:e,url:i,headers:n,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch,urlLengthLimit:this.urlLengthLimit})}};function bs(s){"@babel/helpers - typeof";return bs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bs(s)}function sg(s,t){if(bs(s)!="object"||!s)return s;var e=s[Symbol.toPrimitive];if(e!==void 0){var i=e.call(s,t);if(bs(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function ig(s){var t=sg(s,"string");return bs(t)=="symbol"?t:t+""}function ng(s,t,e){return(t=ig(t))in s?Object.defineProperty(s,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[t]=e,s}function go(s,t){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),e.push.apply(e,i)}return e}function Us(s){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?go(Object(e),!0).forEach(function(i){ng(s,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):go(Object(e)).forEach(function(i){Object.defineProperty(s,i,Object.getOwnPropertyDescriptor(e,i))})}return s}var rg=class Ua{constructor(t,{headers:e={},schema:i,fetch:n,timeout:r,urlLengthLimit:o=8e3}={}){this.url=t,this.headers=new Headers(e),this.schemaName=i,this.urlLengthLimit=o;const a=n??globalThis.fetch;r!==void 0&&r>0?this.fetch=(l,c)=>{const h=new AbortController,u=setTimeout(()=>h.abort(),r),d=c?.signal;if(d){if(d.aborted)return clearTimeout(u),a(l,c);const f=()=>{clearTimeout(u),h.abort()};return d.addEventListener("abort",f,{once:!0}),a(l,Us(Us({},c),{},{signal:h.signal})).finally(()=>{clearTimeout(u),d.removeEventListener("abort",f)})}return a(l,Us(Us({},c),{},{signal:h.signal})).finally(()=>clearTimeout(u))}:this.fetch=a}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new eg(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(t){return new Ua(this.url,{headers:this.headers,schema:t,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(t,e={},{head:i=!1,get:n=!1,count:r}={}){var o;let a;const l=new URL(`${this.url}/rpc/${t}`);let c;const h=f=>f!==null&&typeof f=="object"&&(!Array.isArray(f)||f.some(h)),u=i&&Object.values(e).some(h);u?(a="POST",c=e):i||n?(a=i?"HEAD":"GET",Object.entries(e).filter(([f,g])=>g!==void 0).map(([f,g])=>[f,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([f,g])=>{l.searchParams.append(f,g)})):(a="POST",c=e);const d=new Headers(this.headers);return u?d.set("Prefer",r?`count=${r},return=minimal`:"return=minimal"):r&&d.set("Prefer",`count=${r}`),new Me({method:a,url:l,headers:d,schema:this.schemaName,body:c,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}};class og{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const e=globalThis.process;if(e){const i=e.versions;if(i&&i.node){const n=i.node,r=parseInt(n.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let e=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(e+=`

Suggested solution: ${t.workaround}`),new Error(e)}static createWebSocket(t,e){const i=this.getWebSocketConstructor();return new i(t,e)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const ag="2.95.3",lg=`realtime-js/${ag}`,cg="1.0.0",za="2.0.0",po=za,an=1e4,hg=1e3,ug=100;var Ft;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(Ft||(Ft={}));var Y;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(Y||(Y={}));var xt;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(xt||(xt={}));var ln;(function(s){s.websocket="websocket"})(ln||(ln={}));var he;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(he||(he={}));class dg{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,e){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return e(this._binaryEncodeUserBroadcastPush(t));let i=[t.join_ref,t.ref,t.topic,t.event,t.payload];return e(JSON.stringify(i))}_binaryEncodeUserBroadcastPush(t){var e;return this._isArrayBuffer((e=t.payload)===null||e===void 0?void 0:e.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var e,i;const n=(i=(e=t.payload)===null||e===void 0?void 0:e.payload)!==null&&i!==void 0?i:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,n)}_encodeJsonUserBroadcastPush(t){var e,i;const n=(i=(e=t.payload)===null||e===void 0?void 0:e.payload)!==null&&i!==void 0?i:{},o=new TextEncoder().encode(JSON.stringify(n)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(t,e,i){var n,r;const o=t.topic,a=(n=t.ref)!==null&&n!==void 0?n:"",l=(r=t.join_ref)!==null&&r!==void 0?r:"",c=t.payload.event,h=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},u=Object.keys(h).length===0?"":JSON.stringify(h);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`metadata length ${u.length} exceeds maximum of 255`);const d=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+c.length+u.length,f=new ArrayBuffer(this.HEADER_LENGTH+d);let g=new DataView(f),p=0;g.setUint8(p++,this.KINDS.userBroadcastPush),g.setUint8(p++,l.length),g.setUint8(p++,a.length),g.setUint8(p++,o.length),g.setUint8(p++,c.length),g.setUint8(p++,u.length),g.setUint8(p++,e),Array.from(l,b=>g.setUint8(p++,b.charCodeAt(0))),Array.from(a,b=>g.setUint8(p++,b.charCodeAt(0))),Array.from(o,b=>g.setUint8(p++,b.charCodeAt(0))),Array.from(c,b=>g.setUint8(p++,b.charCodeAt(0))),Array.from(u,b=>g.setUint8(p++,b.charCodeAt(0)));var m=new Uint8Array(f.byteLength+i.byteLength);return m.set(new Uint8Array(f),0),m.set(new Uint8Array(i),f.byteLength),m.buffer}decode(t,e){if(this._isArrayBuffer(t)){let i=this._binaryDecode(t);return e(i)}if(typeof t=="string"){const i=JSON.parse(t),[n,r,o,a,l]=i;return e({join_ref:n,ref:r,topic:o,event:a,payload:l})}return e({})}_binaryDecode(t){const e=new DataView(t),i=e.getUint8(0),n=new TextDecoder;if(i===this.KINDS.userBroadcast)return this._decodeUserBroadcast(t,e,n)}_decodeUserBroadcast(t,e,i){const n=e.getUint8(1),r=e.getUint8(2),o=e.getUint8(3),a=e.getUint8(4);let l=this.HEADER_LENGTH+4;const c=i.decode(t.slice(l,l+n));l=l+n;const h=i.decode(t.slice(l,l+r));l=l+r;const u=i.decode(t.slice(l,l+o));l=l+o;const d=t.slice(l,t.byteLength),f=a===this.JSON_ENCODING?JSON.parse(i.decode(d)):d,g={type:this.BROADCAST_EVENT,event:h,payload:f};return o>0&&(g.meta=JSON.parse(u)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:g}}_isArrayBuffer(t){var e;return t instanceof ArrayBuffer||((e=t?.constructor)===null||e===void 0?void 0:e.name)==="ArrayBuffer"}_pick(t,e){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([i])=>e.includes(i)))}}class Wa{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var B;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(B||(B={}));const mo=(s,t,e={})=>{var i;const n=(i=e.skipTypes)!==null&&i!==void 0?i:[];return t?Object.keys(t).reduce((r,o)=>(r[o]=fg(o,s,t,n),r),{}):{}},fg=(s,t,e,i)=>{const n=t.find(a=>a.name===s),r=n?.type,o=e[s];return r&&!i.includes(r)?Va(r,o):cn(o)},Va=(s,t)=>{if(s.charAt(0)==="_"){const e=s.slice(1,s.length);return bg(t,e)}switch(s){case B.bool:return gg(t);case B.float4:case B.float8:case B.int2:case B.int4:case B.int8:case B.numeric:case B.oid:return pg(t);case B.json:case B.jsonb:return mg(t);case B.timestamp:return yg(t);case B.abstime:case B.date:case B.daterange:case B.int4range:case B.int8range:case B.money:case B.reltime:case B.text:case B.time:case B.timestamptz:case B.timetz:case B.tsrange:case B.tstzrange:return cn(t);default:return cn(t)}},cn=s=>s,gg=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},pg=s=>{if(typeof s=="string"){const t=parseFloat(s);if(!Number.isNaN(t))return t}return s},mg=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch{return s}return s},bg=(s,t)=>{if(typeof s!="string")return s;const e=s.length-1,i=s[e];if(s[0]==="{"&&i==="}"){let r;const o=s.slice(1,e);try{r=JSON.parse("["+o+"]")}catch{r=o?o.split(","):[]}return r.map(a=>Va(t,a))}return s},yg=s=>typeof s=="string"?s.replace(" ","T"):s,Ha=s=>{const t=new URL(s);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Li{constructor(t,e,i={},n=an){this.channel=t,this.event=e,this.payload=i,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var i;return this._hasReceived(t)&&e((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:e}){this.recHooks.filter(i=>i.status===t).forEach(i=>i.callback(e))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var bo;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(bo||(bo={}));class ls{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=e?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},n=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ls.syncState(this.state,n,r,o),this.pendingDiffs.forEach(l=>{this.state=ls.syncDiff(this.state,l,r,o)}),this.pendingDiffs=[],a()}),this.channel._on(i.diff,{},n=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=ls.syncDiff(this.state,n,r,o),a())}),this.onJoin((n,r,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:r,newPresences:o})}),this.onLeave((n,r,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:r,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,e,i,n){const r=this.cloneDeep(t),o=this.transformState(e),a={},l={};return this.map(r,(c,h)=>{o[c]||(l[c]=h)}),this.map(o,(c,h)=>{const u=r[c];if(u){const d=h.map(m=>m.presence_ref),f=u.map(m=>m.presence_ref),g=h.filter(m=>f.indexOf(m.presence_ref)<0),p=u.filter(m=>d.indexOf(m.presence_ref)<0);g.length>0&&(a[c]=g),p.length>0&&(l[c]=p)}else a[c]=h}),this.syncDiff(r,{joins:a,leaves:l},i,n)}static syncDiff(t,e,i,n){const{joins:r,leaves:o}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return i||(i=()=>{}),n||(n=()=>{}),this.map(r,(a,l)=>{var c;const h=(c=t[a])!==null&&c!==void 0?c:[];if(t[a]=this.cloneDeep(l),h.length>0){const u=t[a].map(f=>f.presence_ref),d=h.filter(f=>u.indexOf(f.presence_ref)<0);t[a].unshift(...d)}i(a,h,l)}),this.map(o,(a,l)=>{let c=t[a];if(!c)return;const h=l.map(u=>u.presence_ref);c=c.filter(u=>h.indexOf(u.presence_ref)<0),t[a]=c,n(a,c,l),c.length===0&&delete t[a]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(i=>e(i,t[i]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,i)=>{const n=t[i];return"metas"in n?e[i]=n.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):e[i]=n,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var yo;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(yo||(yo={}));var cs;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(cs||(cs={}));var Rt;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(Rt||(Rt={}));class $e{constructor(t,e={config:{}},i){var n,r;if(this.topic=t,this.params=e,this.socket=i,this.bindings={},this.state=Y.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new Li(this,xt.join,this.params,this.timeout),this.rejoinTimer=new Wa(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Y.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Y.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Y.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Y.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Y.errored,this.rejoinTimer.scheduleTimeout())}),this._on(xt.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new ls(this),this.broadcastEndpointURL=Ha(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((r=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||r===void 0)&&r.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,e=this.timeout){var i,n,r;if(this.socket.isConnected()||this.socket.connect(),this.state==Y.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(n=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map(f=>f.filter))!==null&&n!==void 0?n:[],h=!!this.bindings[cs.PRESENCE]&&this.bindings[cs.PRESENCE].length>0||((r=this.params.config.presence)===null||r===void 0?void 0:r.enabled)===!0,u={},d={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:h}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(f=>t?.(Rt.CHANNEL_ERROR,f)),this._onClose(()=>t?.(Rt.CLOSED)),this.updateJoinPayload(Object.assign({config:d},u)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",async({postgres_changes:f})=>{var g;if(this.socket._isManualToken()||this.socket.setAuth(),f===void 0){t?.(Rt.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,m=(g=p?.length)!==null&&g!==void 0?g:0,b=[];for(let y=0;y<m;y++){const _=p[y],{filter:{event:v,schema:w,table:x,filter:S}}=_,E=f&&f[y];if(E&&E.event===v&&$e.isFilterValueEqual(E.schema,w)&&$e.isFilterValueEqual(E.table,x)&&$e.isFilterValueEqual(E.filter,S))b.push(Object.assign(Object.assign({},_),{id:E.id}));else{this.unsubscribe(),this.state=Y.errored,t?.(Rt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=b,t&&t(Rt.SUBSCRIBED);return}}).receive("error",f=>{this.state=Y.errored,t?.(Rt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{t?.(Rt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,e={}){return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,e,i){return this.state===Y.joined&&t===cs.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,e,i)}async httpSend(t,e,i={}){var n;if(e==null)return Promise.reject("Payload is required for httpSend()");const r={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(r.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:r,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:e,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(n=i.timeout)!==null&&n!==void 0?n:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const c=await a.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(t,e={}){var i,n;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:r,payload:o}=t,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(i=e.timeout)!==null&&i!==void 0?i:this.timeout);return await((n=c.body)===null||n===void 0?void 0:n.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var o,a,l;const c=this._push(t.type,t,e.timeout||this.timeout);t.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&r("ok"),c.receive("ok",()=>r("ok")),c.receive("error",()=>r("error")),c.receive("timeout",()=>r("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Y.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(xt.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(n=>{i=new Li(this,xt.leave,{},t),i.receive("ok",()=>{e(),n("ok")}).receive("timeout",()=>{e(),n("timed out")}).receive("error",()=>{n("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Y.closed,this.bindings={}}async _fetchWithTimeout(t,e,i){const n=new AbortController,r=setTimeout(()=>n.abort(),i),o=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:n.signal}));return clearTimeout(r),o}_push(t,e,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Li(this,t,e,i);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>ug){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(t,e,i){return e}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,e,i){var n,r;const o=t.toLocaleLowerCase(),{close:a,error:l,leave:c,join:h}=xt;if(i&&[a,l,c,h].indexOf(o)>=0&&i!==this._joinRef())return;let d=this._onMessage(o,e,i);if(e&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(f=>{var g,p,m;return((g=f.filter)===null||g===void 0?void 0:g.event)==="*"||((m=(p=f.filter)===null||p===void 0?void 0:p.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===o}).map(f=>f.callback(d,i)):(r=this.bindings[o])===null||r===void 0||r.filter(f=>{var g,p,m,b,y,_;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const v=f.id,w=(g=f.filter)===null||g===void 0?void 0:g.event;return v&&((p=e.ids)===null||p===void 0?void 0:p.includes(v))&&(w==="*"||w?.toLocaleLowerCase()===((m=e.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{const v=(y=(b=f?.filter)===null||b===void 0?void 0:b.event)===null||y===void 0?void 0:y.toLocaleLowerCase();return v==="*"||v===((_=e?.event)===null||_===void 0?void 0:_.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof d=="object"&&"ids"in d){const g=d.data,{schema:p,table:m,commit_timestamp:b,type:y,errors:_}=g;d=Object.assign(Object.assign({},{schema:p,table:m,commit_timestamp:b,eventType:y,new:{},old:{},errors:_}),this._getPayloadRecords(g))}f.callback(d,i)})}_isClosed(){return this.state===Y.closed}_isJoined(){return this.state===Y.joined}_isJoining(){return this.state===Y.joining}_isLeaving(){return this.state===Y.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,e,i){const n=t.toLocaleLowerCase(),r={type:n,filter:e,callback:i};return this.bindings[n]?this.bindings[n].push(r):this.bindings[n]=[r],this}_off(t,e){const i=t.toLocaleLowerCase();return this.bindings[i]&&(this.bindings[i]=this.bindings[i].filter(n=>{var r;return!(((r=n.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===i&&$e.isEqual(n.filter,e))})),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(t[i]!==e[i])return!1;return!0}static isFilterValueEqual(t,e){return(t??void 0)===(e??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(xt.close,{},t)}_onError(t){this._on(xt.error,{},e=>t(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Y.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const e={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(e.new=mo(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(e.old=mo(t.columns,t.old_record)),e}}const ji=()=>{},zs={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},_g=[1e3,2e3,5e3,1e4],vg=1e4,wg=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class xg{constructor(t,e){var i;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=an,this.transport=null,this.heartbeatIntervalMs=zs.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ji,this.ref=0,this.reconnectTimer=null,this.vsn=po,this.logger=ji,this.conn=null,this.sendBuffer=[],this.serializer=new dg,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=n=>n?(...r)=>n(...r):(...r)=>fetch(...r),!(!((i=e?.params)===null||i===void 0)&&i.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=e.params.apikey,this.endPoint=`${t}/${ln.websocket}`,this.httpEndpoint=Ha(t),this._initializeOptions(e),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(e?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=og.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const e=t.message;throw e.includes("Node.js")?new Error(`${e}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${e}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,e){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const i=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(i),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,e??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return e==="ok"&&this._remove(t),this.channels.length===0&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,e,i){this.logger(t,e,i)}connectionState(){switch(this.conn&&this.conn.readyState){case Ft.connecting:return he.Connecting;case Ft.open:return he.Open;case Ft.closing:return he.Closing;default:return he.Closed}}isConnected(){return this.connectionState()===he.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,e={config:{}}){const i=`realtime:${t}`,n=this.getChannels().find(r=>r.topic===i);if(n)return n;{const r=new $e(`realtime:${t}`,e,this);return this.channels.push(r),r}}push(t){const{topic:e,event:i,payload:n,ref:r}=t,o=()=>{this.encode(t,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${e} ${i} (${r})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(hg,"heartbeat timeout"),setTimeout(()=>{var e;this.isConnected()||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout()},zs.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let e=this.channels.find(i=>i.topic===t&&(i._isJoined()||i._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}_remove(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,e=>{if(e.topic==="phoenix"&&e.event==="phx_reply"&&e.ref&&e.ref===this.pendingHeartbeatRef){const c=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(e.payload.status==="ok"?"ok":"error",c)}catch(h){this.log("error","error in heartbeat callback",h)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:i,event:n,payload:r,ref:o}=e,a=o?`(${o})`:"",l=r.status||"";this.log("receive",`${l} ${i} ${n} ${a}`.trim(),r),this.channels.filter(c=>c._isMember(i)).forEach(c=>c._trigger(n,r,o)),this._triggerStateCallbacks("message",e)})}_clearTimer(t){var e;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((e=this.reconnectTimer)===null||e===void 0||e.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===Ft.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Ft.open||this.conn.readyState===Ft.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this._terminateWorker()},this.workerRef.onmessage=e=>{e.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var e;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t);try{this.heartbeatCallback("error")}catch(e){this.log("error","error in heartbeat callback",e)}}_triggerChanError(){this.channels.forEach(t=>t._trigger(xt.error))}_appendParams(t,e){if(Object.keys(e).length===0)return t;const i=t.match(/\?/)?"&":"?",n=new URLSearchParams(e);return`${t}${i}${n}`}_workerObjectUrl(t){let e;if(t)e=t;else{const i=new Blob([wg],{type:"application/javascript"});e=URL.createObjectURL(i)}return e}_setConnectionState(t,e=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=e)}async _performAuth(t=null){let e,i=!1;if(t)e=t,i=!0;else if(this.accessToken)try{e=await this.accessToken()}catch(n){this.log("error","Error fetching access token from callback",n),e=this.accessTokenValue}else e=this.accessTokenValue;i?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(n=>{const r={access_token:e,version:lg};e&&n.updateJoinPayload(r),n.joinedOnce&&n._isJoined()&&n._push(xt.access_token,{access_token:e})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(e=>{this.log("error",`Error setting auth in ${t}`,e)})}_triggerStateCallbacks(t,e){try{this.stateChangeCallbacks[t].forEach(i=>{try{i(e)}catch(n){this.log("error",`error in ${t} callback`,n)}})}catch(i){this.log("error",`error triggering ${t} callbacks`,i)}}_setupReconnectionTimer(){this.reconnectTimer=new Wa(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},zs.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var e,i,n,r,o,a,l,c,h,u,d,f;switch(this.transport=(e=t?.transport)!==null&&e!==void 0?e:null,this.timeout=(i=t?.timeout)!==null&&i!==void 0?i:an,this.heartbeatIntervalMs=(n=t?.heartbeatIntervalMs)!==null&&n!==void 0?n:zs.HEARTBEAT_INTERVAL,this.worker=(r=t?.worker)!==null&&r!==void 0?r:!1,this.accessToken=(o=t?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=t?.heartbeatCallback)!==null&&a!==void 0?a:ji,this.vsn=(l=t?.vsn)!==null&&l!==void 0?l:po,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=t?.reconnectAfterMs)!==null&&c!==void 0?c:(g=>_g[g-1]||vg),this.vsn){case cg:this.encode=(h=t?.encode)!==null&&h!==void 0?h:((g,p)=>p(JSON.stringify(g))),this.decode=(u=t?.decode)!==null&&u!==void 0?u:((g,p)=>p(JSON.parse(g)));break;case za:this.encode=(d=t?.encode)!==null&&d!==void 0?d:this.serializer.encode.bind(this.serializer),this.decode=(f=t?.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}var ys=class extends Error{constructor(s,t){super(s),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Sg(s,t,e){const i=new URL(t,s);if(e)for(const[n,r]of Object.entries(e))r!==void 0&&i.searchParams.set(n,r);return i.toString()}async function kg(s){return!s||s.type==="none"?{}:s.type==="bearer"?{Authorization:`Bearer ${s.token}`}:s.type==="header"?{[s.name]:s.value}:s.type==="custom"?await s.getHeaders():{}}function Eg(s){const t=s.fetchImpl??globalThis.fetch;return{async request({method:e,path:i,query:n,body:r,headers:o}){const a=Sg(s.baseUrl,i,n),l=await kg(s.auth),c=await t(a,{method:e,headers:{...r?{"Content-Type":"application/json"}:{},...l,...o},body:r?JSON.stringify(r):void 0}),h=await c.text(),u=(c.headers.get("content-type")||"").includes("application/json"),d=u&&h?JSON.parse(h):h;if(!c.ok){const f=u?d:void 0,g=f?.error;throw new ys(g?.message??`Request failed with status ${c.status}`,{status:c.status,icebergType:g?.type,icebergCode:g?.code,details:f})}return{status:c.status,headers:c.headers,data:d}}}}function Ws(s){return s.join("")}var Tg=class{constructor(s,t=""){this.client=s,this.prefix=t}async listNamespaces(s){const t=s?{parent:Ws(s.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(i=>({namespace:i}))}async createNamespace(s,t){const e={namespace:s.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:e})).data}async dropNamespace(s){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ws(s.namespace)}`})}async loadNamespaceMetadata(s){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ws(s.namespace)}`})).data.properties}}async namespaceExists(s){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ws(s.namespace)}`}),!0}catch(t){if(t instanceof ys&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(s,t){try{return await this.createNamespace(s,t)}catch(e){if(e instanceof ys&&e.status===409)return;throw e}}};function Ee(s){return s.join("")}var Ag=class{constructor(s,t="",e){this.client=s,this.prefix=t,this.accessDelegation=e}async listTables(s){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ee(s.namespace)}/tables`})).data.identifiers}async createTable(s,t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ee(s.namespace)}/tables`,body:t,headers:e})).data.metadata}async updateTable(s,t){const e=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ee(s.namespace)}/tables/${s.name}`,body:t});return{"metadata-location":e.data["metadata-location"],metadata:e.data.metadata}}async dropTable(s,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ee(s.namespace)}/tables/${s.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(s){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ee(s.namespace)}/tables/${s.name}`,headers:t})).data.metadata}async tableExists(s){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ee(s.namespace)}/tables/${s.name}`,headers:t}),!0}catch(e){if(e instanceof ys&&e.status===404)return!1;throw e}}async createTableIfNotExists(s,t){try{return await this.createTable(s,t)}catch(e){if(e instanceof ys&&e.status===409)return await this.loadTable({namespace:s.namespace,name:t.name});throw e}}},Og=class{constructor(s){let t="v1";s.catalogName&&(t+=`/${s.catalogName}`);const e=s.baseUrl.endsWith("/")?s.baseUrl:`${s.baseUrl}/`;this.client=Eg({baseUrl:e,auth:s.auth,fetchImpl:s.fetch}),this.accessDelegation=s.accessDelegation?.join(","),this.namespaceOps=new Tg(this.client,t),this.tableOps=new Ag(this.client,t,this.accessDelegation)}async listNamespaces(s){return this.namespaceOps.listNamespaces(s)}async createNamespace(s,t){return this.namespaceOps.createNamespace(s,t)}async dropNamespace(s){await this.namespaceOps.dropNamespace(s)}async loadNamespaceMetadata(s){return this.namespaceOps.loadNamespaceMetadata(s)}async listTables(s){return this.tableOps.listTables(s)}async createTable(s,t){return this.tableOps.createTable(s,t)}async updateTable(s,t){return this.tableOps.updateTable(s,t)}async dropTable(s,t){await this.tableOps.dropTable(s,t)}async loadTable(s){return this.tableOps.loadTable(s)}async namespaceExists(s){return this.namespaceOps.namespaceExists(s)}async tableExists(s){return this.tableOps.tableExists(s)}async createNamespaceIfNotExists(s,t){return this.namespaceOps.createNamespaceIfNotExists(s,t)}async createTableIfNotExists(s,t){return this.tableOps.createTableIfNotExists(s,t)}},yi=class extends Error{constructor(s,t="storage",e,i){super(s),this.__isStorageError=!0,this.namespace=t,this.name=t==="vectors"?"StorageVectorsError":"StorageError",this.status=e,this.statusCode=i}};function _i(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}var Vs=class extends yi{constructor(s,t,e,i="storage"){super(s,i,t,e),this.name=i==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=t,this.statusCode=e}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},qa=class extends yi{constructor(s,t,e="storage"){super(s,e),this.name=e==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=t}};const Cg=s=>s?(...t)=>s(...t):(...t)=>fetch(...t),Pg=s=>{if(typeof s!="object"||s===null)return!1;const t=Object.getPrototypeOf(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},hn=s=>{if(Array.isArray(s))return s.map(e=>hn(e));if(typeof s=="function"||s!==Object(s))return s;const t={};return Object.entries(s).forEach(([e,i])=>{const n=e.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace(/[-_]/g,""));t[n]=hn(i)}),t},Rg=s=>!s||typeof s!="string"||s.length===0||s.length>100||s.trim()!==s||s.includes("/")||s.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(s);function _s(s){"@babel/helpers - typeof";return _s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_s(s)}function Mg(s,t){if(_s(s)!="object"||!s)return s;var e=s[Symbol.toPrimitive];if(e!==void 0){var i=e.call(s,t);if(_s(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Dg(s){var t=Mg(s,"string");return _s(t)=="symbol"?t:t+""}function Ig(s,t,e){return(t=Dg(t))in s?Object.defineProperty(s,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[t]=e,s}function _o(s,t){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),e.push.apply(e,i)}return e}function C(s){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?_o(Object(e),!0).forEach(function(i){Ig(s,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):_o(Object(e)).forEach(function(i){Object.defineProperty(s,i,Object.getOwnPropertyDescriptor(e,i))})}return s}const vo=s=>{var t;return s.msg||s.message||s.error_description||(typeof s.error=="string"?s.error:(t=s.error)===null||t===void 0?void 0:t.message)||JSON.stringify(s)},Lg=async(s,t,e,i)=>{if(s&&typeof s=="object"&&"status"in s&&"ok"in s&&typeof s.status=="number"&&!e?.noResolveJson){const n=s,r=n.status||500;if(typeof n.json=="function")n.json().then(o=>{const a=o?.statusCode||o?.code||r+"";t(new Vs(vo(o),r,a,i))}).catch(()=>{if(i==="vectors"){const o=r+"";t(new Vs(n.statusText||`HTTP ${r} error`,r,o,i))}else{const o=r+"";t(new Vs(n.statusText||`HTTP ${r} error`,r,o,i))}});else{const o=r+"";t(new Vs(n.statusText||`HTTP ${r} error`,r,o,i))}}else t(new qa(vo(s),s,i))},jg=(s,t,e,i)=>{const n={method:s,headers:t?.headers||{}};return s==="GET"||s==="HEAD"||!i?C(C({},n),e):(Pg(i)?(n.headers=C({"Content-Type":"application/json"},t?.headers),n.body=JSON.stringify(i)):n.body=i,t?.duplex&&(n.duplex=t.duplex),C(C({},n),e))};async function Xe(s,t,e,i,n,r,o){return new Promise((a,l)=>{s(e,jg(t,i,n,r)).then(c=>{if(!c.ok)throw c;if(i?.noResolveJson)return c;if(o==="vectors"){const h=c.headers.get("content-type");if(c.headers.get("content-length")==="0"||c.status===204)return{};if(!h||!h.includes("application/json"))return{}}return c.json()}).then(c=>a(c)).catch(c=>Lg(c,l,i,o))})}function Ka(s="storage"){return{get:async(t,e,i,n)=>Xe(t,"GET",e,i,n,void 0,s),post:async(t,e,i,n,r)=>Xe(t,"POST",e,n,r,i,s),put:async(t,e,i,n,r)=>Xe(t,"PUT",e,n,r,i,s),head:async(t,e,i,n)=>Xe(t,"HEAD",e,C(C({},i),{},{noResolveJson:!0}),n,void 0,s),remove:async(t,e,i,n,r)=>Xe(t,"DELETE",e,n,r,i,s)}}const $g=Ka("storage"),{get:vs,post:wt,put:un,head:Ng,remove:Fn}=$g,mt=Ka("vectors");var We=class{constructor(s,t={},e,i="storage"){this.shouldThrowOnError=!1,this.url=s,this.headers=t,this.fetch=Cg(e),this.namespace=i}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(s){var t=this;try{return{data:await s(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(_i(e))return{data:null,error:e};throw e}}},Bg=class{constructor(s,t){this.downloadFn=s,this.shouldThrowOnError=t}then(s,t){return this.execute().then(s,t)}async execute(){var s=this;try{return{data:(await s.downloadFn()).body,error:null}}catch(t){if(s.shouldThrowOnError)throw t;if(_i(t))return{data:null,error:t};throw t}}};let Ga;Ga=Symbol.toStringTag;var Fg=class{constructor(s,t){this.downloadFn=s,this.shouldThrowOnError=t,this[Ga]="BlobDownloadBuilder",this.promise=null}asStream(){return new Bg(this.downloadFn,this.shouldThrowOnError)}then(s,t){return this.getPromise().then(s,t)}catch(s){return this.getPromise().catch(s)}finally(s){return this.getPromise().finally(s)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var s=this;try{return{data:await(await s.downloadFn()).blob(),error:null}}catch(t){if(s.shouldThrowOnError)throw t;if(_i(t))return{data:null,error:t};throw t}}};const Ug={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},wo={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var zg=class extends We{constructor(s,t={},e,i){super(s,t,i,"storage"),this.bucketId=e}async uploadOrUpdate(s,t,e,i){var n=this;return n.handleOperation(async()=>{let r;const o=C(C({},wo),i);let a=C(C({},n.headers),s==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&e instanceof Blob?(r=new FormData,r.append("cacheControl",o.cacheControl),l&&r.append("metadata",n.encodeMetadata(l)),r.append("",e)):typeof FormData<"u"&&e instanceof FormData?(r=e,r.has("cacheControl")||r.append("cacheControl",o.cacheControl),l&&!r.has("metadata")&&r.append("metadata",n.encodeMetadata(l))):(r=e,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=n.toBase64(n.encodeMetadata(l))),(typeof ReadableStream<"u"&&r instanceof ReadableStream||r&&typeof r=="object"&&"pipe"in r&&typeof r.pipe=="function")&&!o.duplex&&(o.duplex="half")),i?.headers&&(a=C(C({},a),i.headers));const c=n._removeEmptyFolders(t),h=n._getFinalPath(c),u=await(s=="PUT"?un:wt)(n.fetch,`${n.url}/object/${h}`,r,C({headers:a},o?.duplex?{duplex:o.duplex}:{}));return{path:c,id:u.Id,fullPath:u.Key}})}async upload(s,t,e){return this.uploadOrUpdate("POST",s,t,e)}async uploadToSignedUrl(s,t,e,i){var n=this;const r=n._removeEmptyFolders(s),o=n._getFinalPath(r),a=new URL(n.url+`/object/upload/sign/${o}`);return a.searchParams.set("token",t),n.handleOperation(async()=>{let l;const c=C({upsert:wo.upsert},i),h=C(C({},n.headers),{"x-upsert":String(c.upsert)});return typeof Blob<"u"&&e instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",e)):typeof FormData<"u"&&e instanceof FormData?(l=e,l.append("cacheControl",c.cacheControl)):(l=e,h["cache-control"]=`max-age=${c.cacheControl}`,h["content-type"]=c.contentType),{path:r,fullPath:(await un(n.fetch,a.toString(),l,{headers:h})).Key}})}async createSignedUploadUrl(s,t){var e=this;return e.handleOperation(async()=>{let i=e._getFinalPath(s);const n=C({},e.headers);t?.upsert&&(n["x-upsert"]="true");const r=await wt(e.fetch,`${e.url}/object/upload/sign/${i}`,{},{headers:n}),o=new URL(e.url+r.url),a=o.searchParams.get("token");if(!a)throw new yi("No token returned by API");return{signedUrl:o.toString(),path:s,token:a}})}async update(s,t,e){return this.uploadOrUpdate("PUT",s,t,e)}async move(s,t,e){var i=this;return i.handleOperation(async()=>await wt(i.fetch,`${i.url}/object/move`,{bucketId:i.bucketId,sourceKey:s,destinationKey:t,destinationBucket:e?.destinationBucket},{headers:i.headers}))}async copy(s,t,e){var i=this;return i.handleOperation(async()=>({path:(await wt(i.fetch,`${i.url}/object/copy`,{bucketId:i.bucketId,sourceKey:s,destinationKey:t,destinationBucket:e?.destinationBucket},{headers:i.headers})).Key}))}async createSignedUrl(s,t,e){var i=this;return i.handleOperation(async()=>{let n=i._getFinalPath(s),r=await wt(i.fetch,`${i.url}/object/sign/${n}`,C({expiresIn:t},e?.transform?{transform:e.transform}:{}),{headers:i.headers});const o=e?.download?`&download=${e.download===!0?"":e.download}`:"";return{signedUrl:encodeURI(`${i.url}${r.signedURL}${o}`)}})}async createSignedUrls(s,t,e){var i=this;return i.handleOperation(async()=>{const n=await wt(i.fetch,`${i.url}/object/sign/${i.bucketId}`,{expiresIn:t,paths:s},{headers:i.headers}),r=e?.download?`&download=${e.download===!0?"":e.download}`:"";return n.map(o=>C(C({},o),{},{signedUrl:o.signedURL?encodeURI(`${i.url}${o.signedURL}${r}`):null}))})}download(s,t,e){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString(t?.transform||{}),r=n?`?${n}`:"",o=this._getFinalPath(s),a=()=>vs(this.fetch,`${this.url}/${i}/${o}${r}`,{headers:this.headers,noResolveJson:!0},e);return new Fg(a,this.shouldThrowOnError)}async info(s){var t=this;const e=t._getFinalPath(s);return t.handleOperation(async()=>hn(await vs(t.fetch,`${t.url}/object/info/${e}`,{headers:t.headers})))}async exists(s){var t=this;const e=t._getFinalPath(s);try{return await Ng(t.fetch,`${t.url}/object/${e}`,{headers:t.headers}),{data:!0,error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(_i(i)&&i instanceof qa){const n=i.originalError;if([400,404].includes(n?.status))return{data:!1,error:i}}throw i}}getPublicUrl(s,t){const e=this._getFinalPath(s),i=[],n=t?.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&i.push(n);const r=typeof t?.transform<"u"?"render/image":"object",o=this.transformOptsToQueryString(t?.transform||{});o!==""&&i.push(o);let a=i.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${r}/public/${e}${a}`)}}}async remove(s){var t=this;return t.handleOperation(async()=>await Fn(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:s},{headers:t.headers}))}async list(s,t,e){var i=this;return i.handleOperation(async()=>{const n=C(C(C({},Ug),t),{},{prefix:s||""});return await wt(i.fetch,`${i.url}/object/list/${i.bucketId}`,n,{headers:i.headers},e)})}async listV2(s,t){var e=this;return e.handleOperation(async()=>{const i=C({},s);return await wt(e.fetch,`${e.url}/object/list-v2/${e.bucketId}`,i,{headers:e.headers},t)})}encodeMetadata(s){return JSON.stringify(s)}toBase64(s){return typeof Buffer<"u"?Buffer.from(s).toString("base64"):btoa(s)}_getFinalPath(s){return`${this.bucketId}/${s.replace(/^\/+/,"")}`}_removeEmptyFolders(s){return s.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(s){const t=[];return s.width&&t.push(`width=${s.width}`),s.height&&t.push(`height=${s.height}`),s.resize&&t.push(`resize=${s.resize}`),s.format&&t.push(`format=${s.format}`),s.quality&&t.push(`quality=${s.quality}`),t.join("&")}};const Wg="2.95.3",Ts={"X-Client-Info":`storage-js/${Wg}`};var Vg=class extends We{constructor(s,t={},e,i){const n=new URL(s);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase."));const r=n.href.replace(/\/$/,""),o=C(C({},Ts),t);super(r,o,e,"storage")}async listBuckets(s){var t=this;return t.handleOperation(async()=>{const e=t.listBucketOptionsToQueryString(s);return await vs(t.fetch,`${t.url}/bucket${e}`,{headers:t.headers})})}async getBucket(s){var t=this;return t.handleOperation(async()=>await vs(t.fetch,`${t.url}/bucket/${s}`,{headers:t.headers}))}async createBucket(s,t={public:!1}){var e=this;return e.handleOperation(async()=>await wt(e.fetch,`${e.url}/bucket`,{id:s,name:s,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:e.headers}))}async updateBucket(s,t){var e=this;return e.handleOperation(async()=>await un(e.fetch,`${e.url}/bucket/${s}`,{id:s,name:s,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:e.headers}))}async emptyBucket(s){var t=this;return t.handleOperation(async()=>await wt(t.fetch,`${t.url}/bucket/${s}/empty`,{},{headers:t.headers}))}async deleteBucket(s){var t=this;return t.handleOperation(async()=>await Fn(t.fetch,`${t.url}/bucket/${s}`,{},{headers:t.headers}))}listBucketOptionsToQueryString(s){const t={};return s&&("limit"in s&&(t.limit=String(s.limit)),"offset"in s&&(t.offset=String(s.offset)),s.search&&(t.search=s.search),s.sortColumn&&(t.sortColumn=s.sortColumn),s.sortOrder&&(t.sortOrder=s.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},Hg=class extends We{constructor(s,t={},e){const i=s.replace(/\/$/,""),n=C(C({},Ts),t);super(i,n,e,"storage")}async createBucket(s){var t=this;return t.handleOperation(async()=>await wt(t.fetch,`${t.url}/bucket`,{name:s},{headers:t.headers}))}async listBuckets(s){var t=this;return t.handleOperation(async()=>{const e=new URLSearchParams;s?.limit!==void 0&&e.set("limit",s.limit.toString()),s?.offset!==void 0&&e.set("offset",s.offset.toString()),s?.sortColumn&&e.set("sortColumn",s.sortColumn),s?.sortOrder&&e.set("sortOrder",s.sortOrder),s?.search&&e.set("search",s.search);const i=e.toString(),n=i?`${t.url}/bucket?${i}`:`${t.url}/bucket`;return await vs(t.fetch,n,{headers:t.headers})})}async deleteBucket(s){var t=this;return t.handleOperation(async()=>await Fn(t.fetch,`${t.url}/bucket/${s}`,{},{headers:t.headers}))}from(s){var t=this;if(!Rg(s))throw new yi("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const e=new Og({baseUrl:this.url,catalogName:s,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),i=this.shouldThrowOnError;return new Proxy(e,{get(n,r){const o=n[r];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(n,a),error:null}}catch(l){if(i)throw l;return{data:null,error:l}}}}})}},qg=class extends We{constructor(s,t={},e){const i=s.replace(/\/$/,""),n=C(C({},Ts),{},{"Content-Type":"application/json"},t);super(i,n,e,"vectors")}async createIndex(s){var t=this;return t.handleOperation(async()=>await mt.post(t.fetch,`${t.url}/CreateIndex`,s,{headers:t.headers})||{})}async getIndex(s,t){var e=this;return e.handleOperation(async()=>await mt.post(e.fetch,`${e.url}/GetIndex`,{vectorBucketName:s,indexName:t},{headers:e.headers}))}async listIndexes(s){var t=this;return t.handleOperation(async()=>await mt.post(t.fetch,`${t.url}/ListIndexes`,s,{headers:t.headers}))}async deleteIndex(s,t){var e=this;return e.handleOperation(async()=>await mt.post(e.fetch,`${e.url}/DeleteIndex`,{vectorBucketName:s,indexName:t},{headers:e.headers})||{})}},Kg=class extends We{constructor(s,t={},e){const i=s.replace(/\/$/,""),n=C(C({},Ts),{},{"Content-Type":"application/json"},t);super(i,n,e,"vectors")}async putVectors(s){var t=this;if(s.vectors.length<1||s.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return t.handleOperation(async()=>await mt.post(t.fetch,`${t.url}/PutVectors`,s,{headers:t.headers})||{})}async getVectors(s){var t=this;return t.handleOperation(async()=>await mt.post(t.fetch,`${t.url}/GetVectors`,s,{headers:t.headers}))}async listVectors(s){var t=this;if(s.segmentCount!==void 0){if(s.segmentCount<1||s.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(s.segmentIndex!==void 0&&(s.segmentIndex<0||s.segmentIndex>=s.segmentCount))throw new Error(`segmentIndex must be between 0 and ${s.segmentCount-1}`)}return t.handleOperation(async()=>await mt.post(t.fetch,`${t.url}/ListVectors`,s,{headers:t.headers}))}async queryVectors(s){var t=this;return t.handleOperation(async()=>await mt.post(t.fetch,`${t.url}/QueryVectors`,s,{headers:t.headers}))}async deleteVectors(s){var t=this;if(s.keys.length<1||s.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return t.handleOperation(async()=>await mt.post(t.fetch,`${t.url}/DeleteVectors`,s,{headers:t.headers})||{})}},Gg=class extends We{constructor(s,t={},e){const i=s.replace(/\/$/,""),n=C(C({},Ts),{},{"Content-Type":"application/json"},t);super(i,n,e,"vectors")}async createBucket(s){var t=this;return t.handleOperation(async()=>await mt.post(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:s},{headers:t.headers})||{})}async getBucket(s){var t=this;return t.handleOperation(async()=>await mt.post(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:s},{headers:t.headers}))}async listBuckets(s={}){var t=this;return t.handleOperation(async()=>await mt.post(t.fetch,`${t.url}/ListVectorBuckets`,s,{headers:t.headers}))}async deleteBucket(s){var t=this;return t.handleOperation(async()=>await mt.post(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:s},{headers:t.headers})||{})}},Jg=class extends Gg{constructor(s,t={}){super(s,t.headers||{},t.fetch)}from(s){return new Yg(this.url,this.headers,s,this.fetch)}async createBucket(s){var t=()=>super.createBucket,e=this;return t().call(e,s)}async getBucket(s){var t=()=>super.getBucket,e=this;return t().call(e,s)}async listBuckets(s={}){var t=()=>super.listBuckets,e=this;return t().call(e,s)}async deleteBucket(s){var t=()=>super.deleteBucket,e=this;return t().call(e,s)}},Yg=class extends qg{constructor(s,t,e,i){super(s,t,i),this.vectorBucketName=e}async createIndex(s){var t=()=>super.createIndex,e=this;return t().call(e,C(C({},s),{},{vectorBucketName:e.vectorBucketName}))}async listIndexes(s={}){var t=()=>super.listIndexes,e=this;return t().call(e,C(C({},s),{},{vectorBucketName:e.vectorBucketName}))}async getIndex(s){var t=()=>super.getIndex,e=this;return t().call(e,e.vectorBucketName,s)}async deleteIndex(s){var t=()=>super.deleteIndex,e=this;return t().call(e,e.vectorBucketName,s)}index(s){return new Xg(this.url,this.headers,this.vectorBucketName,s,this.fetch)}},Xg=class extends Kg{constructor(s,t,e,i,n){super(s,t,n),this.vectorBucketName=e,this.indexName=i}async putVectors(s){var t=()=>super.putVectors,e=this;return t().call(e,C(C({},s),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async getVectors(s){var t=()=>super.getVectors,e=this;return t().call(e,C(C({},s),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async listVectors(s={}){var t=()=>super.listVectors,e=this;return t().call(e,C(C({},s),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async queryVectors(s){var t=()=>super.queryVectors,e=this;return t().call(e,C(C({},s),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async deleteVectors(s){var t=()=>super.deleteVectors,e=this;return t().call(e,C(C({},s),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}},Zg=class extends Vg{constructor(s,t={},e,i){super(s,t,e,i)}from(s){return new zg(this.url,this.headers,s,this.fetch)}get vectors(){return new Jg(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Hg(this.url+"/iceberg",this.headers,this.fetch)}};const Ja="2.95.3",De=30*1e3,dn=3,$i=dn*De,Qg="http://localhost:9999",tp="supabase.auth.token",ep={"X-Client-Info":`gotrue-js/${Ja}`},fn="X-Supabase-Api-Version",Ya={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},sp=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,ip=600*1e3;class ws extends Error{constructor(t,e,i){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=i}}function A(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class np extends ws{constructor(t,e,i){super(t,e,i),this.name="AuthApiError",this.status=e,this.code=i}}function rp(s){return A(s)&&s.name==="AuthApiError"}class ue extends ws{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class Bt extends ws{constructor(t,e,i,n){super(t,i,n),this.name=e,this.status=i}}class gt extends Bt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Ni(s){return A(s)&&s.name==="AuthSessionMissingError"}class Te extends Bt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Hs extends Bt{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class qs extends Bt{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function op(s){return A(s)&&s.name==="AuthImplicitGrantRedirectError"}class xo extends Bt{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ap extends Bt{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class gn extends Bt{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}}function Bi(s){return A(s)&&s.name==="AuthRetryableFetchError"}class So extends Bt{constructor(t,e,i){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=i}}class pn extends Bt{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const oi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ko=` 	
\r=`.split(""),lp=(()=>{const s=new Array(128);for(let t=0;t<s.length;t+=1)s[t]=-1;for(let t=0;t<ko.length;t+=1)s[ko[t].charCodeAt(0)]=-2;for(let t=0;t<oi.length;t+=1)s[oi[t].charCodeAt(0)]=t;return s})();function Eo(s,t,e){if(s!==null)for(t.queue=t.queue<<8|s,t.queuedBits+=8;t.queuedBits>=6;){const i=t.queue>>t.queuedBits-6&63;e(oi[i]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const i=t.queue>>t.queuedBits-6&63;e(oi[i]),t.queuedBits-=6}}function Xa(s,t,e){const i=lp[s];if(i>-1)for(t.queue=t.queue<<6|i,t.queuedBits+=6;t.queuedBits>=8;)e(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(i===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function To(s){const t=[],e=o=>{t.push(String.fromCodePoint(o))},i={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},r=o=>{up(o,i,e)};for(let o=0;o<s.length;o+=1)Xa(s.charCodeAt(o),n,r);return t.join("")}function cp(s,t){if(s<=127){t(s);return}else if(s<=2047){t(192|s>>6),t(128|s&63);return}else if(s<=65535){t(224|s>>12),t(128|s>>6&63),t(128|s&63);return}else if(s<=1114111){t(240|s>>18),t(128|s>>12&63),t(128|s>>6&63),t(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function hp(s,t){for(let e=0;e<s.length;e+=1){let i=s.charCodeAt(e);if(i>55295&&i<=56319){const n=(i-55296)*1024&65535;i=(s.charCodeAt(e+1)-56320&65535|n)+65536,e+=1}cp(i,t)}}function up(s,t,e){if(t.utf8seq===0){if(s<=127){e(s);return}for(let i=1;i<6;i+=1)if((s>>7-i&1)===0){t.utf8seq=i;break}if(t.utf8seq===2)t.codepoint=s&31;else if(t.utf8seq===3)t.codepoint=s&15;else if(t.utf8seq===4)t.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|s&63,t.utf8seq-=1,t.utf8seq===0&&e(t.codepoint)}}function Be(s){const t=[],e={queue:0,queuedBits:0},i=n=>{t.push(n)};for(let n=0;n<s.length;n+=1)Xa(s.charCodeAt(n),e,i);return new Uint8Array(t)}function dp(s){const t=[];return hp(s,e=>t.push(e)),new Uint8Array(t)}function fe(s){const t=[],e={queue:0,queuedBits:0},i=n=>{t.push(n)};return s.forEach(n=>Eo(n,e,i)),Eo(null,e,i),t.join("")}function fp(s){return Math.round(Date.now()/1e3)+s}function gp(){return Symbol("auth-callback")}const it=()=>typeof window<"u"&&typeof document<"u",re={tested:!1,writable:!1},Za=()=>{if(!it())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(re.tested)return re.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),re.tested=!0,re.writable=!0}catch{re.tested=!0,re.writable=!1}return re.writable};function pp(s){const t={},e=new URL(s);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((n,r)=>{t[r]=n})}catch{}return e.searchParams.forEach((i,n)=>{t[n]=i}),t}const Qa=s=>s?(...t)=>s(...t):(...t)=>fetch(...t),mp=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",Ie=async(s,t,e)=>{await s.setItem(t,JSON.stringify(e))},oe=async(s,t)=>{const e=await s.getItem(t);if(!e)return null;try{return JSON.parse(e)}catch{return e}},st=async(s,t)=>{await s.removeItem(t)};class vi{constructor(){this.promise=new vi.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}}vi.promiseConstructor=Promise;function Ks(s){const t=s.split(".");if(t.length!==3)throw new pn("Invalid JWT structure");for(let i=0;i<t.length;i++)if(!sp.test(t[i]))throw new pn("JWT not in base64url format");return{header:JSON.parse(To(t[0])),payload:JSON.parse(To(t[1])),signature:Be(t[2]),raw:{header:t[0],payload:t[1]}}}async function bp(s){return await new Promise(t=>{setTimeout(()=>t(null),s)})}function yp(s,t){return new Promise((i,n)=>{(async()=>{for(let r=0;r<1/0;r++)try{const o=await s(r);if(!t(r,null,o)){i(o);return}}catch(o){if(!t(r,o)){n(o);return}}})()})}function _p(s){return("0"+s.toString(16)).substr(-2)}function vp(){const t=new Uint32Array(56);if(typeof crypto>"u"){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=e.length;let n="";for(let r=0;r<56;r++)n+=e.charAt(Math.floor(Math.random()*i));return n}return crypto.getRandomValues(t),Array.from(t,_p).join("")}async function wp(s){const e=new TextEncoder().encode(s),i=await crypto.subtle.digest("SHA-256",e),n=new Uint8Array(i);return Array.from(n).map(r=>String.fromCharCode(r)).join("")}async function xp(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const e=await wp(s);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ae(s,t,e=!1){const i=vp();let n=i;e&&(n+="/PASSWORD_RECOVERY"),await Ie(s,`${t}-code-verifier`,n);const r=await xp(i);return[r,i===r?"plain":"s256"]}const Sp=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function kp(s){const t=s.headers.get(fn);if(!t||!t.match(Sp))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function Ep(s){if(!s)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(s<=t)throw new Error("JWT has expired")}function Tp(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Ap=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Oe(s){if(!Ap.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Fi(){const s={};return new Proxy(s,{get:(t,e)=>{if(e==="__isUserNotAvailableProxy")return!0;if(typeof e=="symbol"){const i=e.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Op(s,t){return new Proxy(s,{get:(e,i,n)=>{if(i==="__isInsecureUserWarningProxy")return!0;if(typeof i=="symbol"){const r=i.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)"||r==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(e,i,n)}return!t.value&&typeof i=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(e,i,n)}})}function Ao(s){return JSON.parse(JSON.stringify(s))}const ce=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),Cp=[502,503,504];async function Oo(s){var t;if(!mp(s))throw new gn(ce(s),0);if(Cp.includes(s.status))throw new gn(ce(s),s.status);let e;try{e=await s.json()}catch(r){throw new ue(ce(r),r)}let i;const n=kp(s);if(n&&n.getTime()>=Ya["2024-01-01"].timestamp&&typeof e=="object"&&e&&typeof e.code=="string"?i=e.code:typeof e=="object"&&e&&typeof e.error_code=="string"&&(i=e.error_code),i){if(i==="weak_password")throw new So(ce(e),s.status,((t=e.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(i==="session_not_found")throw new gt}else if(typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((r,o)=>r&&typeof o=="string",!0))throw new So(ce(e),s.status,e.weak_password.reasons);throw new np(ce(e),s.status||500,i)}const Pp=(s,t,e,i)=>{const n={method:s,headers:t?.headers||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),n.body=JSON.stringify(i),Object.assign(Object.assign({},n),e))};async function O(s,t,e,i){var n;const r=Object.assign({},i?.headers);r[fn]||(r[fn]=Ya["2024-01-01"].name),i?.jwt&&(r.Authorization=`Bearer ${i.jwt}`);const o=(n=i?.query)!==null&&n!==void 0?n:{};i?.redirectTo&&(o.redirect_to=i.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await Rp(s,t,e+a,{headers:r,noResolveJson:i?.noResolveJson},{},i?.body);return i?.xform?i?.xform(l):{data:Object.assign({},l),error:null}}async function Rp(s,t,e,i,n,r){const o=Pp(t,i,n,r);let a;try{a=await s(e,Object.assign({},o))}catch(l){throw console.error(l),new gn(ce(l),0)}if(a.ok||await Oo(a),i?.noResolveJson)return a;try{return await a.json()}catch(l){await Oo(l)}}function vt(s){var t;let e=null;Ip(s)&&(e=Object.assign({},s),s.expires_at||(e.expires_at=fp(s.expires_in)));const i=(t=s.user)!==null&&t!==void 0?t:s;return{data:{session:e,user:i},error:null}}function Co(s){const t=vt(s);return!t.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((e,i)=>e&&typeof i=="string",!0)&&(t.data.weak_password=s.weak_password),t}function Ut(s){var t;return{data:{user:(t=s.user)!==null&&t!==void 0?t:s},error:null}}function Mp(s){return{data:s,error:null}}function Dp(s){const{action_link:t,email_otp:e,hashed_token:i,redirect_to:n,verification_type:r}=s,o=bi(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:t,email_otp:e,hashed_token:i,redirect_to:n,verification_type:r},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function Po(s){return s}function Ip(s){return s.access_token&&s.refresh_token&&s.expires_in}const Ui=["global","local","others"];class Lp{constructor({url:t="",headers:e={},fetch:i}){this.url=t,this.headers=e,this.fetch=Qa(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,e=Ui[0]){if(Ui.indexOf(e)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ui.join(", ")}`);try{return await O(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(i){if(A(i))return{data:null,error:i};throw i}}async inviteUserByEmail(t,e={}){try{return await O(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:Ut})}catch(i){if(A(i))return{data:{user:null},error:i};throw i}}async generateLink(t){try{const{options:e}=t,i=bi(t,["options"]),n=Object.assign(Object.assign({},i),e);return"newEmail"in i&&(n.new_email=i?.newEmail,delete n.newEmail),await O(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Dp,redirectTo:e?.redirectTo})}catch(e){if(A(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(t){try{return await O(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Ut})}catch(e){if(A(e))return{data:{user:null},error:e};throw e}}async listUsers(t){var e,i,n,r,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},h=await O(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(e=t?.page)===null||e===void 0?void 0:e.toString())!==null&&i!==void 0?i:"",per_page:(r=(n=t?.perPage)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:""},xform:Po});if(h.error)throw h.error;const u=await h.json(),d=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(g=>{const p=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(g.split(";")[1].split("=")[1]);c[`${m}Page`]=p}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(A(c))return{data:{users:[]},error:c};throw c}}async getUserById(t){Oe(t);try{return await O(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Ut})}catch(e){if(A(e))return{data:{user:null},error:e};throw e}}async updateUserById(t,e){Oe(t);try{return await O(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:Ut})}catch(i){if(A(i))return{data:{user:null},error:i};throw i}}async deleteUser(t,e=!1){Oe(t);try{return await O(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:Ut})}catch(i){if(A(i))return{data:{user:null},error:i};throw i}}async _listFactors(t){Oe(t.userId);try{const{data:e,error:i}=await O(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:e,error:i}}catch(e){if(A(e))return{data:null,error:e};throw e}}async _deleteFactor(t){Oe(t.userId),Oe(t.id);try{return{data:await O(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(A(e))return{data:null,error:e};throw e}}async _listOAuthClients(t){var e,i,n,r,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},h=await O(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(e=t?.page)===null||e===void 0?void 0:e.toString())!==null&&i!==void 0?i:"",per_page:(r=(n=t?.perPage)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:""},xform:Po});if(h.error)throw h.error;const u=await h.json(),d=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(g=>{const p=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(g.split(";")[1].split("=")[1]);c[`${m}Page`]=p}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(A(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(t){try{return await O(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(A(e))return{data:null,error:e};throw e}}async _getOAuthClient(t){try{return await O(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(A(e))return{data:null,error:e};throw e}}async _updateOAuthClient(t,e){try{return await O(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:e,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(A(i))return{data:null,error:i};throw i}}async _deleteOAuthClient(t){try{return await O(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(A(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(t){try{return await O(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(A(e))return{data:null,error:e};throw e}}}function Ro(s={}){return{getItem:t=>s[t]||null,setItem:(t,e)=>{s[t]=e},removeItem:t=>{delete s[t]}}}const Ce={debug:!!(globalThis&&Za()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class tl extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class jp extends tl{}async function $p(s,t,e){Ce.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,t);const i=new globalThis.AbortController;return t>0&&setTimeout(()=>{i.abort(),Ce.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async n=>{if(n){Ce.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,n.name);try{return await e()}finally{Ce.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,n.name)}}else{if(t===0)throw Ce.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new jp(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(Ce.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await e()}}))}function Np(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function el(s){if(!/^0x[a-fA-F0-9]{40}$/.test(s))throw new Error(`@supabase/auth-js: Address "${s}" is invalid.`);return s.toLowerCase()}function Bp(s){return parseInt(s,16)}function Fp(s){const t=new TextEncoder().encode(s);return"0x"+Array.from(t,i=>i.toString(16).padStart(2,"0")).join("")}function Up(s){var t;const{chainId:e,domain:i,expirationTime:n,issuedAt:r=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:h,uri:u,version:d}=s;{if(!Number.isInteger(e))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${e}`);if(!i)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(d!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(!((t=s.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${s.statement}`)}const f=el(s.address),g=h?`${h}://${i}`:i,p=s.statement?`${s.statement}
`:"",m=`${g} wants you to sign in with your Ethereum account:
${f}

${p}`;let b=`URI: ${u}
Version: ${d}
Chain ID: ${e}${o?`
Nonce: ${o}`:""}
Issued At: ${r.toISOString()}`;if(n&&(b+=`
Expiration Time: ${n.toISOString()}`),a&&(b+=`
Not Before: ${a.toISOString()}`),l&&(b+=`
Request ID: ${l}`),c){let y=`
Resources:`;for(const _ of c){if(!_||typeof _!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${_}`);y+=`
- ${_}`}b+=y}return`${m}
${b}`}class J extends Error{constructor({message:t,code:e,cause:i,name:n}){var r;super(t,{cause:i}),this.__isWebAuthnError=!0,this.name=(r=n??(i instanceof Error?i.name:void 0))!==null&&r!==void 0?r:"Unknown Error",this.code=e}}class ai extends J{constructor(t,e){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e,message:t}),this.name="WebAuthnUnknownError",this.originalError=e}}function zp({error:s,options:t}){var e,i,n;const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(t.signal instanceof AbortSignal)return new J({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else if(s.name==="ConstraintError"){if(((e=r.authenticatorSelection)===null||e===void 0?void 0:e.requireResidentKey)===!0)return new J({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:s});if(t.mediation==="conditional"&&((i=r.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new J({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:s});if(((n=r.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new J({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:s})}else{if(s.name==="InvalidStateError")return new J({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:s});if(s.name==="NotAllowedError")return new J({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="NotSupportedError")return r.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new J({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:s}):new J({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:s});if(s.name==="SecurityError"){const o=window.location.hostname;if(sl(o)){if(r.rp.id!==o)return new J({message:`The RP ID "${r.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new J({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="TypeError"){if(r.user.id.byteLength<1||r.user.id.byteLength>64)return new J({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:s})}else if(s.name==="UnknownError")return new J({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new J({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}function Wp({error:s,options:t}){const{publicKey:e}=t;if(!e)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(t.signal instanceof AbortSignal)return new J({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else{if(s.name==="NotAllowedError")return new J({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="SecurityError"){const i=window.location.hostname;if(sl(i)){if(e.rpId!==i)return new J({message:`The RP ID "${e.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new J({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="UnknownError")return new J({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new J({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}class Vp{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const Hp=new Vp;function qp(s){if(!s)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(s);const{challenge:t,user:e,excludeCredentials:i}=s,n=bi(s,["challenge","user","excludeCredentials"]),r=Be(t).buffer,o=Object.assign(Object.assign({},e),{id:Be(e.id).buffer}),a=Object.assign(Object.assign({},n),{challenge:r,user:o});if(i&&i.length>0){a.excludeCredentials=new Array(i.length);for(let l=0;l<i.length;l++){const c=i[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:Be(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function Kp(s){if(!s)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(s);const{challenge:t,allowCredentials:e}=s,i=bi(s,["challenge","allowCredentials"]),n=Be(t).buffer,r=Object.assign(Object.assign({},i),{challenge:n});if(e&&e.length>0){r.allowCredentials=new Array(e.length);for(let o=0;o<e.length;o++){const a=e[o];r.allowCredentials[o]=Object.assign(Object.assign({},a),{id:Be(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return r}function Gp(s){var t;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const e=s;return{id:s.id,rawId:s.id,response:{attestationObject:fe(new Uint8Array(s.response.attestationObject)),clientDataJSON:fe(new Uint8Array(s.response.clientDataJSON))},type:"public-key",clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Jp(s){var t;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const e=s,i=s.getClientExtensionResults(),n=s.response;return{id:s.id,rawId:s.id,response:{authenticatorData:fe(new Uint8Array(n.authenticatorData)),clientDataJSON:fe(new Uint8Array(n.clientDataJSON)),signature:fe(new Uint8Array(n.signature)),userHandle:n.userHandle?fe(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:i,authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function sl(s){return s==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(s)}function Mo(){var s,t;return!!(it()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((s=navigator?.credentials)===null||s===void 0?void 0:s.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function Yp(s){try{const t=await navigator.credentials.create(s);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new ai("Browser returned unexpected credential type",t)}:{data:null,error:new ai("Empty credential response",t)}}catch(t){return{data:null,error:zp({error:t,options:s})}}}async function Xp(s){try{const t=await navigator.credentials.get(s);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new ai("Browser returned unexpected credential type",t)}:{data:null,error:new ai("Empty credential response",t)}}catch(t){return{data:null,error:Wp({error:t,options:s})}}}const Zp={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Qp={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function li(...s){const t=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),e=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),i={};for(const n of s)if(n)for(const r in n){const o=n[r];if(o!==void 0)if(Array.isArray(o))i[r]=o;else if(e(o))i[r]=o;else if(t(o)){const a=i[r];t(a)?i[r]=li(a,o):i[r]=li(o)}else i[r]=o}return i}function tm(s,t){return li(Zp,s,t||{})}function em(s,t){return li(Qp,s,t||{})}class sm{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:e,friendlyName:i,signal:n},r){var o;try{const{data:a,error:l}=await this.client.mfa.challenge({factorId:t,webauthn:e});if(!a)return{data:null,error:l};const c=n??Hp.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:h}=a.webauthn.credential_options.publicKey;if(!h.name){const u=i;if(u)h.name=`${h.id}:${u}`;else{const f=(await this.client.getUser()).data.user,g=((o=f?.user_metadata)===null||o===void 0?void 0:o.name)||f?.email||f?.id||"User";h.name=`${h.id}:${g}`}}h.displayName||(h.displayName=h.name)}switch(a.webauthn.type){case"create":{const h=tm(a.webauthn.credential_options.publicKey,r?.create),{data:u,error:d}=await Yp({publicKey:h,signal:c});return u?{data:{factorId:t,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:d}}case"request":{const h=em(a.webauthn.credential_options.publicKey,r?.request),{data:u,error:d}=await Xp(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:h,signal:c}));return u?{data:{factorId:t,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:d}}}}catch(a){return A(a)?{data:null,error:a}:{data:null,error:new ue("Unexpected error in challenge",a)}}}async _verify({challengeId:t,factorId:e,webauthn:i}){return this.client.mfa.verify({factorId:e,challengeId:t,webauthn:i})}async _authenticate({factorId:t,webauthn:{rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},r){if(!e)return{data:null,error:new ws("rpId is required for WebAuthn authentication")};try{if(!Mo())return{data:null,error:new ue("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:t,webauthn:{rpId:e,rpOrigins:i},signal:n},{request:r});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:t,challengeId:o.challengeId,webauthn:{type:l.type,rpId:e,rpOrigins:i,credential_response:l.credential_response}})}catch(o){return A(o)?{data:null,error:o}:{data:null,error:new ue("Unexpected error in authenticate",o)}}}async _register({friendlyName:t,webauthn:{rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},r){if(!e)return{data:null,error:new ws("rpId is required for WebAuthn registration")};try{if(!Mo())return{data:null,error:new ue("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:t});if(!o)return await this.client.mfa.listFactors().then(h=>{var u;return(u=h.data)===null||u===void 0?void 0:u.all.find(d=>d.factor_type==="webauthn"&&d.friendly_name===t&&d.status!=="unverified")}).then(h=>h?this.client.mfa.unenroll({factorId:h?.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:e,rpOrigins:i},signal:n},{create:r});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:e,rpOrigins:i,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(o){return A(o)?{data:null,error:o}:{data:null,error:new ue("Unexpected error in register",o)}}}}Np();const im={url:Qg,storageKey:tp,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ep,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function Do(s,t,e){return await e()}const Pe={};class xs{get jwks(){var t,e;return(e=(t=Pe[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&e!==void 0?e:{keys:[]}}set jwks(t){Pe[this.storageKey]=Object.assign(Object.assign({},Pe[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,e;return(e=(t=Pe[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&e!==void 0?e:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Pe[this.storageKey]=Object.assign(Object.assign({},Pe[this.storageKey]),{cachedAt:t})}constructor(t){var e,i,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const r=Object.assign(Object.assign({},im),t);if(this.storageKey=r.storageKey,this.instanceID=(e=xs.nextInstanceID[this.storageKey])!==null&&e!==void 0?e:0,xs.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.instanceID>0&&it()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=r.persistSession,this.autoRefreshToken=r.autoRefreshToken,this.admin=new Lp({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Qa(r.fetch),this.lock=r.lock||Do,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,this.throwOnError=r.throwOnError,this.lockAcquireTimeout=r.lockAcquireTimeout,r.lock?this.lock=r.lock:this.persistSession&&it()&&(!((i=globalThis?.navigator)===null||i===void 0)&&i.locks)?this.lock=$p:this.lock=Do,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new sm(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:Za()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Ro(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=Ro(this.memoryStorage)),it()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o);try{await this._notifyAllSubscribers(o.data.event,o.data.session,!1)}catch(a){this._debug("#broadcastChannel","error",a)}})}this.initialize().catch(o=>{this._debug("#initialize()","error",o)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Ja}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let e={},i="none";if(it()&&(e=pp(window.location.href),this._isImplicitGrantCallback(e)?i="implicit":await this._isPKCECallback(e)&&(i="pkce")),it()&&this.detectSessionInUrl&&i!=="none"){const{data:n,error:r}=await this._getSessionFromURL(e,i);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),op(r)){const l=(t=r.details)===null||t===void 0?void 0:t.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:r}}return{error:r}}const{session:o,redirectType:a}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return A(e)?this._returnResult({error:e}):this._returnResult({error:new ue("Unexpected error during initialization",e)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var e,i,n;try{const r=await O(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(i=(e=t?.options)===null||e===void 0?void 0:e.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:(n=t?.options)===null||n===void 0?void 0:n.captchaToken}},xform:vt}),{data:o,error:a}=r;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(r){if(A(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signUp(t){var e,i,n;try{let r;if("email"in t){const{email:h,password:u,options:d}=t;let f=null,g=null;this.flowType==="pkce"&&([f,g]=await Ae(this.storage,this.storageKey)),r=await O(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d?.emailRedirectTo,body:{email:h,password:u,data:(e=d?.data)!==null&&e!==void 0?e:{},gotrue_meta_security:{captcha_token:d?.captchaToken},code_challenge:f,code_challenge_method:g},xform:vt})}else if("phone"in t){const{phone:h,password:u,options:d}=t;r=await O(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:u,data:(i=d?.data)!==null&&i!==void 0?i:{},channel:(n=d?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:vt})}else throw new Hs("You must provide either an email or phone number and a password");const{data:o,error:a}=r;if(a||!o)return await st(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(r){if(await st(this.storage,`${this.storageKey}-code-verifier`),A(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithPassword(t){try{let e;if("email"in t){const{email:r,password:o,options:a}=t;e=await O(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Co})}else if("phone"in t){const{phone:r,password:o,options:a}=t;e=await O(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Co})}else throw new Hs("You must provide either an email or phone number and a password");const{data:i,error:n}=e;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!i||!i.session||!i.user){const r=new Te;return this._returnResult({data:{user:null,session:null},error:r})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:n})}catch(e){if(A(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOAuth(t){var e,i,n,r;return await this._handleProviderSignIn(t.provider,{redirectTo:(e=t.options)===null||e===void 0?void 0:e.redirectTo,scopes:(i=t.options)===null||i===void 0?void 0:i.scopes,queryParams:(n=t.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(r=t.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:e}=t;switch(e){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${e}"`)}}async signInWithEthereum(t){var e,i,n,r,o,a,l,c,h,u,d;let f,g;if("message"in t)f=t.message,g=t.signature;else{const{chain:p,wallet:m,statement:b,options:y}=t;let _;if(it())if(typeof m=="object")_=m;else{const T=window;if("ethereum"in T&&typeof T.ethereum=="object"&&"request"in T.ethereum&&typeof T.ethereum.request=="function")_=T.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!y?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");_=m}const v=new URL((e=y?.url)!==null&&e!==void 0?e:window.location.href),w=await _.request({method:"eth_requestAccounts"}).then(T=>T).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!w||w.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const x=el(w[0]);let S=(i=y?.signInWithEthereum)===null||i===void 0?void 0:i.chainId;if(!S){const T=await _.request({method:"eth_chainId"});S=Bp(T)}const E={domain:v.host,address:x,statement:b,uri:v.href,version:"1",chainId:S,nonce:(n=y?.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(o=(r=y?.signInWithEthereum)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=y?.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=y?.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=y?.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(h=y?.signInWithEthereum)===null||h===void 0?void 0:h.resources};f=Up(E),g=await _.request({method:"personal_sign",params:[Fp(f),x]})}try{const{data:p,error:m}=await O(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:g},!((u=t.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:(d=t.options)===null||d===void 0?void 0:d.captchaToken}}:null),xform:vt});if(m)throw m;if(!p||!p.session||!p.user){const b=new Te;return this._returnResult({data:{user:null,session:null},error:b})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:Object.assign({},p),error:m})}catch(p){if(A(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async signInWithSolana(t){var e,i,n,r,o,a,l,c,h,u,d,f;let g,p;if("message"in t)g=t.message,p=t.signature;else{const{chain:m,wallet:b,statement:y,options:_}=t;let v;if(it())if(typeof b=="object")v=b;else{const x=window;if("solana"in x&&typeof x.solana=="object"&&("signIn"in x.solana&&typeof x.solana.signIn=="function"||"signMessage"in x.solana&&typeof x.solana.signMessage=="function"))v=x.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!_?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=b}const w=new URL((e=_?.url)!==null&&e!==void 0?e:window.location.href);if("signIn"in v&&v.signIn){const x=await v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},_?.signInWithSolana),{version:"1",domain:w.host,uri:w.href}),y?{statement:y}:null));let S;if(Array.isArray(x)&&x[0]&&typeof x[0]=="object")S=x[0];else if(x&&typeof x=="object"&&"signedMessage"in x&&"signature"in x)S=x;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in S&&"signature"in S&&(typeof S.signedMessage=="string"||S.signedMessage instanceof Uint8Array)&&S.signature instanceof Uint8Array)g=typeof S.signedMessage=="string"?S.signedMessage:new TextDecoder().decode(S.signedMessage),p=S.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in v)||typeof v.signMessage!="function"||!("publicKey"in v)||typeof v!="object"||!v.publicKey||!("toBase58"in v.publicKey)||typeof v.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${w.host} wants you to sign in with your Solana account:`,v.publicKey.toBase58(),...y?["",y,""]:[""],"Version: 1",`URI: ${w.href}`,`Issued At: ${(n=(i=_?.signInWithSolana)===null||i===void 0?void 0:i.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((r=_?.signInWithSolana)===null||r===void 0)&&r.notBefore?[`Not Before: ${_.signInWithSolana.notBefore}`]:[],...!((o=_?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${_.signInWithSolana.expirationTime}`]:[],...!((a=_?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${_.signInWithSolana.chainId}`]:[],...!((l=_?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${_.signInWithSolana.nonce}`]:[],...!((c=_?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${_.signInWithSolana.requestId}`]:[],...!((u=(h=_?.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||u===void 0)&&u.length?["Resources",..._.signInWithSolana.resources.map(S=>`- ${S}`)]:[]].join(`
`);const x=await v.signMessage(new TextEncoder().encode(g),"utf8");if(!x||!(x instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=x}}try{const{data:m,error:b}=await O(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:fe(p)},!((d=t.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(f=t.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:vt});if(b)throw b;if(!m||!m.session||!m.user){const y=new Te;return this._returnResult({data:{user:null,session:null},error:y})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:Object.assign({},m),error:b})}catch(m){if(A(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async _exchangeCodeForSession(t){const e=await oe(this.storage,`${this.storageKey}-code-verifier`),[i,n]=(e??"").split("/");try{if(!i&&this.flowType==="pkce")throw new ap;const{data:r,error:o}=await O(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:i},xform:vt});if(await st(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!r||!r.session||!r.user){const a=new Te;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign(Object.assign({},r),{redirectType:n??null}),error:o})}catch(r){if(await st(this.storage,`${this.storageKey}-code-verifier`),A(r))return this._returnResult({data:{user:null,session:null,redirectType:null},error:r});throw r}}async signInWithIdToken(t){try{const{options:e,provider:i,token:n,access_token:r,nonce:o}=t,a=await O(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:n,access_token:r,nonce:o,gotrue_meta_security:{captcha_token:e?.captchaToken}},xform:vt}),{data:l,error:c}=a;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const h=new Te;return this._returnResult({data:{user:null,session:null},error:h})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(e){if(A(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOtp(t){var e,i,n,r,o;try{if("email"in t){const{email:a,options:l}=t;let c=null,h=null;this.flowType==="pkce"&&([c,h]=await Ae(this.storage,this.storageKey));const{error:u}=await O(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(e=l?.data)!==null&&e!==void 0?e:{},create_user:(i=l?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:h},redirectTo:l?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:u})}if("phone"in t){const{phone:a,options:l}=t,{data:c,error:h}=await O(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(r=l?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(o=l?.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c?.message_id},error:h})}throw new Hs("You must provide either an email or phone number.")}catch(a){if(await st(this.storage,`${this.storageKey}-code-verifier`),A(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(t){var e,i;try{let n,r;"options"in t&&(n=(e=t.options)===null||e===void 0?void 0:e.redirectTo,r=(i=t.options)===null||i===void 0?void 0:i.captchaToken);const{data:o,error:a}=await O(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:r}}),redirectTo:n,xform:vt});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(n){if(A(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithSSO(t){var e,i,n,r,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await Ae(this.storage,this.storageKey));const c=await O(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(i=(e=t.options)===null||e===void 0?void 0:e.redirectTo)!==null&&i!==void 0?i:void 0}),!((n=t?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:Mp});return!((r=c.data)===null||r===void 0)&&r.url&&it()&&!(!((o=t.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(a){if(await st(this.storage,`${this.storageKey}-code-verifier`),A(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:e},error:i}=t;if(i)throw i;if(!e)throw new gt;const{error:n}=await O(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(t){if(A(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const e=`${this.url}/resend`;if("email"in t){const{email:i,type:n,options:r}=t,{error:o}=await O(this.fetch,"POST",e,{headers:this.headers,body:{email:i,type:n,gotrue_meta_security:{captcha_token:r?.captchaToken}},redirectTo:r?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in t){const{phone:i,type:n,options:r}=t,{data:o,error:a}=await O(this.fetch,"POST",e,{headers:this.headers,body:{phone:i,type:n,gotrue_meta_security:{captcha_token:r?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o?.message_id},error:a})}throw new Hs("You must provide either an email or phone number and a type")}catch(e){if(A(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async e=>e))}async _acquireLock(t,e){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const i=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await i,await e()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const i=e();for(this.pendingInLock.push((async()=>{try{await i}catch{}})()),await i;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await i}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const e=await this.__loadSession();return await t(e)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const e=await oe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",e),e!==null&&(this._isValidSession(e)?t=e:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const i=t.expires_at?t.expires_at*1e3-Date.now()<$i:!1;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",t.expires_at),!i){if(this.userStorage){const o=await oe(this.userStorage,this.storageKey+"-user");o?.user?t.user=o.user:t.user=Fi()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};t.user=Op(t.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:n,error:r}=await this._callRefreshToken(t.refresh_token);return r?this._returnResult({data:{session:null},error:r}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const e=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return e.data.user&&(this.suppressGetSessionWarning=!0),e}async _getUser(t){try{return t?await O(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Ut}):await this._useSession(async e=>{var i,n,r;const{data:o,error:a}=e;if(a)throw a;return!(!((i=o.session)===null||i===void 0)&&i.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new gt}:await O(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&r!==void 0?r:void 0,xform:Ut})})}catch(e){if(A(e))return Ni(e)&&(await this._removeSession(),await st(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:e});throw e}}async updateUser(t,e={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(t,e))}async _updateUser(t,e={}){try{return await this._useSession(async i=>{const{data:n,error:r}=i;if(r)throw r;if(!n.session)throw new gt;const o=n.session;let a=null,l=null;this.flowType==="pkce"&&t.email!=null&&([a,l]=await Ae(this.storage,this.storageKey));const{data:c,error:h}=await O(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:e?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:Ut});if(h)throw h;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(i){if(await st(this.storage,`${this.storageKey}-code-verifier`),A(i))return this._returnResult({data:{user:null},error:i});throw i}}async setSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new gt;const e=Date.now()/1e3;let i=e,n=!0,r=null;const{payload:o}=Ks(t.access_token);if(o.exp&&(i=o.exp,n=i<=e),n){const{data:a,error:l}=await this._callRefreshToken(t.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};r=a}else{const{data:a,error:l}=await this._getUser(t.access_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});r={access_token:t.access_token,refresh_token:t.refresh_token,user:a.user,token_type:"bearer",expires_in:i-e,expires_at:i},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return this._returnResult({data:{user:r.user,session:r},error:null})}catch(e){if(A(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async e=>{var i;if(!t){const{data:o,error:a}=e;if(a)throw a;t=(i=o.session)!==null&&i!==void 0?i:void 0}if(!t?.refresh_token)throw new gt;const{data:n,error:r}=await this._callRefreshToken(t.refresh_token);return r?this._returnResult({data:{user:null,session:null},error:r}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(e){if(A(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _getSessionFromURL(t,e){try{if(!it())throw new qs("No browser detected.");if(t.error||t.error_description||t.error_code)throw new qs(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(e){case"implicit":if(this.flowType==="pkce")throw new xo("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new qs("Not a valid implicit grant flow url.");break;default:}if(e==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new xo("No code detected.");const{data:y,error:_}=await this._exchangeCodeForSession(t.code);if(_)throw _;const v=new URL(window.location.href);return v.searchParams.delete("code"),window.history.replaceState(window.history.state,"",v.toString()),{data:{session:y.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:n,access_token:r,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=t;if(!r||!a||!o||!c)throw new qs("No session defined in URL");const h=Math.round(Date.now()/1e3),u=parseInt(a);let d=h+u;l&&(d=parseInt(l));const f=d-h;f*1e3<=De&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${u}s`);const g=d-u;h-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,d,h):h-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,d,h);const{data:p,error:m}=await this._getUser(r);if(m)throw m;const b={provider_token:i,provider_refresh_token:n,access_token:r,expires_in:u,expires_at:d,refresh_token:o,token_type:c,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:b,redirectType:t.type},error:null})}catch(i){if(A(i))return this._returnResult({data:{session:null,redirectType:null},error:i});throw i}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const e=await oe(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&e)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async e=>{var i;const{data:n,error:r}=e;if(r&&!Ni(r))return this._returnResult({error:r});const o=(i=n.session)===null||i===void 0?void 0:i.access_token;if(o){const{error:a}=await this.admin.signOut(o,t);if(a&&!(rp(a)&&(a.status===404||a.status===401||a.status===403)||Ni(a)))return this._returnResult({error:a})}return t!=="others"&&(await this._removeSession(),await st(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const e=gp(),i={id:e,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this._debug("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,i),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(e)})))(),{data:{subscription:i}}}async _emitInitialSession(t){return await this._useSession(async e=>{var i,n;try{const{data:{session:r},error:o}=e;if(o)throw o;await((i=this.stateChangeEmitters.get(t))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",t,"session",r)}catch(r){await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",r),console.error(r)}})}async resetPasswordForEmail(t,e={}){let i=null,n=null;this.flowType==="pkce"&&([i,n]=await Ae(this.storage,this.storageKey,!0));try{return await O(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:i,code_challenge_method:n,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(r){if(await st(this.storage,`${this.storageKey}-code-verifier`),A(r))return this._returnResult({data:null,error:r});throw r}}async getUserIdentities(){var t;try{const{data:e,error:i}=await this.getUser();if(i)throw i;return this._returnResult({data:{identities:(t=e.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var e;try{const{data:i,error:n}=await this._useSession(async r=>{var o,a,l,c,h;const{data:u,error:d}=r;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(o=t.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=t.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await O(this.fetch,"GET",f,{headers:this.headers,jwt:(h=(c=u.session)===null||c===void 0?void 0:c.access_token)!==null&&h!==void 0?h:void 0})});if(n)throw n;return it()&&!(!((e=t.options)===null||e===void 0)&&e.skipBrowserRedirect)&&window.location.assign(i?.url),this._returnResult({data:{provider:t.provider,url:i?.url},error:null})}catch(i){if(A(i))return this._returnResult({data:{provider:t.provider,url:null},error:i});throw i}}async linkIdentityIdToken(t){return await this._useSession(async e=>{var i;try{const{error:n,data:{session:r}}=e;if(n)throw n;const{options:o,provider:a,token:l,access_token:c,nonce:h}=t,u=await O(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(i=r?.access_token)!==null&&i!==void 0?i:void 0,body:{provider:a,id_token:l,access_token:c,nonce:h,link_identity:!0,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:vt}),{data:d,error:f}=u;return f?this._returnResult({data:{user:null,session:null},error:f}):!d||!d.session||!d.user?this._returnResult({data:{user:null,session:null},error:new Te}):(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("USER_UPDATED",d.session)),this._returnResult({data:d,error:f}))}catch(n){if(await st(this.storage,`${this.storageKey}-code-verifier`),A(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}})}async unlinkIdentity(t){try{return await this._useSession(async e=>{var i,n;const{data:r,error:o}=e;if(o)throw o;return await O(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(n=(i=r.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0})})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}}async _refreshAccessToken(t){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(e,"begin");try{const i=Date.now();return await yp(async n=>(n>0&&await bp(200*Math.pow(2,n-1)),this._debug(e,"refreshing attempt",n),await O(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:vt})),(n,r)=>{const o=200*Math.pow(2,n);return r&&Bi(r)&&Date.now()+o-i<De})}catch(i){if(this._debug(e,"error",i),A(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}finally{this._debug(e,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,e){const i=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",e,"url",i),it()&&!e.skipBrowserRedirect&&window.location.assign(i),{data:{provider:t,url:i},error:null}}async _recoverAndRefresh(){var t,e;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const n=await oe(this.storage,this.storageKey);if(n&&this.userStorage){let o=await oe(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},await Ie(this.userStorage,this.storageKey+"-user",o)),n.user=(t=o?.user)!==null&&t!==void 0?t:Fi()}else if(n&&!n.user&&!n.user){const o=await oe(this.storage,this.storageKey+"-user");o&&o?.user?(n.user=o.user,await st(this.storage,this.storageKey+"-user"),await Ie(this.storage,this.storageKey,n)):n.user=Fi()}if(this._debug(i,"session from storage",n),!this._isValidSession(n)){this._debug(i,"session is not valid"),n!==null&&await this._removeSession();return}const r=((e=n.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<$i;if(this._debug(i,`session has${r?"":" not"} expired with margin of ${$i}s`),r){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),Bi(o)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(n.access_token);!a&&o?.user?(n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(i,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(i,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(i,"error",n),console.error(n);return}finally{this._debug(i,"end")}}async _callRefreshToken(t){var e,i;if(!t)throw new gt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new vi;const{data:r,error:o}=await this._refreshAccessToken(t);if(o)throw o;if(!r.session)throw new gt;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const a={data:r.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(r){if(this._debug(n,"error",r),A(r)){const o={data:null,error:r};return Bi(r)||await this._removeSession(),(e=this.refreshingDeferred)===null||e===void 0||e.resolve(o),o}throw(i=this.refreshingDeferred)===null||i===void 0||i.reject(r),r}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(t,e,i=!0){const n=`#_notifyAllSubscribers(${t})`;this._debug(n,"begin",e,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:t,session:e});const r=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(t,e)}catch(l){r.push(l)}});if(await Promise.all(o),r.length>0){for(let a=0;a<r.length;a+=1)console.error(r[a]);throw r[0]}}finally{this._debug(n,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await st(this.storage,`${this.storageKey}-code-verifier`);const e=Object.assign({},t),i=e.user&&e.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!i&&e.user&&await Ie(this.userStorage,this.storageKey+"-user",{user:e.user});const n=Object.assign({},e);delete n.user;const r=Ao(n);await Ie(this.storage,this.storageKey,r)}else{const n=Ao(e);await Ie(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await st(this.storage,this.storageKey),await st(this.storage,this.storageKey+"-code-verifier"),await st(this.storage,this.storageKey+"-user"),this.userStorage&&await st(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&it()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),De);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t);const e=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);const e=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,e&&clearTimeout(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:i}}=e;if(!i||!i.refresh_token||!i.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((i.expires_at*1e3-t)/De);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${De}ms, refresh threshold is ${dn} ticks`),n<=dn&&await this._callRefreshToken(i.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof tl)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!it()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(t){this._debug("#visibilityChangedCallback","error",t)}},window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const e=`#_onVisibilityChanged(${t})`;this._debug(e,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,e,i){const n=[`provider=${encodeURIComponent(e)}`];if(i?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),i?.scopes&&n.push(`scopes=${encodeURIComponent(i.scopes)}`),this.flowType==="pkce"){const[r,o]=await Ae(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(r)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(a.toString())}if(i?.queryParams){const r=new URLSearchParams(i.queryParams);n.push(r.toString())}return i?.skipBrowserRedirect&&n.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${t}?${n.join("&")}`}async _unenroll(t){try{return await this._useSession(async e=>{var i;const{data:n,error:r}=e;return r?this._returnResult({data:null,error:r}):await O(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token})})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}}async _enroll(t){try{return await this._useSession(async e=>{var i,n;const{data:r,error:o}=e;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:l,error:c}=await O(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(i=r?.session)===null||i===void 0?void 0:i.access_token});return c?this._returnResult({data:null,error:c}):(t.factorType==="totp"&&l.type==="totp"&&(!((n=l?.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}}async _verify(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async e=>{var i;const{data:n,error:r}=e;if(r)return this._returnResult({data:null,error:r});const o=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?Gp(t.webauthn.credential_response):Jp(t.webauthn.credential_response)})}:{code:t.code}),{data:a,error:l}=await O(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:o,headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}})}async _challenge(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async e=>{var i;const{data:n,error:r}=e;if(r)return this._returnResult({data:null,error:r});const o=await O(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:qp(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Kp(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}})}async _challengeAndVerify(t){const{data:e,error:i}=await this._challenge({factorId:t.factorId});return i?this._returnResult({data:null,error:i}):await this._verify({factorId:t.factorId,challengeId:e.id,code:t.code})}async _listFactors(){var t;const{data:{user:e},error:i}=await this.getUser();if(i)return{data:null,error:i};const n={all:[],phone:[],totp:[],webauthn:[]};for(const r of(t=e?.factors)!==null&&t!==void 0?t:[])n.all.push(r),r.status==="verified"&&n[r.factor_type].push(r);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(t){var e,i,n,r;if(t)try{const{payload:f}=Ks(t);let g=null;f.aal&&(g=f.aal);let p=g;const{data:{user:m},error:b}=await this.getUser(t);if(b)return this._returnResult({data:null,error:b});((i=(e=m?.factors)===null||e===void 0?void 0:e.filter(v=>v.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(p="aal2");const _=f.amr||[];return{data:{currentLevel:g,nextLevel:p,currentAuthenticationMethods:_},error:null}}catch(f){if(A(f))return this._returnResult({data:null,error:f});throw f}const{data:{session:o},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=Ks(o.access_token);let c=null;l.aal&&(c=l.aal);let h=c;((r=(n=o.user.factors)===null||n===void 0?void 0:n.filter(f=>f.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(h="aal2");const d=l.amr||[];return{data:{currentLevel:c,nextLevel:h,currentAuthenticationMethods:d},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async e=>{const{data:{session:i},error:n}=e;return n?this._returnResult({data:null,error:n}):i?await O(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:i.access_token,xform:r=>({data:r,error:null})}):this._returnResult({data:null,error:new gt})})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}}async _approveAuthorization(t,e){try{return await this._useSession(async i=>{const{data:{session:n},error:r}=i;if(r)return this._returnResult({data:null,error:r});if(!n)return this._returnResult({data:null,error:new gt});const o=await O(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&it()&&!e?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(i){if(A(i))return this._returnResult({data:null,error:i});throw i}}async _denyAuthorization(t,e){try{return await this._useSession(async i=>{const{data:{session:n},error:r}=i;if(r)return this._returnResult({data:null,error:r});if(!n)return this._returnResult({data:null,error:new gt});const o=await O(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&it()&&!e?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(i){if(A(i))return this._returnResult({data:null,error:i});throw i}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:e},error:i}=t;return i?this._returnResult({data:null,error:i}):e?await O(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:e.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new gt})})}catch(t){if(A(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async e=>{const{data:{session:i},error:n}=e;return n?this._returnResult({data:null,error:n}):i?(await O(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:i.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new gt})})}catch(e){if(A(e))return this._returnResult({data:null,error:e});throw e}}async fetchJwk(t,e={keys:[]}){let i=e.keys.find(a=>a.kid===t);if(i)return i;const n=Date.now();if(i=this.jwks.keys.find(a=>a.kid===t),i&&this.jwks_cached_at+ip>n)return i;const{data:r,error:o}=await O(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!r.keys||r.keys.length===0||(this.jwks=r,this.jwks_cached_at=n,i=r.keys.find(a=>a.kid===t),!i)?null:i}async getClaims(t,e={}){try{let i=t;if(!i){const{data:f,error:g}=await this.getSession();if(g||!f.session)return this._returnResult({data:null,error:g});i=f.session.access_token}const{header:n,payload:r,signature:o,raw:{header:a,payload:l}}=Ks(i);e?.allowExpired||Ep(r.exp);const c=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,e?.keys?{keys:e.keys}:e?.jwks);if(!c){const{error:f}=await this.getUser(i);if(f)throw f;return{data:{claims:r,header:n,signature:o},error:null}}const h=Tp(n.alg),u=await crypto.subtle.importKey("jwk",c,h,!0,["verify"]);if(!await crypto.subtle.verify(h,u,o,dp(`${a}.${l}`)))throw new pn("Invalid JWT signature");return{data:{claims:r,header:n,signature:o},error:null}}catch(i){if(A(i))return this._returnResult({data:null,error:i});throw i}}}xs.nextInstanceID={};const nm=xs,rm="2.95.3";let is="";typeof Deno<"u"?is="deno":typeof document<"u"?is="web":typeof navigator<"u"&&navigator.product==="ReactNative"?is="react-native":is="node";const om={"X-Client-Info":`supabase-js-${is}/${rm}`},am={headers:om},lm={schema:"public"},cm={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},hm={};function Ss(s){"@babel/helpers - typeof";return Ss=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ss(s)}function um(s,t){if(Ss(s)!="object"||!s)return s;var e=s[Symbol.toPrimitive];if(e!==void 0){var i=e.call(s,t);if(Ss(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function dm(s){var t=um(s,"string");return Ss(t)=="symbol"?t:t+""}function fm(s,t,e){return(t=dm(t))in s?Object.defineProperty(s,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[t]=e,s}function Io(s,t){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),e.push.apply(e,i)}return e}function H(s){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Io(Object(e),!0).forEach(function(i){fm(s,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):Io(Object(e)).forEach(function(i){Object.defineProperty(s,i,Object.getOwnPropertyDescriptor(e,i))})}return s}const gm=s=>s?(...t)=>s(...t):(...t)=>fetch(...t),pm=()=>Headers,mm=(s,t,e)=>{const i=gm(e),n=pm();return async(r,o)=>{var a;const l=(a=await t())!==null&&a!==void 0?a:s;let c=new n(o?.headers);return c.has("apikey")||c.set("apikey",s),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),i(r,H(H({},o),{},{headers:c}))}};function bm(s){return s.endsWith("/")?s:s+"/"}function ym(s,t){var e,i;const{db:n,auth:r,realtime:o,global:a}=s,{db:l,auth:c,realtime:h,global:u}=t,d={db:H(H({},l),n),auth:H(H({},c),r),realtime:H(H({},h),o),storage:{},global:H(H(H({},u),a),{},{headers:H(H({},(e=u?.headers)!==null&&e!==void 0?e:{}),(i=a?.headers)!==null&&i!==void 0?i:{})}),accessToken:async()=>""};return s.accessToken?d.accessToken=s.accessToken:delete d.accessToken,d}function _m(s){const t=s?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(bm(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var vm=class extends nm{constructor(s){super(s)}},wm=class{constructor(s,t,e){var i,n;this.supabaseUrl=s,this.supabaseKey=t;const r=_m(s);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",r),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",r),this.storageUrl=new URL("storage/v1",r),this.functionsUrl=new URL("functions/v1",r);const o=`sb-${r.hostname.split(".")[0]}-auth-token`,a={db:lm,realtime:hm,auth:H(H({},cm),{},{storageKey:o}),global:am},l=ym(e??{},a);if(this.storageKey=(i=l.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(n=l.global.headers)!==null&&n!==void 0?n:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(h,u)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(u)} is not possible`)}});else{var c;this.auth=this._initSupabaseAuthClient((c=l.auth)!==null&&c!==void 0?c:{},this.headers,l.global.fetch)}this.fetch=mm(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(H({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(h=>this.realtime.setAuth(h)).catch(h=>console.warn("Failed to set initial Realtime auth token:",h)),this.rest=new rg(new URL("rest/v1",r).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch,timeout:l.db.timeout,urlLengthLimit:l.db.urlLengthLimit}),this.storage=new Zg(this.storageUrl.href,this.headers,this.fetch,e?.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new Xf(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(s){return this.rest.from(s)}schema(s){return this.rest.schema(s)}rpc(s,t={},e={head:!1,get:!1,count:void 0}){return this.rest.rpc(s,t,e)}channel(s,t={config:{}}){return this.realtime.channel(s,t)}getChannels(){return this.realtime.getChannels()}removeChannel(s){return this.realtime.removeChannel(s)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var s=this,t,e;if(s.accessToken)return await s.accessToken();const{data:i}=await s.auth.getSession();return(t=(e=i.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:s.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:s,persistSession:t,detectSessionInUrl:e,storage:i,userStorage:n,storageKey:r,flowType:o,lock:a,debug:l,throwOnError:c},h,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new vm({url:this.authUrl.href,headers:H(H({},d),h),storageKey:r,autoRefreshToken:s,persistSession:t,detectSessionInUrl:e,storage:i,userStorage:n,flowType:o,lock:a,debug:l,throwOnError:c,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(s){return new xg(this.realtimeUrl.href,H(H({},s),{},{params:H(H({},{apikey:this.supabaseKey}),s?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,t)=>{this._handleTokenChanged(s,"CLIENT",t?.access_token)})}_handleTokenChanged(s,t,e){(s==="TOKEN_REFRESHED"||s==="SIGNED_IN")&&this.changedAccessToken!==e?(this.changedAccessToken=e,this.realtime.setAuth(e)):s==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const xm=(s,t,e)=>new wm(s,t,e);function Sm(){if(typeof window<"u")return!1;const s=globalThis.process;if(!s)return!1;const t=s.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Sm()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");let Z=null;function il(){return Z=xm("https://pwvudnaueupwbhfprmyg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3dnVkbmF1ZXVwd2JoZnBybXlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1ODMyNTMsImV4cCI6MjA4NjE1OTI1M30.KcER7BEPPoClh5LKpNxO6axrtAoXNDnERJOZy1jpsjE"),!0}function km(s,t){return localStorage.setItem("fg_supabase_url",s),localStorage.setItem("fg_supabase_key",t),il()}function ve(){return Z!==null}async function Em(){if(!Z)return[];const{data:s,error:t}=await Z.from("wallets").select("*").order("created_at");return t?(console.error("fetchWallets error:",t),[]):s||[]}async function Tm(s){if(!Z)return null;const{data:t,error:e}=await Z.from("wallets").insert(s).select().single();return e?(console.error("createWallet error:",e),null):t}async function Am(s){if(!Z)return[];let t=Z.from("categories").select("*").order("sort_order");const{data:e,error:i}=await t;return i?(console.error("fetchCategories error:",i),[]):e||[]}async function Om(s,t,e){if(!Z)return[];let i=Z.from("transactions").select("*, categories(name, icon)").eq("wallet_id",s).order("date",{ascending:!1}).order("created_at",{ascending:!1});t&&(i=i.gte("date",t)),e&&(i=i.lte("date",e));const{data:n,error:r}=await i;return r?(console.error("fetchTransactions error:",r),[]):n||[]}async function Cm(s){if(!Z)return null;const{data:t,error:e}=await Z.from("transactions").insert(s).select("*, categories(name, icon)").single();return e?(console.error("createTransaction error:",e),null):t}async function Pm(s){if(!Z)return[];const{data:t,error:e}=await Z.from("debts").select("*").eq("wallet_id",s).order("created_at");return e?(console.error("fetchDebts error:",e),[]):t||[]}async function Rm(s){if(!Z)return null;const{data:t,error:e}=await Z.from("debts").insert(s).select().single();return e?(console.error("createDebt error:",e),null):t}async function nl(){if(!Z)return[];const{data:s,error:t}=await Z.from("fiat_accounts").select("*").order("created_at");return t?(console.error("fetchAccounts error:",t),[]):s||[]}async function rl(){if(!Z)return null;try{const[s,t,e]=await Promise.all([Em(),Am(),nl()]);if(s.length===0)return null;const i={};return s.forEach(n=>{i[n.id]=[]}),t.forEach(n=>{i[n.wallet_id]&&i[n.wallet_id].push(n)}),{wallets:s,categories:i,accounts:e}}catch(s){return console.error("syncFromSupabase error:",s),null}}il();const ol=[{keywords:["icloud","adobe","midjourney","canva","spotify","netflix","chatgpt","openai","github","figma","notion","youtube premium","amazon prime","hbo","disney","apple music","google one","dropbox","slack","zoom","claude","copilot"],category:"Suscripciones",type:"expense"},{keywords:["uber","didi","gasolina","estacionamiento","taxi","metro","metrobs","cabify","autopista","caseta","peaje","beat"],category:"Transporte",type:"expense"},{keywords:["oxxo","walmart","soriana","mercado","super","chedraui","costco","sam's","rappi","uber eats","didi food","restaurante","comida","despensa","bodega aurrera","la comer","starbucks","caf"],category:"Comida",type:"expense"},{keywords:["farmacia","doctor","hospital","salud","dentista","medicina","consultorio","clnica","guadalajara","similares","san pablo","benavides"],category:"Salud",type:"expense"},{keywords:["cfe","telmex","izzi","totalplay","megacable","axtel","agua","gas","luz elctrica","internet","telfono","celular"],category:"Servicios",type:"expense"},{keywords:["gym","gimnasio","ropa","zara","liverpool","palacio de hierro","corte","peluquera"],category:"Personal",type:"expense"},{keywords:["veterinario","petco","mascotas","croquetas","+kota"],category:"Mascotas",type:"expense"},{keywords:["paales","huggies","beb","baby","frmula","pediatra","leche"],category:"Beb",type:"expense"},{keywords:["cuadro","mural","tattoo","tatuaje","diseo","ilustracin"],category:null,type:"income"},{keywords:["material","pintura","lienzo","canvas","pinceles","tinta"],category:"Materiales",type:"expense"},{keywords:["renta","alquiler","arrendamiento"],category:"Renta",type:"expense"}];function al(s,t=[]){if(!s)return{category:null,type:null};const e=s.toLowerCase().trim();for(const i of ol)if(i.keywords.some(r=>e.includes(r))){const r=t.find(o=>o.name.toLowerCase()===(i.category||"").toLowerCase()&&o.type===i.type);if(r)return{category:r.name,type:i.type};if(i.category)return{category:i.category,type:i.type}}return{category:null,type:null}}function Mm(s,t=[]){if(!s||s.length<2)return[];const e=s.toLowerCase(),i=new Set;return t.forEach(n=>{n.toLowerCase().includes(e)&&i.add(n)}),ol.forEach(n=>{n.keywords.forEach(r=>{r.includes(e)&&i.add(r.charAt(0).toUpperCase()+r.slice(1))})}),[...i].slice(0,5)}function Dm(s,t=[]){const e={...s};if(!e.category_name&&e.description){const i=al(e.description,t);i.category&&(e.category_name=i.category,!e.type&&i.type&&(e.type=i.type))}return e.date||(e.date=new Date().toISOString().split("T")[0]),e}const k=s=>document.getElementById(s),zi=k("walletSwitcher"),Im=k("monthLabel"),Lm=k("totalIncome"),jm=k("totalExpense"),Lo=k("totalBalance"),Wi=k("profitCard"),$m=k("profitAmount"),Nm=k("profitMargin"),jo=k("budgetFill"),Bm=k("budgetSpent"),Fm=k("budgetTotal"),Um=k("recentTransactions"),zm=k("allTransactions"),Gt=k("categoryChips"),Re=k("autoSuggest"),Mt=k("quickEntryModal"),de=k("addWalletModal"),Le=k("addDebtModal"),$o=k("debtsList"),Wm=k("accountsList"),Vm=k("settingsWallets"),Vi=k("toast");let Hi=null,Ze="all";async function Hm(){const s=tt();if(document.documentElement.setAttribute("data-theme",s.theme),fl(s.theme),ve()){const i=await rl();i&&At({wallets:i.wallets.map(n=>({id:n.id,name:n.name,emoji:n.emoji,color:n.color,wallet_type:n.wallet_type,monthly_budget:Number(n.monthly_budget)||0})),categories:Object.fromEntries(Object.entries(i.categories).map(([n,r])=>[n,r.map(o=>({id:o.id,name:o.name,icon:o.icon,type:o.type}))])),accounts:i.accounts.map(n=>({id:n.id,name:n.name,institution:n.institution||"",balance:Number(n.balance)||0,currency:n.currency||"MXN"})),activeWalletId:i.wallets[0]?.id||s.activeWalletId,supabaseConnected:!0})}No(),k("entryDate").value=new Date().toISOString().split("T")[0],mn(),await me(),Jm();const t="https://pwvudnaueupwbhfprmyg.supabase.co",e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3dnVkbmF1ZXVwd2JoZnBybXlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1ODMyNTMsImV4cCI6MjA4NjE1OTI1M30.KcER7BEPPoClh5LKpNxO6axrtAoXNDnERJOZy1jpsjE";k("supabaseUrl").value=t,k("supabaseKey").value=e,Ym(),Uf((i,n)=>{(n.has("activeWalletId")||n.has("wallets"))&&(No(),me()),n.has("currentMonth")&&(mn(),me())})}function No(){const s=tt();zi.innerHTML=s.wallets.map(e=>`
    <button class="wallet-tab ${e.id===s.activeWalletId?"active":""}" data-wallet="${e.id}">
      <span class="emoji">${e.emoji}</span>
      <span>${e.name}</span>
    </button>
  `).join("")+'<button class="wallet-tab add-wallet" id="addWalletTab">+</button>',zi.querySelectorAll(".wallet-tab:not(.add-wallet)").forEach(e=>{e.addEventListener("click",()=>{At({activeWalletId:e.dataset.wallet})})});const t=zi.querySelector(".add-wallet");t&&t.addEventListener("click",()=>je(de))}let qi=!1;async function me(){if(!qi){qi=!0;try{const s=tt(),t=Fa(),{start:e,end:i}=Hf();let n=[];ve()?(n=await Om(t.id,e,i),s.transactions=n,jn()):n=s.transactions.filter(h=>h.wallet_id===t.id&&h.date>=e&&h.date<=i);const r=n.filter(h=>h.type==="income").reduce((h,u)=>h+Number(u.amount),0),o=n.filter(h=>h.type==="expense").reduce((h,u)=>h+Number(u.amount),0),a=r-o;if(Lm.textContent=ct(r),jm.textContent=ct(o),Lo.textContent=ct(a),Lo.className=`balance-amount ${a>=0?"income":"expense"}`,t.wallet_type==="business"){Wi.classList.remove("hidden");const h=r>0?(a/r*100).toFixed(1):0;$m.textContent=ct(a),Nm.textContent=`${h}%`,Wi.className=`profit-card ${a<0?"negative":""}`}else Wi.classList.add("hidden");const l=t.monthly_budget||0;if(l>0){const h=Math.min(o/l*100,100);jo.style.width=`${h}%`,jo.className=`budget-fill ${h>90?"danger":h>70?"warning":""}`,Bm.textContent=ct(o),Fm.textContent=ct(l),k("budgetSection").classList.remove("hidden")}else k("budgetSection").classList.add("hidden");qm(n),ll(Um,n.slice(0,8)),Mt.classList.contains("active")||(zt(),hl()),cl(n),ul(),Km(),Gm()}finally{qi=!1}}}function qm(s){const t={};s.filter(o=>o.type==="expense").forEach(o=>{const a=o.categories?.name||o.category_name||"Sin categora";t[a]=(t[a]||0)+Number(o.amount)});const e=Object.keys(t),i=Object.values(t),n=["#C8B560","#6EC6A0","#E07A5F","#7BA3C9","#B88BA5","#8B9D83","#D4A853","#A3A3C9","#C9946B","#8BC99B","#C96B8B","#6BC9C9"];Hi&&Hi.destroy();const r=k("categoryChart");if(r){if(e.length===0){r.style.display="none";return}r.style.display="block",Hi=new Dn(r,{type:"doughnut",data:{labels:e,datasets:[{data:i,backgroundColor:n.slice(0,e.length),borderWidth:0,borderRadius:4,spacing:2}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"68%",plugins:{legend:{position:"bottom",labels:{padding:16,usePointStyle:!0,pointStyleWidth:8,font:{family:"'Inter', 'DM Sans', sans-serif",size:11},color:getComputedStyle(document.documentElement).getPropertyValue("--text-secondary").trim()}},tooltip:{backgroundColor:getComputedStyle(document.documentElement).getPropertyValue("--bg-card").trim(),titleColor:getComputedStyle(document.documentElement).getPropertyValue("--text").trim(),bodyColor:getComputedStyle(document.documentElement).getPropertyValue("--text-secondary").trim(),padding:12,cornerRadius:8,titleFont:{family:"'Inter', 'DM Sans', sans-serif"},bodyFont:{family:"'DM Sans', sans-serif"},callbacks:{label:o=>` ${o.label}: ${ct(o.raw)}`}}}}})}}function ll(s,t){if(t.length===0){s.innerHTML=`
      <div class="tx-empty">
        <span class="empty-icon"></span>
        <p>No hay registros este mes</p>
        <p style="margin-top:4px;font-size:0.75rem;">Toca + para agregar uno</p>
      </div>`;return}const e={};t.forEach(i=>{const n=i.date;e[n]||(e[n]=[]),e[n].push(i)}),s.innerHTML=Object.entries(e).map(([i,n])=>`
    <div class="tx-date-group">
      <div class="tx-date-header">${Kf(i)}</div>
      ${n.map(r=>{const o=r.categories?.name||r.category_name||"",a=r.categories?.icon||r.category_icon||"";return`
          <div class="tx-item" data-id="${r.id}">
            <div class="tx-icon ${r.type}">${a}</div>
            <div class="tx-info">
              <div class="tx-description">${r.description||o||"Sin descripcin"}</div>
              <div class="tx-category">${o}${r.account?"  "+r.account:""}</div>
            </div>
            <div class="tx-amount ${r.type}">
              ${r.type==="expense"?"-":"+"}${ct(r.amount)}
            </div>
          </div>`}).join("")}
    </div>
  `).join("")}function cl(s){let t=[...s];const e=k("searchTx")?.value?.toLowerCase()||"";e&&(t=t.filter(r=>(r.description||"").toLowerCase().includes(e)||(r.categories?.name||r.category_name||"").toLowerCase().includes(e))),Ze!=="all"&&(t=t.filter(r=>(r.categories?.name||r.category_name)===Ze)),ll(zm,t);const i=[...new Set(s.map(r=>r.categories?.name||r.category_name).filter(Boolean))],n=k("filterChips");n&&(n.innerHTML=`
      <button class="filter-chip ${Ze==="all"?"active":""}" data-filter="all">Todas</button>
      ${i.map(r=>`
        <button class="filter-chip ${Ze===r?"active":""}" data-filter="${r}">${r}</button>
      `).join("")}
    `,n.querySelectorAll(".filter-chip").forEach(r=>{r.addEventListener("click",()=>{Ze=r.dataset.filter,cl(s)})}))}function zt(){const s=tt(),t=document.querySelector(".type-btn.active")?.dataset.type||"expense",e=Nn(s.activeWalletId,t);Gt.innerHTML=e.map(i=>`
    <button type="button" class="category-chip" data-category="${i.name}" data-icon="${i.icon}">
      ${i.icon} ${i.name}
    </button>
  `).join(""),Gt.querySelectorAll(".category-chip").forEach(i=>{i.addEventListener("click",()=>{Gt.querySelectorAll(".category-chip").forEach(n=>n.classList.remove("active")),i.classList.add("active"),Xs()})})}function hl(){const s=tt(),t=k("entryAccount");t.innerHTML='<option value="">Seleccionar cuenta</option>'+s.accounts.map(e=>`<option value="${e.name}">${e.name}</option>`).join("")}async function ul(){const s=tt();let t=[];if(ve()?t=await Pm(s.activeWalletId):t=s.debts.filter(e=>e.wallet_id===s.activeWalletId),t.length===0){$o.innerHTML=`
      <div class="tx-empty">
        <span class="empty-icon"></span>
        <p>No hay deudas registradas</p>
      </div>`;return}$o.innerHTML=t.map(e=>{const i=e.total_amount>0?(e.paid_amount/e.total_amount*100).toFixed(1):0;return`
      <div class="debt-card">
        <div class="debt-header">
          <span class="debt-name">${e.name}</span>
          <span class="debt-status ${e.status}">${e.status==="paid"?"Pagada":"Activa"}</span>
        </div>
        <div class="debt-progress">
          <div class="debt-progress-fill" style="width: ${i}%"></div>
        </div>
        <div class="debt-details">
          <span>${ct(e.paid_amount)} / ${ct(e.total_amount)}</span>
          <span>${i}%</span>
        </div>
        ${e.monthly_payment?`<div class="debt-details" style="margin-top:4px;"><span>Pago mensual: ${ct(e.monthly_payment)}</span></div>`:""}
      </div>`}).join("")}async function Km(){let t=tt().accounts;if(ve()){const e=await nl();e.length>0&&(t=e)}Wm.innerHTML=t.map(e=>`
    <div class="account-card">
      <div class="account-icon"></div>
      <div class="account-info">
        <div class="account-name">${e.name}</div>
        <div class="account-inst">${e.institution||""}</div>
      </div>
      <div class="account-balance">${ct(e.balance||0)}</div>
    </div>
  `).join("")}function Gm(){const s=tt();Vm.innerHTML=s.wallets.map(t=>`
    <div class="settings-wallet-item">
      <div class="settings-wallet-info">
        <span>${t.emoji}</span>
        <span>${t.name}</span>
        <span style="color:var(--text-muted);font-size:0.75rem;">${t.wallet_type==="business"?"Negocio":"Personal"}</span>
      </div>
      <span style="color:var(--text-muted);font-size:0.75rem;">${ct(t.monthly_budget||0)}/mes</span>
    </div>
  `).join("")}function mn(){const s=tt();Im.textContent=qf(s.currentMonth)}function Bo(s){const t=tt(),[e,i]=t.currentMonth.split("-").map(Number),n=new Date(e,i-1+s,1);At({currentMonth:`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`}),mn()}function je(s){s.classList.add("active"),document.body.style.overflow="hidden"}function It(s){s.classList.remove("active"),document.body.style.overflow=""}function Xs(){const s=Gt.querySelector(".category-chip.active");zf({type:document.querySelector(".type-btn.active")?.dataset.type||"expense",amount:k("entryAmount").value,description:k("entryDescription").value,category:s?.dataset.category||"",categoryIcon:s?.dataset.icon||"",account:k("entryAccount").value,date:k("entryDate").value,notes:k("entryNotes").value,walletId:tt().activeWalletId}),k("draftIndicator").classList.remove("hidden")}function Jm(){const s=Wf();s&&s.walletId===tt().activeWalletId&&(k("entryAmount").value=s.amount||"",k("entryDescription").value=s.description||"",k("entryAccount").value=s.account||"",k("entryDate").value=s.date||new Date().toISOString().split("T")[0],k("entryNotes").value=s.notes||"",document.querySelectorAll(".type-btn").forEach(t=>{t.classList.toggle("active",t.dataset.type===s.type)}),zt(),setTimeout(()=>{if(s.category){const t=Gt.querySelector(`[data-category="${s.category}"]`);t&&t.classList.add("active")}},100),k("draftIndicator").classList.remove("hidden"))}function dl(){k("quickEntryForm").reset(),k("entryDate").value=new Date().toISOString().split("T")[0],Gt.querySelectorAll(".category-chip").forEach(s=>s.classList.remove("active")),document.querySelectorAll(".type-btn").forEach(s=>{s.classList.toggle("active",s.dataset.type==="expense")}),k("draftIndicator").classList.add("hidden"),$n(),zt()}function Gs(s){document.querySelectorAll(".page").forEach(e=>e.classList.remove("active"));const t=k(s);t&&t.classList.add("active"),document.querySelectorAll(".nav-item").forEach(e=>{e.classList.toggle("active",e.dataset.page===s)})}function dt(s){Vi.textContent=s,Vi.classList.add("visible"),setTimeout(()=>Vi.classList.remove("visible"),2500)}function fl(s){const t=k("themeToggle").querySelector(".icon");t.textContent=s==="dark"?"":""}function Ym(){k("themeToggle").addEventListener("click",()=>{const t=tt().theme==="dark"?"light":"dark";At({theme:t}),document.documentElement.setAttribute("data-theme",t),fl(t),document.querySelector('meta[name="theme-color"]').setAttribute("content",t==="dark"?"#111110":"#FAF8F5"),me()}),k("prevMonth").addEventListener("click",()=>Bo(-1)),k("nextMonth").addEventListener("click",()=>Bo(1)),k("fabAdd").addEventListener("click",()=>{zt(),hl(),je(Mt),k("entryAmount").focus()}),k("closeModal").addEventListener("click",()=>It(Mt)),Mt.addEventListener("click",s=>{s.target===Mt&&It(Mt)}),document.querySelectorAll(".close-wallet-modal").forEach(s=>{s.addEventListener("click",()=>It(de))}),de.addEventListener("click",s=>{s.target===de&&It(de)}),document.querySelectorAll(".close-debt-modal").forEach(s=>{s.addEventListener("click",()=>It(Le))}),Le.addEventListener("click",s=>{s.target===Le&&It(Le)}),document.querySelectorAll(".type-btn").forEach(s=>{s.addEventListener("click",()=>{document.querySelectorAll(".type-btn").forEach(t=>t.classList.remove("active")),s.classList.add("active"),zt(),Xs()})}),k("entryDescription").addEventListener("input",s=>{const t=s.target.value,e=tt(),i=document.querySelector(".type-btn.active")?.dataset.type||"expense",n=Nn(e.activeWalletId,i),r=Mm(t,e.transactions.map(o=>o.description).filter(Boolean));r.length>0?(Re.innerHTML=r.map(o=>`
        <div class="auto-suggest-item">${o}</div>
      `).join(""),Re.classList.add("visible"),Re.querySelectorAll(".auto-suggest-item").forEach(o=>{o.addEventListener("click",()=>{k("entryDescription").value=o.textContent,Re.classList.remove("visible"),Fo(o.textContent,n)})})):Re.classList.remove("visible"),Fo(t,n),Xs()}),k("entryDescription").addEventListener("blur",()=>{setTimeout(()=>Re.classList.remove("visible"),200)}),["entryAmount","entryAccount","entryDate","entryNotes"].forEach(s=>{k(s)?.addEventListener("input",Xs)}),k("clearDraft")?.addEventListener("click",()=>{dl(),dt("Borrador descartado")}),k("quickEntryForm").addEventListener("submit",async s=>{s.preventDefault(),await Xm()}),document.querySelectorAll(".nav-item[data-page]").forEach(s=>{s.addEventListener("click",()=>Gs(s.dataset.page))}),k("viewAllTx")?.addEventListener("click",()=>Gs("pageTransactions")),k("backFromTx")?.addEventListener("click",()=>Gs("pageDashboard")),k("searchTx")?.addEventListener("input",()=>me()),k("addWalletForm").addEventListener("submit",async s=>{s.preventDefault(),await Zm()}),k("addWalletBtn")?.addEventListener("click",()=>je(de)),k("addDebtBtn")?.addEventListener("click",()=>je(Le)),k("addDebtForm").addEventListener("submit",async s=>{s.preventDefault(),await Qm()}),k("saveSupabase")?.addEventListener("click",()=>{const s=k("supabaseUrl").value.trim(),t=k("supabaseKey").value.trim();s&&t&&(km(s,t)?(At({supabaseConnected:!0}),dt(" Supabase conectado"),me()):dt(" Error de conexin"))}),k("exportCSV")?.addEventListener("click",tb),k("clearDrafts")?.addEventListener("click",()=>{$n(),dt("Borradores eliminados")}),k("qaExpense")?.addEventListener("click",()=>{zt(),document.querySelectorAll(".type-btn").forEach(s=>s.classList.remove("active")),document.querySelector('.type-btn[data-type="expense"]')?.classList.add("active"),zt(),je(Mt),k("entryAmount").focus()}),k("qaIncome")?.addEventListener("click",()=>{document.querySelectorAll(".type-btn").forEach(s=>s.classList.remove("active")),document.querySelector('.type-btn[data-type="income"]')?.classList.add("active"),zt(),je(Mt),k("entryAmount").focus()}),k("qaTransactions")?.addEventListener("click",()=>{Gs("pageTransactions")})}function Fo(s,t){const e=al(s,t);e.category&&Gt.querySelectorAll(".category-chip").forEach(i=>{i.classList.toggle("active",i.dataset.category===e.category)})}async function Xm(){const s=tt(),t=document.querySelector(".type-btn.active")?.dataset.type||"expense",e=parseFloat(k("entryAmount").value),i=k("entryDescription").value.trim(),n=Gt.querySelector(".category-chip.active"),r=n?.dataset.category||"",o=n?.dataset.icon||"",a=k("entryAccount").value,l=k("entryDate").value,c=k("entryNotes").value.trim();if(!e||e<=0){dt("Ingresa un monto vlido");return}const h=k("submitEntry");h.querySelector(".btn-text").classList.add("hidden"),h.querySelector(".btn-loading").classList.remove("hidden"),h.disabled=!0;const u={wallet_id:s.activeWalletId,type:t,amount:e,description:i||r,date:l||new Date().toISOString().split("T")[0],account:a,notes:c,created_at:new Date().toISOString()},f=(s.categories[s.activeWalletId]||[]).find(p=>p.name===r);f?.id&&(u.category_id=f.id);const g=Dm(u,Nn(s.activeWalletId));if(Object.assign(u,g),ve()){const{created_at:p,category_name:m,category_icon:b,...y}=u,_=await Cm(y);if(_)s.transactions=[_,...s.transactions],jn(),dt(`${t==="income"?"":""} ${ct(e)} registrado`);else{u.id=crypto.randomUUID(),u.category_name=r,u.category_icon=o;const v=[u,...s.transactions];At({transactions:v}),dt(" Guardado localmente (error Supabase)")}}else{u.id=crypto.randomUUID(),u.category_name=r,u.category_icon=o;const p=[u,...s.transactions];At({transactions:p}),dt(`${t==="income"?"":""} ${ct(e)} registrado`)}$n(),dl(),It(Mt),h.querySelector(".btn-text").classList.remove("hidden"),h.querySelector(".btn-loading").classList.add("hidden"),h.disabled=!1,me()}async function Zm(){const s=k("walletName").value.trim(),t=k("walletEmoji").value.trim()||"",e=k("walletType").value,i=parseFloat(k("walletBudget").value)||0;if(!s){dt("Ingresa un nombre");return}const n={name:s,emoji:t,wallet_type:e,monthly_budget:i,color:"#C8B560"};if(ve()){if(await Tm(n)){const o=await rl();o&&At({wallets:o.wallets.map(a=>({id:a.id,name:a.name,emoji:a.emoji,color:a.color,wallet_type:a.wallet_type,monthly_budget:Number(a.monthly_budget)||0})),categories:Object.fromEntries(Object.entries(o.categories).map(([a,l])=>[a,l.map(c=>({id:c.id,name:c.name,icon:c.icon,type:c.type}))]))})}}else{n.id=s.toLowerCase().replace(/\s+/g,"-");const r=tt();At({wallets:[...r.wallets,n],categories:{...r.categories,[n.id]:e==="business"?[{name:"Ingresos",icon:"",type:"income"},{name:"Gastos",icon:"",type:"expense"}]:[{name:"General",icon:"",type:"expense"},{name:"Ingreso",icon:"",type:"income"}]}})}k("addWalletForm").reset(),It(de),dt(`${t} ${s} creada`)}async function Qm(){const s=tt(),t={id:crypto.randomUUID(),wallet_id:s.activeWalletId,name:k("debtName").value.trim(),total_amount:parseFloat(k("debtTotal").value)||0,paid_amount:parseFloat(k("debtPaid").value)||0,monthly_payment:parseFloat(k("debtMonthly").value)||0,interest_rate:parseFloat(k("debtInterest").value)||0,due_date:k("debtDueDate").value||null,status:"active",notes:k("debtNotes").value.trim(),created_at:new Date().toISOString()};if(!t.name||!t.total_amount){dt("Completa nombre y monto");return}if(At({debts:[...s.debts,t]}),ve()){const{id:e,...i}=t;await Rm(i)}k("addDebtForm").reset(),It(Le),dt(" Deuda registrada"),ul()}function tb(){const s=tt(),t=Fa(),e=s.transactions.filter(c=>c.wallet_id===t.id);if(e.length===0){dt("No hay datos para exportar");return}const i=["Fecha","Tipo","Categora","Descripcin","Monto","Cuenta","Notas"],n=e.map(c=>[c.date,c.type==="income"?"Ingreso":"Gasto",c.category_name||"",c.description||"",c.amount,c.account||"",c.notes||""]),r=[i,...n].map(c=>c.map(h=>`"${h}"`).join(",")).join(`
`),o=new Blob(["\uFEFF"+r],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(o),l=document.createElement("a");l.href=a,l.download=`fg_${t.name}_${s.currentMonth}.csv`,l.click(),URL.revokeObjectURL(a),dt(" CSV exportado")}document.addEventListener("DOMContentLoaded",Hm);
